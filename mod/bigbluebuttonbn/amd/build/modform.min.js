define("mod_bigbluebuttonbn/modform",["exports","core/str","core/notification","core/templates"],(function(_exports,_str,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);var ELEMENT_SELECTOR_instanceTypeSelection=function(){return document.querySelector("select#id_type")},ELEMENT_SELECTOR_instanceTypeProfiles=function(){return document.querySelector("[data-profile-types]")},ELEMENT_SELECTOR_participantData=function(){return document.querySelector("[data-participant-data]")},ELEMENT_SELECTOR_participantList=function(){return document.getElementsByName("participants")[0]},ELEMENT_SELECTOR_participantTable=function(){return document.getElementById("participant_list_table")},ELEMENT_SELECTOR_participantSelectionType=function(){return document.getElementsByName("bigbluebuttonbn_participant_selection_type")[0]},ELEMENT_SELECTOR_participantSelection=function(){return document.getElementsByName("bigbluebuttonbn_participant_selection")[0]},ELEMENT_SELECTOR_participantAddButton=function(){return document.getElementsByName("bigbluebuttonbn_participant_selection_add")[0]};_exports.init=function(info){var selectedType=ELEMENT_SELECTOR_instanceTypeSelection(),instanceTypeProfiles=JSON.parse(ELEMENT_SELECTOR_instanceTypeProfiles().dataset.profileTypes),profileType=info.instanceTypeDefault;null!==selectedType&&-1!==selectedType.selectedIndex&&(profileType=selectedType.options[selectedType.selectedIndex].value);var isFeatureEnabled=function(profileType,feature){return-1!==instanceTypeProfiles[profileType].features.indexOf(feature)};applyInstanceTypeProfile(profileType,isFeatureEnabled),selectedType.addEventListener("change",(function(e){applyInstanceTypeProfile(e.target.value,isFeatureEnabled)})),ELEMENT_SELECTOR_participantSelectionType().addEventListener("change",(function(e){var currentTypeSelect=e.target;updateSelectionFromType(currentTypeSelect)})),ELEMENT_SELECTOR_participantAddButton().addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),participantAddFromCurrentSelection()})),participantListInit()};var fn,_ref,applyInstanceTypeProfile=function(profileType,isFeatureEnabled){var showAll=isFeatureEnabled(profileType,"all"),showFieldset=function(id,show){var node=document.querySelector("#"+id);node&&(node.style.display=show?"block":"none")},showInput=function(id,show){var node=document.querySelector("#"+id);if(node){var ancestor=node.closest("div").closest("div");ancestor.style.display=show?"block":"none"}},showFormGroup=function(id,show){var node=document.querySelector("#fgroup_id_"+id);node&&(show?node.classList.remove("hidden"):node.classList.add("hidden"))};showFieldset("id_room",showAll||isFeatureEnabled(profileType,"showroom")),showInput("id_record",showAll||isFeatureEnabled(profileType,"showroom")),showFieldset("id_recordings",showAll||isFeatureEnabled(profileType,"showrecordings")),showInput("id_recordings_imported",showAll||isFeatureEnabled(profileType,"showrecordings")),showFieldset("id_preuploadpresentation",showAll||isFeatureEnabled(profileType,"preuploadpresentation")),showFieldset("id_permissions",showAll||isFeatureEnabled(profileType,"permissions")),showFieldset("id_schedule",showAll||isFeatureEnabled(profileType,"schedule")),showFieldset("id_modstandardelshdr",showAll||isFeatureEnabled(profileType,"modstandardelshdr")),showFieldset("id_availabilityconditionsheader",showAll||isFeatureEnabled(profileType,"availabilityconditionsheader")),showFieldset("id_tagshdr",showAll||isFeatureEnabled(profileType,"tagshdr")),showFieldset("id_competenciessection",showAll||isFeatureEnabled(profileType,"competenciessection")),showFormGroup("completionattendancegroup",showAll||isFeatureEnabled(profileType,"completionattendance")),showFormGroup("completionengagementgroup",showAll||isFeatureEnabled(profileType,"completionengagement"))},participantListInit=function(){var participantData=JSON.parse(ELEMENT_SELECTOR_participantData().dataset.participantData);getParticipantList().forEach((function(participant){var selectionTypeValue=participant.selectiontype,selectionValue=participant.selectionid,selectionRole=participant.role;"all"!==participant.selectiontype&&void 0===participantData[participant.selectiontype].children[participant.selectionid]||participantAddToForm(selectionTypeValue,selectionValue,selectionRole,!0).then()}))},participantAddToForm=(fn=regeneratorRuntime.mark((function _callee(selectionTypeValue,selectionValue,selectedRole,canRemove){var participantData,sviewer,smoderator,roles,listTable,templateContext,_yield$Templates$rend,html,js,newNode,removeNode;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return participantData=JSON.parse(ELEMENT_SELECTOR_participantData().dataset.participantData),_context.next=3,(0,_str.get_string)("mod_form_field_participant_bbb_role_viewer","mod_bigbluebuttonbn");case 3:return sviewer=_context.sent,_context.next=6,(0,_str.get_string)("mod_form_field_participant_bbb_role_moderator","mod_bigbluebuttonbn");case 6:return smoderator=_context.sent,(roles={viewer:{id:"viewer",label:sviewer},moderator:{id:"moderator",label:smoderator}})[selectedRole].isselected=!0,_context.prev=9,listTable=document.querySelector("#participant_list_table tbody"),templateContext={selectiontypevalue:selectionTypeValue,selectionvalue:selectionValue,participanttype:participantData[selectionTypeValue].name,participantvalue:"all"!==selectionTypeValue?participantData[selectionTypeValue].children[selectionValue].name:null,roles:Object.values(roles),canRemove:canRemove},_context.next=14,_templates.default.renderForPromise("mod_bigbluebuttonbn/participant_form_add",templateContext);case 14:_yield$Templates$rend=_context.sent,html=_yield$Templates$rend.html,js=_yield$Templates$rend.js,(newNode=_templates.default.appendNodeContents(listTable,html,js)[0]).querySelector(".participant-select").addEventListener("change",(function(){participantListRoleUpdate(selectionTypeValue,selectionValue)})),(removeNode=newNode.querySelector(".remove-button"))&&removeNode.addEventListener("click",(function(){participantRemove(selectionTypeValue,selectionValue)})),_context.next=26;break;case 23:_context.prev=23,_context.t0=_context.catch(9),_notification.default.exception(_context.t0);case 26:case"end":return _context.stop()}}),_callee,null,[[9,23]])})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3,_x4){return _ref.apply(this,arguments)}),participantListUpdate=function(list){ELEMENT_SELECTOR_participantList().value=JSON.stringify(list)},getParticipantList=function(){var participantListValue=ELEMENT_SELECTOR_participantList().value;return participantListValue?JSON.parse(participantListValue):[]},participantRemove=function(selectionTypeValue,selectionValue){for(var pList=getParticipantList(),id="participant_list_tr_"+selectionTypeValue+"-"+selectionValue,participantListTable=ELEMENT_SELECTOR_participantTable(),selectionid=""===selectionValue?null:selectionValue,i=0;i<pList.length;i++)pList[i].selectiontype===selectionTypeValue&&pList[i].selectionid===selectionid&&pList.splice(i,1);for(var _i=0;_i<participantListTable.rows.length;_i++)participantListTable.rows[_i].id===id&&participantListTable.deleteRow(_i);participantListUpdate(pList)},participantListRoleUpdate=function(type,id){for(var participantListRoleSelection=document.querySelector("#participant_list_tr_".concat(type,"-").concat(id," .participant-select")),pList=getParticipantList(),i=0;i<pList.length;i++)pList[i].selectiontype===type&&pList[i].selectionid===id&&(pList[i].role=participantListRoleSelection.value);participantListUpdate(pList)},participantAddFromCurrentSelection=function(){for(var selectionType=ELEMENT_SELECTOR_participantSelectionType(),selection=ELEMENT_SELECTOR_participantSelection(),pList=getParticipantList(),i=0;i<pList.length;i++)if(pList[i].selectiontype===selectionType.value&&pList[i].selectionid===selection.value)return;pList.push({selectiontype:selectionType.value,selectionid:selection.value,role:"viewer"}),participantAddToForm(selectionType.value,selection.value,"viewer",!0).then(),participantListUpdate(pList)},updateSelectionFromType=function(currentTypeSelect){for(var createNewOption=function(selectItem,label,value){var option=document.createElement("option");option.text=label,option.value=value,selectItem.add(option)},participantData=JSON.parse(ELEMENT_SELECTOR_participantData().dataset.participantData),participantSelect=ELEMENT_SELECTOR_participantSelection();participantSelect.firstChild;)participantSelect.removeChild(participantSelect.firstChild);-1!==currentTypeSelect.selectedIndex&&(Object.values(participantData[currentTypeSelect.value].children).forEach((function(option){createNewOption(participantSelect,option.name,option.id)})),"all"===currentTypeSelect.value?(createNewOption(participantSelect,"---------------","all"),participantSelect.disabled=!0):participantSelect.disabled=!1)}}));

//# sourceMappingURL=modform.min.js.map