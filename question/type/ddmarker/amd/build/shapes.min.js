define ("qtype_ddmarker/shapes",function(){"use strict";function a(a,b){this.x=a;this.y=b}a.prototype.toString=function(){return this.x+","+this.y};a.prototype.move=function(a,b){this.x+=a;this.y+=b};a.prototype.offset=function(b,c){if(b instanceof a){c=b.y;b=b.x}return new a(this.x+b,this.y+c)};a.parse=function(b){var c=b.split(",");if(2!==c.length){throw new Error(b+" is not a valid point")}return new a(Math.round(c[0]),Math.round(c[1]))};function b(b,c,d){this.label=b;this.centre=new a(c||0,d||0)}b.prototype.getType=function(){throw new Error("Not implemented.")};b.prototype.getCoordinates=function(){throw new Error("Not implemented.")};b.prototype.parse=function(){throw new Error("Not implemented.")};b.prototype.move=function(){};b.prototype.edit=function(){};b.prototype.normalizeShape=function(){};b.prototype.makeSvg=function(){throw new Error("Not implemented.")};b.prototype.updateSvg=function(){};b.prototype.makeSimilarCircle=function(){throw new Error("Not implemented.")};b.prototype.makeSimilarRectangle=function(){throw new Error("Not implemented.")};b.prototype.makeSimilarPolygon=function(){throw new Error("Not implemented.")};b.prototype.getHandlePositions=function(){return null};function c(a,c,d,e){c=c||15;d=d||15;b.call(this,a,c,d);this.radius=e||15}c.prototype=new b;c.prototype.getType=function(){return"circle"};c.prototype.getCoordinates=function(){return this.centre+";"+Math.abs(this.radius)};c.prototype.makeSvg=function(a){var b=h(a,"circle");this.updateSvg(b);return b};c.prototype.updateSvg=function(a){a.childNodes[0].setAttribute("cx",this.centre.x);a.childNodes[0].setAttribute("cy",this.centre.y);a.childNodes[0].setAttribute("r",Math.abs(this.radius));a.childNodes[1].setAttribute("x",this.centre.x);a.childNodes[1].setAttribute("y",this.centre.y+15);a.childNodes[1].textContent=this.label};c.prototype.parse=function(b){if(!b.match(/^\d+,\d+;\d+$/)){return!1}var c=b.split(";");this.centre=a.parse(c[0]);this.radius=Math.round(c[1]);return!0};c.prototype.move=function(a,b,c,d){this.centre.move(a,b);if(this.centre.x<this.radius){this.centre.x=this.radius}if(this.centre.x>c-this.radius){this.centre.x=c-this.radius}if(this.centre.y<this.radius){this.centre.y=this.radius}if(this.centre.y>d-this.radius){this.centre.y=d-this.radius}};c.prototype.edit=function(a,b,c,d,e){this.radius+=b;var f=Math.min(this.centre.x,this.centre.y,d-this.centre.x,e-this.centre.y);if(this.radius>f){this.radius=f}if(this.radius<-f){this.radius=-f}};c.prototype.normalizeShape=function(){this.radius=Math.abs(this.radius)};c.prototype.makeSimilarRectangle=function(){return new d(this.label,this.centre.x-this.radius,this.centre.y-this.radius,2*this.radius,2*this.radius)};c.prototype.makeSimilarPolygon=function(){return new e(this.label,[this.centre.offset(-this.radius,-this.radius),this.centre.offset(-this.radius,this.radius),this.centre.offset(this.radius,this.radius),this.centre.offset(this.radius,-this.radius)])};c.prototype.getHandlePositions=function(){return{moveHandle:this.centre,editHandles:[this.centre.offset(this.radius,0)]}};function d(a,c,d,e,f){b.call(this,a,c,d);this.width=e||30;this.height=f||30}d.prototype=new b;d.prototype.getType=function(){return"rectangle"};d.prototype.getCoordinates=function(){return this.centre+";"+this.width+","+this.height};d.prototype.makeSvg=function(a){var b=h(a,"rect");this.updateSvg(b);return b};d.prototype.updateSvg=function(a){if(0<=this.width){a.childNodes[0].setAttribute("x",this.centre.x);a.childNodes[0].setAttribute("width",this.width)}else{a.childNodes[0].setAttribute("x",this.centre.x+this.width);a.childNodes[0].setAttribute("width",-this.width)}if(0<=this.height){a.childNodes[0].setAttribute("y",this.centre.y);a.childNodes[0].setAttribute("height",this.height)}else{a.childNodes[0].setAttribute("y",this.centre.y+this.height);a.childNodes[0].setAttribute("height",-this.height)}a.childNodes[1].setAttribute("x",this.centre.x+this.width/2);a.childNodes[1].setAttribute("y",this.centre.y+this.height/2+15);a.childNodes[1].textContent=this.label};d.prototype.parse=function(b){if(!b.match(/^\d+,\d+;\d+,\d+$/)){return!1}var c=b.split(";");this.centre=a.parse(c[0]);var d=a.parse(c[1]);this.width=d.x;this.height=d.y;return!0};d.prototype.move=function(a,b,c,d){this.centre.move(a,b);if(0>this.centre.x){this.centre.x=0}if(this.centre.x>c-this.width){this.centre.x=c-this.width}if(0>this.centre.y){this.centre.y=0}if(this.centre.y>d-this.height){this.centre.y=d-this.height}};d.prototype.edit=function(a,b,c,d,e){this.width+=b;this.height+=c;if(this.width<-this.centre.x){this.width=-this.centre.x}if(this.width>d-this.centre.x){this.width=d-this.centre.x}if(this.height<-this.centre.y){this.height=-this.centre.y}if(this.height>e-this.centre.y){this.height=e-this.centre.y}};d.prototype.normalizeShape=function(){if(0>this.width){this.centre.x+=this.width;this.width=-this.width}if(0>this.height){this.centre.y+=this.height;this.height=-this.height}};d.prototype.makeSimilarCircle=function(){return new c(this.label,Math.round(this.centre.x+this.width/2),Math.round(this.centre.y+this.height/2),Math.round((this.width+this.height)/4))};d.prototype.makeSimilarPolygon=function(){return new e(this.label,[this.centre,this.centre.offset(0,this.height),this.centre.offset(this.width,this.height),this.centre.offset(this.width,0)])};d.prototype.getHandlePositions=function(){return{moveHandle:this.centre.offset(this.width/2,this.height/2),editHandles:[this.centre.offset(this.width,this.height)]}};function e(c,d){b.call(this,c,0,0);this.points=d?d.slice():[new a(10,10),new a(40,10),new a(10,40)];this.normalizeShape()}e.prototype=new b;e.prototype.getType=function(){return"polygon"};e.prototype.getCoordinates=function(){for(var a="",b=0;b<this.points.length;b++){a+=this.centre.offset(this.points[b])+";"}return a.slice(0,a.length-1)};e.prototype.makeSvg=function(a){var b=h(a,"polygon");this.updateSvg(b);return b};e.prototype.updateSvg=function(a){a.childNodes[0].setAttribute("points",this.getCoordinates().replace(/[,;]/g," "));a.childNodes[1].setAttribute("x",this.centre.x);a.childNodes[1].setAttribute("y",this.centre.y+15);a.childNodes[1].textContent=this.label};e.prototype.parse=function(b){if(!b.match(/^\d+,\d+(?:;\d+,\d+)*$/)){return!1}for(var c=b.split(";"),d=[],e=0;e<c.length;e++){d.push(a.parse(c[e]))}this.points=d;this.centre.x=0;this.centre.y=0;this.normalizeShape();return!0};e.prototype.move=function(a,b,c,d){this.centre.move(a,b);for(var e=c,f=0,g=d,h=0,j=0;j<this.points.length;j++){e=Math.min(e,this.points[j].x);f=Math.max(f,this.points[j].x);g=Math.min(g,this.points[j].y);h=Math.max(h,this.points[j].y)}if(this.centre.x<-e){this.centre.x=-e}if(this.centre.x>c-f){this.centre.x=c-f}if(this.centre.y<-g){this.centre.y=-g}if(this.centre.y>d-h){this.centre.y=d-h}};e.prototype.edit=function(a,b,c,d,e){this.points[a].move(b,c);if(this.points[a].x<-this.centre.x){this.points[a].x=-this.centre.x}if(this.points[a].x>d-this.centre.x){this.points[a].x=d-this.centre.x}if(this.points[a].y<-this.centre.y){this.points[a].y=-this.centre.y}if(this.points[a].y>e-this.centre.y){this.points[a].y=e-this.centre.y}};e.prototype.addNewPointAfter=function(b){this.points.splice(b,0,new a(this.points[b].x,this.points[b].y))};e.prototype.normalizeShape=function(){var a,b=0,c=0;if(0===this.points.length){return}for(a=0;a<this.points.length;a++){b+=this.points[a].x;c+=this.points[a].y}b=Math.round(b/this.points.length);c=Math.round(c/this.points.length);if(0===b&&0===c){return}for(a=0;a<this.points.length;a++){this.points[a].move(-b,-c)}this.centre.move(b,c)};e.prototype.makeSimilarCircle=function(){return this.makeSimilarRectangle().makeSimilarCircle()};e.prototype.makeSimilarRectangle=function(){for(var a,b=0,c=0,e=0,f=0,g=0;g<this.points.length;g++){a=this.points[g];b=Math.min(b,a.x);c=Math.max(c,a.x);e=Math.min(e,a.y);f=Math.max(f,a.y)}return new d(this.label,this.centre.x+b,this.centre.y+e,Math.max(c-b,10),Math.max(f-e,10))};e.prototype.getHandlePositions=function(){for(var a=[],b=0;b<this.points.length;b++){a.push(this.points[b].offset(this.centre.x,this.centre.y))}return{moveHandle:this.centre,editHandles:a}};function f(a){b.call(this,a)}f.prototype=new b;f.prototype.getType=function(){return"null"};f.prototype.getCoordinates=function(){return""};f.prototype.makeSvg=function(){return null};f.prototype.updateSvg=function(){};f.prototype.parse=function(){return!1};f.prototype.makeSimilarCircle=function(){return new c(this.label)};f.prototype.makeSimilarRectangle=function(){return new d(this.label)};f.prototype.makeSimilarPolygon=function(){return new e(this.label)};function g(a,b){var c=a.ownerDocument.createElementNS("http://www.w3.org/2000/svg",b);a.appendChild(c);return c}function h(a,b){var c=g(a,"g");g(c,b).setAttribute("class","shape");g(c,"text").setAttribute("class","shapeLabel");return c}return{Point:a,Shape:b,Circle:c,Rectangle:d,Polygon:e,NullShape:f,createSvgElement:g,make:function make(a,b){switch(a){case"circle":return new c(b);case"rectangle":return new d(b);case"polygon":return new e(b);default:return new f(b);}},getSimilar:function getSimilar(a,b){if(a===b.getType()){return b}switch(a){case"circle":return b.makeSimilarCircle();case"rectangle":return b.makeSimilarRectangle();case"polygon":return b.makeSimilarPolygon();default:return new f(b.label);}}}});
//# sourceMappingURL=shapes.min.js.map
