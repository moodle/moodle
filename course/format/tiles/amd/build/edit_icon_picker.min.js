function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("format_tiles/edit_icon_picker",["jquery","core/templates","core/ajax","core/str","core/notification","core/config"],function(a,b,c,d,e,f){"use strict";var g,h={pickAnIcon:""},i=[],j=[],k=function(b,d){var e=c.call([{methodname:"format_tiles_get_icon_set",args:{courseid:b}}]);e[0].done(function(b){if(b.photos){j=JSON.parse(b.photos)}var c=JSON.parse(b.icons);Object.keys(c).forEach(function(a){i.push({filename:a,displayname:c[a]})});if(0>=i.length){require(["core/log"],function(a){a.error("Error empty icon set");a.debug(b)})}if("function"==typeof d){d()}var e=j.map(function(a){return a.filename});a("#iconpickerphotos").find(".photo").each(function(b,c){c=a(c);if(-1===e.indexOf(c.attr("data-filename"))){c.fadeOut(500)}});if(!0!==b.status){require(["core/log"],function(a){a.error("Non true status response when getting icon set");a.debug(b)})}});e[0].fail(function(a){require(["core/log"],function(b){b.error("Fail when getting icon set");b.debug(a)})})},l=function(a,b){return f.wwwroot+"/course/format/tiles/editimage.php?courseid="+a+"&sectionid="+b},m=function(f,g,h,i,j,m,n,o,p){var q=a("#selectedicon"),r=function(c,d,e){var i="",n={tileicon:h,tileid:g,secid:f,isediting:1};switch(e){case"tileicon":i="tileicon";break;case"tilephoto":i="tilebarphoto";n.phototileurl=d;n.phototileediturl=l(m,f);n.iamgetype=e;c.closest(".tileiconcontainer").addClass("hasphoto");setTimeout(function(){k(m)},3e3);break;case"draftfile":i="tilebarphoto";n.phototileurl=d;n.phototileediturl=l(m,f);n.iamgetype=e;break;default:throw new Error("Invalid image type "+e);}var o="course-view-tiles"===j?c:q;o.animate({opacity:0},500,function(){b.render("format_tiles/"+i,n).done(function(a){o.html(a).animate({opacity:1},500)})});if("course-editsection"===j&&"tilephoto"===e){a("input[name=tilephoto]").val(h)}},s={image:h,courseid:m,sectionid:f,imagetype:n,sourcecontextid:o===void 0?0:o,sourceitemid:p===void 0?0:p},t=c.call([{methodname:"format_tiles_set_image",args:s}]);t[0].done(function(c){if(!0===c.status){if("course-view-tiles"===j){r(a("#tileicon_"+g),c.imageurl,n)}else if("course-edit"===j||"course-editsection"===j){var f=a("#id_defaulttileicon");if("course-editsection"===j){f=a("#id_tileicon")}f.val(h);if("tileicon"===n){b.renderPix("tileicon/"+h,"format_tiles",i).done(function(a){q.html(a);if("course-editsection"===j){d.get_strings([{key:"tip",component:"format_tiles"},{key:"tileselecttip",component:"format_tiles"}]).done(function(a){e.alert(a[0],a[1])})}});if("course-editsection"===j){a("input[name=tilephoto]").val("")}}else if("tilephoto"===n){r(a("#tileicon_"+g),c.imageurl,n)}}}}).fail(function(a){require(["core/log"],function(b){b.error("Fail setting icon");b.debug(a)})})},n=function(c,d,n,o,p,q){var r=function(b,f,g){var h=a("#iconpickerphotos");h.html(b);var i=[];h.find("img").each(function(b,e){e=a(e);if(e.attr("data-filesize")<200000){setTimeout(function(){e.attr("src",e.attr("data-url"))},20*b)}else{i.push(e)}e.click(function(b){var e=a(b.currentTarget);m(f.attr("data-true-sectionid"),f.attr("data-section"),e.attr("data-filename"),e.attr("data-filename"),c,d,e.attr("data-imagetype"),e.attr("data-contextid"),e.attr("data-itemid"));g.hide()})});setTimeout(function(){i.forEach(function(a){a.attr("src",a.attr("data-url"))})},1e3)};if("object"!==_typeof(g)){var s=function(){b.render("format_tiles/icon_picker_modal_body",{icon_picker_icons:i,photosallowed:p,wwwroot:f.wwwroot,documentationurl:q}).done(function(e){require(["core/modal_factory"],function(i){i.create({type:i.types.DEFAULT,title:h.pickAnIcon,body:e}).done(function(h){g=h;h.setLarge();h.show();var i=a(h.root);i.attr("id","icon_picker_modal");i.attr("data-true-sectionid",n);i.attr("data-section",o);i.addClass("icon_picker_modal");i.on("click",".pickericon",function(b){var e=a(b.currentTarget);m(n,o,e.attr("data-icon"),e.attr("title"),c,d,"tileicon",e.attr("data-contextid"),e.attr("data-itemid"));h.hide()});i.on("input","input.iconsearch",function(b){var c=b.currentTarget.value.toLowerCase();i.find(".pickericon").show();if(3<=c.length){i.find(".pickericon").filter(function(b,d){return 0>a(d).attr("data-original-title").toLowerCase().indexOf(c)}).hide()}});try{var q=a(".pickericon");if("function"==typeof q.tooltip){q.tooltip()}}catch(a){require(["core/log"],function(b){b.debug(a)})}if(p){var k=l(d,n);i.find("#phototilebtn").attr("href",k);a("#launch-photo-library").click(function(){if(0!==j.length){b.render("format_tiles/icon_picker_photos",{icon_picker_photos:j,wwwroot:f.wwwroot}).done(function(a){r(a,i,h)})}})}})})})};if(0>=i.length){k(d,s)}else{s()}}else{g.root.attr("data-true-sectionid",n);g.root.attr("data-section",o);g.root.off("click");g.root.on("click",".pickericon",function(b){var e=a(b.currentTarget);m(n,o,e.attr("data-icon"),e.attr("title"),c,d,e.attr("data-imagetype"),e.attr("data-contextid"),e.attr("data-itemid"));g.hide()});if(p){var t=l(d,n);g.root.find("#phototilebtn").attr("href",t)}g.show()}};return{init:function init(b,c,f,g){a(document).ready(function(){var e=f?"picknewiconphoto":"picknewicon";d.get_string(e,"format_tiles").done(function(a){h.pickAnIcon=a});k(b);var i=a("#page-content");if(0===i.length){i=a("#region-main")}i.on("click",".launchiconpicker",function(d){d.preventDefault();var e=a(d.currentTarget);n(c,b,e.attr("data-true-sectionid"),e.attr("data-section"),f,g)})})}}});
//# sourceMappingURL=edit_icon_picker.min.js.map
