{"version":3,"file":"actions.min.js","sources":["../../../src/local/content/actions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course state actions dispatcher.\n *\n * This module captures all data-dispatch links in the course content and dispatch the proper\n * state mutation, including any confirmation and modal required.\n *\n * @module     core_courseformat/local/content/actions\n * @class      core_courseformat/local/content/actions\n * @copyright  2021 Ferran Recio <ferran@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Templates from 'core/templates';\nimport {prefetchStrings} from 'core/prefetch';\nimport {get_string as getString} from 'core/str';\nimport {getList, getFirst} from 'core/normalise';\nimport * as CourseEvents from 'core_course/events';\nimport Pending from 'core/pending';\nimport ContentTree from 'core_courseformat/local/courseeditor/contenttree';\n// The jQuery module is only used for interacting with Boostrap 4. It can we removed when MDL-71979 is integrated.\nimport jQuery from 'jquery';\n\n// Load global strings.\nprefetchStrings('core', ['movecoursesection', 'movecoursemodule', 'confirm', 'delete']);\n\n// Mutations are dispatched by the course content actions.\n// Formats can use this module addActions static method to add custom actions.\n// Direct mutations can be simple strings (mutation) name or functions.\nconst directMutations = {\n    sectionHide: 'sectionHide',\n    sectionShow: 'sectionShow',\n    cmHide: 'cmHide',\n    cmShow: 'cmShow',\n    cmStealth: 'cmStealth',\n    cmMoveRight: 'cmMoveRight',\n    cmMoveLeft: 'cmMoveLeft',\n};\n\nexport default class extends BaseComponent {\n\n    /**\n     * Constructor hook.\n     */\n    create() {\n        // Optional component name for debugging.\n        this.name = 'content_actions';\n        // Default query selectors.\n        this.selectors = {\n            ACTIONLINK: `[data-action]`,\n            // Move modal selectors.\n            SECTIONLINK: `[data-for='section']`,\n            CMLINK: `[data-for='cm']`,\n            SECTIONNODE: `[data-for='sectionnode']`,\n            MODALTOGGLER: `[data-toggle='collapse']`,\n            ADDSECTION: `[data-action='addSection']`,\n            CONTENTTREE: `#destination-selector`,\n            ACTIONMENU: `.action-menu`,\n            ACTIONMENUTOGGLER: `[data-toggle=\"dropdown\"]`,\n            // Availability modal selectors.\n            OPTIONSRADIO: `[type='radio']`,\n        };\n        // Component css classes.\n        this.classes = {\n            DISABLED: `disabled`,\n        };\n    }\n\n    /**\n     * Add extra actions to the module.\n     *\n     * @param {array} actions array of methods to execute\n     */\n    static addActions(actions) {\n        for (const [action, mutationReference] of Object.entries(actions)) {\n            if (typeof mutationReference !== 'function' && typeof mutationReference !== 'string') {\n                throw new Error(`${action} action must be a mutation name or a function`);\n            }\n            directMutations[action] = mutationReference;\n        }\n    }\n\n    /**\n     * Initial state ready method.\n     *\n     * @param {Object} state the state data.\n     *\n     */\n    stateReady(state) {\n        // Delegate dispatch clicks.\n        this.addEventListener(\n            this.element,\n            'click',\n            this._dispatchClick\n        );\n        // Check section limit.\n        this._checkSectionlist({state});\n        // Add an Event listener to recalculate limits it if a section HTML is altered.\n        this.addEventListener(\n            this.element,\n            CourseEvents.sectionRefreshed,\n            () => this._checkSectionlist({state})\n        );\n    }\n\n    /**\n     * Return the component watchers.\n     *\n     * @returns {Array} of watchers\n     */\n    getWatchers() {\n        return [\n            // Check section limit.\n            {watch: `course.sectionlist:updated`, handler: this._checkSectionlist},\n        ];\n    }\n\n    _dispatchClick(event) {\n        const target = event.target.closest(this.selectors.ACTIONLINK);\n        if (!target) {\n            return;\n        }\n        if (target.classList.contains(this.classes.DISABLED)) {\n            event.preventDefault();\n            return;\n        }\n\n        // Invoke proper method.\n        const actionName = target.dataset.action;\n        const methodName = this._actionMethodName(actionName);\n\n        if (this[methodName] !== undefined) {\n            this[methodName](target, event);\n            return;\n        }\n\n        // Check direct mutations or mutations handlers.\n        if (directMutations[actionName] !== undefined) {\n            if (typeof directMutations[actionName] === 'function') {\n                directMutations[actionName](target, event);\n                return;\n            }\n            this._requestMutationAction(target, event, directMutations[actionName]);\n            return;\n        }\n    }\n\n    _actionMethodName(name) {\n        const requestName = name.charAt(0).toUpperCase() + name.slice(1);\n        return `_request${requestName}`;\n    }\n\n    /**\n     * Check the section list and disable some options if needed.\n     *\n     * @param {Object} detail the update details.\n     * @param {Object} detail.state the state object.\n     */\n    _checkSectionlist({state}) {\n        // Disable \"add section\" actions if the course max sections has been exceeded.\n        this._setAddSectionLocked(state.course.sectionlist.length > state.course.maxsections);\n    }\n\n    /**\n     * Return the ids represented by this element.\n     *\n     * Depending on the dataset attributes the action could represent a single id\n     * or a bulk actions with all the current selected ids.\n     *\n     * @param {HTMLElement} target\n     * @returns {Number[]} array of Ids\n     */\n    _getTargetIds(target) {\n        let ids = [];\n        if (target?.dataset?.id) {\n            ids.push(target.dataset.id);\n        }\n        const bulkType = target?.dataset?.bulk;\n        if (!bulkType) {\n            return ids;\n        }\n        const bulk = this.reactive.get('bulk');\n        if (bulk.enabled && bulk.selectedType === bulkType) {\n            ids = [...ids, ...bulk.selection];\n        }\n        return ids;\n    }\n\n    /**\n     * Handle a move section request.\n     *\n     * @param {Element} target the dispatch action element\n     * @param {Event} event the triggered event\n     */\n    async _requestMoveSection(target, event) {\n        // Check we have an id.\n        const sectionId = target.dataset.id;\n        if (!sectionId) {\n            return;\n        }\n        const sectionInfo = this.reactive.get('section', sectionId);\n\n        event.preventDefault();\n\n        // The section edit menu to refocus on end.\n        const editTools = this._getClosestActionMenuToogler(target);\n\n        // Collect section information from the state.\n        const exporter = this.reactive.getExporter();\n        const data = exporter.course(this.reactive.state);\n\n        // Add the target section id and title.\n        data.sectionid = sectionInfo.id;\n        data.sectiontitle = sectionInfo.title;\n\n        // Build the modal parameters from the event data.\n        const modalParams = {\n            title: getString('movecoursesection', 'core'),\n            body: Templates.render('core_courseformat/local/content/movesection', data),\n        };\n\n        // Create the modal.\n        const modal = await this._modalBodyRenderedPromise(modalParams);\n\n        const modalBody = getList(modal.getBody())[0];\n\n        // Disable current element and section zero.\n        const currentElement = modalBody.querySelector(`${this.selectors.SECTIONLINK}[data-id='${sectionId}']`);\n        this._disableLink(currentElement);\n        const generalSection = modalBody.querySelector(`${this.selectors.SECTIONLINK}[data-number='0']`);\n        this._disableLink(generalSection);\n\n        // Setup keyboard navigation.\n        new ContentTree(\n            modalBody.querySelector(this.selectors.CONTENTTREE),\n            {\n                SECTION: this.selectors.SECTIONNODE,\n                TOGGLER: this.selectors.MODALTOGGLER,\n                COLLAPSE: this.selectors.MODALTOGGLER,\n            },\n            true\n        );\n\n        // Capture click.\n        modalBody.addEventListener('click', (event) => {\n            const target = event.target;\n            if (!target.matches('a') || target.dataset.for != 'section' || target.dataset.id === undefined) {\n                return;\n            }\n            if (target.getAttribute('aria-disabled')) {\n                return;\n            }\n            event.preventDefault();\n            this.reactive.dispatch('sectionMove', [sectionId], target.dataset.id);\n            this._destroyModal(modal, editTools);\n        });\n    }\n\n    /**\n     * Handle a move cm request.\n     *\n     * @param {Element} target the dispatch action element\n     * @param {Event} event the triggered event\n     */\n    async _requestMoveCm(target, event) {\n        // Check we have an id.\n        const cmId = target.dataset.id;\n        if (!cmId) {\n            return;\n        }\n        const cmInfo = this.reactive.get('cm', cmId);\n\n        event.preventDefault();\n\n        // The section edit menu to refocus on end.\n        const editTools = this._getClosestActionMenuToogler(target);\n\n        // Collect section information from the state.\n        const exporter = this.reactive.getExporter();\n        const data = exporter.course(this.reactive.state);\n\n        // Add the target cm info.\n        data.cmid = cmInfo.id;\n        data.cmname = cmInfo.name;\n\n        // Build the modal parameters from the event data.\n        const modalParams = {\n            title: getString('movecoursemodule', 'core'),\n            body: Templates.render('core_courseformat/local/content/movecm', data),\n        };\n\n        // Create the modal.\n        const modal = await this._modalBodyRenderedPromise(modalParams);\n\n        const modalBody = getList(modal.getBody())[0];\n\n        // Disable current element.\n        let currentElement = modalBody.querySelector(`${this.selectors.CMLINK}[data-id='${cmId}']`);\n        this._disableLink(currentElement);\n\n        // Setup keyboard navigation.\n        new ContentTree(\n            modalBody.querySelector(this.selectors.CONTENTTREE),\n            {\n                SECTION: this.selectors.SECTIONNODE,\n                TOGGLER: this.selectors.MODALTOGGLER,\n                COLLAPSE: this.selectors.MODALTOGGLER,\n                ENTER: this.selectors.SECTIONLINK,\n            }\n        );\n\n        // Open the cm section node if possible (Bootstrap 4 uses jQuery to interact with collapsibles).\n        // All jQuery int this code can be replaced when MDL-71979 is integrated.\n        const sectionnode = currentElement.closest(this.selectors.SECTIONNODE);\n        const toggler = jQuery(sectionnode).find(this.selectors.MODALTOGGLER);\n        let collapsibleId = toggler.data('target') ?? toggler.attr('href');\n        if (collapsibleId) {\n            // We cannot be sure we have # in the id element name.\n            collapsibleId = collapsibleId.replace('#', '');\n            jQuery(`#${collapsibleId}`).collapse('toggle');\n        }\n\n        // Capture click.\n        modalBody.addEventListener('click', (event) => {\n            const target = event.target;\n            if (!target.matches('a') || target.dataset.for === undefined || target.dataset.id === undefined) {\n                return;\n            }\n            if (target.getAttribute('aria-disabled')) {\n                return;\n            }\n            event.preventDefault();\n\n            // Get draggable data from cm or section to dispatch.\n            let targetSectionId;\n            let targetCmId;\n            if (target.dataset.for == 'cm') {\n                const dropData = exporter.cmDraggableData(this.reactive.state, target.dataset.id);\n                targetSectionId = dropData.sectionid;\n                targetCmId = dropData.nextcmid;\n            } else {\n                const section = this.reactive.get('section', target.dataset.id);\n                targetSectionId = target.dataset.id;\n                targetCmId = section?.cmlist[0];\n            }\n\n            this.reactive.dispatch('cmMove', [cmId], targetSectionId, targetCmId);\n            this._destroyModal(modal, editTools);\n        });\n    }\n\n    /**\n     * Handle a create section request.\n     *\n     * @param {Element} target the dispatch action element\n     * @param {Event} event the triggered event\n     */\n    async _requestAddSection(target, event) {\n        event.preventDefault();\n        this.reactive.dispatch('addSection', target.dataset.id ?? 0);\n    }\n\n    /**\n     * Handle a delete section request.\n     *\n     * @param {Element} target the dispatch action element\n     * @param {Event} event the triggered event\n     */\n    async _requestDeleteSection(target, event) {\n        // Check we have an id.\n        const sectionId = target.dataset.id;\n\n        if (!sectionId) {\n            return;\n        }\n        const sectionInfo = this.reactive.get('section', sectionId);\n\n        event.preventDefault();\n\n        const cmList = sectionInfo.cmlist ?? [];\n        if (cmList.length || sectionInfo.hassummary || sectionInfo.rawtitle) {\n            // We need confirmation if the section has something.\n            const modalParams = {\n                title: getString('confirm', 'core'),\n                body: getString('confirmdeletesection', 'moodle', sectionInfo.title),\n                saveButtonText: getString('delete', 'core'),\n                type: ModalFactory.types.SAVE_CANCEL,\n            };\n\n            const modal = await this._modalBodyRenderedPromise(modalParams);\n\n            modal.getRoot().on(\n                ModalEvents.save,\n                e => {\n                    // Stop the default save button behaviour which is to close the modal.\n                    e.preventDefault();\n                    modal.destroy();\n                    this.reactive.dispatch('sectionDelete', [sectionId]);\n                }\n            );\n            return;\n        } else {\n            // We don't need confirmation to delete empty sections.\n            this.reactive.dispatch('sectionDelete', [sectionId]);\n        }\n    }\n\n    /**\n     * Handle a toggle cm selection.\n     *\n     * @param {Element} target the dispatch action element\n     */\n    async _requestToggleSelectionCm(target) {\n        const cmId = target.dataset.id;\n        if (!cmId) {\n            return;\n        }\n        const value = target.checked ?? false;\n        const mutation = (value) ? 'cmSelect' : 'cmUnselect';\n        this.reactive.dispatch(mutation, [cmId]);\n    }\n\n    /**\n     * Handle a toggle section selection.\n     *\n     * @param {Element} target the dispatch action element\n     */\n    async _requestToggleSelectionSection(target) {\n        const sectionId = target.dataset.id;\n        if (!sectionId) {\n            return;\n        }\n        const value = target.checked ?? false;\n        const mutation = (value) ? 'sectionSelect' : 'sectionUnselect';\n        this.reactive.dispatch(mutation, [sectionId]);\n    }\n\n    /**\n     * Basic mutation action helper.\n     *\n     * @param {Element} target the dispatch action element\n     * @param {Event} event the triggered event\n     * @param {string} mutationName the mutation name\n     */\n    async _requestMutationAction(target, event, mutationName) {\n        if (!target.dataset.id) {\n            return;\n        }\n        event.preventDefault();\n        this.reactive.dispatch(mutationName, [target.dataset.id]);\n    }\n\n    /**\n     * Handle a course module duplicate request.\n     *\n     * @param {Element} target the dispatch action element\n     * @param {Event} event the triggered event\n     */\n    async _requestCmDuplicate(target, event) {\n        const cmIds = this._getTargetIds(target);\n        if (cmIds.length == 0) {\n            return;\n        }\n        const sectionId = target.dataset.sectionid ?? null;\n        event.preventDefault();\n        this.reactive.dispatch('cmDuplicate', cmIds, sectionId);\n    }\n\n    /**\n     * Handle a delete cm request.\n     *\n     * @param {Element} target the dispatch action element\n     * @param {Event} event the triggered event\n     */\n    async _requestCmDelete(target, event) {\n        // Check we have an id.\n        const cmId = target.dataset.id;\n\n        if (!cmId) {\n            return;\n        }\n        const cmInfo = this.reactive.get('cm', cmId);\n\n        event.preventDefault();\n\n        const modalParams = {\n            title: getString('confirm', 'core'),\n            body: getString(\n                'deletechecktypename',\n                'moodle',\n                {\n                    type: cmInfo.modname,\n                    name: cmInfo.name,\n                }\n            ),\n            saveButtonText: getString('delete', 'core'),\n            type: ModalFactory.types.SAVE_CANCEL,\n        };\n\n        const modal = await this._modalBodyRenderedPromise(modalParams);\n\n        modal.getRoot().on(\n            ModalEvents.save,\n            e => {\n                // Stop the default save button behaviour which is to close the modal.\n                e.preventDefault();\n                modal.destroy();\n                this.reactive.dispatch('cmDelete', [cmId]);\n            }\n        );\n    }\n\n    /**\n     * Handle a cm availability change request.\n     *\n     * @param {Element} target the dispatch action element\n     */\n    async _requestCmAvailability(target) {\n        const cmIds = this._getTargetIds(target);\n        if (cmIds.length == 0) {\n            return;\n        }\n        // Show the availability modal to decide which action to trigger.\n        const exporter = this.reactive.getExporter();\n        const data = {\n            allowstealth: exporter.canUseStealth(this.reactive.state, cmIds),\n        };\n        const modalParams = {\n            title: getString('availability', 'core'),\n            body: Templates.render('core_courseformat/local/content/cm/availabilitymodal', data),\n            saveButtonText: getString('apply', 'core'),\n            type: ModalFactory.types.SAVE_CANCEL,\n        };\n        const modal = await this._modalBodyRenderedPromise(modalParams);\n\n        this._setupMutationRadioButtonModal(modal, cmIds);\n    }\n\n    /**\n     * Handle a section availability change request.\n     *\n     * @param {Element} target the dispatch action element\n     */\n    async _requestSectionAvailability(target) {\n        const sectionIds = this._getTargetIds(target);\n        if (sectionIds.length == 0) {\n            return;\n        }\n        // Show the availability modal to decide which action to trigger.\n        const modalParams = {\n            title: getString('availability', 'core'),\n            body: Templates.render('core_courseformat/local/content/section/availabilitymodal', []),\n            saveButtonText: getString('apply', 'core'),\n            type: ModalFactory.types.SAVE_CANCEL,\n        };\n        const modal = await this._modalBodyRenderedPromise(modalParams);\n\n        this._setupMutationRadioButtonModal(modal, sectionIds);\n    }\n\n    /**\n     * Add events to a mutation selector radio buttons modal.\n     * @param {Modal} modal\n     * @param {Number[]} ids the section or cm ids to apply the mutation\n     */\n    _setupMutationRadioButtonModal(modal, ids) {\n        // The save button is not enabled until the user selects an option.\n        modal.setButtonDisabled('save', true);\n\n        const submitFunction = (radio) => {\n            const mutation = radio?.value;\n            if (!mutation) {\n                return false;\n            }\n            this.reactive.dispatch(mutation, ids);\n            return true;\n        };\n\n        const modalBody = getFirst(modal.getBody());\n        const radioOptions = modalBody.querySelectorAll(this.selectors.OPTIONSRADIO);\n        radioOptions.forEach(radio => {\n            radio.addEventListener('change', () => {\n                modal.setButtonDisabled('save', false);\n            });\n            radio.parentNode.addEventListener('click', () => {\n                radio.checked = true;\n                modal.setButtonDisabled('save', false);\n            });\n            radio.parentNode.addEventListener('dblclick', dbClickEvent => {\n                if (submitFunction(radio)) {\n                    dbClickEvent.preventDefault();\n                    modal.destroy();\n                }\n            });\n        });\n\n        modal.getRoot().on(\n            ModalEvents.save,\n            () => {\n                const radio = modalBody.querySelector(`${this.selectors.OPTIONSRADIO}:checked`);\n                submitFunction(radio);\n            }\n        );\n    }\n\n    /**\n     * Disable all add sections actions.\n     *\n     * @param {boolean} locked the new locked value.\n     */\n    _setAddSectionLocked(locked) {\n        const targets = this.getElements(this.selectors.ADDSECTION);\n        targets.forEach(element => {\n            element.classList.toggle(this.classes.DISABLED, locked);\n            this.setElementLocked(element, locked);\n        });\n    }\n\n    /**\n     * Replace an element with a copy with a different tag name.\n     *\n     * @param {Element} element the original element\n     */\n    _disableLink(element) {\n        if (element) {\n            element.style.pointerEvents = 'none';\n            element.style.userSelect = 'none';\n            element.classList.add(this.classes.DISABLED);\n            element.setAttribute('aria-disabled', true);\n            element.addEventListener('click', event => event.preventDefault());\n        }\n    }\n\n    /**\n     * Render a modal and return a body ready promise.\n     *\n     * @param {object} modalParams the modal params\n     * @return {Promise} the modal body ready promise\n     */\n    _modalBodyRenderedPromise(modalParams) {\n        return new Promise((resolve, reject) => {\n            ModalFactory.create(modalParams).then((modal) => {\n                modal.setRemoveOnClose(true);\n                // Handle body loading event.\n                modal.getRoot().on(ModalEvents.bodyRendered, () => {\n                    resolve(modal);\n                });\n                // Configure some extra modal params.\n                if (modalParams.saveButtonText !== undefined) {\n                    modal.setSaveButtonText(modalParams.saveButtonText);\n                }\n                modal.show();\n                return;\n            }).catch(() => {\n                reject(`Cannot load modal content`);\n            });\n        });\n    }\n\n    /**\n     * Hide and later destroy a modal.\n     *\n     * Behat will fail if we remove the modal while some boostrap collapse is executing.\n     *\n     * @param {Modal} modal\n     * @param {HTMLElement} element the dom element to focus on.\n     */\n    _destroyModal(modal, element) {\n        modal.hide();\n        const pendingDestroy = new Pending(`courseformat/actions:destroyModal`);\n        if (element) {\n            element.focus();\n        }\n        setTimeout(() =>{\n            modal.destroy();\n            pendingDestroy.resolve();\n        }, 500);\n    }\n\n    /**\n     * Get the closest actions menu toggler to an action element.\n     *\n     * @param {HTMLElement} element the action link element\n     * @returns {HTMLElement|undefined}\n     */\n    _getClosestActionMenuToogler(element) {\n        const actionMenu = element.closest(this.selectors.ACTIONMENU);\n        if (!actionMenu) {\n            return undefined;\n        }\n        return actionMenu.querySelector(this.selectors.ACTIONMENUTOGGLER);\n    }\n}\n"],"names":["_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_interopRequireDefault","obj","__esModule","default","_modal_factory","_modal_events","_templates","CourseEvents","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_interopRequireWildcard","_pending","_contenttree","_jquery","prefetchStrings","directMutations","sectionHide","sectionShow","cmHide","cmShow","cmStealth","cmMoveRight","cmMoveLeft","_default","BaseComponent","create","this","name","selectors","ACTIONLINK","SECTIONLINK","CMLINK","SECTIONNODE","MODALTOGGLER","ADDSECTION","CONTENTTREE","ACTIONMENU","ACTIONMENUTOGGLER","OPTIONSRADIO","classes","DISABLED","static","actions","action","mutationReference","entries","Error","concat","stateReady","state","addEventListener","element","_dispatchClick","_checkSectionlist","sectionRefreshed","getWatchers","watch","handler","event","target","closest","classList","contains","preventDefault","actionName","dataset","methodName","_actionMethodName","undefined","_requestMutationAction","requestName","charAt","toUpperCase","slice","_ref","_setAddSectionLocked","course","sectionlist","length","maxsections","_getTargetIds","_target$dataset","_target$dataset2","ids","id","push","bulkType","bulk","reactive","enabled","selectedType","selection","async","sectionId","sectionInfo","editTools","_getClosestActionMenuToogler","data","getExporter","sectionid","sectiontitle","title","modalParams","getString","body","Templates","render","modal","_modalBodyRenderedPromise","modalBody","getList","getBody","currentElement","querySelector","_disableLink","generalSection","ContentTree","SECTION","TOGGLER","COLLAPSE","matches","for","getAttribute","dispatch","_destroyModal","_toggler$data","cmId","cmInfo","exporter","cmid","cmname","ENTER","sectionnode","toggler","jQuery","find","collapsibleId","attr","replace","collapse","targetSectionId","targetCmId","dropData","cmDraggableData","nextcmid","section","cmlist","_target$dataset$id","_sectionInfo$cmlist","hassummary","rawtitle","saveButtonText","type","ModalFactory","types","SAVE_CANCEL","getRoot","on","ModalEvents","save","e","destroy","_target$checked","mutation","checked","_target$checked2","mutationName","_target$dataset$secti","cmIds","modname","allowstealth","canUseStealth","_setupMutationRadioButtonModal","sectionIds","setButtonDisabled","submitFunction","radio","value","getFirst","querySelectorAll","forEach","parentNode","dbClickEvent","locked","getElements","toggle","setElementLocked","style","pointerEvents","userSelect","add","setAttribute","Promise","resolve","reject","then","setRemoveOnClose","bodyRendered","setSaveButtonText","show","catch","hide","pendingDestroy","Pending","focus","setTimeout","actionMenu","_exports"],"mappings":"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"}