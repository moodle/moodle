{"version":3,"file":"dialogue.min.js","sources":["../../../src/local/activitychooser/dialogue.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A type of dialogue used as for choosing options.\n *\n * @module     core_course/local/chooser/dialogue\n * @package    core\n * @copyright  2019 Mihail Geshoski <mihail@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport * as ModalEvents from 'core/modal_events';\nimport selectors from 'core_course/local/activitychooser/selectors';\nimport * as Templates from 'core/templates';\nimport {end, arrowLeft, arrowRight, home, enter, space} from 'core/key_codes';\nimport {addIconToContainer} from 'core/loadingicon';\nimport * as Repository from 'core_course/local/activitychooser/repository';\nimport Notification from 'core/notification';\nimport {debounce} from 'core/utils';\nconst getPlugin = pluginName => import(pluginName);\n\n/**\n * Given an event from the main module 'page' navigate to it's help section via a carousel.\n *\n * @method showModuleHelp\n * @param {jQuery} carousel Our initialized carousel to manipulate\n * @param {Object} moduleData Data of the module to carousel to\n * @param {jQuery} modal We need to figure out if the current modal has a footer.\n */\nconst showModuleHelp = (carousel, moduleData, modal = null) => {\n    // If we have a real footer then we need to change temporarily.\n    if (modal !== null && moduleData.showFooter === true) {\n        modal.setFooter(Templates.render('core_course/local/activitychooser/footer_partial', moduleData));\n    }\n    const help = carousel.find(selectors.regions.help)[0];\n    help.innerHTML = '';\n    help.classList.add('m-auto');\n\n    // Add a spinner.\n    const spinnerPromise = addIconToContainer(help);\n\n    // Used later...\n    let transitionPromiseResolver = null;\n    const transitionPromise = new Promise(resolve => {\n        transitionPromiseResolver = resolve;\n    });\n\n    // Build up the html & js ready to place into the help section.\n    const contentPromise = Templates.renderForPromise('core_course/local/activitychooser/help', moduleData);\n\n    // Wait for the content to be ready, and for the transition to be complet.\n    Promise.all([contentPromise, spinnerPromise, transitionPromise])\n        .then(([{html, js}]) => Templates.replaceNodeContents(help, html, js))\n        .then(() => {\n            help.querySelector(selectors.regions.chooserSummary.header).focus();\n            return help;\n        })\n        .catch(Notification.exception);\n\n    // Move to the next slide, and resolve the transition promise when it's done.\n    carousel.one('slid.bs.carousel', () => {\n        transitionPromiseResolver();\n    });\n    // Trigger the transition between 'pages'.\n    carousel.carousel('next');\n};\n\n/**\n * Given a user wants to change the favourite state of a module we either add or remove the status.\n * We also propergate this change across our map of modals.\n *\n * @method manageFavouriteState\n * @param {HTMLElement} modalBody The DOM node of the modal to manipulate\n * @param {HTMLElement} caller\n * @param {Function} partialFavourite Partially applied function we need to manage favourite status\n */\nconst manageFavouriteState = async(modalBody, caller, partialFavourite) => {\n    const isFavourite = caller.dataset.favourited;\n    const id = caller.dataset.id;\n    const name = caller.dataset.name;\n    const internal = caller.dataset.internal;\n    // Switch on fave or not.\n    if (isFavourite === 'true') {\n        await Repository.unfavouriteModule(name, id);\n\n        partialFavourite(internal, false, modalBody);\n    } else {\n        await Repository.favouriteModule(name, id);\n\n        partialFavourite(internal, true, modalBody);\n    }\n\n};\n\n/**\n * Register chooser related event listeners.\n *\n * @method registerListenerEvents\n * @param {Promise} modal Our modal that we are working with\n * @param {Map} mappedModules A map of all of the modules we are working with with K: mod_name V: {Object}\n * @param {Function} partialFavourite Partially applied function we need to manage favourite status\n * @param {Object} footerData Our base footer object.\n */\nconst registerListenerEvents = (modal, mappedModules, partialFavourite, footerData) => {\n    const bodyClickListener = async(e) => {\n        if (e.target.closest(selectors.actions.optionActions.showSummary)) {\n            const carousel = $(modal.getBody()[0].querySelector(selectors.regions.carousel));\n\n            const module = e.target.closest(selectors.regions.chooserOption.container);\n            const moduleName = module.dataset.modname;\n            const moduleData = mappedModules.get(moduleName);\n            // We need to know if the overall modal has a footer so we know when to show a real / vs fake footer.\n            moduleData.showFooter = modal.hasFooterContent();\n            showModuleHelp(carousel, moduleData, modal);\n        }\n\n        if (e.target.closest(selectors.actions.optionActions.manageFavourite)) {\n            const caller = e.target.closest(selectors.actions.optionActions.manageFavourite);\n            await manageFavouriteState(modal.getBody()[0], caller, partialFavourite);\n            const activeSectionId = modal.getBody()[0].querySelector(selectors.elements.activetab).getAttribute(\"href\");\n            const sectionChooserOptions = modal.getBody()[0]\n                .querySelector(selectors.regions.getSectionChooserOptions(activeSectionId));\n            const firstChooserOption = sectionChooserOptions\n                .querySelector(selectors.regions.chooserOption.container);\n            toggleFocusableChooserOption(firstChooserOption, true);\n            initChooserOptionsKeyboardNavigation(modal.getBody()[0], mappedModules, sectionChooserOptions, modal);\n        }\n\n        // From the help screen go back to the module overview.\n        if (e.target.matches(selectors.actions.closeOption)) {\n            const carousel = $(modal.getBody()[0].querySelector(selectors.regions.carousel));\n\n            // Trigger the transition between 'pages'.\n            carousel.carousel('prev');\n            carousel.on('slid.bs.carousel', () => {\n                const allModules = modal.getBody()[0].querySelector(selectors.regions.modules);\n                const caller = allModules.querySelector(selectors.regions.getModuleSelector(e.target.dataset.modname));\n                caller.focus();\n            });\n        }\n\n        // The \"clear search\" button is triggered.\n        if (e.target.closest(selectors.actions.clearSearch)) {\n            // Clear the entered search query in the search bar and hide the search results container.\n            const searchInput = modal.getBody()[0].querySelector(selectors.actions.search);\n            searchInput.value = \"\";\n            searchInput.focus();\n            toggleSearchResultsView(modal, mappedModules, searchInput.value);\n        }\n    };\n\n    // We essentially have two types of footer.\n    // A fake one that is handled within the template for chooser_help and then all of the stuff for\n    // modal.footer. We need to ensure we know exactly what type of footer we are using so we know what we\n    // need to manage. The below code handles a real footer going to a mnet carousel item.\n    const footerClickListener = async(e) => {\n        if (footerData.footer === true) {\n            const footerjs = await getPlugin(footerData.customfooterjs);\n            await footerjs.footerClickListener(e, footerData, modal);\n        }\n    };\n\n    modal.getBodyPromise()\n\n    // The return value of getBodyPromise is a jquery object containing the body NodeElement.\n    .then(body => body[0])\n\n    // Set up the carousel.\n    .then(body => {\n        $(body.querySelector(selectors.regions.carousel))\n            .carousel({\n                interval: false,\n                pause: true,\n                keyboard: false\n            });\n\n        return body;\n    })\n\n    // Add the listener for clicks on the body.\n    .then(body => {\n        body.addEventListener('click', bodyClickListener);\n        return body;\n    })\n\n    // Add a listener for an input change in the activity chooser's search bar.\n    .then(body => {\n        const searchInput = body.querySelector(selectors.actions.search);\n        // The search input is triggered.\n        searchInput.addEventListener('input', debounce(() => {\n            // Display the search results.\n            toggleSearchResultsView(modal, mappedModules, searchInput.value);\n        }, 300));\n        return body;\n    })\n\n    // Register event listeners related to the keyboard navigation controls.\n    .then(body => {\n        // Get the active chooser options section.\n        const activeSectionId = body.querySelector(selectors.elements.activetab).getAttribute(\"href\");\n        const sectionChooserOptions = body.querySelector(selectors.regions.getSectionChooserOptions(activeSectionId));\n        const firstChooserOption = sectionChooserOptions.querySelector(selectors.regions.chooserOption.container);\n\n        toggleFocusableChooserOption(firstChooserOption, true);\n        initChooserOptionsKeyboardNavigation(body, mappedModules, sectionChooserOptions, modal);\n\n        return body;\n    })\n    .catch();\n\n    modal.getFooterPromise()\n\n    // The return value of getBodyPromise is a jquery object containing the body NodeElement.\n    .then(footer => footer[0])\n    // Add the listener for clicks on the footer.\n    .then(footer => {\n        footer.addEventListener('click', footerClickListener);\n        return footer;\n    })\n    .catch();\n};\n\n/**\n * Initialise the keyboard navigation controls for the chooser options.\n *\n * @method initChooserOptionsKeyboardNavigation\n * @param {HTMLElement} body Our modal that we are working with\n * @param {Map} mappedModules A map of all of the modules we are working with with K: mod_name V: {Object}\n * @param {HTMLElement} chooserOptionsContainer The section that contains the chooser items\n * @param {Object} modal Our created modal for the section\n */\nconst initChooserOptionsKeyboardNavigation = (body, mappedModules, chooserOptionsContainer, modal = null) => {\n    const chooserOptions = chooserOptionsContainer.querySelectorAll(selectors.regions.chooserOption.container);\n\n    Array.from(chooserOptions).forEach((element) => {\n        return element.addEventListener('keydown', (e) => {\n\n            // Check for enter/ space triggers for showing the help.\n            if (e.keyCode === enter || e.keyCode === space) {\n                if (e.target.matches(selectors.actions.optionActions.showSummary)) {\n                    e.preventDefault();\n                    const module = e.target.closest(selectors.regions.chooserOption.container);\n                    const moduleName = module.dataset.modname;\n                    const moduleData = mappedModules.get(moduleName);\n                    const carousel = $(body.querySelector(selectors.regions.carousel));\n                    carousel.carousel({\n                        interval: false,\n                        pause: true,\n                        keyboard: false\n                    });\n\n                    // We need to know if the overall modal has a footer so we know when to show a real / vs fake footer.\n                    moduleData.showFooter = modal.hasFooterContent();\n                    showModuleHelp(carousel, moduleData, modal);\n                }\n            }\n\n            // Next.\n            if (e.keyCode === arrowRight) {\n                e.preventDefault();\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const nextOption = currentOption.nextElementSibling;\n                const firstOption = chooserOptionsContainer.firstElementChild;\n                const toFocusOption = clickErrorHandler(nextOption, firstOption);\n                focusChooserOption(toFocusOption, currentOption);\n            }\n\n            // Previous.\n            if (e.keyCode === arrowLeft) {\n                e.preventDefault();\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const previousOption = currentOption.previousElementSibling;\n                const lastOption = chooserOptionsContainer.lastElementChild;\n                const toFocusOption = clickErrorHandler(previousOption, lastOption);\n                focusChooserOption(toFocusOption, currentOption);\n            }\n\n            if (e.keyCode === home) {\n                e.preventDefault();\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const firstOption = chooserOptionsContainer.firstElementChild;\n                focusChooserOption(firstOption, currentOption);\n            }\n\n            if (e.keyCode === end) {\n                e.preventDefault();\n                const currentOption = e.target.closest(selectors.regions.chooserOption.container);\n                const lastOption = chooserOptionsContainer.lastElementChild;\n                focusChooserOption(lastOption, currentOption);\n            }\n        });\n    });\n};\n\n/**\n * Focus on a chooser option element and remove the previous chooser element from the focus order\n *\n * @method focusChooserOption\n * @param {HTMLElement} currentChooserOption The current chooser option element that we want to focus\n * @param {HTMLElement|null} previousChooserOption The previous focused option element\n */\nconst focusChooserOption = (currentChooserOption, previousChooserOption = null) => {\n    if (previousChooserOption !== null) {\n        toggleFocusableChooserOption(previousChooserOption, false);\n    }\n\n    toggleFocusableChooserOption(currentChooserOption, true);\n    currentChooserOption.focus();\n};\n\n/**\n * Add or remove a chooser option from the focus order.\n *\n * @method toggleFocusableChooserOption\n * @param {HTMLElement} chooserOption The chooser option element which should be added or removed from the focus order\n * @param {Boolean} isFocusable Whether the chooser element is focusable or not\n */\nconst toggleFocusableChooserOption = (chooserOption, isFocusable) => {\n    const chooserOptionLink = chooserOption.querySelector(selectors.actions.addChooser);\n    const chooserOptionHelp = chooserOption.querySelector(selectors.actions.optionActions.showSummary);\n    const chooserOptionFavourite = chooserOption.querySelector(selectors.actions.optionActions.manageFavourite);\n\n    if (isFocusable) {\n        // Set tabindex to 0 to add current chooser option element to the focus order.\n        chooserOption.tabIndex = 0;\n        chooserOptionLink.tabIndex = 0;\n        chooserOptionHelp.tabIndex = 0;\n        chooserOptionFavourite.tabIndex = 0;\n    } else {\n        // Set tabindex to -1 to remove the previous chooser option element from the focus order.\n        chooserOption.tabIndex = -1;\n        chooserOptionLink.tabIndex = -1;\n        chooserOptionHelp.tabIndex = -1;\n        chooserOptionFavourite.tabIndex = -1;\n    }\n};\n\n/**\n * Small error handling function to make sure the navigated to object exists\n *\n * @method clickErrorHandler\n * @param {HTMLElement} item What we want to check exists\n * @param {HTMLElement} fallback If we dont match anything fallback the focus\n * @return {HTMLElement}\n */\nconst clickErrorHandler = (item, fallback) => {\n    if (item !== null) {\n        return item;\n    } else {\n        return fallback;\n    }\n};\n\n/**\n * Render the search results in a defined container\n *\n * @method renderSearchResults\n * @param {HTMLElement} searchResultsContainer The container where the data should be rendered\n * @param {Object} searchResultsData Data containing the module items that satisfy the search criteria\n */\nconst renderSearchResults = async(searchResultsContainer, searchResultsData) => {\n    const templateData = {\n        'searchresultsnumber': searchResultsData.length,\n        'searchresults': searchResultsData\n    };\n    // Build up the html & js ready to place into the help section.\n    const {html, js} = await Templates.renderForPromise('core_course/local/activitychooser/search_results', templateData);\n    await Templates.replaceNodeContents(searchResultsContainer, html, js);\n};\n\n/**\n * Toggle (display/hide) the search results depending on the value of the search query\n *\n * @method toggleSearchResultsView\n * @param {Object} modal Our created modal for the section\n * @param {Map} mappedModules A map of all of the modules we are working with with K: mod_name V: {Object}\n * @param {String} searchQuery The search query\n */\nconst toggleSearchResultsView = async(modal, mappedModules, searchQuery) => {\n    const modalBody = modal.getBody()[0];\n    const searchResultsContainer = modalBody.querySelector(selectors.regions.searchResults);\n    const chooserContainer = modalBody.querySelector(selectors.regions.chooser);\n    const clearSearchButton = modalBody.querySelector(selectors.elements.clearsearch);\n    const searchIcon = modalBody.querySelector(selectors.elements.searchicon);\n\n    if (searchQuery.length > 0) { // Search query is present.\n        const searchResultsData = searchModules(mappedModules, searchQuery);\n        await renderSearchResults(searchResultsContainer, searchResultsData);\n        const searchResultItemsContainer = searchResultsContainer.querySelector(selectors.regions.searchResultItems);\n        const firstSearchResultItem = searchResultItemsContainer.querySelector(selectors.regions.chooserOption.container);\n        if (firstSearchResultItem) {\n            // Set the first result item to be focusable.\n            toggleFocusableChooserOption(firstSearchResultItem, true);\n            // Register keyboard events on the created search result items.\n            initChooserOptionsKeyboardNavigation(modalBody, mappedModules, searchResultItemsContainer, modal);\n        }\n        // Display the \"clear\" search button in the activity chooser search bar.\n        searchIcon.classList.add('d-none');\n        clearSearchButton.classList.remove('d-none');\n        // Hide the default chooser options container.\n        chooserContainer.setAttribute('hidden', 'hidden');\n        // Display the search results container.\n        searchResultsContainer.removeAttribute('hidden');\n    } else { // Search query is not present.\n        // Hide the \"clear\" search button in the activity chooser search bar.\n        clearSearchButton.classList.add('d-none');\n        searchIcon.classList.remove('d-none');\n        // Hide the search results container.\n        searchResultsContainer.setAttribute('hidden', 'hidden');\n        // Display the default chooser options container.\n        chooserContainer.removeAttribute('hidden');\n    }\n};\n\n/**\n * Return the list of modules which have a name or description that matches the given search term.\n *\n * @method searchModules\n * @param {Array} modules List of available modules\n * @param {String} searchTerm The search term to match\n * @return {Array}\n */\nconst searchModules = (modules, searchTerm) => {\n    if (searchTerm === '') {\n        return modules;\n    }\n    searchTerm = searchTerm.toLowerCase();\n    const searchResults = [];\n    modules.forEach((activity) => {\n        const activityName = activity.title.toLowerCase();\n        const activityDesc = activity.help.toLowerCase();\n        if (activityName.includes(searchTerm) || activityDesc.includes(searchTerm)) {\n            searchResults.push(activity);\n        }\n    });\n\n    return searchResults;\n};\n\n/**\n * Set up our tabindex information across the chooser.\n *\n * @method setupKeyboardAccessibility\n * @param {Promise} modal Our created modal for the section\n * @param {Map} mappedModules A map of all of the built module information\n */\nconst setupKeyboardAccessibility = (modal, mappedModules) => {\n    modal.getModal()[0].tabIndex = -1;\n\n    modal.getBodyPromise().then(body => {\n        $(selectors.elements.tab).on('shown.bs.tab', (e) => {\n            const activeSectionId = e.target.getAttribute(\"href\");\n            const activeSectionChooserOptions = body[0]\n                .querySelector(selectors.regions.getSectionChooserOptions(activeSectionId));\n            const firstChooserOption = activeSectionChooserOptions\n                .querySelector(selectors.regions.chooserOption.container);\n            const prevActiveSectionId = e.relatedTarget.getAttribute(\"href\");\n            const prevActiveSectionChooserOptions = body[0]\n                .querySelector(selectors.regions.getSectionChooserOptions(prevActiveSectionId));\n\n            // Disable the focus of every chooser option in the previous active section.\n            disableFocusAllChooserOptions(prevActiveSectionChooserOptions);\n            // Enable the focus of the first chooser option in the current active section.\n            toggleFocusableChooserOption(firstChooserOption, true);\n            initChooserOptionsKeyboardNavigation(body[0], mappedModules, activeSectionChooserOptions, modal);\n        });\n        return;\n    }).catch(Notification.exception);\n};\n\n/**\n * Disable the focus of all chooser options in a specific container (section).\n *\n * @method disableFocusAllChooserOptions\n * @param {HTMLElement} sectionChooserOptions The section that contains the chooser items\n */\nconst disableFocusAllChooserOptions = (sectionChooserOptions) => {\n    const allChooserOptions = sectionChooserOptions.querySelectorAll(selectors.regions.chooserOption.container);\n    allChooserOptions.forEach((chooserOption) => {\n        toggleFocusableChooserOption(chooserOption, false);\n    });\n};\n\n/**\n * Display the module chooser.\n *\n * @method displayChooser\n * @param {Promise} modalPromise Our created modal for the section\n * @param {Array} sectionModules An array of all of the built module information\n * @param {Function} partialFavourite Partially applied function we need to manage favourite status\n * @param {Object} footerData Our base footer object.\n */\nexport const displayChooser = (modalPromise, sectionModules, partialFavourite, footerData) => {\n    // Make a map so we can quickly fetch a specific module's object for either rendering or searching.\n    const mappedModules = new Map();\n    sectionModules.forEach((module) => {\n        mappedModules.set(module.componentname + '_' + module.link, module);\n    });\n\n    // Register event listeners.\n    modalPromise.then(modal => {\n        registerListenerEvents(modal, mappedModules, partialFavourite, footerData);\n\n        // We want to focus on the first chooser option element as soon as the modal is opened.\n        setupKeyboardAccessibility(modal, mappedModules);\n\n        // We want to focus on the action select when the dialog is closed.\n        modal.getRoot().on(ModalEvents.hidden, () => {\n            modal.destroy();\n        });\n\n        return modal;\n    }).catch();\n};\n"],"names":["_jquery","_interopRequireDefault","ModalEvents","_interopRequireWildcard","_selectors","Templates","Repository","_notification","_ref3","_ref6","_ref7","getPlugin","pluginName","_systemImportTransformerGlobalIdentifier","define","amd","Promise","resolve","reject","require","showModuleHelp","carousel","moduleData","modal","showFooter","setFooter","render","help","find","selectors","regions","innerHTML","classList","add","spinnerPromise","transitionPromiseResolver","transitionPromise","contentPromise","renderForPromise","all","then","_ref","_ref2$","_slicedToArray","html","js","replaceNodeContents","querySelector","chooserSummary","header","focus","catch","Notification","exception","one","manageFavouriteState","_asyncToGenerator","regeneratorRuntime","mark","modalBody","caller","partialFavourite","isFavourite","id","name","internal","wrap","_context","prev","next","dataset","favourited","unfavouriteModule","favouriteModule","stop","_callee","_x","_x2","_x3","apply","this","arguments","initChooserOptionsKeyboardNavigation","body","mappedModules","chooserOptionsContainer","chooserOptions","querySelectorAll","chooserOption","container","Array","from","forEach","element","addEventListener","e","keyCode","enter","space","target","matches","actions","optionActions","showSummary","preventDefault","moduleName","closest","modname","get","interval","pause","keyboard","hasFooterContent","arrowRight","currentOption","nextOption","nextElementSibling","firstOption","firstElementChild","toFocusOption","clickErrorHandler","focusChooserOption","arrowLeft","previousOption","previousElementSibling","lastOption","lastElementChild","home","end","currentChooserOption","previousChooserOption","toggleFocusableChooserOption","isFocusable","chooserOptionLink","addChooser","chooserOptionHelp","chooserOptionFavourite","manageFavourite","tabIndex","item","fallback","renderSearchResults","_callee4","searchResultsContainer","searchResultsData","templateData","_yield$Templates$rend","_context4","length","sent","_x6","_x7","toggleSearchResultsView","searchQuery","chooserContainer","clearSearchButton","searchIcon","searchResultItemsContainer","firstSearchResultItem","_context5","getBody","searchResults","chooser","elements","clearsearch","searchicon","searchModules","searchResultItems","remove","setAttribute","removeAttribute","_callee5","_x8","_x9","_x10","modules","searchTerm","toLowerCase","activity","activityName","title","activityDesc","includes","push","disableFocusAllChooserOptions","sectionChooserOptions","modalPromise","sectionModules","footerData","Map","module","set","componentname","link","_ref4","_ref5","bodyClickListener","activeSectionId","firstChooserOption","_carousel","searchInput","_context2","default","activetab","getAttribute","getSectionChooserOptions","closeOption","on","getModuleSelector","clearSearch","search","value","_callee2","_x4","footerClickListener","footerjs","_context3","footer","customfooterjs","_callee3","_x5","getBodyPromise","getFooterPromise","registerListenerEvents","getModal","tab","activeSectionChooserOptions","prevActiveSectionId","relatedTarget","prevActiveSectionChooserOptions","setupKeyboardAccessibility","getRoot","hidden","destroy"],"mappings":"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"}