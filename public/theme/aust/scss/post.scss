/* stylelint-disable declaration-no-important */
// AuST Branding Colors
$aust-blue: #036;
$aust-gold: #fdb913;

// --- COMMON STYLES (Applies to ALL Modes) ---

.bg-primary {
    background-color: $aust-blue !important;
}

.text-primary {
    color: $aust-blue !important;
}

a {
    color: $aust-blue;

    &:hover {
        color: darken($aust-blue, 15%);
    }
}

.btn-primary {
    background-color: $aust-blue;
    border-color: $aust-blue;

    &:hover,
    &:focus,
    &:active {
        background-color: darken($aust-blue, 10%);
        border-color: darken($aust-blue, 10%);
    }
}

// Navbar Base Styles
nav.navbar {
    background-color: $aust-blue !important;
    border-bottom: 4px solid $aust-gold !important;

    .navbar-brand {
        color: #fff !important;
        font-weight: bold;
        font-size: 1.25rem;
        display: flex;
        align-items: center;

        &:hover {
            color: #fff !important;
        }
    }

    .nav-link,
    .nav-item .nav-link,
    a {
        color: rgba(255, 255, 255, 0.9) !important;

        &:hover {
            color: $aust-gold !important;
            background-color: rgba(255, 255, 255, 0.1) !important;
        }
    }

    // Always white icons in navbar
    .icon,
    .fa {
        color: #fff !important;
    }
}

// Login Logo (Shared)
.login-container img.img-fluid,
.login-wrapper img.img-fluid {
    content: url([[pix:theme|logo]]);
    max-height: 120px;
    width: auto;
}

// Hide default site name text next to logo on login page only
.pagelayout-login .navbar-brand .site-name {
    display: none !important;
}

// --- LIGHT MODE SPECIFIC ---
@media (prefers-color-scheme: light) {

    // Body Background - Ensure NO pink
    body {
        background-color: #fce4ec; // Resetting to system default or mild color if needed, but user hated pink. 
        // Setting to white/gray standard for now to be safe, or just commenting out the pink one.
        background-color: #fff;
    }

    // Header Dropdown Menu - White text in light mode
    .dropdown-menu,
    nav .dropdown-menu,
    .navbar .dropdown-menu,
    .moremenu .dropdown-menu,
    [data-region="moredropdown"] {
        background-color: #fff !important;
        border: 1px solid #dee2e6 !important;
        color: #000 !important;

        .dropdown-item,
        a.dropdown-item,
        li a {
            color: #000 !important;
            background-color: #fff !important;

            &:hover,
            &:focus {
                background-color: #f8f9fa !important;
                color: #000 !important;
            }
        }
    }

    // Search Button Icon - White on blue background
    .simplesearchform .btn,
    .simplesearchform .btn-submit,
    .simplesearchform button[type="submit"],
    button.btn.btn-submit {
        background-color: $aust-blue !important;
        border-color: $aust-blue !important;

        .icon,
        .fa,
        .fa-magnifying-glass,
        i.icon,
        i.fa {
            color: #fff !important;
        }
    }

    // Notification Popovers - White
    .popover-region-container,
    .popover-region-content,
    .popover-region-notifications .popover-region-content,
    .popover-region-header-container,
    .content-item-container,
    .popover-region-footer-container {
        background-color: #fff !important;
        color: #000 !important;
        border-color: #dee2e6 !important;

        .popover-region-header-text,
        .notification-message,
        .content-item-body,
        div {
            color: #000 !important;
        }

        .content-item-container:hover {
            background-color: #f8f9fa !important;
        }
    }

    // Footer Debugging - White
    .footer-content-debugging {
        background-color: #fff !important;
        color: #000 !important;
        border-top: 1px solid #dee2e6 !important;

        &.footer-dark,
        &.bg-dark,
        &.text-light {
            background-color: #fff !important;
            color: #000 !important;
        }

        .footer-dark-inner {
            background-color: #fff !important;
            color: #000 !important;
        }
    }

    // Login Page - Light Mode Base
    body.pagelayout-login,
    #page-login-index {
        background-image: url([[pix:theme|login_background]]) !important;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-color: transparent !important;
    }

    // Login Card - Light Mode
    body.pagelayout-login .login-container {
        background-color: #fff !important;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        max-width: 500px;
        margin: 0 auto;
        color: #000 !important;
    }

    // Transparent Wrappers
    body.pagelayout-login #page-wrapper,
    body.pagelayout-login #page,
    body.pagelayout-login #page-content {
        background-color: transparent !important;
        background: transparent !important;
    }
}


// --- DARK MODE MIXIN ---
@mixin dark-mode-styles {

    // Global Reset
    body,
    html,
    #page,
    #page-wrapper,
    #page-content,
    .card,
    .userprofile .profile_tree,
    .groupinfobox,
    .main-inner,
    #topofscroll {
        background-color: #121212 !important;
        color: #e0e0e0 !important;
    }

    // Force .bg-white to be dark in dark mode contexts
    .bg-white {
        background-color: #1e1e1e !important;
        color: #e0e0e0 !important;
    }

    // Text & Headers
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    p,
    .text-muted,
    .text-dark {
        color: #f0f0f0 !important;
    }

    // Links
    a {
        color: #64b5f6 !important;

        &:hover {
            color: $aust-gold !important;
        }
    }

    // Login Page (Specific Fixes)
    &.pagelayout-login body,
    body.pagelayout-login,
    #page-login-index {
        background-color: transparent !important;
        background-image: url([[pix:theme|login_background]]) !important;
        background-size: cover;
        background-attachment: fixed;
    }

    body.pagelayout-login .login-container {
        background-color: rgba(0, 0, 0, 0.85) !important;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        box-shadow: none !important;
        color: #fff !important;

        .loginform {
            background-color: transparent !important;
        }

        .form-control {
            background-color: #2c333b !important;
            border-color: #444 !important;
            color: #fff !important;
        }
    }

    // Login Page Wrappers
    body.pagelayout-login #page-wrapper,
    body.pagelayout-login #page,
    body.pagelayout-login #page-content {
        background-color: transparent !important;
        background: transparent !important;
    }

    // Dropdown Menus
    .dropdown-menu,
    #user-action-menu.dropdown-menu,
    .dropdown-menu.show,
    nav .dropdown-menu {
        background-color: #1d2125 !important;
        border-color: #444 !important;
        color: #e6edf3 !important;

        .dropdown-item,
        a,
        .dropdown-toggle {
            color: #e6edf3 !important;

            &:hover,
            &:focus {
                background-color: $aust-blue !important;
                color: #fff !important;
            }
        }

        .dropdown-divider {
            border-top-color: #444 !important;
        }
    }

    // Notifications
    .popover-region-container,
    .popover-region-content-container,
    .popover-region-content,
    .popover-region-header-container,
    .popover-region-footer-container {
        background-color: #1d2125 !important;
        border-color: #444 !important;
        color: #e6edf3 !important;
    }

    .popover-region-header-text {
        color: #fff !important;
    }

    .content-item-container {
        background-color: #1d2125 !important;
        border-bottom: 1px solid #444 !important;

        &:hover {
            background-color: #2c333b !important;
        }

        &.unread {
            background-color: #2a2f35 !important;
        }

        .notification-message {
            color: #e6edf3 !important;
        }
    }

    // Tables
    .table,
    .generaltable {
        color: #e0e0e0 !important;
        background-color: transparent !important;

        th,
        td,
        .cell {
            border-color: #333 !important;
            background-color: transparent !important;
            color: #fff !important;
        }

        &.table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(255, 255, 255, 0.05) !important;
        }
    }

    // Alerts
    .alert {
        background-color: #252525 !important;
        border-color: #333 !important;
        color: #e0e0e0 !important;

        &.alert-info {
            background-color: rgba(0, 75, 135, 0.3) !important;
            border-color: $aust-blue !important;
        }

        &.alert-success {
            background-color: rgba(40, 167, 69, 0.3) !important;
            border-color: #28a745 !important;
        }

        &.alert-warning {
            background-color: rgba(253, 185, 19, 0.2) !important;
            border-color: $aust-gold !important;
        }
    }

    // Forms
    input,
    textarea,
    select,
    .form-control,
    .custom-select {
        background-color: #2c2c2c !important;
        border: 1px solid #444 !important;
        color: #fff !important;

        &:focus {
            background-color: #333 !important;
            border-color: $aust-blue !important;
        }
    }

    // Input Groups (Search boxes)
    .input-group-text,
    .input-group-text.bg-white {
        background-color: #2c2c2c !important;
        border-color: #444 !important;
        color: #fff !important;
    }

    // Quiz
    .que {

        .info,
        .formulation {
            background-color: #1e1e1e !important;
            color: #fff !important;
            border-color: #333 !important;
        }

        .qtext,
        .ablock,
        .prompt,
        .answer,
        label {
            color: #fff !important;
        }
    }

    // Grade Report / User Report
    .user-report-container {
        background-color: transparent !important;
        color: #e0e0e0 !important;

        .table-responsive,
        table.user-grade {
            background-color: transparent !important;
            color: #e0e0e0 !important;

            th,
            td {
                background-color: transparent !important;
                border-color: #444 !important;
            }

            tr.category,
            th.category {
                background-color: #252525 !important;
                color: #fff !important;
            }

            tr.baggt,
            th.baggt,
            td.baggt {
                background-color: #2a2a2a !important;
                color: #fff !important;
            }
        }
    }

    // Chat / Messaging - AGRESSIVE FIXES
    .message-app,
    .message-drawer,
    .header-container,
    .body-container,
    .footer-container,
    .drawer,
    [data-region="message-drawer"],
    [data-region="right-hand-drawer"] {
        background-color: #1e1e1e !important;
        color: #e0e0e0 !important;

        // Force white backgrounds inside here to be dark
        .bg-white {
            background-color: #1e1e1e !important;
            color: #e0e0e0 !important;
        }

        // List items (Conversations)
        .list-group-item {
            background-color: #1e1e1e !important;
            border-color: #333 !important;
            color: #e0e0e0 !important;

            &:hover,
            &.list-group-item-action:hover {
                background-color: #2c333b !important;
                color: #fff !important;
            }
        }

        // Textareas
        textarea {
            background-color: #2c2c2c !important;
            color: #fff !important;
        }
    }

    .message {
        background-color: #333 !important;
        color: #fff !important;
        border: 1px solid #444 !important;

        .time {
            color: #ccc !important;
        }
    }

    // Report Builder
    .reportbuilder-filters-sidebar,
    .filter-group {
        background-color: #1e1e1e !important;
        color: #e0e0e0 !important;

        .filter-header,
        label {
            color: #fff !important;
        }
    }

    // Modals
    .modal-content,
    .moodle-dialogue-base .moodle-dialogue-wrap {
        background-color: #1e1e1e !important;
        border-color: #333 !important;
        color: #e0e0e0 !important;

        .modal-header,
        .modal-footer {
            border-color: #333 !important;
        }

        .close,
        .btn-close {
            filter: invert(1);
            opacity: 1 !important;
        }

        .modal-title,
        h5 {
            color: #fff !important;
        }
    }

    // Drawers
    .drawer,
    .drawer-content {
        background-color: #1e1e1e !important;
        color: #e0e0e0 !important;
    }

    // Navigation - Force Navbar to Dark
    nav.navbar {
        background-color: #1e1e1e !important;
        border-bottom: 4px solid #fdb913 !important; // Keep AuST Gold border

        // Ensure brand text is white
        .navbar-brand {
            color: #fff !important;
        }
    }

    // Navigation Items & Menus
    .moremenu,
    .nav-tabs,
    .secondary-navigation,
    .primary-navigation,
    .navbar-nav {
        background-color: transparent !important;
        border-bottom-color: #444 !important;

        .nav-link {
            background-color: transparent !important;
            color: #e0e0e0 !important;
            border: none !important;

            &:hover,
            &:focus {
                background-color: rgba(255, 255, 255, 0.1) !important;
                color: #fff !important;
            }

            &.active {
                background-color: rgba(255, 255, 255, 0.1) !important; // Translucent active state
                color: #fff !important;
                border-bottom: 3px solid #fdb913 !important; // AuST Gold active indicator to match border
            }
        }
    }

    // Dropdowns (Global Dark Mode)
    .dropdown-menu {
        background-color: #2c2c2c !important;
        border-color: #444 !important;

        .dropdown-item {
            color: #e0e0e0 !important;

            &:hover,
            &:focus {
                background-color: #0f6cbf !important;
                color: #fff !important;
            }
        }
    }

    // CARDS & BLOCKS - Critical Fix for White Areas
    .card,
    .block,
    .card-body,
    .block-cards,
    .activity-item,
    .section-item,
    .custom-card {
        background-color: #1e1e1e !important;
        border-color: #333 !important;
        color: #e0e0e0 !important;
    }

    // Ensure card footers/headers match
    .card-footer,
    .card-header {
        background-color: #252525 !important;
        border-bottom-color: #333 !important;
        border-top-color: #333 !important;
    }

    // Course List & Course Boxes
    .coursebox,
    #frontpage-available-course-list,
    .courses .coursebox,
    .course-content,
    .course-section {
        background-color: #1e1e1e !important;
        border-color: #333 !important;
        color: #e0e0e0 !important;

        .info,
        .content,
        .activity-item,
        .section-item {
            background-color: #1e1e1e !important;
        }

        .coursename a {
            color: #64b5f6 !important;
        }
    }

    // Forms & Settings
    .mform,
    .fcontainer,
    .fitem,
    fieldset.collapsible,
    .settingsform,
    #page-admin-setting-frontpagesettings {
        background-color: #1e1e1e !important;
        color: #e0e0e0 !important;

        legend,
        label,
        .col-form-label {
            color: #e0e0e0 !important;
        }
    }

    // Grader Report
    .gradereport-grader-table,
    .grader-report-grader,
    .path-grade-report-grader,
    .path-grade-report {
        background-color: #1e1e1e !important;
        color: #e0e0e0 !important;

        th.header,
        td.cell {
            background-color: #1e1e1e !important;
            color: #e0e0e0 !important;
            border-color: #333 !important;
        }

        // Sticky headers/columns in grader report
        .floating {
            background-color: #1e1e1e !important;
        }
    }

    // Generic White Background Overrides
    .bg-white,
    .bg-light,
    .white-container {
        background-color: #1e1e1e !important;
        color: #e0e0e0 !important;
    }

    // Fix for Section Lists (White background removal)
    ul.topics,
    ul.weeks,
    ul.section-list,
    .course-content ul.section,
    .course-content-item-content {
        background-color: transparent !important;
    }

    // Fix for "Completion" button and other subtle buttons
    .btn.btn-subtle-body {
        background-color: #2c2c2c !important;
        color: #e0e0e0 !important;
        border: 1px solid #444 !important;

        &:hover,
        &:focus {
            background-color: #333 !important;
            color: #fff !important;
        }
    }

    // Fix for Collapse/Expand Icons
    .icons-collapse-expand {
        color: #fff !important;
        background-color: transparent !important;

        .icon,
        .fa {
            color: #fff !important;
        }
    }

    // Ensure Main Region is Dark
    #region-main,
    .region-main-content {
        background-color: #1e1e1e !important;
        color: #e0e0e0 !important;
    }

    // Links in dark mode (lighter blue)
    a:not(.btn) {
        color: #64b5f6;
    }

    // Footer Popover Button
    .btn-footer-popover {
        &.bg-secondary {
            background-color: #444 !important;
            --bs-bg-opacity: 1;
            color: #fff !important;
        }

        .icon {
            color: #fff !important;
        }

        &:hover {
            background-color: #555 !important;
        }
    }

    // Icons
    .icon,
    .fa,
    .fa-regular,
    .fa-solid,
    i.icon,
    svg.icon {
        color: #fff !important;
    }
}

// --- APPLY DARK MODE ---

// 1. System Preference
@media (prefers-color-scheme: dark) {
    @include dark-mode-styles;
}

// 2. Explicit Theme Attribute (Toggle)
[data-bs-theme="dark"] {
    @include dark-mode-styles;
}