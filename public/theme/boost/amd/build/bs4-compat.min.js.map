{"version":3,"file":"bs4-compat.min.js","sources":["../src/bs4-compat.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n\r\n/**\r\n * Backward compatibility for Bootstrap 5.\r\n *\r\n * This module silently adapts the current page to Bootstrap 5.\r\n * When the Boostrap 4 backward compatibility period ends in MDL-84465,\r\n * this module will be removed.\r\n *\r\n * @module     theme_boost/bs4-compat\r\n * @copyright  2025 Mikel Mart√≠n <mikel@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @deprecated since Moodle 5.0\r\n * @todo       Final deprecation in Moodle 6.0. See MDL-84465.\r\n */\r\n\r\nimport {DefaultAllowlist} from './bootstrap/util/sanitizer';\r\nimport Popover from 'theme_boost/bootstrap/popover';\r\nimport Tooltip from 'theme_boost/bootstrap/tooltip';\r\nimport log from 'core/log';\r\n\r\n/**\r\n * List of Bootstrap 4 elements to replace with Bootstrap 5 elements.\r\n * This list is based on the Bootstrap 4 to 5 migration guide:\r\n * https://getbootstrap.com/docs/5.0/migration/\r\n *\r\n * The list is not exhaustive and it will be updated as needed.\r\n */\r\nconst bootstrapElements = [\r\n    {\r\n        selector: '.alert button.close',\r\n        replacements: [\r\n            {bs4: 'data-dismiss', bs5: 'data-bs-dismiss'},\r\n        ],\r\n    },\r\n    {\r\n        selector: '[data-toggle=\"modal\"]',\r\n        replacements: [\r\n            {bs4: 'data-toggle', bs5: 'data-bs-toggle'},\r\n            {bs4: 'data-target', bs5: 'data-bs-target'},\r\n        ],\r\n    },\r\n    {\r\n        selector: '.modal .modal-header button.close',\r\n        replacements: [\r\n            {bs4: 'data-dismiss', bs5: 'data-bs-dismiss'},\r\n        ],\r\n    },\r\n    {\r\n        selector: '[data-toggle=\"dropdown\"]',\r\n        replacements: [\r\n            {bs4: 'data-toggle', bs5: 'data-bs-toggle'},\r\n        ],\r\n    },\r\n    {\r\n        selector: '[data-toggle=\"collapse\"]',\r\n        replacements: [\r\n            {bs4: 'data-toggle', bs5: 'data-bs-toggle'},\r\n            {bs4: 'data-target', bs5: 'data-bs-target'},\r\n            {bs4: 'data-parent', bs5: 'data-bs-parent'},\r\n        ],\r\n    },\r\n    {\r\n        selector: '.carousel [data-slide]',\r\n        replacements: [\r\n            {bs4: 'data-slide', bs5: 'data-bs-slide'},\r\n            {bs4: 'data-target', bs5: 'data-bs-target'},\r\n        ],\r\n    },\r\n    {\r\n        selector: '[data-toggle=\"tooltip\"]',\r\n        replacements: [\r\n            {bs4: 'data-toggle', bs5: 'data-bs-toggle'},\r\n            {bs4: 'data-placement', bs5: 'data-bs-placement'},\r\n            {bs4: 'data-animation', bs5: 'data-bs-animation'},\r\n            {bs4: 'data-delay', bs5: 'data-bs-delay'},\r\n            {bs4: 'data-title', bs5: 'data-bs-title'},\r\n            {bs4: 'data-html', bs5: 'data-bs-html'},\r\n            {bs4: 'data-trigger', bs5: 'data-bs-trigger'},\r\n            {bs4: 'data-selector', bs5: 'data-bs-selector'},\r\n            {bs4: 'data-container', bs5: 'data-bs-container'},\r\n        ],\r\n    },\r\n    {\r\n        selector: '[data-toggle=\"popover\"]',\r\n        replacements: [\r\n            {bs4: 'data-toggle', bs5: 'data-bs-toggle'},\r\n            {bs4: 'data-content', bs5: 'data-bs-content'},\r\n            {bs4: 'data-placement', bs5: 'data-bs-placement'},\r\n            {bs4: 'data-animation', bs5: 'data-bs-animation'},\r\n            {bs4: 'data-delay', bs5: 'data-bs-delay'},\r\n            {bs4: 'data-title', bs5: 'data-bs-title'},\r\n            {bs4: 'data-html', bs5: 'data-bs-html'},\r\n            {bs4: 'data-trigger', bs5: 'data-bs-trigger'},\r\n            {bs4: 'data-selector', bs5: 'data-bs-selector'},\r\n            {bs4: 'data-container', bs5: 'data-bs-container'},\r\n        ],\r\n    },\r\n    {\r\n        selector: '[data-toggle=\"tab\"]',\r\n        replacements: [\r\n            {bs4: 'data-toggle', bs5: 'data-bs-toggle'},\r\n            {bs4: 'data-target', bs5: 'data-bs-target'},\r\n        ],\r\n    },\r\n];\r\n\r\n/**\r\n * Replace Bootstrap 4 attributes with Bootstrap 5 attributes.\r\n *\r\n * @param {HTMLElement} container The element to search for Bootstrap 4 elements.\r\n */\r\nconst replaceBootstrap4Attributes = (container) => {\r\n    for (const bootstrapElement of bootstrapElements) {\r\n        const elements = container.querySelectorAll(bootstrapElement.selector);\r\n        for (const element of elements) {\r\n            for (const replacement of bootstrapElement.replacements) {\r\n                if (element.hasAttribute(replacement.bs4)) {\r\n                    element.setAttribute(replacement.bs5, element.getAttribute(replacement.bs4));\r\n                    element.removeAttribute(replacement.bs4);\r\n                    log.debug(`Silent Bootstrap 4 to 5 compatibility: ${replacement.bs4} replaced by ${replacement.bs5}`);\r\n                    log.debug(element);\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Ensure Bootstrap 4 components are initialized.\r\n *\r\n * Some elements (tooltip and popovers) needs to be initialized manually after adding the data attributes.\r\n *\r\n * @param {HTMLElement} container The element to search for Bootstrap 4 elements.\r\n */\r\nconst initializeBootsrap4Components = (container) => {\r\n    const popoverConfig = {\r\n        container: 'body',\r\n        trigger: 'focus',\r\n        allowList: Object.assign(DefaultAllowlist, {table: [], thead: [], tbody: [], tr: [], th: [], td: []}),\r\n    };\r\n    container.querySelectorAll('[data-bs-toggle=\"popover\"]').forEach((tooltipTriggerEl) => {\r\n        const popOverInstance = Popover.getInstance(tooltipTriggerEl);\r\n        if (!popOverInstance) {\r\n            new Popover(tooltipTriggerEl, popoverConfig);\r\n        }\r\n    });\r\n\r\n    container.querySelectorAll('[data-bs-toggle=\"tooltip\"]').forEach((tooltipTriggerEl) => {\r\n        const tooltipInstance = Tooltip.getInstance(tooltipTriggerEl);\r\n        if (!tooltipInstance) {\r\n            new Tooltip(tooltipTriggerEl);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Init Bootstrap 4 compatibility.\r\n *\r\n * @deprecated since Moodle 5.0\r\n * @param {HTMLElement} element The element to search for Bootstrap 4 elements.\r\n */\r\nexport const init = (element) => {\r\n    if (!element) {\r\n        element = document;\r\n    }\r\n    replaceBootstrap4Attributes(element);\r\n    initializeBootsrap4Components(element);\r\n};\r\n"],"names":["bootstrapElements","selector","replacements","bs4","bs5","element","document","container","bootstrapElement","elements","querySelectorAll","replacement","hasAttribute","setAttribute","getAttribute","removeAttribute","debug","replaceBootstrap4Attributes","popoverConfig","trigger","allowList","Object","assign","DefaultAllowlist","table","thead","tbody","tr","th","td","forEach","tooltipTriggerEl","Popover","getInstance","Tooltip","initializeBootsrap4Components"],"mappings":";;;;;;;;;;;;;8MA0CMA,kBAAoB,CACtB,CACIC,SAAU,sBACVC,aAAc,CACV,CAACC,IAAK,eAAgBC,IAAK,qBAGnC,CACIH,SAAU,wBACVC,aAAc,CACV,CAACC,IAAK,cAAeC,IAAK,kBAC1B,CAACD,IAAK,cAAeC,IAAK,oBAGlC,CACIH,SAAU,oCACVC,aAAc,CACV,CAACC,IAAK,eAAgBC,IAAK,qBAGnC,CACIH,SAAU,2BACVC,aAAc,CACV,CAACC,IAAK,cAAeC,IAAK,oBAGlC,CACIH,SAAU,2BACVC,aAAc,CACV,CAACC,IAAK,cAAeC,IAAK,kBAC1B,CAACD,IAAK,cAAeC,IAAK,kBAC1B,CAACD,IAAK,cAAeC,IAAK,oBAGlC,CACIH,SAAU,yBACVC,aAAc,CACV,CAACC,IAAK,aAAcC,IAAK,iBACzB,CAACD,IAAK,cAAeC,IAAK,oBAGlC,CACIH,SAAU,0BACVC,aAAc,CACV,CAACC,IAAK,cAAeC,IAAK,kBAC1B,CAACD,IAAK,iBAAkBC,IAAK,qBAC7B,CAACD,IAAK,iBAAkBC,IAAK,qBAC7B,CAACD,IAAK,aAAcC,IAAK,iBACzB,CAACD,IAAK,aAAcC,IAAK,iBACzB,CAACD,IAAK,YAAaC,IAAK,gBACxB,CAACD,IAAK,eAAgBC,IAAK,mBAC3B,CAACD,IAAK,gBAAiBC,IAAK,oBAC5B,CAACD,IAAK,iBAAkBC,IAAK,uBAGrC,CACIH,SAAU,0BACVC,aAAc,CACV,CAACC,IAAK,cAAeC,IAAK,kBAC1B,CAACD,IAAK,eAAgBC,IAAK,mBAC3B,CAACD,IAAK,iBAAkBC,IAAK,qBAC7B,CAACD,IAAK,iBAAkBC,IAAK,qBAC7B,CAACD,IAAK,aAAcC,IAAK,iBACzB,CAACD,IAAK,aAAcC,IAAK,iBACzB,CAACD,IAAK,YAAaC,IAAK,gBACxB,CAACD,IAAK,eAAgBC,IAAK,mBAC3B,CAACD,IAAK,gBAAiBC,IAAK,oBAC5B,CAACD,IAAK,iBAAkBC,IAAK,uBAGrC,CACIH,SAAU,sBACVC,aAAc,CACV,CAACC,IAAK,cAAeC,IAAK,kBAC1B,CAACD,IAAK,cAAeC,IAAK,mCA4DjBC,UACZA,UACDA,QAAUC,UApDmBC,CAAAA,gBAC5B,MAAMC,oBAAoBR,kBAAmB,OACxCS,SAAWF,UAAUG,iBAAiBF,iBAAiBP,cACxD,MAAMI,WAAWI,aACb,MAAME,eAAeH,iBAAiBN,aACnCG,QAAQO,aAAaD,YAAYR,OACjCE,QAAQQ,aAAaF,YAAYP,IAAKC,QAAQS,aAAaH,YAAYR,MACvEE,QAAQU,gBAAgBJ,YAAYR,kBAChCa,uDAAgDL,YAAYR,4BAAmBQ,YAAYP,mBAC3FY,MAAMX,YA6C1BY,CAA4BZ,SA/BOE,CAAAA,kBAC7BW,cAAgB,CAClBX,UAAW,OACXY,QAAS,QACTC,UAAWC,OAAOC,OAAOC,4BAAkB,CAACC,MAAO,GAAIC,MAAO,GAAIC,MAAO,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,MAErGtB,UAAUG,iBAAiB,8BAA8BoB,SAASC,mBACtCC,iBAAQC,YAAYF,uBAEpCC,iBAAQD,iBAAkBb,kBAItCX,UAAUG,iBAAiB,8BAA8BoB,SAASC,mBACtCG,iBAAQD,YAAYF,uBAEpCG,iBAAQH,sBAgBpBI,CAA8B9B"}