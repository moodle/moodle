{"version":3,"file":"content.min.js","sources":["../src/content.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Module to assist with creation and management of content.\r\n *\r\n * @module     editor_tiny/content\r\n * @copyright  Andrew Lyons <andrew@nicols.co.uk>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * Add MathML support to the editor.\r\n *\r\n * @param {TinyMCE} editor\r\n */\r\nexport const addMathMLSupport = (editor) => {\r\n    const getNodeType = (node) => {\r\n        const style = node.attr('style');\r\n        if (style?.includes('display')) {\r\n            if (style.match(/display:[^;]*inline/)) {\r\n                return 'tiny-math-span';\r\n            }\r\n        }\r\n        return 'tiny-math-block';\r\n    };\r\n\r\n\r\n    editor.on('PreInit', () => {\r\n        editor.schema.addCustomElements({\r\n            // Add support for MathML by defining some tiny-math blocks which extends SPAN/DIV.\r\n            // Note: This is blind support and does not check the child content.\r\n            // Any invalid markup will be accepted.\r\n            // Note: We use the same names as the Tiny Premium Math plugin to avoid conflicts if both are enabled.\r\n            math: {\r\n                'extends': 'div',\r\n            },\r\n            'tiny-math-span': {\r\n                'extends': \"span\",\r\n            },\r\n            'tiny-math-block': {\r\n                'extends': \"div\",\r\n            },\r\n        });\r\n\r\n        // Add a Parser filter to wrap math nodes in a tiny-math-[block|span] element.\r\n        editor.parser.addNodeFilter('math', (nodes) => nodes.forEach((node) => {\r\n            if (node.parent) {\r\n                if (node.parent.name === 'tiny-math-block' || node.parent.name === 'tiny-math-span') {\r\n                    // Already wrapped.\r\n                    return;\r\n                }\r\n            }\r\n\r\n            const displayMode = getNodeType(node);\r\n            node.wrap(editor.editorManager.html.Node.create(displayMode, {\r\n                contenteditable: 'false',\r\n            }));\r\n        }));\r\n\r\n        // Add a Serializer filter to remove the tiny-math-[block|span] wrapper.\r\n        editor.serializer.addNodeFilter('tiny-math-span, tiny-math-block', (nodes, name) => nodes.forEach((node) => {\r\n            const displayMode = name.replace('tiny-math-', '');\r\n            node.children().forEach((child) => {\r\n                const currentStyle = child.attr('style');\r\n                if (currentStyle) {\r\n                    child.attr('style', `${currentStyle};display: ${displayMode}`);\r\n                } else {\r\n                    child.attr('style', `display: ${displayMode}`);\r\n                }\r\n            });\r\n            node.unwrap();\r\n        }));\r\n    });\r\n};\r\n\r\n/**\r\n * Add SVG support to the editor.\r\n *\r\n * @param {TinyMCE} editor\r\n */\r\nexport const addSVGSupport = (editor) => {\r\n    editor.on('PreInit', () => {\r\n        editor.schema.addCustomElements({\r\n            // Add support for SVG by defining an SVG tag which extends DIV.\r\n            // Note: This is blind support and does not check the child content.\r\n            // Any invalid markup will be accepted.\r\n            svg: {\r\n                'extends': \"div\",\r\n                'attributes': [\r\n                    \"id\",\r\n                    \"tabindex\",\r\n                    \"lang\",\r\n                    \"xml:space\",\r\n                    \"class\",\r\n                    \"style\",\r\n                    \"x\",\r\n                    \"y\",\r\n                    \"width\",\r\n                    \"height\",\r\n                    \"viewBox\",\r\n                    \"preserveAspectRatio\",\r\n                    \"transform\",\r\n                ],\r\n            },\r\n            'tiny-svg-block': {\r\n                'extends': \"div\",\r\n            },\r\n        });\r\n\r\n        editor.parser.addNodeFilter('svg', (nodes) => nodes.forEach((node) => {\r\n            node.wrap(editor.editorManager.html.Node.create('tiny-svg-block', {\r\n                contenteditable: 'false',\r\n            }));\r\n        }));\r\n        editor.serializer.addNodeFilter('tiny-svg-block', (nodes) => nodes.forEach((node) => {\r\n            node.unwrap();\r\n        }));\r\n    });\r\n};\r\n"],"names":["editor","on","schema","addCustomElements","math","parser","addNodeFilter","nodes","forEach","node","parent","name","displayMode","style","attr","includes","match","getNodeType","wrap","editorManager","html","Node","create","contenteditable","serializer","replace","children","child","currentStyle","unwrap","svg"],"mappings":"uMA4BiCA,SAY7BA,OAAOC,GAAG,WAAW,KACjBD,OAAOE,OAAOC,kBAAkB,CAK5BC,KAAM,SACS,wBAEG,SACH,0BAEI,SACJ,SAKnBJ,OAAOK,OAAOC,cAAc,QAASC,OAAUA,MAAMC,SAASC,UACtDA,KAAKC,SACoB,oBAArBD,KAAKC,OAAOC,MAAmD,mBAArBF,KAAKC,OAAOC,mBAMxDC,YArCOH,CAAAA,aACXI,MAAQJ,KAAKK,KAAK,gBACpBD,MAAAA,OAAAA,MAAOE,SAAS,YACZF,MAAMG,MAAM,uBACL,iBAGR,mBA8BiBC,CAAYR,MAChCA,KAAKS,KAAKlB,OAAOmB,cAAcC,KAAKC,KAAKC,OAAOV,YAAa,CACzDW,gBAAiB,gBAKzBvB,OAAOwB,WAAWlB,cAAc,mCAAmC,CAACC,MAAOI,OAASJ,MAAMC,SAASC,aACzFG,YAAcD,KAAKc,QAAQ,aAAc,IAC/ChB,KAAKiB,WAAWlB,SAASmB,cACfC,aAAeD,MAAMb,KAAK,SAC5Bc,aACAD,MAAMb,KAAK,kBAAYc,kCAAyBhB,cAEhDe,MAAMb,KAAK,2BAAqBF,iBAGxCH,KAAKoB,yCAUa7B,SAC1BA,OAAOC,GAAG,WAAW,KACjBD,OAAOE,OAAOC,kBAAkB,CAI5B2B,IAAK,SACU,iBACG,CACV,KACA,WACA,OACA,YACA,QACA,QACA,IACA,IACA,QACA,SACA,UACA,sBACA,+BAGU,SACH,SAInB9B,OAAOK,OAAOC,cAAc,OAAQC,OAAUA,MAAMC,SAASC,OACzDA,KAAKS,KAAKlB,OAAOmB,cAAcC,KAAKC,KAAKC,OAAO,iBAAkB,CAC9DC,gBAAiB,gBAGzBvB,OAAOwB,WAAWlB,cAAc,kBAAmBC,OAAUA,MAAMC,SAASC,OACxEA,KAAKoB"}