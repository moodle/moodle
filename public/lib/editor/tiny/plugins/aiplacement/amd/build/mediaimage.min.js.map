{"version":3,"file":"mediaimage.min.js","sources":["../src/mediaimage.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * AI Modal for Tiny.\r\n *\r\n * @module      tiny_aiplacement/mediaimage\r\n * @copyright   2024 Matt Porritt <matt.porritt@moodle.com>\r\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport {getString} from 'core/str';\r\nimport MediaImage from 'tiny_media/image/image';\r\nimport Notification from 'core/notification';\r\nimport {prefetchStrings} from 'core/prefetch';\r\nimport {MAX_LENGTH_ALT} from 'tiny_media/image/imagehelpers';\r\n\r\nprefetchStrings('core_ai', [\r\n    'contentwatermark',\r\n]);\r\n\r\nexport default class AiMediaImage extends MediaImage {\r\n    constructor(editor, url, alt) {\r\n        super(editor); // Call the parent class constructor\r\n        this.generatedImageUrl = url;\r\n        this.altText = alt;\r\n        getString('contentwatermark', 'core_ai').then((watermark) => {\r\n            this.watermark = watermark;\r\n            return;\r\n        }).catch(Notification.exception);\r\n    }\r\n\r\n    getSelectedImage() {\r\n        const imgElement = document.createElement('img');\r\n\r\n        // Set attributes for the img element\r\n        imgElement.src = this.generatedImageUrl;\r\n        imgElement.alt = this.truncateAltText(this.altText);\r\n\r\n        return imgElement;\r\n    }\r\n\r\n    /**\r\n     * Truncate the alt text if it is longer than the maximum length.\r\n     * @param {String} altText The alt text\r\n     * @return {string} The truncated alt text\r\n     */\r\n    truncateAltText(altText) {\r\n        const maximumAltTextLength = MAX_LENGTH_ALT;\r\n        const watermark = ' - ' + this.watermark;\r\n        const ellipsis = '...';\r\n\r\n        // Append the watermark to the alt text.\r\n        if (altText.length + watermark.length <= maximumAltTextLength) {\r\n            altText = altText + watermark;\r\n        } else {\r\n            const remainingLength = maximumAltTextLength - watermark.length - ellipsis.length;\r\n            altText = altText.substring(0, remainingLength) + ellipsis + watermark;\r\n        }\r\n        return altText;\r\n    }\r\n}\r\n"],"names":["AiMediaImage","MediaImage","constructor","editor","url","alt","generatedImageUrl","altText","then","watermark","catch","Notification","exception","getSelectedImage","imgElement","document","createElement","src","this","truncateAltText","maximumAltTextLength","MAX_LENGTH_ALT","length","remainingLength","substring"],"mappings":";;;;;;;6MA6BgB,UAAW,CACvB,2BAGiBA,qBAAqBC,eACtCC,YAAYC,OAAQC,IAAKC,WACfF,aACDG,kBAAoBF,SACpBG,QAAUF,uBACL,mBAAoB,WAAWG,MAAMC,iBACtCA,UAAYA,aAElBC,MAAMC,sBAAaC,WAG1BC,yBACUC,WAAaC,SAASC,cAAc,cAG1CF,WAAWG,IAAMC,KAAKZ,kBACtBQ,WAAWT,IAAMa,KAAKC,gBAAgBD,KAAKX,SAEpCO,WAQXK,gBAAgBZ,eACNa,qBAAuBC,6BACvBZ,UAAY,MAAQS,KAAKT,aAI3BF,QAAQe,OAASb,UAAUa,QAAUF,qBACrCb,SAAoBE,cACjB,OACGc,gBAAkBH,qBAAuBX,UAAUa,OAN5C,MAM8DA,OAC3Ef,QAAUA,QAAQiB,UAAU,EAAGD,iBAPlB,MAOgDd,iBAE1DF"}