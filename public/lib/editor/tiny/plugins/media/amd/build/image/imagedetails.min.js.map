{"version":3,"file":"imagedetails.min.js","sources":["../../src/image/imagedetails.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Tiny media plugin image details class for Moodle.\r\n *\r\n * @module      tiny_media/image/imagedetails\r\n * @copyright   2024 Meirza <meirza.arson@moodle.com>\r\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Config from 'core/config';\r\nimport ModalEvents from 'core/modal_events';\r\nimport Notification from 'core/notification';\r\nimport Pending from 'core/pending';\r\nimport Selectors from '../selectors';\r\nimport Templates from 'core/templates';\r\nimport {getString} from 'core/str';\r\nimport {ImageInsert} from './imageinsert';\r\nimport {MediaBase} from '../mediabase';\r\nimport {\r\n    body,\r\n    footer,\r\n    hideElements,\r\n    showElements,\r\n    isPercentageValue,\r\n} from '../helpers';\r\n\r\nexport class ImageDetails extends MediaBase {\r\n    DEFAULTS = {\r\n        WIDTH: 160,\r\n        HEIGHT: 160,\r\n    };\r\n\r\n    selectorType = Selectors.IMAGE.type;\r\n\r\n    mediaDimensions = null;\r\n\r\n    constructor(\r\n        root,\r\n        editor,\r\n        currentModal,\r\n        canShowFilePicker,\r\n        canShowDropZone,\r\n        currentUrl,\r\n        image,\r\n    ) {\r\n        super();\r\n        this.root = root;\r\n        this.editor = editor;\r\n        this.currentModal = currentModal;\r\n        this.canShowFilePicker = canShowFilePicker;\r\n        this.canShowDropZone = canShowDropZone;\r\n        this.currentUrl = currentUrl;\r\n        this.image = image;\r\n        this.toggleMaxlengthFeedbackSuffix = false;\r\n    }\r\n\r\n    init = function() {\r\n        this.currentModal.setTitle(getString('imagedetails', 'tiny_media'));\r\n        this.imageTypeChecked();\r\n        this.presentationChanged();\r\n        this.storeImageDimensions(this.image);\r\n        this.setImageDimensions();\r\n        this.registerEventListeners();\r\n    };\r\n\r\n    /**\r\n     * Loads and displays a preview image based on the provided URL, and handles image loading events.\r\n     */\r\n    loadInsertImage = async function() {\r\n        const templateContext = {\r\n            elementid: this.editor.id,\r\n            showfilepicker: this.canShowFilePicker,\r\n            showdropzone: this.canShowDropZone,\r\n            bodyTemplate: Selectors.IMAGE.template.body.insertImageBody,\r\n            footerTemplate: Selectors.IMAGE.template.footer.insertImageFooter,\r\n            selector: Selectors.IMAGE.type,\r\n        };\r\n\r\n        Promise.all([body(templateContext, this.root), footer(templateContext, this.root)])\r\n            .then(() => {\r\n                const imageinsert = new ImageInsert(\r\n                    this.root,\r\n                    this.editor,\r\n                    this.currentModal,\r\n                    this.canShowFilePicker,\r\n                    this.canShowDropZone,\r\n                );\r\n                imageinsert.init();\r\n                return;\r\n            })\r\n            .catch(error => {\r\n                window.console.log(error);\r\n            });\r\n    };\r\n\r\n    storeImageDimensions(image) {\r\n        // Store dimensions of the raw image, falling back to defaults for images without dimensions (e.g. SVG).\r\n        this.mediaDimensions = {\r\n            width: image.width || this.DEFAULTS.WIDTH,\r\n            height: image.height || this.DEFAULTS.HEIGHT,\r\n        };\r\n\r\n        const getCurrentWidth = (element) => {\r\n            if (element.value === '') {\r\n                element.value = this.mediaDimensions.width;\r\n            }\r\n            return element.value;\r\n        };\r\n\r\n        const getCurrentHeight = (element) => {\r\n            if (element.value === '') {\r\n                element.value = this.mediaDimensions.height;\r\n            }\r\n            return element.value;\r\n        };\r\n\r\n        const widthInput = this.root.querySelector(Selectors.IMAGE.elements.width);\r\n        const currentWidth = getCurrentWidth(widthInput);\r\n\r\n        const heightInput = this.root.querySelector(Selectors.IMAGE.elements.height);\r\n        const currentHeight = getCurrentHeight(heightInput);\r\n\r\n        const preview = this.root.querySelector(Selectors.IMAGE.elements.preview);\r\n        preview.setAttribute('src', image.src);\r\n        preview.style.display = '';\r\n\r\n        /**\r\n         * Sets the selected size option based on current width and height values.\r\n         *\r\n         * @param {number} currentWidth - The current width value.\r\n         * @param {number} currentHeight - The current height value.\r\n         */\r\n        const setSelectedSize = (currentWidth, currentHeight) => {\r\n            if (this.mediaDimensions.width === currentWidth &&\r\n                this.mediaDimensions.height === currentHeight\r\n            ) {\r\n                this.currentWidth = this.mediaDimensions.width;\r\n                this.currentHeight = this.mediaDimensions.height;\r\n                this.sizeChecked('original');\r\n            } else {\r\n                this.currentWidth = currentWidth;\r\n                this.currentHeight = currentHeight;\r\n                this.sizeChecked('custom');\r\n            }\r\n        };\r\n\r\n        setSelectedSize(Number(currentWidth), Number(currentHeight));\r\n    }\r\n\r\n    /**\r\n     * Sets the dimensions of the image preview element based on user input and constraints.\r\n     */\r\n    setImageDimensions = () => {\r\n        const imagePreviewBox = this.root.querySelector(Selectors.IMAGE.elements.previewBox);\r\n        const image = this.root.querySelector(Selectors.IMAGE.elements.preview);\r\n        const widthField = this.root.querySelector(Selectors.IMAGE.elements.width);\r\n        const heightField = this.root.querySelector(Selectors.IMAGE.elements.height);\r\n\r\n        const updateImageDimensions = () => {\r\n            // Get the latest dimensions of the preview box for responsiveness.\r\n            const boxWidth = imagePreviewBox.clientWidth;\r\n            const boxHeight = imagePreviewBox.clientHeight;\r\n            // Get the new width and height for the image.\r\n            const dimensions = this.fitSquareIntoBox(widthField.value, heightField.value, boxWidth, boxHeight);\r\n            image.style.width = `${dimensions.width}px`;\r\n            image.style.height = `${dimensions.height}px`;\r\n        };\r\n        // If the client size is zero, then get the new dimensions once the modal is shown.\r\n        if (imagePreviewBox.clientWidth === 0) {\r\n            // Call the shown event.\r\n            this.currentModal.getRoot().on(ModalEvents.shown, () => {\r\n                updateImageDimensions();\r\n            });\r\n        } else {\r\n            updateImageDimensions();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Handles changes in the image presentation checkbox and enables/disables the image alt text input accordingly.\r\n     */\r\n    async presentationChanged() {\r\n        const presentation = this.root.querySelector(Selectors.IMAGE.elements.presentation);\r\n        const alt = this.root.querySelector(Selectors.IMAGE.elements.alt);\r\n        alt.disabled = presentation.checked;\r\n\r\n        // Counting the image description characters.\r\n        await this.handleKeyupCharacterCount();\r\n    }\r\n\r\n    /**\r\n     * This function checks whether an image URL is local (within the same website's domain) or external (from an external source).\r\n     * Depending on the result, it dynamically updates the visibility and content of HTML elements in a user interface.\r\n     * If the image is local then we only show it's filename.\r\n     * If the image is external then it will show full URL and it can be updated.\r\n     */\r\n    imageTypeChecked() {\r\n        const regex = new RegExp(`${Config.wwwroot}`);\r\n\r\n        // True if the URL is from external, otherwise false.\r\n        const isExternalUrl = regex.test(this.currentUrl) === false;\r\n\r\n        // Hide the URL input.\r\n        hideElements(Selectors.IMAGE.elements.url, this.root);\r\n\r\n        if (!isExternalUrl) {\r\n            // Split the URL by '/' to get an array of segments.\r\n            const segments = this.currentUrl.split('/');\r\n            // Get the last segment, which should be the filename.\r\n            const filename = segments.pop().split('?')[0];\r\n            // Show the file name.\r\n            this.setFilenameLabel(decodeURI(filename));\r\n        } else {\r\n\r\n            this.setFilenameLabel(decodeURI(this.currentUrl));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the string for the URL label element.\r\n     *\r\n     * @param {string} label - The label text to set.\r\n     */\r\n    setFilenameLabel(label) {\r\n        const urlLabelEle = this.root.querySelector(Selectors.IMAGE.elements.fileNameLabel);\r\n        if (urlLabelEle) {\r\n            urlLabelEle.innerHTML = label;\r\n            urlLabelEle.setAttribute(\"title\", label);\r\n        }\r\n    }\r\n\r\n    toggleAriaInvalid(selectors, predicate) {\r\n        selectors.forEach((selector) => {\r\n            const elements = this.root.querySelectorAll(selector);\r\n            elements.forEach((element) => element.setAttribute('aria-invalid', predicate));\r\n        });\r\n    }\r\n\r\n    hasErrorUrlField() {\r\n        const urlError = this.currentUrl === '';\r\n        if (urlError) {\r\n            showElements(Selectors.IMAGE.elements.urlWarning, this.root);\r\n        } else {\r\n            hideElements(Selectors.IMAGE.elements.urlWarning, this.root);\r\n        }\r\n        this.toggleAriaInvalid([Selectors.IMAGE.elements.url], urlError);\r\n\r\n        return urlError;\r\n    }\r\n\r\n    hasErrorAltField() {\r\n        const alt = this.root.querySelector(Selectors.IMAGE.elements.alt).value;\r\n        const presentation = this.root.querySelector(Selectors.IMAGE.elements.presentation).checked;\r\n        const imageAltError = alt === '' && !presentation;\r\n        if (imageAltError) {\r\n            showElements(Selectors.IMAGE.elements.altWarning, this.root);\r\n        } else {\r\n            hideElements(Selectors.IMAGE.elements.altWarning, this.root);\r\n        }\r\n        this.toggleAriaInvalid([Selectors.IMAGE.elements.alt, Selectors.IMAGE.elements.presentation], imageAltError);\r\n\r\n        return imageAltError;\r\n    }\r\n\r\n    setImage() {\r\n        const pendingPromise = new Pending('tiny_media:setImage');\r\n        const url = this.currentUrl;\r\n        if (url === '') {\r\n            return;\r\n        }\r\n\r\n        // Check if there are any accessibility issues.\r\n        if (this.hasErrorUrlField() || this.hasErrorAltField()) {\r\n            pendingPromise.resolve();\r\n            return;\r\n        }\r\n\r\n        // Check for invalid width or height.\r\n        const width = this.root.querySelector(Selectors.IMAGE.elements.width).value;\r\n        if (!isPercentageValue(width) && isNaN(parseInt(width, 10))) {\r\n            this.root.querySelector(Selectors.IMAGE.elements.width).focus();\r\n            pendingPromise.resolve();\r\n            return;\r\n        }\r\n\r\n        const height = this.root.querySelector(Selectors.IMAGE.elements.height).value;\r\n        if (!isPercentageValue(height) && isNaN(parseInt(height, 10))) {\r\n            this.root.querySelector(Selectors.IMAGE.elements.height).focus();\r\n            pendingPromise.resolve();\r\n            return;\r\n        }\r\n\r\n        const imageContext = {\r\n            url: this.currentUrl,\r\n            alt: this.root.querySelector(Selectors.IMAGE.elements.alt).value,\r\n            width: this.root.querySelector(Selectors.IMAGE.elements.width).value,\r\n            height: this.root.querySelector(Selectors.IMAGE.elements.height).value,\r\n            presentation: this.root.querySelector(Selectors.IMAGE.elements.presentation).checked,\r\n            customStyle: this.root.querySelector(Selectors.IMAGE.elements.customStyle).value,\r\n        };\r\n\r\n        Templates.render('tiny_media/image/image', imageContext)\r\n        .then((html) => {\r\n            this.editor.insertContent(html);\r\n            this.currentModal.destroy();\r\n            pendingPromise.resolve();\r\n\r\n            return html;\r\n        })\r\n        .catch(error => {\r\n            window.console.log(error);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Deletes the image after confirming with the user and loads the insert image page.\r\n     */\r\n    deleteImage() {\r\n        Notification.deleteCancelPromise(\r\n            getString('deleteimage', 'tiny_media'),\r\n            getString('deleteimagewarning', 'tiny_media'),\r\n        ).then(() => {\r\n            hideElements(Selectors.IMAGE.elements.altWarning, this.root);\r\n            // Removing the image in the preview will bring the user to the insert page.\r\n            this.loadInsertImage();\r\n            return;\r\n        }).catch(() => {\r\n            // User cancelled the delete action.\r\n            return;\r\n        });\r\n    }\r\n\r\n    registerEventListeners() {\r\n        const submitAction = this.root.querySelector(Selectors.IMAGE.actions.submit);\r\n        submitAction.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            this.setImage();\r\n        });\r\n\r\n        const deleteImageEle = this.root.querySelector(Selectors.IMAGE.actions.deleteImage);\r\n        deleteImageEle.addEventListener('click', () => {\r\n            this.deleteImage();\r\n        });\r\n        deleteImageEle.addEventListener(\"keydown\", (e) => {\r\n            if (e.key === \"Enter\") {\r\n                this.deleteImage();\r\n            }\r\n        });\r\n\r\n        this.root.addEventListener('change', async(e) => {\r\n            const presentationEle = e.target.closest(Selectors.IMAGE.elements.presentation);\r\n            if (presentationEle) {\r\n                await this.presentationChanged();\r\n            }\r\n        });\r\n\r\n        const customSize = this.root.querySelector(Selectors.IMAGE.elements.customSizeToggle);\r\n        if (customSize) {\r\n            customSize.addEventListener('click', (e) => {\r\n                e.preventDefault();\r\n                this.sizeChecked('custom');\r\n            });\r\n        }\r\n\r\n        const originalSize = this.root.querySelector(Selectors.IMAGE.elements.originalSizeToggle);\r\n        if (originalSize) {\r\n            originalSize.addEventListener('click', (e) => {\r\n                e.preventDefault();\r\n                this.sizeChecked('original');\r\n            });\r\n        }\r\n\r\n        this.root.addEventListener('blur', async(e) => {\r\n            if (e.target.nodeType === Node.ELEMENT_NODE) {\r\n\r\n                const presentationEle = e.target.closest(Selectors.IMAGE.elements.presentation);\r\n                if (presentationEle) {\r\n                    await this.presentationChanged();\r\n                }\r\n            }\r\n        }, true);\r\n\r\n        // Character count.\r\n        this.root.addEventListener('keyup', async(e) => {\r\n            const altEle = e.target.closest(Selectors.IMAGE.elements.alt);\r\n            if (altEle) {\r\n                await this.handleKeyupCharacterCount();\r\n            }\r\n        });\r\n\r\n        this.root.addEventListener('input', (e) => {\r\n            const widthEle = e.target.closest(Selectors.IMAGE.elements.width);\r\n            if (widthEle) {\r\n                // Avoid empty value.\r\n                widthEle.value = widthEle.value === \"\" ? 0 : Number(widthEle.value);\r\n                this.autoAdjustSize();\r\n            }\r\n\r\n            const heightEle = e.target.closest(Selectors.IMAGE.elements.height);\r\n            if (heightEle) {\r\n                // Avoid empty value.\r\n                heightEle.value = heightEle.value === \"\" ? 0 : Number(heightEle.value);\r\n                this.autoAdjustSize(true);\r\n            }\r\n        });\r\n    }\r\n\r\n    async handleKeyupCharacterCount() {\r\n        const altField = this.root.querySelector(Selectors.IMAGE.elements.alt);\r\n        const alt = altField.value;\r\n        const current = this.root.querySelector('#currentcount');\r\n        current.innerHTML = alt.length;\r\n        const maxLength = altField.getAttribute('maxlength');\r\n        const maxLengthFeedback = document.getElementById('maxlength_feedback');\r\n        if (alt.length >= maxLength) {\r\n            maxLengthFeedback.textContent = await getString('maxlengthreached', 'core', maxLength);\r\n\r\n            // Clever (or hacky?;p) way to ensure that the feedback message is announced to screen readers.\r\n            const suffix = this.toggleMaxlengthFeedbackSuffix ? '' : '.';\r\n            maxLengthFeedback.textContent += suffix;\r\n            this.toggleMaxlengthFeedbackSuffix = !this.toggleMaxlengthFeedbackSuffix;\r\n\r\n            // Clear the feedback message after 4 seconds. This is similar to the default timeout of toast messages\r\n            // before disappearing from view. It is important to clear the message to prevent screen reader users from navigating\r\n            // into this region and avoiding confusion.\r\n            setTimeout(() => {\r\n                maxLengthFeedback.textContent = '';\r\n            }, 4000);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Calculates the dimensions to fit a square into a specified box while maintaining aspect ratio.\r\n     *\r\n     * @param {number} squareWidth - The width of the square.\r\n     * @param {number} squareHeight - The height of the square.\r\n     * @param {number} boxWidth - The width of the box.\r\n     * @param {number} boxHeight - The height of the box.\r\n     * @returns {Object} An object with the new width and height of the square to fit in the box.\r\n     */\r\n    fitSquareIntoBox = (squareWidth, squareHeight, boxWidth, boxHeight) => {\r\n        if (squareWidth < boxWidth && squareHeight < boxHeight) {\r\n          // If the square is smaller than the box, keep its dimensions.\r\n          return {\r\n            width: squareWidth,\r\n            height: squareHeight,\r\n          };\r\n        }\r\n        // Calculate the scaling factor based on the minimum scaling required to fit in the box.\r\n        const widthScaleFactor = boxWidth / squareWidth;\r\n        const heightScaleFactor = boxHeight / squareHeight;\r\n        const minScaleFactor = Math.min(widthScaleFactor, heightScaleFactor);\r\n        // Scale the square's dimensions based on the aspect ratio and the minimum scaling factor.\r\n        const newWidth = squareWidth * minScaleFactor;\r\n        const newHeight = squareHeight * minScaleFactor;\r\n        return {\r\n          width: newWidth,\r\n          height: newHeight,\r\n        };\r\n    };\r\n}\r\n"],"names":["ImageDetails","MediaBase","constructor","root","editor","currentModal","canShowFilePicker","canShowDropZone","currentUrl","image","WIDTH","HEIGHT","Selectors","IMAGE","type","setTitle","imageTypeChecked","presentationChanged","storeImageDimensions","this","setImageDimensions","registerEventListeners","async","templateContext","elementid","id","showfilepicker","showdropzone","bodyTemplate","template","body","insertImageBody","footerTemplate","footer","insertImageFooter","selector","Promise","all","then","ImageInsert","init","catch","error","window","console","log","imagePreviewBox","querySelector","elements","previewBox","preview","widthField","width","heightField","height","updateImageDimensions","boxWidth","clientWidth","boxHeight","clientHeight","dimensions","fitSquareIntoBox","value","style","getRoot","on","ModalEvents","shown","squareWidth","squareHeight","widthScaleFactor","heightScaleFactor","minScaleFactor","Math","min","toggleMaxlengthFeedbackSuffix","mediaDimensions","DEFAULTS","currentWidth","element","getCurrentWidth","currentHeight","getCurrentHeight","setAttribute","src","display","sizeChecked","setSelectedSize","Number","presentation","alt","disabled","checked","handleKeyupCharacterCount","isExternalUrl","RegExp","Config","wwwroot","test","url","setFilenameLabel","decodeURI","filename","split","pop","label","urlLabelEle","fileNameLabel","innerHTML","toggleAriaInvalid","selectors","predicate","forEach","querySelectorAll","hasErrorUrlField","urlError","urlWarning","hasErrorAltField","imageAltError","altWarning","setImage","pendingPromise","Pending","resolve","isNaN","parseInt","focus","imageContext","customStyle","render","html","insertContent","destroy","deleteImage","deleteCancelPromise","loadInsertImage","actions","submit","addEventListener","e","preventDefault","deleteImageEle","key","target","closest","customSize","customSizeToggle","originalSize","originalSizeToggle","nodeType","Node","ELEMENT_NODE","widthEle","autoAdjustSize","heightEle","altField","length","maxLength","getAttribute","maxLengthFeedback","document","getElementById","textContent","suffix","setTimeout"],"mappings":"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"}