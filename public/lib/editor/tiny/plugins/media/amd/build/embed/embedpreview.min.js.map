{"version":3,"file":"embedpreview.min.js","sources":["../../src/embed/embedpreview.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Tiny media plugin embed preview and details class.\r\n *\r\n * This handles the embed file/url preview before embedding them into tiny editor.\r\n *\r\n * @module      tiny_media/embed/embedpreview\r\n * @copyright   2024 Stevani Andolo <stevani@hotmail.com.au>\r\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Selectors from '../selectors';\r\nimport {component} from '../common';\r\nimport {getString} from 'core/str';\r\nimport {\r\n    sourceTypeChecked,\r\n    getFileName,\r\n    setPropertiesFromData,\r\n    showElements,\r\n    stopMediaLoading,\r\n    hideElements,\r\n} from '../helpers';\r\nimport {EmbedHandler} from './embedhandler';\r\nimport {MediaBase} from '../mediabase';\r\nimport Notification from 'core/notification';\r\nimport EmbedModal from './embedmodal';\r\nimport {\r\n    getEmbeddedMediaDetails,\r\n    insertMediaThumbnailTemplateContext,\r\n    fetchPreview,\r\n} from './embedhelpers';\r\nimport {notifyFilterContentUpdated} from 'core_filters/events';\r\n\r\nexport class EmbedPreview extends MediaBase {\r\n\r\n    // Selector type for \"EMBED\".\r\n    selectorType = Selectors.EMBED.type;\r\n\r\n    // Fixed aspect ratio used for external media providers.\r\n    linkMediaAspectRatio = 1.78;\r\n\r\n    constructor(data) {\r\n        super();\r\n        setPropertiesFromData(this, data); // Creates dynamic properties based on \"data\" param.\r\n    }\r\n\r\n    /**\r\n     * Init the media details preview.\r\n     */\r\n    init = async() => {\r\n        this.currentModal.setTitle(getString('mediadetails', component));\r\n        sourceTypeChecked({\r\n            fetchedTitle: this.fetchedMediaLinkTitle ?? null,\r\n            source: this.originalUrl,\r\n            root: this.root,\r\n            urlSelector: Selectors.EMBED.elements.fromUrl,\r\n            fileNameSelector: Selectors.EMBED.elements.fileNameLabel,\r\n        });\r\n        this.setMediaSourceAndPoster();\r\n        this.registerMediaDetailsEventListeners(this.currentModal);\r\n    };\r\n\r\n    /**\r\n     * Sets media source and thumbnail for the video.\r\n     */\r\n    setMediaSourceAndPoster = async() => {\r\n        const box = this.root.querySelector(Selectors.EMBED.elements.previewBox);\r\n        const previewArea = document.querySelector(Selectors.EMBED.elements.mediaPreviewContainer);\r\n        previewArea.setAttribute('data-original-url', this.originalUrl);\r\n\r\n        // Previewing existing media could be a link one.\r\n        // Or, new media added using url input and mediaType is neither video or audio.\r\n        if (this.mediaType === 'link' || (this.newMediaLink && !['video', 'audio'].includes(this.mediaType))) {\r\n            previewArea.setAttribute('data-media-type', 'link');\r\n            previewArea.innerHTML = await fetchPreview(this.originalUrl, this.contextId);\r\n            notifyFilterContentUpdated(previewArea);\r\n        } else if (this.mediaType === 'video') {\r\n            const video = document.createElement('video');\r\n            video.src = this.originalUrl;\r\n\r\n            // Media url can be played using html video.\r\n            video.addEventListener('loadedmetadata', () => {\r\n                const videoHeight = video.videoHeight;\r\n                const videoWidth = video.videoWidth;\r\n                const widthProportion = (videoWidth - videoHeight);\r\n                const isLandscape = widthProportion > 0;\r\n\r\n                // Store dimensions of the raw video.\r\n                this.mediaDimensions = {\r\n                    width: videoWidth,\r\n                    height: videoHeight,\r\n                };\r\n\r\n                // Set the media preview based on the media dimensions.\r\n                if (isLandscape) {\r\n                    video.width = box.offsetWidth;\r\n                } else {\r\n                    video.height = box.offsetHeight;\r\n                }\r\n\r\n                const height = this.root.querySelector(Selectors.EMBED.elements.height);\r\n                const width = this.root.querySelector(Selectors.EMBED.elements.width);\r\n\r\n                if (height.value === '' && width.value === '') {\r\n                    height.value = videoHeight;\r\n                    width.value = videoWidth;\r\n                }\r\n\r\n                // Size checking and adjustment.\r\n                if (videoHeight === parseInt(height.value) && videoWidth === parseInt(width.value)) {\r\n                    this.currentWidth = this.mediaDimensions.width;\r\n                    this.currentHeight = this.mediaDimensions.height;\r\n                    this.sizeChecked('original');\r\n                } else {\r\n                    this.currentWidth = parseInt(width.value);\r\n                    this.currentHeight = parseInt(height.value);\r\n                    this.sizeChecked('custom');\r\n                }\r\n            });\r\n\r\n            video.controls = true;\r\n            if (this.media.poster) {\r\n                previewArea.setAttribute('data-media-poster', this.media.poster);\r\n                if (!video.classList.contains('w-100')) {\r\n                    video.classList.add('w-100');\r\n                }\r\n                video.poster = this.media.poster;\r\n            }\r\n            video.load();\r\n\r\n            previewArea.setAttribute('data-media-type', 'video');\r\n            previewArea.innerHTML = video.outerHTML;\r\n            notifyFilterContentUpdated(previewArea);\r\n        } else if (this.mediaType === 'audio') {\r\n            const audio = document.createElement('audio');\r\n            audio.src = this.originalUrl;\r\n            audio.controls = true;\r\n            audio.load();\r\n\r\n            previewArea.setAttribute('data-media-type', 'audio');\r\n            previewArea.innerHTML = audio.outerHTML;\r\n            notifyFilterContentUpdated(previewArea);\r\n        } else {\r\n            // Show warning notification.\r\n            const urlWarningLabelEle = this.root.querySelector(Selectors.EMBED.elements.urlWarning);\r\n            urlWarningLabelEle.innerHTML = await getString('medianotavailabledesc', component, this.originalUrl);\r\n            showElements(Selectors.EMBED.elements.urlWarning, this.root);\r\n\r\n            // Stop the spinner.\r\n            stopMediaLoading(this.root, Selectors.EMBED.type);\r\n\r\n            // Reset the upload form.\r\n            (new EmbedHandler(this)).resetUploadForm();\r\n            return;\r\n        }\r\n\r\n        // Stop the loader and display back the body template when the media is loaded.\r\n        stopMediaLoading(this.root, Selectors.EMBED.type);\r\n        showElements(Selectors.EMBED.elements.mediaDetailsBody, this.root);\r\n\r\n        // Set the media name/title.\r\n        this.root.querySelector(Selectors.EMBED.elements.title).value = this.setMediaTitle();\r\n    };\r\n\r\n    /**\r\n     * Set media name/title.\r\n     *\r\n     * @returns {string}\r\n     */\r\n    setMediaTitle = () => {\r\n        // Getting and setting up media title/name.\r\n        let fileName = null;\r\n        if (['video', 'audio'].includes(this.mediaType)) {\r\n            fileName = getFileName(this.originalUrl); // Get original filename.\r\n        } else if (this.fetchedMediaLinkTitle) {\r\n            fileName = this.fetchedMediaLinkTitle;\r\n        } else {\r\n            fileName = this.originalUrl;\r\n        }\r\n\r\n        if (this.isUpdating) {\r\n            if (!this.newMediaLink) {\r\n                fileName = this.mediaTitle; // Title from the selected media.\r\n            }\r\n        }\r\n\r\n        return fileName;\r\n    };\r\n\r\n    /**\r\n     * Deletes the media after confirming with the user and loads the insert media page.\r\n     */\r\n    deleteMedia = () => {\r\n        Notification.deleteCancelPromise(\r\n            getString('deletemedia', component),\r\n            getString('deletemediawarning', component),\r\n        ).then(() => {\r\n            // Reset media upload form.\r\n            (new EmbedHandler(this)).resetUploadForm();\r\n\r\n            // Delete any selected media mediaData.\r\n            delete this.mediaData;\r\n            return;\r\n        }).catch(error => {\r\n            window.console.log(error);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Delete embedded media thumbnail.\r\n     */\r\n    deleteEmbeddedThumbnail = () => {\r\n        Notification.deleteCancelPromise(\r\n            getString('deleteembeddedthumbnail', component),\r\n            getString('deleteembeddedthumbnailwarning', component),\r\n        ).then(async() => {\r\n            if (this.mediaType === 'video') {\r\n                const video = this.root.querySelector('video');\r\n                if (video) {\r\n                    video.removeAttribute('poster');\r\n                    const preview = this.root.querySelector(Selectors.EMBED.elements.mediaPreviewContainer);\r\n                    preview.removeAttribute('data-media-poster');\r\n                }\r\n            }\r\n\r\n            const deleteCustomThumbnail = this.root.querySelector(Selectors.EMBED.actions.deleteCustomThumbnail);\r\n            deleteCustomThumbnail.remove();\r\n\r\n            const uploadCustomThumbnail = this.root.querySelector(Selectors.EMBED.actions.uploadCustomThumbnail);\r\n            uploadCustomThumbnail.textContent = await getString('uploadthumbnail', component);\r\n            return;\r\n        }).catch(error => {\r\n            window.console.log(error);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Shows the insert thumbnail dialogue.\r\n     */\r\n    showUploadThumbnail = async() => {\r\n        const uploadThumbnailModal = await EmbedModal.create({\r\n            large: true,\r\n            templateContext: {elementid: this.editor.getElement().id},\r\n        });\r\n        const root = uploadThumbnailModal.getRoot()[0];\r\n\r\n        // Get selected media metadata.\r\n        const mediaData = getEmbeddedMediaDetails(this);\r\n        mediaData.isUpdating = this.isUpdating;\r\n\r\n        const embedHandler = new EmbedHandler(this);\r\n        embedHandler.loadInsertThumbnailTemplatePromise(\r\n            insertMediaThumbnailTemplateContext(this), // Get template context for creating media thumbnail.\r\n            {root, uploadThumbnailModal}, // Required root elements.\r\n            await embedHandler.getMediaTemplateContext(mediaData) // Get current media data.\r\n        );\r\n    };\r\n\r\n    /**\r\n     * Only registers event listeners for new loaded elements in embed preview modal.\r\n     */\r\n    registerMediaDetailsEventListeners = async() => {\r\n        // Handle the original size when selected.\r\n        const originalSize = this.root.querySelector(Selectors.EMBED.elements.originalSizeToggle);\r\n        if (originalSize) {\r\n            originalSize.addEventListener('click', (e) => {\r\n                e.preventDefault();\r\n                this.sizeChecked('original');\r\n            });\r\n        }\r\n\r\n        // Handle the custom size when selected.\r\n        const customSize = this.root.querySelector(Selectors.EMBED.elements.customSizeToggle);\r\n        if (customSize) {\r\n            customSize.addEventListener('click', (e) => {\r\n                e.preventDefault();\r\n                this.sizeChecked('custom');\r\n            });\r\n        }\r\n\r\n        const widthEle = this.root.querySelector(Selectors.EMBED.elements.width);\r\n        const heightEle = this.root.querySelector(Selectors.EMBED.elements.height);\r\n\r\n        // Handle the custom with size when inputted.\r\n        if (widthEle) {\r\n            widthEle.addEventListener('input', () => {\r\n                if (this.mediaType === 'link') {\r\n                    // Let's apply the 16:9 aspect ratio if it's a link media type.\r\n                    heightEle.value = Math.round(widthEle.value / this.linkMediaAspectRatio);\r\n                } else {\r\n                    // Avoid empty value.\r\n                    widthEle.value = widthEle.value === \"\" ? 0 : Number(widthEle.value);\r\n                    this.autoAdjustSize();\r\n                }\r\n            });\r\n        }\r\n\r\n        // Handle the custom height size when inputted.\r\n        if (heightEle) {\r\n            heightEle.addEventListener('input', () => {\r\n                if (this.mediaType === 'link') {\r\n                    // Let's apply the 16:9 aspect ratio if it's a link media type.\r\n                    widthEle.value = Math.round(heightEle.value * this.linkMediaAspectRatio);\r\n                } else {\r\n                    // Avoid empty value.\r\n                    heightEle.value = heightEle.value === \"\" ? 0 : Number(heightEle.value);\r\n                    this.autoAdjustSize(true);\r\n                }\r\n            });\r\n        }\r\n\r\n        // Handle media preview delete.\r\n        const deleteMedia = this.root.querySelector(Selectors.EMBED.actions.deleteMedia);\r\n        if (deleteMedia) {\r\n            deleteMedia.addEventListener('click', (e) => {\r\n                e.preventDefault();\r\n                this.deleteMedia();\r\n            });\r\n        }\r\n\r\n        // Show subtitles and captions settings.\r\n        const showSubtitleCaption = this.root.querySelector(Selectors.EMBED.actions.showSubtitleCaption);\r\n        if (showSubtitleCaption) {\r\n            showSubtitleCaption.addEventListener('click', (e) => {\r\n                e.preventDefault();\r\n                hideElements([\r\n                    Selectors.EMBED.actions.showSubtitleCaption,\r\n                    Selectors.EMBED.actions.cancelMediaDetails,\r\n                    Selectors.EMBED.elements.mediaDetailsBody,\r\n                ], this.root);\r\n                showElements([\r\n                    Selectors.EMBED.actions.backToMediaDetails,\r\n                    Selectors.EMBED.elements.mediaSubtitleCaptionBody,\r\n                ], this.root);\r\n            });\r\n        }\r\n\r\n        // Back to media preview.\r\n        const backToMediaDetails = this.root.querySelector(Selectors.EMBED.actions.backToMediaDetails);\r\n        if (backToMediaDetails) {\r\n            backToMediaDetails.addEventListener('click', () => {\r\n                hideElements([\r\n                    Selectors.EMBED.actions.backToMediaDetails,\r\n                    Selectors.EMBED.elements.mediaSubtitleCaptionBody,\r\n                ], this.root);\r\n                showElements([\r\n                    Selectors.EMBED.actions.showSubtitleCaption,\r\n                    Selectors.EMBED.actions.cancelMediaDetails,\r\n                    Selectors.EMBED.elements.mediaDetailsBody,\r\n                ], this.root);\r\n            });\r\n        }\r\n\r\n        // Handles upload media thumbnail.\r\n        const uploadCustomThumbnail = this.root.querySelector(Selectors.EMBED.actions.uploadCustomThumbnail);\r\n        if (uploadCustomThumbnail) {\r\n            uploadCustomThumbnail.addEventListener('click', () => {\r\n                this.showUploadThumbnail();\r\n            });\r\n        }\r\n\r\n        // Handles delete media thumbnail.\r\n        const deleteCustomThumbnail = this.root.querySelector(Selectors.EMBED.actions.deleteCustomThumbnail);\r\n        if (deleteCustomThumbnail) {\r\n            deleteCustomThumbnail.addEventListener('click', () => {\r\n                this.deleteEmbeddedThumbnail();\r\n            });\r\n        }\r\n\r\n        // Handles language track selection.\r\n        const langTracks = this.root.querySelectorAll(Selectors.EMBED.elements.trackLang);\r\n        if (langTracks) {\r\n            langTracks.forEach((dropdown) => {\r\n                const defaultVal = dropdown.getAttribute('data-value');\r\n                if (defaultVal) {\r\n                    Array.from(dropdown.options).some(option => {\r\n                        // Check if srclang in track is a language code like \"en\"\r\n                        // or language name like \"English\" prior to MDL-85159.\r\n                        if (option.dataset.languageCode === defaultVal || option.value === defaultVal) {\r\n                            option.selected = true;\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    };\r\n}\r\n"],"names":["EmbedPreview","MediaBase","constructor","data","Selectors","EMBED","type","async","currentModal","setTitle","component","fetchedTitle","this","fetchedMediaLinkTitle","source","originalUrl","root","urlSelector","elements","fromUrl","fileNameSelector","fileNameLabel","setMediaSourceAndPoster","registerMediaDetailsEventListeners","box","querySelector","previewBox","previewArea","document","mediaPreviewContainer","setAttribute","mediaType","newMediaLink","includes","innerHTML","contextId","video","createElement","src","addEventListener","videoHeight","videoWidth","isLandscape","mediaDimensions","width","height","offsetWidth","offsetHeight","value","parseInt","currentWidth","currentHeight","sizeChecked","controls","media","poster","classList","contains","add","load","outerHTML","urlWarning","EmbedHandler","resetUploadForm","audio","mediaDetailsBody","title","setMediaTitle","fileName","isUpdating","mediaTitle","deleteCancelPromise","then","mediaData","catch","error","window","console","log","removeAttribute","actions","deleteCustomThumbnail","remove","uploadCustomThumbnail","textContent","uploadThumbnailModal","EmbedModal","create","large","templateContext","elementid","editor","getElement","id","getRoot","embedHandler","loadInsertThumbnailTemplatePromise","getMediaTemplateContext","originalSize","originalSizeToggle","e","preventDefault","customSize","customSizeToggle","widthEle","heightEle","Math","round","linkMediaAspectRatio","Number","autoAdjustSize","deleteMedia","showSubtitleCaption","cancelMediaDetails","backToMediaDetails","mediaSubtitleCaptionBody","showUploadThumbnail","deleteEmbeddedThumbnail","langTracks","querySelectorAll","trackLang","forEach","dropdown","defaultVal","getAttribute","Array","from","options","some","option","dataset","languageCode","selected"],"mappings":"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"}