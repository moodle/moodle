{"version":3,"file":"embedhandler.min.js","sources":["../../src/embed/embedhandler.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Tiny media plugin embed handler class.\r\n *\r\n * This handles anything that embed requires like:\r\n * - Calling the media preview in embedPreview.\r\n * - Loading the embed insert.\r\n * - Getting selected media data.\r\n * - Handles url and repository uploads.\r\n * - Reset embed insert when embed preview is deleted.\r\n * - Handles media embedding into tiny and etc.\r\n *\r\n * @module      tiny_media/embed/embedhandler\r\n * @copyright   2024 Stevani Andolo <stevani@hotmail.com.au>\r\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Selectors from \"../selectors\";\r\nimport {EmbedInsert} from './embedinsert';\r\nimport {\r\n    body,\r\n    footer,\r\n    setPropertiesFromData,\r\n    isValidUrl,\r\n    stopMediaLoading,\r\n    startMediaLoading,\r\n} from '../helpers';\r\nimport * as ModalEvents from 'core/modal_events';\r\nimport {displayFilepicker} from 'editor_tiny/utils';\r\nimport {\r\n    insertMediaTemplateContext,\r\n    getHelpStrings,\r\n    prepareMoodleLang,\r\n    getMoodleLangObj,\r\n    hasAudioVideoAttr,\r\n    insertMediaThumbnailTemplateContext,\r\n} from \"./embedhelpers\";\r\nimport Templates from 'core/templates';\r\nimport {EmbedThumbnailInsert} from './embedthumbnailinsert';\r\n\r\nexport class EmbedHandler {\r\n\r\n    constructor(data) {\r\n        setPropertiesFromData(this, data); // Creates dynamic properties based on \"data\" param.\r\n    }\r\n\r\n    /**\r\n     * Load the media insert dialogue.\r\n     *\r\n     * @param {object} templateContext Object template context\r\n     */\r\n    loadTemplatePromise = (templateContext) => {\r\n        templateContext.elementid = this.editor.id;\r\n        templateContext.bodyTemplate = Selectors.EMBED.template.body.insertMediaBody;\r\n        templateContext.footerTemplate = Selectors.EMBED.template.footer.insertMediaFooter;\r\n        templateContext.selector = Selectors.EMBED.type;\r\n\r\n        Promise.all([body(templateContext, this.root), footer(templateContext, this.root)])\r\n            .then(() => {\r\n                (new EmbedInsert(this)).init();\r\n                return;\r\n            })\r\n            .catch(error => {\r\n                window.console.log(error);\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Load the media thumbnail insert dialogue.\r\n     *\r\n     * @param {object} templateContext Object template context\r\n     * @param {HTMLElement} root\r\n     * @param {object} mediaData\r\n     */\r\n    loadInsertThumbnailTemplatePromise = async(templateContext, root, mediaData) => {\r\n        Promise.all([body(templateContext, root.root), footer(templateContext, root.root)])\r\n            .then(() => {\r\n                if (!this.currentModal.insertMediaModal) {\r\n                    this.currentModal.insertMediaModal = this.currentModal;\r\n                }\r\n\r\n                if (root.uploadThumbnailModal) {\r\n                    this.currentModal.uploadThumbnailModal = root.uploadThumbnailModal;\r\n                }\r\n\r\n                this.thumbnailModalRoot = root.root;\r\n                (new EmbedThumbnailInsert(this)).init(mediaData);\r\n                return;\r\n            })\r\n            .catch(error => {\r\n                window.console.log(error);\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Loads the media preview dialogue.\r\n     *\r\n     * @param {object} embedPreview Object of embedPreview\r\n     * @param {object} templateContext Object of template context\r\n     */\r\n    loadMediaDetails = async(embedPreview, templateContext) => {\r\n        Promise.all([body(templateContext, this.root), footer(templateContext, this.root)])\r\n            .then(() => {\r\n                embedPreview.init();\r\n                return;\r\n            })\r\n            .catch(error => {\r\n                stopMediaLoading(this.root, Selectors.EMBED.type);\r\n                window.console.log(error);\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Reset the media/thumbnail insert modal form.\r\n     *\r\n     * @param {boolean} isMediaInsert Is current state media insert or thumbnail insert?\r\n     */\r\n    resetUploadForm = (isMediaInsert = true) => {\r\n        if (isMediaInsert) {\r\n            this.newMediaLink = false;\r\n            this.fetchedMediaLinkTitle = null;\r\n            this.resetCurrentMediaData();\r\n            this.loadTemplatePromise(insertMediaTemplateContext(this));\r\n        } else {\r\n            this.loadInsertThumbnailTemplatePromise(\r\n                insertMediaThumbnailTemplateContext(this), // Get template context for creating media thumbnail.\r\n                {root: this.thumbnailModalRoot}, // Required root elements.\r\n                this.mediaData // Get current media data.\r\n            );\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Get selected media data.\r\n     *\r\n     * @returns {null|object}\r\n     */\r\n    getMediaProperties = () => {\r\n        const media = this.selectedMedia;\r\n        if (!media) {\r\n            return null;\r\n        }\r\n\r\n        const tracks = {\r\n            subtitles: [],\r\n            captions: [],\r\n            descriptions: [],\r\n            chapters: [],\r\n            metadata: []\r\n        };\r\n        const sources = [];\r\n\r\n        media.querySelectorAll('track').forEach((track) => {\r\n            tracks[track.getAttribute('kind')].push({\r\n                src: track.getAttribute('src'),\r\n                srclang: track.getAttribute('srclang'),\r\n                label: track.getAttribute('label'),\r\n                defaultTrack: hasAudioVideoAttr(track, 'default')\r\n            });\r\n        });\r\n\r\n        media.querySelectorAll('source').forEach((source) => {\r\n            sources.push(source.src);\r\n        });\r\n        const title = media.getAttribute('title') ?? media.textContent;\r\n\r\n        return {\r\n            type: this.mediaType,\r\n            sources,\r\n            poster: media.getAttribute('poster'),\r\n            title: title ? title.trim() : false,\r\n            width: media.getAttribute('width'),\r\n            height: media.getAttribute('height'),\r\n            autoplay: hasAudioVideoAttr(media, 'autoplay'),\r\n            loop: hasAudioVideoAttr(media, 'loop'),\r\n            muted: hasAudioVideoAttr(media, 'muted'),\r\n            controls: hasAudioVideoAttr(media, 'controls'),\r\n            tracks,\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Get selected media data.\r\n     *\r\n     * @returns {object}\r\n     */\r\n    getCurrentEmbedData = () => {\r\n        const properties = this.getMediaProperties();\r\n        if (!properties || this.newMediaLink) {\r\n            return {media: {}};\r\n        }\r\n\r\n        const processedProperties = {};\r\n        processedProperties.media = properties;\r\n        processedProperties.link = false;\r\n\r\n        return processedProperties;\r\n    };\r\n\r\n    /**\r\n     * Get help strings for media subtitles and captions.\r\n     *\r\n     * @returns {null|object}\r\n     */\r\n    getHelpStrings = async() => {\r\n        if (!this.helpStrings) {\r\n            this.helpStrings = await getHelpStrings();\r\n        }\r\n\r\n        return this.helpStrings;\r\n    };\r\n\r\n    /**\r\n     * Set template context for insert media dialogue.\r\n     *\r\n     * @param {object} data Object of media data\r\n     * @returns {object}\r\n     */\r\n    getTemplateContext = async(data) => {\r\n        const languages = prepareMoodleLang(this.editor);\r\n        const helpIcons = Array.from(Object.entries(await this.getHelpStrings())).forEach(([key, text]) => {\r\n            data[`${key.toLowerCase()}helpicon`] = {text};\r\n        });\r\n\r\n        return Object.assign({}, {\r\n            elementid: this.editor.getElement().id,\r\n            showFilePickerTrack: this.canShowFilePickerTrack,\r\n            langsInstalled: languages.installed,\r\n            langsAvailable: languages.available,\r\n            media: true,\r\n            isUpdating: this.isUpdating,\r\n        }, data, helpIcons);\r\n    };\r\n\r\n    /**\r\n     * Set and get media template context.\r\n     *\r\n     * @param {null|object} data Null or object of media data\r\n     * @returns {Promise<object>} A promise that resolves template context.\r\n     */\r\n    getMediaTemplateContext = async(data = null) => {\r\n        if (!data) {\r\n            data = Object.assign({}, this.getCurrentEmbedData());\r\n        } else {\r\n            if (data.hasOwnProperty('isUpdating')) {\r\n                this.isUpdating = data.isUpdating;\r\n            } else {\r\n                this.isUpdating = Object.keys(data).length > 1;\r\n            }\r\n        }\r\n        return await this.getTemplateContext(data);\r\n    };\r\n\r\n    /**\r\n     * Handles changes in the media URL input field and loads a preview of the media if the URL has changed.\r\n     */\r\n    urlChanged() {\r\n        const url = this.root.querySelector(Selectors.EMBED.elements.fromUrl).value;\r\n        if (url && url !== this.currentUrl) {\r\n            // Set to null on new url change.\r\n            this.mediaType = null;\r\n\r\n            // Flag as new media link insert.\r\n            this.newMediaLink = true;\r\n            this.loadMediaPreview(url);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load the media preview dialogue.\r\n     *\r\n     * @param {string} url String of media url\r\n     */\r\n    loadMediaPreview = (url) => {\r\n        (new EmbedInsert(this)).loadMediaPreview(url);\r\n    };\r\n\r\n    /**\r\n     * Callback for file picker that previews the media or add the captions and subtitles.\r\n     *\r\n     * @param {object} params Object of media url and etc\r\n     * @param {html} element Selected element.\r\n     * @param {string} fpType Caption type.\r\n     */\r\n    trackFilePickerCallback(params, element, fpType) {\r\n        if (params.url !== '') {\r\n            const tabPane = element.closest('.tab-pane');\r\n            if (tabPane) {\r\n                element.closest(Selectors.EMBED.elements.source).querySelector(Selectors.EMBED.elements.url).value = params.url;\r\n\r\n                if (fpType === 'subtitle') {\r\n                    // If the file is subtitle file. We need to match the language and label for that file.\r\n                    const subtitleLang = params.file.split('.vtt')[0].split('-').slice(-1)[0];\r\n                    const langObj = getMoodleLangObj(subtitleLang, this.editor);\r\n                    if (langObj) {\r\n                        const track = element.closest(Selectors.EMBED.elements.track);\r\n                        track.querySelector(Selectors.EMBED.elements.trackLabel).value = langObj.lang.trim();\r\n                        track.querySelector(Selectors.EMBED.elements.trackLang).value = langObj.code;\r\n                    }\r\n                }\r\n            } else {\r\n                // Flag as new file upload.\r\n                this.newFileUpload = true;\r\n                this.resetCurrentMediaData();\r\n                this.loadMediaPreview(params.url);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reset current media data.\r\n     */\r\n    resetCurrentMediaData = () => {\r\n        // Reset the value of the following props.\r\n        this.media = {};\r\n        this.mediaType = null;\r\n        this.selectedMedia = null;\r\n    };\r\n\r\n    /**\r\n     * Add new html track element.\r\n     *\r\n     * @param {html} element\r\n     */\r\n    addTrackComponent(element) {\r\n        const trackElement = element.closest(Selectors.EMBED.elements.track);\r\n        const clone = trackElement.cloneNode(true);\r\n\r\n        trackElement.querySelector('.removecomponent-wrapper').classList.remove('hidden');\r\n        trackElement.querySelector('.addcomponent-wrapper').classList.add('hidden');\r\n        trackElement.parentNode.insertBefore(clone, trackElement.nextSibling);\r\n    }\r\n\r\n    /**\r\n     * Remove added html track element.\r\n     *\r\n     * @param {html} element\r\n     */\r\n    removeTrackComponent(element) {\r\n        const sourceElement = element.closest(Selectors.EMBED.elements.track);\r\n        sourceElement.remove();\r\n    }\r\n\r\n    /**\r\n     * Get picker type based on the selected element.\r\n     *\r\n     * @param {html} element Selected element\r\n     * @returns {string}\r\n     */\r\n    getFilePickerTypeFromElement = (element) => {\r\n        if (element.closest(Selectors.EMBED.elements.posterSource)) {\r\n            return 'image';\r\n        }\r\n        if (element.closest(Selectors.EMBED.elements.trackSource)) {\r\n            return 'subtitle';\r\n        }\r\n\r\n        return 'media';\r\n    };\r\n\r\n    /**\r\n     * Get captions/subtitles type.\r\n     *\r\n     * @param {html} tabPane\r\n     * @returns {string}\r\n     */\r\n    getTrackTypeFromTabPane = (tabPane) => {\r\n        return tabPane.getAttribute('data-track-kind');\r\n    };\r\n\r\n    /**\r\n     * Handle click events.\r\n     *\r\n     * @param {html} e Selected element\r\n     */\r\n    clickHandler = async(e) => {\r\n        const element = e.target;\r\n\r\n        // Handle repository browsing.\r\n        const mediaBrowser = element.closest(Selectors.EMBED.actions.mediaBrowser);\r\n        if (mediaBrowser) {\r\n            e.preventDefault();\r\n            const fpType = this.getFilePickerTypeFromElement(element);\r\n            const params = await displayFilepicker(this.editor, fpType);\r\n            this.trackFilePickerCallback(params, element, fpType);\r\n        }\r\n\r\n        // Handles add media url.\r\n        const addUrlEle = e.target.closest(Selectors.EMBED.actions.addUrl);\r\n        if (addUrlEle) {\r\n            startMediaLoading(this.root, Selectors.EMBED.type);\r\n            this.urlChanged();\r\n        }\r\n\r\n        // Handles adding tracks.\r\n        const addComponentTrackAction = element.closest(Selectors.EMBED.elements.track + ' .addcomponent');\r\n        if (addComponentTrackAction) {\r\n            e.preventDefault();\r\n            this.addTrackComponent(element);\r\n        }\r\n\r\n        // Handles removing added tracks.\r\n        const removeComponentTrackAction = element.closest(Selectors.EMBED.elements.track + ' .removecomponent');\r\n        if (removeComponentTrackAction) {\r\n            e.preventDefault();\r\n            this.removeTrackComponent(element);\r\n        }\r\n\r\n        // Only allow one track per tab to be selected as \"default\".\r\n        const trackDefaultAction = element.closest(Selectors.EMBED.elements.trackDefault);\r\n        if (trackDefaultAction && trackDefaultAction.checked) {\r\n            const getKind = (el) => this.getTrackTypeFromTabPane(el.parentElement.closest('.tab-pane'));\r\n\r\n            element.parentElement\r\n                .closest('.tab-content')\r\n                .querySelectorAll(Selectors.EMBED.elements.trackDefault)\r\n                .forEach((select) => {\r\n                    if (select !== element && getKind(element) === getKind(select)) {\r\n                        select.checked = false;\r\n                    }\r\n                });\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Enables or disables the URL-related buttons in the footer based on the current URL and input value.\r\n     *\r\n     * @param {html} input Url input field\r\n     * @param {object} root\r\n     */\r\n    toggleUrlButton(input, root) {\r\n        const url = input.value;\r\n        const addUrl = root.querySelector(Selectors.EMBED.actions.addUrl);\r\n        addUrl.disabled = !(url !== \"\" && isValidUrl(url));\r\n    }\r\n\r\n    /**\r\n     * Get media html to be inserted or updated into tiny.\r\n     *\r\n     * @param {html} form Selected element\r\n     * @returns {string} String of html\r\n     */\r\n    getMediaHTML = (form) => {\r\n        this.mediaType = this.root.querySelector(Selectors.EMBED.elements.mediaPreviewContainer).dataset.mediaType;\r\n        const tabContent = form.querySelector('.tab-content');\r\n        const callback = 'getMediaHTML' + this.mediaType[0].toUpperCase() + this.mediaType.substr(1);\r\n        return this[callback](tabContent);\r\n    };\r\n\r\n    /**\r\n     * Get media as link.\r\n     *\r\n     * @returns {string} String of html.\r\n     */\r\n    getMediaHTMLLink() {\r\n        const mediaPreviewContainer = document.querySelector(Selectors.EMBED.elements.mediaPreviewContainer);\r\n        const context = {\r\n            name: document.querySelector(Selectors.EMBED.elements.title).value ?? mediaPreviewContainer.dataset.originalUrl,\r\n            url: mediaPreviewContainer.dataset.originalUrl || false\r\n        };\r\n\r\n        return context.url ? Templates.renderForPromise('tiny_media/embed/embed_media_link', context) : '';\r\n    }\r\n\r\n    /**\r\n     * Get media as video.\r\n     *\r\n     * @param {html} tab Selected element\r\n     * @returns {string} String of html.\r\n     */\r\n    getMediaHTMLVideo = (tab) => {\r\n        const details = document.querySelector(Selectors.EMBED.elements.mediaDetailsBody);\r\n        const context = this.getContextForMediaHTML(tab, details);\r\n        context.width = details.querySelector(Selectors.EMBED.elements.width).value || false;\r\n        context.height = details.querySelector(Selectors.EMBED.elements.height).value || false;\r\n\r\n        const mediaPreviewContainer = details.querySelector(Selectors.EMBED.elements.mediaPreviewContainer);\r\n        context.poster = mediaPreviewContainer.dataset.mediaPoster || false;\r\n        return context.sources ? Templates.renderForPromise('tiny_media/embed/embed_media_video', context) : '';\r\n    };\r\n\r\n    /**\r\n     * Get media as audio.\r\n     *\r\n     * @param {html} tab Selected element\r\n     * @returns {string} String of html.\r\n     */\r\n    getMediaHTMLAudio = (tab) => {\r\n        const details = document.querySelector(Selectors.EMBED.elements.mediaDetailsBody);\r\n        const context = this.getContextForMediaHTML(tab, details);\r\n        return context.sources.length ? Templates.renderForPromise('tiny_media/embed/embed_media_audio', context) : '';\r\n    };\r\n\r\n    /**\r\n     * Get previewed media data.\r\n     *\r\n     * @param {html} tab Selected element\r\n     * @param {html} details Selected element\r\n     * @returns {object}\r\n     */\r\n    getContextForMediaHTML = (tab, details) => {\r\n        const tracks = Array.from(tab.querySelectorAll(Selectors.EMBED.elements.track)).map(track => {\r\n            const langTrack = track.querySelector(Selectors.EMBED.elements.trackLang);\r\n            const selectedLangTrack = langTrack.options[langTrack.selectedIndex];\r\n\r\n            return {\r\n                track: track.querySelector(Selectors.EMBED.elements.trackSource + ' ' + Selectors.EMBED.elements.url).value,\r\n                kind: this.getTrackTypeFromTabPane(track.closest('.tab-pane')),\r\n                label: track.querySelector(Selectors.EMBED.elements.trackLabel).value || langTrack.value,\r\n                srclang: selectedLangTrack.dataset.languageCode ?? false,\r\n                defaultTrack: track.querySelector(Selectors.EMBED.elements.trackDefault).checked ? \"true\" : null\r\n            };\r\n        }).filter((track) => !!track.track);\r\n\r\n        const mediaPreviewContainer = details.querySelector(Selectors.EMBED.elements.mediaPreviewContainer);\r\n        let sources = mediaPreviewContainer.dataset.originalUrl ?? null;\r\n\r\n        // Let's check if media has more than one sources.\r\n        if (this.alternativeSources) {\r\n            // Always update the first item in this.alternativeSources to the new one.\r\n            this.alternativeSources[0] = sources;\r\n            // Override the sources to have all the updated sources.\r\n            sources = this.alternativeSources;\r\n        }\r\n\r\n        const title = details.querySelector(Selectors.EMBED.elements.title).value;\r\n        // Remove data-original-url attribute once it's extracted.\r\n        mediaPreviewContainer.removeAttribute('data-original-url');\r\n\r\n        const templateContext = {\r\n            sources,\r\n            tracks,\r\n            showControls: details.querySelector(Selectors.EMBED.elements.mediaControl).checked,\r\n            autoplay: details.querySelector(Selectors.EMBED.elements.mediaAutoplay).checked,\r\n            muted: details.querySelector(Selectors.EMBED.elements.mediaMute).checked,\r\n            loop: details.querySelector(Selectors.EMBED.elements.mediaLoop).checked,\r\n            title: title !== '' ? title.trim() : false,\r\n        };\r\n\r\n        // Add description prop to templateContext if media type is \"link\".\r\n        if (this.mediaType === 'link') {\r\n            // Let's form an alternative title.\r\n            templateContext.description = Array.isArray(sources) ? sources[0] : sources;\r\n        }\r\n\r\n        return templateContext;\r\n    };\r\n\r\n    /**\r\n     * Handle the insert/update media in tiny editor.\r\n     *\r\n     * @param {event} event\r\n     * @param {object} modal Object of current modal\r\n     */\r\n    handleDialogueSubmission = async(event, modal) => {\r\n        const {html} = await this.getMediaHTML(modal.getRoot()[0]);\r\n        if (html) {\r\n            if (this.isUpdating) {\r\n                this.selectedMedia.outerHTML = html;\r\n                this.isUpdating = false;\r\n            } else {\r\n                this.editor.insertContent(html);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Register insert media modal elements' events.\r\n     */\r\n    registerEventListeners = async() => {\r\n        // Handles click events for insert media modal.\r\n        if (this.canShowFilePickerTrack) {\r\n            this.root.addEventListener('click', this.clickHandler.bind(this));\r\n        }\r\n\r\n        // Handles media adding using url input.\r\n        this.root.addEventListener('input', (e) => {\r\n            const urlEle = e.target.closest(Selectors.EMBED.elements.fromUrl);\r\n            if (urlEle) {\r\n                this.toggleUrlButton(urlEle, this.root);\r\n            }\r\n        });\r\n\r\n        // Destroy created modal when it's closed.\r\n        this.modalRoot.on(ModalEvents.hidden, () => {\r\n            this.currentModal.destroy();\r\n        });\r\n\r\n        // Handles media insert to editor.\r\n        this.modalRoot.on(ModalEvents.save, this.handleDialogueSubmission.bind(this));\r\n    };\r\n}\r\n"],"names":["constructor","data","templateContext","elementid","this","editor","id","bodyTemplate","Selectors","EMBED","template","body","insertMediaBody","footerTemplate","footer","insertMediaFooter","selector","type","Promise","all","root","then","EmbedInsert","init","catch","error","window","console","log","async","mediaData","currentModal","insertMediaModal","uploadThumbnailModal","thumbnailModalRoot","EmbedThumbnailInsert","embedPreview","isMediaInsert","_this","newMediaLink","fetchedMediaLinkTitle","resetCurrentMediaData","loadTemplatePromise","loadInsertThumbnailTemplatePromise","media","selectedMedia","tracks","subtitles","captions","descriptions","chapters","metadata","sources","querySelectorAll","forEach","track","getAttribute","push","src","srclang","label","defaultTrack","source","title","textContent","mediaType","poster","trim","width","height","autoplay","loop","muted","controls","properties","getMediaProperties","processedProperties","link","helpStrings","languages","helpIcons","Array","from","Object","entries","getHelpStrings","_ref","key","text","toLowerCase","assign","getElement","showFilePickerTrack","canShowFilePickerTrack","langsInstalled","installed","langsAvailable","available","isUpdating","hasOwnProperty","keys","length","getCurrentEmbedData","getTemplateContext","url","loadMediaPreview","element","closest","elements","posterSource","trackSource","tabPane","e","target","actions","mediaBrowser","preventDefault","fpType","getFilePickerTypeFromElement","params","trackFilePickerCallback","addUrl","urlChanged","addTrackComponent","removeTrackComponent","trackDefaultAction","trackDefault","checked","getKind","el","getTrackTypeFromTabPane","parentElement","select","form","querySelector","mediaPreviewContainer","dataset","tabContent","toUpperCase","substr","tab","details","document","mediaDetailsBody","context","getContextForMediaHTML","value","mediaPoster","Templates","renderForPromise","map","langTrack","trackLang","selectedLangTrack","options","selectedIndex","kind","trackLabel","languageCode","filter","originalUrl","alternativeSources","removeAttribute","showControls","mediaControl","mediaAutoplay","mediaMute","mediaLoop","description","isArray","event","modal","html","getMediaHTML","getRoot","outerHTML","insertContent","addEventListener","clickHandler","bind","urlEle","fromUrl","toggleUrlButton","modalRoot","on","ModalEvents","hidden","destroy","save","handleDialogueSubmission","currentUrl","subtitleLang","file","split","slice","langObj","lang","code","newFileUpload","trackElement","clone","cloneNode","classList","remove","add","parentNode","insertBefore","nextSibling","input","disabled","getMediaHTMLLink","name"],"mappings":"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"}