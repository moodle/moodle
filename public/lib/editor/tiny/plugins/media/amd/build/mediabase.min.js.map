{"version":3,"file":"mediabase.min.js","sources":["../src/mediabase.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Tiny media plugin class helpers for image and embed.\r\n *\r\n * @module      tiny_media/mediabase\r\n * @copyright   2024 Stevani Andolo <stevani@hotmail.com.au>\r\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\nimport {\r\n    isPercentageValue,\r\n    hideElements,\r\n    showElements,\r\n} from './helpers';\r\nimport Selectors from './selectors';\r\n\r\nexport class MediaBase {\r\n\r\n    /**\r\n     * Handles the selection of media size options and updates the form inputs accordingly.\r\n     *\r\n     * @param {string} option - The selected media size option (\"original\" or \"custom\").\r\n     */\r\n    sizeChecked = async(option) => {\r\n        const widthInput = this.root.querySelector(Selectors[this.selectorType].elements.width);\r\n        const heightInput = this.root.querySelector(Selectors[this.selectorType].elements.height);\r\n        if (option === \"original\") {\r\n            this.sizeOriginalChecked();\r\n            widthInput.value = this.mediaDimensions.width;\r\n            heightInput.value = this.mediaDimensions.height;\r\n        } else if (option === \"custom\") {\r\n            this.sizeCustomChecked();\r\n            widthInput.value = this.currentWidth;\r\n            heightInput.value = this.currentHeight;\r\n        }\r\n        this.autoAdjustSize();\r\n    };\r\n\r\n    /**\r\n     * Handles the selection of the \"Original Size\" option and updates the form elements accordingly.\r\n     */\r\n    sizeOriginalChecked() {\r\n        const customSize = this.root.querySelector(Selectors[this.selectorType].elements.customSizeToggle);\r\n        if (customSize && customSize.classList.contains('btn-primary')) {\r\n            customSize.classList.remove('btn-primary');\r\n            customSize.classList.add('btn-outline-primary');\r\n        }\r\n\r\n        const originalSize = this.root.querySelector(Selectors[this.selectorType].elements.originalSizeToggle);\r\n        if (originalSize && originalSize.classList.contains('btn-outline-primary')) {\r\n            originalSize.classList.remove('btn-outline-primary');\r\n            originalSize.classList.add('btn-primary');\r\n        }\r\n\r\n        hideElements(Selectors[this.selectorType].elements.properties, this.root);\r\n    }\r\n\r\n    /**\r\n     * Handles the selection of the \"Custom Size\" option and updates the form elements accordingly.\r\n     */\r\n    sizeCustomChecked() {\r\n        const customSize = this.root.querySelector(Selectors[this.selectorType].elements.customSizeToggle);\r\n        if (customSize && customSize.classList.contains('btn-outline-primary')) {\r\n            customSize.classList.remove('btn-outline-primary');\r\n            customSize.classList.add('btn-primary');\r\n        }\r\n\r\n        const originalSize = this.root.querySelector(Selectors[this.selectorType].elements.originalSizeToggle);\r\n        if (originalSize && originalSize.classList.contains('btn-primary')) {\r\n            originalSize.classList.remove('btn-primary');\r\n            originalSize.classList.add('btn-outline-primary');\r\n        }\r\n\r\n        showElements(Selectors[this.selectorType].elements.properties, this.root);\r\n    }\r\n\r\n    /**\r\n     * Auto adjust the media width/height.\r\n     * It is put here so image.js and/or friends can extend this class and call this for media proportion.\r\n     *\r\n     * @param {boolean} forceHeight Whether set by height or not\r\n     */\r\n    autoAdjustSize = (forceHeight = false) => {\r\n        // If we do not know the media size, do not do anything.\r\n        if (!this.mediaDimensions) {\r\n            return;\r\n        }\r\n\r\n        const widthField = this.root.querySelector(Selectors[this.selectorType].elements.width);\r\n        const heightField = this.root.querySelector(Selectors[this.selectorType].elements.height);\r\n\r\n        const normalizeFieldData = (fieldData) => {\r\n            fieldData.isPercentageValue = isPercentageValue(fieldData.field.value);\r\n            if (fieldData.isPercentageValue) {\r\n                fieldData.percentValue = parseInt(fieldData.field.value, 10);\r\n                fieldData.pixelSize = this.mediaDimensions[fieldData.type] / 100 * fieldData.percentValue;\r\n            } else {\r\n                fieldData.pixelSize = parseInt(fieldData.field.value, 10);\r\n                fieldData.percentValue = fieldData.pixelSize / this.mediaDimensions[fieldData.type] * 100;\r\n            }\r\n\r\n            return fieldData;\r\n        };\r\n\r\n        const getKeyField = () => {\r\n            const getValue = () => {\r\n                if (forceHeight) {\r\n                    return {\r\n                        field: heightField,\r\n                        type: 'height',\r\n                    };\r\n                } else {\r\n                    return {\r\n                        field: widthField,\r\n                        type: 'width',\r\n                    };\r\n                }\r\n            };\r\n\r\n            const currentValue = getValue();\r\n            if (currentValue.field.value === '') {\r\n                currentValue.field.value = this.mediaDimensions[currentValue.type];\r\n            }\r\n\r\n            return normalizeFieldData(currentValue);\r\n        };\r\n\r\n        const getRelativeField = () => {\r\n            if (forceHeight) {\r\n                return normalizeFieldData({\r\n                    field: widthField,\r\n                    type: 'width',\r\n                });\r\n            } else {\r\n                return normalizeFieldData({\r\n                    field: heightField,\r\n                    type: 'height',\r\n                });\r\n            }\r\n        };\r\n\r\n        // Now update with the new values.\r\n        const keyField = getKeyField();\r\n        const relativeField = getRelativeField();\r\n        // We are keeping the media in proportion.\r\n        // Calculate the size for the relative field.\r\n        if (keyField.isPercentageValue) {\r\n            // In proportion, so the percentages are the same.\r\n            relativeField.field.value = keyField.field.value;\r\n            relativeField.percentValue = keyField.percentValue;\r\n        } else {\r\n            relativeField.pixelSize = Math.round(\r\n                keyField.pixelSize / this.mediaDimensions[keyField.type] * this.mediaDimensions[relativeField.type]\r\n            );\r\n            relativeField.field.value = relativeField.pixelSize;\r\n        }\r\n\r\n        if (this.selectorType === Selectors.IMAGE.type) {\r\n            // Store the custom width and height to reuse.\r\n            this.currentWidth = Number(widthField.value) !== this.mediaDimensions.width ? widthField.value : this.currentWidth;\r\n            this.currentHeight = Number(heightField.value) !== this.mediaDimensions.height ? heightField.value : this.currentHeight;\r\n        }\r\n    };\r\n}\r\n"],"names":["async","widthInput","this","root","querySelector","Selectors","selectorType","elements","width","heightInput","height","option","sizeOriginalChecked","value","mediaDimensions","sizeCustomChecked","currentWidth","currentHeight","autoAdjustSize","forceHeight","_this","widthField","heightField","normalizeFieldData","fieldData","isPercentageValue","field","percentValue","parseInt","pixelSize","type","getKeyField","currentValue","getRelativeField","keyField","relativeField","Math","round","IMAGE","Number","customSize","customSizeToggle","classList","contains","remove","add","originalSize","originalSizeToggle","properties"],"mappings":"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"}