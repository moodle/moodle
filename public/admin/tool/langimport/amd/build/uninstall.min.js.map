{"version":3,"file":"uninstall.min.js","sources":["../src/uninstall.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\nimport {getStrings} from 'core/str';\r\nimport {saveCancelPromise, alert as displayAlert} from \"core/notification\";\r\nimport MoodleConfig from 'core/config';\r\n\r\nexport const init = (form) => {\r\n    form?.addEventListener('submit', async(e) => {\r\n        e.preventDefault();\r\n        const selectedOptions = form.querySelector('#menuuninstalllang')?.selectedOptions;\r\n        if (!selectedOptions?.length) {\r\n            const alertStrings = await getStrings(\r\n                ['noenglishuninstalltitle', 'selectlangs'].map((key) => ({key, component: 'tool_langimport'})\r\n            ));\r\n            displayAlert(...alertStrings);\r\n            return;\r\n        }\r\n\r\n        if ([...selectedOptions].map((node) => node.value).indexOf('en') !== -1) {\r\n            const alertStrings = await getStrings(\r\n                ['noenglishuninstalltitle', 'noenglishuninstall'].map((key) => ({key, component: 'tool_langimport'})\r\n                ));\r\n            displayAlert(...alertStrings);\r\n            return;\r\n        }\r\n\r\n        const confirmationStrings = await getStrings([\r\n            {\r\n                key: 'uninstall',\r\n                component: 'tool_langimport',\r\n            },\r\n            {\r\n                key: 'uninstallconfirm',\r\n                component: 'tool_langimport',\r\n                param: [...selectedOptions].map((node) => node.textContent).join(', '),\r\n            },\r\n            {\r\n                key: 'yes',\r\n                component: 'core',\r\n            },\r\n        ]);\r\n\r\n        saveCancelPromise(...confirmationStrings).then(() => {\r\n            const url = new URL(form.action);\r\n            url.searchParams.append('sesskey', MoodleConfig.sesskey);\r\n            url.searchParams.append('confirmtouninstall', [...selectedOptions].map((node) => node.value).join('/'));\r\n            form.action = url.toString();\r\n            form.submit();\r\n            return true;\r\n        })\r\n        .catch(() => {\r\n            return false;\r\n        });\r\n    });\r\n};\r\n"],"names":["form","addEventListener","async","e","preventDefault","selectedOptions","querySelector","_form$querySelector","length","alertStrings","map","key","component","node","value","indexOf","confirmationStrings","param","textContent","join","then","url","URL","action","searchParams","append","MoodleConfig","sesskey","toString","submit","catch"],"mappings":"sSAmBqBA,OACjBA,MAAAA,MAAAA,KAAMC,iBAAiB,UAAUC,MAAAA,4BAC7BC,EAAEC,uBACIC,4CAAkBL,KAAKM,cAAc,4DAAnBC,oBAA0CF,mBAC7DA,MAAAA,kBAAAA,gBAAiBG,OAAQ,OACpBC,mBAAqB,mBACvB,CAAC,0BAA2B,eAAeC,KAAKC,OAAUA,IAAAA,IAAKC,UAAW,6DAE9DH,kBAIkD,IAAlE,IAAIJ,iBAAiBK,KAAKG,MAASA,KAAKC,QAAOC,QAAQ,MAAc,OAC/DN,mBAAqB,mBACvB,CAAC,0BAA2B,sBAAsBC,KAAKC,OAAUA,IAAAA,IAAKC,UAAW,6DAErEH,oBAIdO,0BAA4B,mBAAW,CACzC,CACIL,IAAK,YACLC,UAAW,mBAEf,CACID,IAAK,mBACLC,UAAW,kBACXK,MAAO,IAAIZ,iBAAiBK,KAAKG,MAASA,KAAKK,cAAaC,KAAK,OAErE,CACIR,IAAK,MACLC,UAAW,iDAIEI,qBAAqBI,MAAK,WACrCC,IAAM,IAAIC,IAAItB,KAAKuB,eACzBF,IAAIG,aAAaC,OAAO,UAAWC,gBAAaC,SAChDN,IAAIG,aAAaC,OAAO,qBAAsB,IAAIpB,iBAAiBK,KAAKG,MAASA,KAAKC,QAAOK,KAAK,MAClGnB,KAAKuB,OAASF,IAAIO,WAClB5B,KAAK6B,UACE,KAEVC,OAAM,KACI"}