{"version":3,"file":"tour_filters.min.js","sources":["../src/tour_filters.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * User tours filters.\r\n *\r\n * @module      tool_usertours/tour_filters\r\n * @copyright   2025 The Open University\r\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\nconst ANY_VALUE = \"__ANYVALUE__\";\r\n\r\nexport const init = () => {\r\n    // Initialize the category filter\r\n    initConfigurationCategoryFilter();\r\n};\r\n\r\n/**\r\n * Initialize the category filter for the configuration page.\r\n */\r\nconst initConfigurationCategoryFilter = () => {\r\n    const categorySelect = document.querySelector(\"[name='filter_category[]']\");\r\n    const excludeSelect = document.querySelector(\"[name='filter_exclude_category[]']\");\r\n    const excludeCategoriesContainer = document.getElementById('fitem_id_filter_exclude_category');\r\n\r\n    if (categorySelect && excludeSelect) {\r\n        // Add event listeners to update the exclude categories when the include categories change.\r\n        categorySelect.addEventListener(\"change\", () => {\r\n            updateExcludeCategories(categorySelect, excludeSelect, excludeCategoriesContainer);\r\n        });\r\n\r\n        // Initialize the exclude categories based on the selected include categories.\r\n        updateExcludeCategories(categorySelect, excludeSelect, excludeCategoriesContainer);\r\n    }\r\n};\r\n\r\n/**\r\n * Adjust the height of a select element based on the number of options.\r\n *\r\n * @param {HTMLSelectElement} select\r\n */\r\nconst adjustHeight = (select) => {\r\n    select.size = Math.min(select.options.length || 1, 10);\r\n};\r\n\r\n/**\r\n * Update the exclude categories based on the selected include categories.\r\n *\r\n * @param {HTMLSelectElement} categorySelect\r\n * @param {HTMLSelectElement} excludeSelect\r\n * @param {HTMLElement} excludeCategoriesContainer\r\n */\r\nconst updateExcludeCategories = (categorySelect, excludeSelect, excludeCategoriesContainer) => {\r\n    // Get the selected categories and update the 'Any' option.\r\n    const selectedCategories = new Set(Array.from(categorySelect.selectedOptions).map(option => option.value));\r\n\r\n    // Get the selected exclude categories and create a map of options.\r\n    const excludeSelected = new Set(Array.from(excludeSelect.selectedOptions).map(option => option.value));\r\n    const excludeOptions = new Map();\r\n\r\n    // Flag to check if 'Any' value is selected.\r\n    const anySelected = selectedCategories.has(ANY_VALUE);\r\n    Array.from(categorySelect.options).forEach(option => {\r\n        const isNotAny = option.value !== ANY_VALUE;\r\n\r\n        // If 'Any' is selected, include all options in excludeOptions.\r\n        if (anySelected && isNotAny) {\r\n            excludeOptions.set(option.value, option.text);\r\n        } else if (isNotAny) {\r\n            // Otherwise, check if the option is a child of any selected category.\r\n            for (const selected of selectedCategories) {\r\n                const selectedOption = categorySelect.querySelector(`option[value=\"${selected}\"]`);\r\n                if (option.text.startsWith(`${selectedOption.text} / `)) {\r\n                    excludeOptions.set(option.value, option.text);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    });\r\n    if (excludeOptions.size) {\r\n        // Update the exclude categories select element.\r\n        excludeSelect.innerHTML = '';\r\n        Array.from(excludeOptions)\r\n            .sort(([, a], [, b]) => a.localeCompare(b))\r\n            .forEach(([key, value]) => {\r\n                const option = document.createElement(\"option\");\r\n                option.value = key;\r\n                option.text = value;\r\n                if (excludeSelected.has(key)) {\r\n                    option.selected = true;\r\n                }\r\n                excludeSelect.appendChild(option);\r\n            });\r\n\r\n        // Adjust the height of the select elements.\r\n        adjustHeight(excludeSelect);\r\n        // Show the exclude categories container if it was hidden.\r\n        if (excludeCategoriesContainer.classList.contains('d-none')) {\r\n            excludeCategoriesContainer.classList.remove('d-none');\r\n        }\r\n    } else {\r\n        // Hide the exclude categories container when no child categories exist.\r\n        if (!excludeCategoriesContainer.classList.contains('d-none')) {\r\n            excludeCategoriesContainer.classList.add('d-none');\r\n        }\r\n        // Clear selections to prevent submitting excluded categories when container is hidden.\r\n        excludeSelect.innerHTML = '';\r\n    }\r\n\r\n};\r\n"],"names":["initConfigurationCategoryFilter","categorySelect","document","querySelector","excludeSelect","excludeCategoriesContainer","getElementById","addEventListener","updateExcludeCategories","selectedCategories","Set","Array","from","selectedOptions","map","option","value","excludeSelected","excludeOptions","Map","anySelected","has","select","options","forEach","isNotAny","set","text","selected","selectedOption","startsWith","size","innerHTML","sort","a","b","localeCompare","_ref3","key","createElement","appendChild","Math","min","length","classList","contains","remove","add"],"mappings":"gKAwBoB,KAEhBA,yCAMEA,gCAAkC,WAC9BC,eAAiBC,SAASC,cAAc,8BACxCC,cAAgBF,SAASC,cAAc,sCACvCE,2BAA6BH,SAASI,eAAe,oCAEvDL,gBAAkBG,gBAElBH,eAAeM,iBAAiB,UAAU,KACtCC,wBAAwBP,eAAgBG,cAAeC,+BAI3DG,wBAAwBP,eAAgBG,cAAeC,8BAoBzDG,wBAA0B,CAACP,eAAgBG,cAAeC,oCAEtDI,mBAAqB,IAAIC,IAAIC,MAAMC,KAAKX,eAAeY,iBAAiBC,KAAIC,QAAUA,OAAOC,SAG7FC,gBAAkB,IAAIP,IAAIC,MAAMC,KAAKR,cAAcS,iBAAiBC,KAAIC,QAAUA,OAAOC,SACzFE,eAAiB,IAAIC,IAGrBC,YAAcX,mBAAmBY,IAnDzB,gBA+BIC,IAAAA,OAqBlBX,MAAMC,KAAKX,eAAesB,SAASC,SAAQT,eACjCU,SArDI,iBAqDOV,OAAOC,SAGpBI,aAAeK,SACfP,eAAeQ,IAAIX,OAAOC,MAAOD,OAAOY,WACrC,GAAIF,aAEF,MAAMG,YAAYnB,mBAAoB,OACjCoB,eAAiB5B,eAAeE,sCAA+ByB,mBACjEb,OAAOY,KAAKG,qBAAcD,eAAeF,aAAY,CACrDT,eAAeQ,IAAIX,OAAOC,MAAOD,OAAOY,iBAMpDT,eAAea,MAEf3B,cAAc4B,UAAY,GAC1BrB,MAAMC,KAAKM,gBACNe,MAAK,oBAAIC,UAAOC,gBAAOD,EAAEE,cAAcD,MACvCX,SAAQa,YAAEC,IAAKtB,mBACND,OAASb,SAASqC,cAAc,UACtCxB,OAAOC,MAAQsB,IACfvB,OAAOY,KAAOX,MACVC,gBAAgBI,IAAIiB,OACpBvB,OAAOa,UAAW,GAEtBxB,cAAcoC,YAAYzB,YAlDpBO,OAsDDlB,eArDV2B,KAAOU,KAAKC,IAAIpB,OAAOC,QAAQoB,QAAU,EAAG,IAuD3CtC,2BAA2BuC,UAAUC,SAAS,WAC9CxC,2BAA2BuC,UAAUE,OAAO,YAI3CzC,2BAA2BuC,UAAUC,SAAS,WAC/CxC,2BAA2BuC,UAAUG,IAAI,UAG7C3C,cAAc4B,UAAY"}