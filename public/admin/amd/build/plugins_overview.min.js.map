{"version":3,"file":"plugins_overview.min.js","sources":["../src/plugins_overview.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Allows to filter the plugin list on plugins overview page\r\n *\r\n * @module     core_admin/plugins_overview\r\n * @copyright  2024 Marina Glancy\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nconst SELECTORS = {\r\n    PLUGIN_FILTERS: '#plugins-overview-panel [data-filterby]',\r\n    PLUGIN_ROWS: 'table#plugins-control-panel tbody tr:not(.plugintypeheader)',\r\n    PLUGIN_TYPE_ROWS: 'table#plugins-control-panel tbody tr.plugintypeheader',\r\n};\r\n\r\n/**\r\n * Initialise filters for the \"Plugins overview\" page\r\n */\r\nexport function init() {\r\n    const filters = document.querySelectorAll(SELECTORS.PLUGIN_FILTERS);\r\n    const pluginRows = document.querySelectorAll(SELECTORS.PLUGIN_ROWS);\r\n    const pluginTypeRows = document.querySelectorAll(SELECTORS.PLUGIN_TYPE_ROWS);\r\n\r\n    const filterPlugins = (target) => {\r\n        const filterBy = target.getAttribute('data-filterby');\r\n        const headerVisibility = {};\r\n\r\n        // Hide all plugin rows in the plugin table that do not match the filter and show all others.\r\n        for (const row of pluginRows) {\r\n            const type = [...row.classList].find(s => s.startsWith('type-'));\r\n            const visible = filterBy === 'all' ? true : row.classList.contains(filterBy);\r\n            row.style.display = visible ? null : 'none';\r\n            if (visible && type) {\r\n                headerVisibility[type] = true;\r\n            }\r\n        }\r\n\r\n        // Hide all the plugin type headers that do not have any visible plugins and show all others.\r\n        for (const row of pluginTypeRows) {\r\n            const type = [...row.classList].find(s => s.startsWith('type-'));\r\n            if (type) {\r\n                const visible = filterBy === 'all' || headerVisibility[type];\r\n                row.style.display = visible ? null : 'none';\r\n            }\r\n        }\r\n\r\n        // Toggle 'active' class for the selected filter.\r\n        filters.forEach(el => el.classList.remove('active'));\r\n        target.classList.add('active');\r\n    };\r\n\r\n    // Add event listeners for the links changing plugins filters.\r\n    filters\r\n    .forEach(target => target.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        window.history.replaceState({}, null, e.target.href);\r\n        filterPlugins(target);\r\n    }));\r\n\r\n    // Pre-filter plugins based on the current url anchor.\r\n    if (window.location.hash.length > 1) {\r\n        const anchor = window.location.hash.substring(1);\r\n        const target = [...filters].find(t => t.getAttribute('data-filterby') === anchor);\r\n        if (target) {\r\n            filterPlugins(target);\r\n        }\r\n    }\r\n}\r\n"],"names":["filters","document","querySelectorAll","SELECTORS","pluginRows","pluginTypeRows","filterPlugins","target","filterBy","getAttribute","headerVisibility","row","type","classList","find","s","startsWith","visible","contains","style","display","forEach","el","remove","add","addEventListener","e","preventDefault","window","history","replaceState","href","location","hash","length","anchor","substring","t"],"mappings":"4JAiCUA,QAAUC,SAASC,iBAAiBC,0BACpCC,WAAaH,SAASC,iBAAiBC,uBACvCE,eAAiBJ,SAASC,iBAAiBC,4BAE3CG,cAAiBC,eACbC,SAAWD,OAAOE,aAAa,iBAC/BC,iBAAmB,OAGpB,MAAMC,OAAOP,WAAY,OACpBQ,KAAO,IAAID,IAAIE,WAAWC,MAAKC,GAAKA,EAAEC,WAAW,WACjDC,QAAuB,QAAbT,UAA4BG,IAAIE,UAAUK,SAASV,UACnEG,IAAIQ,MAAMC,QAAUH,QAAU,KAAO,OACjCA,SAAWL,OACXF,iBAAiBE,OAAQ,OAK5B,MAAMD,OAAON,eAAgB,OACxBO,KAAO,IAAID,IAAIE,WAAWC,MAAKC,GAAKA,EAAEC,WAAW,cACnDJ,KAAM,OACAK,QAAuB,QAAbT,UAAsBE,iBAAiBE,MACvDD,IAAIQ,MAAMC,QAAUH,QAAU,KAAO,QAK7CjB,QAAQqB,SAAQC,IAAMA,GAAGT,UAAUU,OAAO,YAC1ChB,OAAOM,UAAUW,IAAI,cAIzBxB,QACCqB,SAAQd,QAAUA,OAAOkB,iBAAiB,SAAUC,IACjDA,EAAEC,iBACFC,OAAOC,QAAQC,aAAa,GAAI,KAAMJ,EAAEnB,OAAOwB,MAC/CzB,cAAcC,aAIdqB,OAAOI,SAASC,KAAKC,OAAS,EAAG,OAC3BC,OAASP,OAAOI,SAASC,KAAKG,UAAU,GACxC7B,OAAS,IAAIP,SAASc,MAAKuB,GAAKA,EAAE5B,aAAa,mBAAqB0B,SACtE5B,QACAD,cAAcC;;;;;;;;MAvDpBJ,yBACc,0CADdA,sBAEW,8DAFXA,2BAGgB"}