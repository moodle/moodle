{"version":3,"file":"placement.min.js","sources":["../src/placement.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Module to load and render the tools for the AI assist plugin.\r\n *\r\n * @module     aiplacement_courseassist/placement\r\n * @copyright  2024 Huong Nguyen <huongnv13@gmail.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Templates from 'core/templates';\r\nimport Ajax from 'core/ajax';\r\nimport 'core/copy_to_clipboard';\r\nimport Notification from 'core/notification';\r\nimport Selectors from 'aiplacement_courseassist/selectors';\r\nimport Policy from 'core_ai/policy';\r\nimport AIHelper from 'core_ai/helper';\r\nimport DrawerEvents from 'core/drawer_events';\r\nimport {subscribe} from 'core/pubsub';\r\nimport * as MessageDrawerHelper from 'core_message/message_drawer_helper';\r\nimport {getString} from 'core/str';\r\nimport * as FocusLock from 'core/local/aria/focuslock';\r\nimport {isSmall} from \"core/pagehelpers\";\r\n\r\nconst AICourseAssist = class {\r\n\r\n    /**\r\n     * The user ID.\r\n     * @type {Integer}\r\n     */\r\n    userId;\r\n    /**\r\n     * The context ID.\r\n     * @type {Integer}\r\n     */\r\n    contextId;\r\n\r\n    /**\r\n     * Constructor.\r\n     * @param {Integer} userId The user ID.\r\n     * @param {Integer} contextId The context ID.\r\n     */\r\n    constructor(userId, contextId) {\r\n        this.userId = userId;\r\n        this.contextId = contextId;\r\n\r\n        this.aiDrawerElement = document.querySelector(Selectors.ELEMENTS.AIDRAWER);\r\n        this.aiDrawerBodyElement = document.querySelector(Selectors.ELEMENTS.AIDRAWER_BODY);\r\n        this.pageElement = document.querySelector(Selectors.ELEMENTS.PAGE);\r\n        this.jumpToElement = document.querySelector(Selectors.ELEMENTS.JUMPTO);\r\n        this.actionElement = document.querySelector(Selectors.ELEMENTS.ACTION);\r\n        this.aiDrawerCloseElement = this.aiDrawerElement.querySelector(Selectors.ELEMENTS.AIDRAWER_CLOSE);\r\n        this.lastAction = '';\r\n        this.responses = new Map();\r\n        this.isDrawerFocusLocked = false;\r\n\r\n        this.registerEventListeners();\r\n    }\r\n\r\n    /**\r\n     * Register event listeners.\r\n     */\r\n    registerEventListeners() {\r\n        document.addEventListener('click', async(e) => {\r\n            // Display summarise.\r\n            const summariseAction = e.target.closest(Selectors.ACTIONS.SUMMARY);\r\n            if (summariseAction) {\r\n                e.preventDefault();\r\n                this.openAIDrawer();\r\n                this.lastAction = 'summarise_text';\r\n                this.actionElement.focus();\r\n                const isPolicyAccepted = await this.isPolicyAccepted();\r\n                if (!isPolicyAccepted) {\r\n                    // Display policy.\r\n                    this.displayPolicy();\r\n                    return;\r\n                }\r\n                this.displayAction(this.lastAction);\r\n            }\r\n            // Display explain.\r\n            const explainAction = e.target.closest(Selectors.ACTIONS.EXPLAIN);\r\n            if (explainAction) {\r\n                e.preventDefault();\r\n                this.openAIDrawer();\r\n                this.lastAction = 'explain_text';\r\n                this.actionElement.focus();\r\n                const isPolicyAccepted = await this.isPolicyAccepted();\r\n                if (!isPolicyAccepted) {\r\n                    // Display policy.\r\n                    this.displayPolicy();\r\n                    return;\r\n                }\r\n                this.displayAction(this.lastAction);\r\n            }\r\n            // Close AI drawer.\r\n            const closeAiDrawer = e.target.closest(Selectors.ELEMENTS.AIDRAWER_CLOSE);\r\n            if (closeAiDrawer) {\r\n                e.preventDefault();\r\n                this.closeAIDrawer();\r\n            }\r\n        });\r\n\r\n        document.addEventListener('keydown', e => {\r\n            if (this.isAIDrawerOpen() && e.key === 'Escape') {\r\n                this.closeAIDrawer();\r\n            }\r\n        });\r\n\r\n        // Close AI drawer if message drawer is shown.\r\n        subscribe(DrawerEvents.DRAWER_SHOWN, () => {\r\n            if (this.isAIDrawerOpen()) {\r\n                this.closeAIDrawer();\r\n            }\r\n        });\r\n\r\n        // Check if there is course assist control region in the page.\r\n        if (this.jumpToElement) {\r\n            // Focus on the AI drawer's close button when the jump-to element is focused.\r\n            this.jumpToElement.addEventListener('focus', () => {\r\n                this.aiDrawerCloseElement.focus();\r\n            });\r\n        }\r\n\r\n        // Focus on the action element when the AI drawer container receives focus.\r\n        this.aiDrawerElement.addEventListener('focus', () => {\r\n            this.actionElement.focus();\r\n        });\r\n\r\n        // Check if the action element exists.\r\n        if (this.actionElement) {\r\n            // Remove active from the action element when it loses focus.\r\n            this.actionElement.addEventListener('blur', () => {\r\n                this.actionElement.classList.remove('active');\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Register event listeners for the policy.\r\n     */\r\n    registerPolicyEventListeners() {\r\n        const acceptAction = document.querySelector(Selectors.ACTIONS.ACCEPT);\r\n        const declineAction = document.querySelector(Selectors.ACTIONS.DECLINE);\r\n        if (acceptAction && this.lastAction.length) {\r\n            acceptAction.addEventListener('click', (e) => {\r\n                e.preventDefault();\r\n                this.acceptPolicy().then(() => {\r\n                    return this.displayAction(this.lastAction);\r\n                }).catch(Notification.exception);\r\n            });\r\n        }\r\n        if (declineAction) {\r\n            declineAction.addEventListener('click', (e) => {\r\n                e.preventDefault();\r\n                this.closeAIDrawer();\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Register event listeners for the error.\r\n     */\r\n    registerErrorEventListeners() {\r\n        const retryAction = document.querySelector(Selectors.ACTIONS.RETRY);\r\n        if (retryAction && this.lastAction.length) {\r\n            retryAction.addEventListener('click', (e) => {\r\n                e.preventDefault();\r\n                this.displayAction(this.lastAction);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Register event listeners for the responses.\r\n     */\r\n    registerResponseEventListeners() {\r\n        // Get all regenerate action buttons (one per response in the AI drawer).\r\n        const regenerateActions = document.querySelectorAll(Selectors.ACTIONS.REGENERATE);\r\n        // Add event listeners for each regenerate action.\r\n        regenerateActions.forEach(regenerateAction => {\r\n            const responseElement = regenerateAction.closest(Selectors.ELEMENTS.RESPONSE);\r\n            if (regenerateAction && responseElement) {\r\n                // Get the action that this response is associated with.\r\n                const actionPerformed = responseElement.getAttribute('data-action-performed');\r\n                regenerateAction.addEventListener('click', (e) => {\r\n                    e.preventDefault();\r\n                    // Remove the old response before displaying the new one.\r\n                    this.removeResponseFromStack(actionPerformed);\r\n                    this.displayAction(actionPerformed);\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    registerLoadingEventListeners() {\r\n        const cancelAction = document.querySelector(Selectors.ACTIONS.CANCEL);\r\n        if (cancelAction) {\r\n            cancelAction.addEventListener('click', (e) => {\r\n                e.preventDefault();\r\n                this.setRequestCancelled();\r\n                this.toggleAIDrawer();\r\n                this.removeResponseFromStack('loading');\r\n                // Refresh the response stack to avoid false indication of loading.\r\n                const responses = this.getResponseStack();\r\n                this.aiDrawerBodyElement.innerHTML = responses;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if the AI drawer is open.\r\n     * @return {boolean} True if the AI drawer is open, false otherwise.\r\n     */\r\n    isAIDrawerOpen() {\r\n        return this.aiDrawerElement.classList.contains('show');\r\n    }\r\n\r\n    /**\r\n     * Check if the request is cancelled.\r\n     * @return {boolean} True if the request is cancelled, false otherwise.\r\n     */\r\n    isRequestCancelled() {\r\n        return this.aiDrawerBodyElement.dataset.cancelled === '1';\r\n    }\r\n\r\n    setRequestCancelled() {\r\n        this.aiDrawerBodyElement.dataset.cancelled = '1';\r\n    }\r\n\r\n    /**\r\n     * Open the AI drawer.\r\n     */\r\n    openAIDrawer() {\r\n        // Close message drawer if it is shown.\r\n        MessageDrawerHelper.hide();\r\n        this.aiDrawerElement.classList.add('show');\r\n        this.aiDrawerElement.setAttribute('tabindex', 0);\r\n        this.aiDrawerBodyElement.setAttribute('aria-live', 'polite');\r\n        if (!this.pageElement.classList.contains('show-drawer-right')) {\r\n            this.addPadding();\r\n        }\r\n        this.jumpToElement.setAttribute('tabindex', 0);\r\n        this.jumpToElement.focus();\r\n\r\n        // If the AI drawer is opened on a small screen, we need to trap the focus tab within the AI drawer.\r\n        if (isSmall()) {\r\n            FocusLock.trapFocus(this.aiDrawerElement);\r\n            this.aiDrawerElement.setAttribute('aria-modal', 'true');\r\n            this.aiDrawerElement.setAttribute('role', 'dialog');\r\n            this.isDrawerFocusLocked = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Close the AI drawer.\r\n     */\r\n    closeAIDrawer() {\r\n        // Untrap focus if it was locked.\r\n        if (this.isDrawerFocusLocked) {\r\n            FocusLock.untrapFocus();\r\n            this.aiDrawerElement.removeAttribute('aria-modal');\r\n            this.aiDrawerElement.setAttribute('role', 'region');\r\n        }\r\n\r\n        this.aiDrawerElement.classList.remove('show');\r\n        this.aiDrawerElement.setAttribute('tabindex', -1);\r\n        this.aiDrawerBodyElement.removeAttribute('aria-live');\r\n        if (this.pageElement.classList.contains('show-drawer-right') && this.aiDrawerBodyElement.dataset.removepadding === '1') {\r\n            this.removePadding();\r\n        }\r\n        this.jumpToElement.setAttribute('tabindex', -1);\r\n\r\n        // We can enforce a focus-visible state on the focus element using element.focus({focusVisible: true}).\r\n        // Unfortunately, this feature isn't supported in all browsers, only Firefox provides support for it.\r\n        // Therefore, we will apply the active class to the action element and set focus on it.\r\n        // This action will make the action element appear focused.\r\n        // When the action element loses focus,\r\n        // we will remove the active class at {@see registerEventListeners()}\r\n        this.actionElement.classList.add('active');\r\n        this.actionElement.focus();\r\n    }\r\n\r\n    /**\r\n     * Toggle the AI drawer.\r\n     */\r\n    toggleAIDrawer() {\r\n        if (this.isAIDrawerOpen()) {\r\n            this.closeAIDrawer();\r\n        } else {\r\n            this.openAIDrawer();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add padding to the page to make space for the AI drawer.\r\n     */\r\n    addPadding() {\r\n        this.pageElement.classList.add('show-drawer-right');\r\n        this.aiDrawerBodyElement.dataset.removepadding = '1';\r\n    }\r\n\r\n    /**\r\n     * Remove padding from the page.\r\n     */\r\n    removePadding() {\r\n        this.pageElement.classList.remove('show-drawer-right');\r\n        this.aiDrawerBodyElement.dataset.removepadding = '0';\r\n    }\r\n\r\n    /**\r\n     * Get important params related to the action.\r\n     * @param {string} action The action to use.\r\n     * @returns {object} The params to use for the action.\r\n     */\r\n    async getParamsForAction(action) {\r\n        let params = {};\r\n\r\n        switch (action) {\r\n            case 'summarise_text':\r\n                params.method = 'aiplacement_courseassist_summarise_text';\r\n                params.heading = await getString('aisummary', 'aiplacement_courseassist');\r\n                break;\r\n\r\n            case 'explain_text':\r\n                params.method = 'aiplacement_courseassist_explain_text';\r\n                params.heading = await getString('aiexplain', 'aiplacement_courseassist');\r\n                break;\r\n        }\r\n\r\n        return params;\r\n    }\r\n\r\n    /**\r\n     * Check if the policy is accepted.\r\n     * @return {bool} True if the policy is accepted, false otherwise.\r\n     */\r\n    async isPolicyAccepted() {\r\n        return await Policy.getPolicyStatus(this.userId);\r\n    }\r\n\r\n    /**\r\n     * Accept the policy.\r\n     * @return {Promise<Object>}\r\n     */\r\n    acceptPolicy() {\r\n        return Policy.acceptPolicy();\r\n    }\r\n\r\n    /**\r\n     * Check if the AI drawer has already generated content for a particular action.\r\n     * @param {string} action The action to check.\r\n     * @return {boolean} True if the AI drawer has generated content, false otherwise.\r\n     */\r\n    hasGeneratedContent(action) {\r\n        return this.responses.has(action);\r\n    }\r\n\r\n    /**\r\n     * Display the policy.\r\n     */\r\n    displayPolicy() {\r\n        Templates.render('core_ai/policyblock', {}).then((html) => {\r\n            this.aiDrawerBodyElement.innerHTML = html;\r\n            this.registerPolicyEventListeners();\r\n            return;\r\n        }).catch(Notification.exception);\r\n    }\r\n\r\n    /**\r\n     * Display the loading spinner.\r\n     */\r\n    displayLoading() {\r\n        Templates.render('aiplacement_courseassist/loading', {}).then((html) => {\r\n            this.addResponseToStack('loading', html);\r\n            const responses = this.getResponseStack();\r\n            this.aiDrawerBodyElement.innerHTML = responses;\r\n            this.registerLoadingEventListeners();\r\n            return;\r\n        }).then(() => {\r\n            this.removeResponseFromStack('loading');\r\n            return;\r\n        }).catch(Notification.exception);\r\n    }\r\n\r\n    /**\r\n     * Display the action result in the AI drawer.\r\n     * @param {string} action The action to display.\r\n     */\r\n    async displayAction(action) {\r\n        if (this.hasGeneratedContent(action)) {\r\n            // Scroll to generated content.\r\n            const existingReponse = document.querySelector('[data-action-performed=\"' + action + '\"]');\r\n            if (existingReponse) {\r\n                this.aiDrawerBodyElement.scrollTop = existingReponse.offsetTop;\r\n            }\r\n        } else {\r\n            // Display loading spinner.\r\n            this.displayLoading();\r\n            // Clear the drawer to prevent including the previously generated response in the new response prompt.\r\n            this.aiDrawerBodyElement.innerHTML = '';\r\n            const params = await this.getParamsForAction(action);\r\n            const request = {\r\n                methodname: params.method,\r\n                args: {\r\n                    contextid: this.contextId,\r\n                    prompttext: this.getTextContent(),\r\n                }\r\n            };\r\n            try {\r\n                const responseObj = await Ajax.call([request])[0];\r\n                if (responseObj.error) {\r\n                    this.displayError(responseObj.error, responseObj.errormessage);\r\n                    return;\r\n                } else {\r\n                    if (!this.isRequestCancelled()) {\r\n                        // Perform replacements on the generated context to ensure it is formatted correctly.\r\n                        const generatedContent = AIHelper.formatResponse(responseObj.generatedcontent);\r\n                        this.displayResponse(generatedContent, action);\r\n                        return;\r\n                    } else {\r\n                        this.aiDrawerBodyElement.dataset.cancelled = '0';\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                window.console.log(error);\r\n                this.displayError();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add the HTML response to the response stack.\r\n     * The stack will be used to display all responses in the AI drawer.\r\n     * @param {String} action The action key.\r\n     * @param {String} html The HTML to store.\r\n     */\r\n    addResponseToStack(action, html) {\r\n        this.responses.set(action, html);\r\n    }\r\n\r\n    /**\r\n     * Remove a stored response, allowing for a regenerated one.\r\n     * @param {String} action The action key.\r\n     */\r\n    removeResponseFromStack(action) {\r\n        if (this.responses.has(action)) {\r\n            this.responses.delete(action);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Return a stack of HTML responses.\r\n     * @return {String} HTML responses.\r\n     */\r\n    getResponseStack() {\r\n        let stack = '';\r\n        // Reverse to get newest first.\r\n        const responses = [...this.responses.values()].reverse();\r\n        for (const response of responses) {\r\n            stack += response;\r\n        }\r\n        return stack;\r\n    }\r\n\r\n    /**\r\n     * Display the responses.\r\n     * @param {String} content The content to display.\r\n     * @param {String} action The action used.\r\n     */\r\n    async displayResponse(content, action) {\r\n        const params = await this.getParamsForAction(action);\r\n        const args = {\r\n            content: content,\r\n            heading: params.heading,\r\n            action: action,\r\n        };\r\n        Templates.render('aiplacement_courseassist/response', args).then((html) => {\r\n            this.addResponseToStack(action, html);\r\n            const responses = this.getResponseStack();\r\n            this.aiDrawerBodyElement.innerHTML = responses;\r\n            this.registerResponseEventListeners();\r\n            return;\r\n        }).catch(Notification.exception);\r\n    }\r\n\r\n    /**\r\n     * Display the error.\r\n     *\r\n     * @param {String} error The error name to display.\r\n     * @param {String} errorMessage The error message to display.\r\n     */\r\n    async displayError(error = '', errorMessage = '') {\r\n        if (!error) {\r\n            // Get the default error message.\r\n            error = await getString('error:defaultname', 'core_ai');\r\n            errorMessage = await getString('error:defaultmessage', 'core_ai');\r\n        }\r\n        Templates.render('aiplacement_courseassist/error', {'error': error, 'errorMessage': errorMessage}).then((html) => {\r\n            this.addResponseToStack('error', html);\r\n            const responses = this.getResponseStack();\r\n            this.aiDrawerBodyElement.innerHTML = responses;\r\n            this.registerErrorEventListeners();\r\n            return;\r\n        }).then(() => {\r\n            this.removeResponseFromStack('error');\r\n            return;\r\n        }).catch(Notification.exception);\r\n    }\r\n\r\n    /**\r\n     * Get the text content of the main region.\r\n     * @return {String} The text content.\r\n     */\r\n    getTextContent() {\r\n        const mainRegion = document.querySelector(Selectors.ELEMENTS.MAIN_REGION);\r\n        return mainRegion.innerText || mainRegion.textContent;\r\n    }\r\n};\r\n\r\nexport default AICourseAssist;\r\n"],"names":["constructor","userId","contextId","aiDrawerElement","document","querySelector","Selectors","ELEMENTS","AIDRAWER","aiDrawerBodyElement","AIDRAWER_BODY","pageElement","PAGE","jumpToElement","JUMPTO","actionElement","ACTION","aiDrawerCloseElement","this","AIDRAWER_CLOSE","lastAction","responses","Map","isDrawerFocusLocked","registerEventListeners","addEventListener","async","e","target","closest","ACTIONS","SUMMARY","preventDefault","openAIDrawer","focus","isPolicyAccepted","displayPolicy","displayAction","EXPLAIN","closeAIDrawer","isAIDrawerOpen","key","DrawerEvents","DRAWER_SHOWN","classList","remove","registerPolicyEventListeners","acceptAction","ACCEPT","declineAction","DECLINE","length","acceptPolicy","then","catch","Notification","exception","registerErrorEventListeners","retryAction","RETRY","registerResponseEventListeners","querySelectorAll","REGENERATE","forEach","regenerateAction","responseElement","RESPONSE","actionPerformed","getAttribute","removeResponseFromStack","registerLoadingEventListeners","cancelAction","CANCEL","setRequestCancelled","toggleAIDrawer","getResponseStack","innerHTML","contains","isRequestCancelled","dataset","cancelled","MessageDrawerHelper","hide","add","setAttribute","addPadding","FocusLock","trapFocus","untrapFocus","removeAttribute","removepadding","removePadding","action","params","method","heading","Policy","getPolicyStatus","hasGeneratedContent","has","render","html","displayLoading","addResponseToStack","existingReponse","scrollTop","offsetTop","request","methodname","getParamsForAction","args","contextid","prompttext","getTextContent","responseObj","Ajax","call","error","displayError","errormessage","generatedContent","AIHelper","formatResponse","generatedcontent","displayResponse","window","console","log","set","delete","stack","values","reverse","response","content","errorMessage","mainRegion","MAIN_REGION","innerText","textContent"],"mappings":"qqEAqCuB,MAkBnBA,YAAYC,OAAQC,+FACXD,OAASA,YACTC,UAAYA,eAEZC,gBAAkBC,SAASC,cAAcC,mBAAUC,SAASC,eAC5DC,oBAAsBL,SAASC,cAAcC,mBAAUC,SAASG,oBAChEC,YAAcP,SAASC,cAAcC,mBAAUC,SAASK,WACxDC,cAAgBT,SAASC,cAAcC,mBAAUC,SAASO,aAC1DC,cAAgBX,SAASC,cAAcC,mBAAUC,SAASS,aAC1DC,qBAAuBC,KAAKf,gBAAgBE,cAAcC,mBAAUC,SAASY,qBAC7EC,WAAa,QACbC,UAAY,IAAIC,SAChBC,qBAAsB,OAEtBC,yBAMTA,yBACIpB,SAASqB,iBAAiB,SAASC,MAAAA,OAEPC,EAAEC,OAAOC,QAAQvB,mBAAUwB,QAAQC,SACtC,CACjBJ,EAAEK,sBACGC,oBACAb,WAAa,sBACbL,cAAcmB,kBACYhB,KAAKiB,oCAG3BC,qBAGJC,cAAcnB,KAAKE,eAGNO,EAAEC,OAAOC,QAAQvB,mBAAUwB,QAAQQ,SACtC,CACfX,EAAEK,sBACGC,oBACAb,WAAa,oBACbL,cAAcmB,kBACYhB,KAAKiB,oCAG3BC,qBAGJC,cAAcnB,KAAKE,YAGNO,EAAEC,OAAOC,QAAQvB,mBAAUC,SAASY,kBAEtDQ,EAAEK,sBACGO,oBAIbnC,SAASqB,iBAAiB,WAAWE,IAC7BT,KAAKsB,kBAA8B,WAAVb,EAAEc,UACtBF,yCAKHG,uBAAaC,cAAc,KAC7BzB,KAAKsB,uBACAD,mBAKTrB,KAAKL,oBAEAA,cAAcY,iBAAiB,SAAS,UACpCR,qBAAqBiB,gBAK7B/B,gBAAgBsB,iBAAiB,SAAS,UACtCV,cAAcmB,WAInBhB,KAAKH,oBAEAA,cAAcU,iBAAiB,QAAQ,UACnCV,cAAc6B,UAAUC,OAAO,aAQhDC,qCACUC,aAAe3C,SAASC,cAAcC,mBAAUwB,QAAQkB,QACxDC,cAAgB7C,SAASC,cAAcC,mBAAUwB,QAAQoB,SAC3DH,cAAgB7B,KAAKE,WAAW+B,QAChCJ,aAAatB,iBAAiB,SAAUE,IACpCA,EAAEK,sBACGoB,eAAeC,MAAK,IACdnC,KAAKmB,cAAcnB,KAAKE,cAChCkC,MAAMC,sBAAaC,cAG1BP,eACAA,cAAcxB,iBAAiB,SAAUE,IACrCA,EAAEK,sBACGO,mBAQjBkB,oCACUC,YAActD,SAASC,cAAcC,mBAAUwB,QAAQ6B,OACzDD,aAAexC,KAAKE,WAAW+B,QAC/BO,YAAYjC,iBAAiB,SAAUE,IACnCA,EAAEK,sBACGK,cAAcnB,KAAKE,eAQpCwC,iCAE8BxD,SAASyD,iBAAiBvD,mBAAUwB,QAAQgC,YAEpDC,SAAQC,yBAChBC,gBAAkBD,iBAAiBnC,QAAQvB,mBAAUC,SAAS2D,aAChEF,kBAAoBC,gBAAiB,OAE/BE,gBAAkBF,gBAAgBG,aAAa,yBACrDJ,iBAAiBvC,iBAAiB,SAAUE,IACxCA,EAAEK,sBAEGqC,wBAAwBF,sBACxB9B,cAAc8B,wBAMnCG,sCACUC,aAAenE,SAASC,cAAcC,mBAAUwB,QAAQ0C,QAC1DD,cACAA,aAAa9C,iBAAiB,SAAUE,IACpCA,EAAEK,sBACGyC,2BACAC,sBACAL,wBAAwB,iBAEvBhD,UAAYH,KAAKyD,wBAClBlE,oBAAoBmE,UAAYvD,aASjDmB,wBACWtB,KAAKf,gBAAgByC,UAAUiC,SAAS,QAOnDC,2BAC0D,MAA/C5D,KAAKT,oBAAoBsE,QAAQC,UAG5CP,2BACShE,oBAAoBsE,QAAQC,UAAY,IAMjD/C,eAEIgD,oBAAoBC,YACf/E,gBAAgByC,UAAUuC,IAAI,aAC9BhF,gBAAgBiF,aAAa,WAAY,QACzC3E,oBAAoB2E,aAAa,YAAa,UAC9ClE,KAAKP,YAAYiC,UAAUiC,SAAS,2BAChCQ,kBAEJxE,cAAcuE,aAAa,WAAY,QACvCvE,cAAcqB,SAGf,4BACAoD,UAAUC,UAAUrE,KAAKf,sBACpBA,gBAAgBiF,aAAa,aAAc,aAC3CjF,gBAAgBiF,aAAa,OAAQ,eACrC7D,qBAAsB,GAOnCgB,gBAEQrB,KAAKK,sBACL+D,UAAUE,mBACLrF,gBAAgBsF,gBAAgB,mBAChCtF,gBAAgBiF,aAAa,OAAQ,gBAGzCjF,gBAAgByC,UAAUC,OAAO,aACjC1C,gBAAgBiF,aAAa,YAAa,QAC1C3E,oBAAoBgF,gBAAgB,aACrCvE,KAAKP,YAAYiC,UAAUiC,SAAS,sBAA2E,MAAnD3D,KAAKT,oBAAoBsE,QAAQW,oBACxFC,qBAEJ9E,cAAcuE,aAAa,YAAa,QAQxCrE,cAAc6B,UAAUuC,IAAI,eAC5BpE,cAAcmB,QAMvBwC,iBACQxD,KAAKsB,sBACAD,qBAEAN,eAOboD,kBACS1E,YAAYiC,UAAUuC,IAAI,0BAC1B1E,oBAAoBsE,QAAQW,cAAgB,IAMrDC,qBACShF,YAAYiC,UAAUC,OAAO,0BAC7BpC,oBAAoBsE,QAAQW,cAAgB,6BAQ5BE,YACjBC,OAAS,UAELD,YACC,iBACDC,OAAOC,OAAS,0CAChBD,OAAOE,cAAgB,kBAAU,YAAa,sCAG7C,eACDF,OAAOC,OAAS,wCAChBD,OAAOE,cAAgB,kBAAU,YAAa,mCAI/CF,6CAQMG,gBAAOC,gBAAgB/E,KAAKjB,QAO7CmD,sBACW4C,gBAAO5C,eAQlB8C,oBAAoBN,eACT1E,KAAKG,UAAU8E,IAAIP,QAM9BxD,mCACcgE,OAAO,sBAAuB,IAAI/C,MAAMgD,YACzC5F,oBAAoBmE,UAAYyB,UAChCvD,kCAENQ,MAAMC,sBAAaC,WAM1B8C,oCACcF,OAAO,mCAAoC,IAAI/C,MAAMgD,YACtDE,mBAAmB,UAAWF,YAC7BhF,UAAYH,KAAKyD,wBAClBlE,oBAAoBmE,UAAYvD,eAChCiD,mCAENjB,MAAK,UACCgB,wBAAwB,cAE9Bf,MAAMC,sBAAaC,+BAONoC,WACZ1E,KAAKgF,oBAAoBN,QAAS,OAE5BY,gBAAkBpG,SAASC,cAAc,2BAA6BuF,OAAS,MACjFY,uBACK/F,oBAAoBgG,UAAYD,gBAAgBE,eAEtD,MAEEJ,sBAEA7F,oBAAoBmE,UAAY,SAE/B+B,QAAU,CACZC,kBAFiB1F,KAAK2F,mBAAmBjB,SAEtBE,OACnBgB,KAAM,CACFC,UAAW7F,KAAKhB,UAChB8G,WAAY9F,KAAK+F,6BAIfC,kBAAoBC,cAAKC,KAAK,CAACT,UAAU,MAC3CO,YAAYG,uBACPC,aAAaJ,YAAYG,MAAOH,YAAYK,kBAG5CrG,KAAK4D,qBAAsB,OAEtB0C,iBAAmBC,gBAASC,eAAeR,YAAYS,mCACxDC,gBAAgBJ,iBAAkB5B,aAGlCnF,oBAAoBsE,QAAQC,UAAY,IAGvD,MAAOqC,OACLQ,OAAOC,QAAQC,IAAIV,YACdC,iBAWjBf,mBAAmBX,OAAQS,WAClBhF,UAAU2G,IAAIpC,OAAQS,MAO/BhC,wBAAwBuB,QAChB1E,KAAKG,UAAU8E,IAAIP,cACdvE,UAAU4G,OAAOrC,QAQ9BjB,uBACQuD,MAAQ,SAEN7G,UAAY,IAAIH,KAAKG,UAAU8G,UAAUC,cAC1C,MAAMC,YAAYhH,UACnB6G,OAASG,gBAENH,4BAQWI,QAAS1C,cAErBkB,KAAO,CACTwB,QAASA,QACTvC,eAHiB7E,KAAK2F,mBAAmBjB,SAGzBG,QAChBH,OAAQA,2BAEFQ,OAAO,oCAAqCU,MAAMzD,MAAMgD,YACzDE,mBAAmBX,OAAQS,YAC1BhF,UAAYH,KAAKyD,wBAClBlE,oBAAoBmE,UAAYvD,eAChCuC,oCAENN,MAAMC,sBAAaC,oCASP6D,6DAAQ,GAAIkB,oEAAe,GACrClB,QAEDA,YAAc,kBAAU,oBAAqB,WAC7CkB,mBAAqB,kBAAU,uBAAwB,+BAEjDnC,OAAO,iCAAkC,OAAUiB,mBAAuBkB,eAAelF,MAAMgD,YAChGE,mBAAmB,QAASF,YAC3BhF,UAAYH,KAAKyD,wBAClBlE,oBAAoBmE,UAAYvD,eAChCoC,iCAENJ,MAAK,UACCgB,wBAAwB,YAE9Bf,MAAMC,sBAAaC,WAO1ByD,uBACUuB,WAAapI,SAASC,cAAcC,mBAAUC,SAASkI,oBACtDD,WAAWE,WAAaF,WAAWG"}