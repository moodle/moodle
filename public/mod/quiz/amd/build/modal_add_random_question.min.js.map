{"version":3,"file":"modal_add_random_question.min.js","sources":["../src/modal_add_random_question.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Contain the logic for the add random question modal.\r\n *\r\n * @module     mod_quiz/modal_add_random_question\r\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport Modal from './add_question_modal';\r\nimport * as Notification from 'core/notification';\r\nimport * as Fragment from 'core/fragment';\r\nimport * as Templates from 'core/templates';\r\nimport * as FormChangeChecker from 'core_form/changechecker';\r\nimport {call as fetchMany} from 'core/ajax';\r\nimport Pending from 'core/pending';\r\n\r\nconst SELECTORS = {\r\n    ANCHOR: 'a[href]',\r\n    EXISTING_CATEGORY_CONTAINER: '[data-region=\"existing-category-container\"]',\r\n    EXISTING_CATEGORY_TAB: '#id_existingcategoryheader',\r\n    NEW_CATEGORY_CONTAINER: '[data-region=\"new-category-container\"]',\r\n    NEW_CATEGORY_TAB: '#id_newcategoryheader',\r\n    TAB_CONTENT: '[data-region=\"tab-content\"]',\r\n    ADD_ON_PAGE_FORM_ELEMENT: '[name=\"addonpage\"]',\r\n    ADD_RANDOM_BUTTON: 'input[type=\"submit\"][name=\"addrandom\"]',\r\n    ADD_NEW_CATEGORY_BUTTON: 'input[type=\"submit\"][name=\"newcategory\"]',\r\n    SUBMIT_BUTTON_ELEMENT: 'input[type=\"submit\"][name=\"addrandom\"], '\r\n        + 'input[type=\"submit\"][name=\"newcategory\"], '\r\n        + 'input[type=\"submit\"][name=\"update\"]',\r\n    FORM_HEADER: 'legend',\r\n    SELECT_NUMBER_TO_ADD: '#menurandomcount',\r\n    NEW_CATEGORY_ELEMENT: '#categoryname',\r\n    PARENT_CATEGORY_ELEMENT: '#parentcategory',\r\n    FILTER_CONDITION_ELEMENT: '[data-filtercondition]',\r\n    FORM_ELEMENT: '#add_random_question_form',\r\n    MESSAGE_INPUT: '[name=\"message\"]',\r\n    SWITCH_TO_OTHER_BANK: 'button[data-action=\"switch-question-bank\"]',\r\n    NEW_BANKMOD_ID: 'data-newmodid',\r\n    BANK_SEARCH: '#searchbanks',\r\n    GO_BACK_BUTTON: 'button[data-action=\"go-back\"]',\r\n    UPDATE_FILTER_BUTTON: 'input[type=\"submit\"][name=\"update\"]',\r\n};\r\n\r\nexport default class ModalAddRandomQuestion extends Modal {\r\n    static TYPE = 'mod_quiz-quiz-add-random-question';\r\n    static TEMPLATE = 'mod_quiz/modal_add_random_question';\r\n\r\n    /**\r\n     * Create the add random question modal.\r\n     *\r\n     * @param  {Number} contextId Current context id.\r\n     * @param  {Number} bankCmId Current question bank course module id.\r\n     * @param  {string} category Category id and category context id comma separated.\r\n     * @param  {string} returnUrl URL to return to after form submission.\r\n     * @param  {Number} quizCmId Current quiz course module id.\r\n     * @param  {boolean} showNewCategory Display the New category tab when selecting random questions.\r\n     */\r\n    static init(\r\n        contextId,\r\n        bankCmId,\r\n        category,\r\n        returnUrl,\r\n        quizCmId,\r\n        showNewCategory = true\r\n    ) {\r\n        const selector = '.menu [data-action=\"addarandomquestion\"], [data-action=\"editrandomquestion\"]';\r\n        document.addEventListener('click', (e) => {\r\n            const trigger = e.target.closest(selector);\r\n            if (!trigger) {\r\n                return;\r\n            }\r\n            e.preventDefault();\r\n\r\n            if (trigger.dataset.slotid) {\r\n                showNewCategory = false;\r\n            }\r\n\r\n            ModalAddRandomQuestion.create({\r\n                contextId,\r\n                bankCmId,\r\n                category,\r\n                returnUrl,\r\n                quizCmId,\r\n                showNewCategory,\r\n                title: trigger.dataset.header,\r\n                addOnPage: trigger.dataset.addonpage,\r\n                slotId: trigger.dataset.slotid,\r\n                templateContext: {\r\n                    hidden: showNewCategory,\r\n                },\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Constructor for the Modal.\r\n     *\r\n     * @param {object} root The root jQuery element for the modal\r\n     */\r\n    constructor(root) {\r\n        super(root);\r\n        this.category = null;\r\n        this.returnUrl = null;\r\n        this.quizCmId = null;\r\n        this.loadedForm = false;\r\n        this.slotId = 0;\r\n        this.savedFilterCondition = null;\r\n    }\r\n\r\n    configure(modalConfig) {\r\n        modalConfig.removeOnClose = true;\r\n\r\n        this.setCategory(modalConfig.category);\r\n        this.setReturnUrl(modalConfig.returnUrl);\r\n        this.showNewCategory = modalConfig.showNewCategory;\r\n        this.setSlotId(modalConfig.slotId ?? 0);\r\n        this.setSavedFilterCondition(modalConfig.savedFilterCondition ?? null);\r\n\r\n        super.configure(modalConfig);\r\n    }\r\n\r\n    /**\r\n     * Set the id of the page that the question should be added to\r\n     * when the user clicks the add to quiz link.\r\n     *\r\n     * @method setAddOnPageId\r\n     * @param {int} id\r\n     */\r\n    setAddOnPageId(id) {\r\n        super.setAddOnPageId(id);\r\n        this.getBody().find(SELECTORS.ADD_ON_PAGE_FORM_ELEMENT).val(id);\r\n    }\r\n\r\n    /**\r\n     * Set the category for this form. The category is a comma separated\r\n     * category id and category context id.\r\n     *\r\n     * @method setCategory\r\n     * @param {string} category\r\n     */\r\n    setCategory(category) {\r\n        this.category = category;\r\n    }\r\n\r\n    /**\r\n     * Returns the saved category.\r\n     *\r\n     * @method getCategory\r\n     * @return {string}\r\n     */\r\n    getCategory() {\r\n        return this.category;\r\n    }\r\n\r\n    /**\r\n     * Set the return URL for the form.\r\n     *\r\n     * @method setReturnUrl\r\n     * @param {string} url\r\n     */\r\n    setReturnUrl(url) {\r\n        this.returnUrl = url;\r\n    }\r\n\r\n    /**\r\n     * Returns the return URL for the form.\r\n     *\r\n     * @method getReturnUrl\r\n     * @return {string}\r\n     */\r\n    getReturnUrl() {\r\n        return this.returnUrl;\r\n    }\r\n\r\n    /**\r\n     * Set the ID of the quiz slot, if we are editing an existing random question.\r\n     *\r\n     * @param {Number} slotId\r\n     */\r\n    setSlotId(slotId) {\r\n        this.slotId = slotId;\r\n    }\r\n\r\n    /**\r\n     * Get the current slot ID.\r\n     *\r\n     * @return {Number}\r\n     */\r\n    getSlotId() {\r\n        return this.slotId;\r\n    }\r\n\r\n    /**\r\n     * Store the current filterCondition JSON string.\r\n     *\r\n     * @param {String} filterCondition\r\n     */\r\n    setSavedFilterCondition(filterCondition) {\r\n        this.savedFilterCondition = filterCondition;\r\n    }\r\n\r\n    /**\r\n     * Return the saved filterCondition JSON string.\r\n     *\r\n     * @return {String}\r\n     */\r\n    getSavedFilterCondition() {\r\n        return this.savedFilterCondition;\r\n    }\r\n\r\n    /**\r\n     * Moves a given form element inside (a child of) a given tab element.\r\n     *\r\n     * Hides the 'legend' (e.g. header) element of the form element because the\r\n     * tab has the name.\r\n     *\r\n     * Moves the submit button into a footer element at the bottom of the form\r\n     * element for styling purposes.\r\n     *\r\n     * @method moveContentIntoTab\r\n     * @param  {jquery} tabContent The form element to move into the tab.\r\n     * @param  {jquey} tabElement The tab element for the form element to move into.\r\n     */\r\n    moveContentIntoTab(tabContent, tabElement) {\r\n        // Hide the header because the tabs show us which part of the form we're\r\n        // looking at.\r\n        tabContent.find(SELECTORS.FORM_HEADER).addClass('hidden');\r\n        // Move the element inside a tab.\r\n        tabContent.wrap(tabElement);\r\n    }\r\n\r\n    /**\r\n     * Empty the tab content container and move all tabs from the form into the\r\n     * tab container element.\r\n     *\r\n     * @method moveTabsIntoTabContent\r\n     * @param  {jquery} form The form element.\r\n     */\r\n    moveTabsIntoTabContent(form) {\r\n        // Empty it to remove the loading icon.\r\n        const tabContent = this.getBody().find(SELECTORS.TAB_CONTENT).empty();\r\n        // Make sure all tabs are inside the tab content element.\r\n        form.find('[role=\"tabpanel\"]').wrapAll(tabContent);\r\n    }\r\n\r\n    /**\r\n     * Make sure all of the tabs have a cancel button in their fotter to sit along\r\n     * side the submit button.\r\n     *\r\n     * @method moveCancelButtonToTabs\r\n     * @param  {jquey} form The form element.\r\n     */\r\n    moveCancelButtonToTabs(form) {\r\n        const cancelButton = form.find(SELECTORS.CANCEL_BUTTON_ELEMENT).addClass('ms-1');\r\n        const tabFooters = form.find('[data-region=\"footer\"]');\r\n        // Remove the buttons container element.\r\n        cancelButton.closest(SELECTORS.BUTTON_CONTAINER).remove();\r\n        cancelButton.clone().appendTo(tabFooters);\r\n    }\r\n\r\n    /**\r\n     * Load the add random question form in a fragement and perform some transformation\r\n     * on the HTML to convert it into tabs for rendering in the modal.\r\n     *\r\n     * @method loadForm\r\n     * @return {promise} Resolved with form HTML and JS.\r\n     */\r\n    loadForm() {\r\n        const addonpage = this.getAddOnPageId();\r\n        const returnurl = this.getReturnUrl();\r\n        const quizcmid = this.quizCmId;\r\n        const bankcmid = this.bankCmId;\r\n        const savedfiltercondition = this.getSavedFilterCondition();\r\n        this.setSavedFilterCondition(null);\r\n\r\n        return Fragment.loadFragment(\r\n            'mod_quiz',\r\n            'add_random_question_form',\r\n            this.getContextId(),\r\n            {\r\n                addonpage: addonpage ?? null,\r\n                returnurl,\r\n                quizcmid,\r\n                bankcmid,\r\n                slotid: this.getSlotId(),\r\n                savedfiltercondition,\r\n            }\r\n        )\r\n            .then((html, js) => {\r\n                const form = $(html);\r\n                if (!this.getSlotId()) {\r\n                    const existingCategoryTabContent = form.find(SELECTORS.EXISTING_CATEGORY_TAB);\r\n                    const existingCategoryTab = this.getBody().find(SELECTORS.EXISTING_CATEGORY_CONTAINER);\r\n                    const newCategoryTabContent = form.find(SELECTORS.NEW_CATEGORY_TAB);\r\n                    const newCategoryTab = this.getBody().find(SELECTORS.NEW_CATEGORY_CONTAINER);\r\n\r\n                    // Transform the form into tabs for better rendering in the modal.\r\n                    this.moveContentIntoTab(existingCategoryTabContent, existingCategoryTab);\r\n                    this.moveContentIntoTab(newCategoryTabContent, newCategoryTab);\r\n                    this.moveTabsIntoTabContent(form);\r\n                }\r\n\r\n                Templates.replaceNode(this.getBody().find(SELECTORS.TAB_CONTENT), form, js);\r\n                return;\r\n            })\r\n            .then(() => {\r\n                // Make sure the form change checker is disabled otherwise it'll stop the user from navigating away from the\r\n                // page once the modal is hidden.\r\n                FormChangeChecker.disableAllChecks();\r\n\r\n                // Add question to quiz.\r\n                this.getBody()[0].addEventListener('click', (e) => {\r\n                    const button = e.target.closest(SELECTORS.SUBMIT_BUTTON_ELEMENT);\r\n                    if (!button) {\r\n                        return;\r\n                    }\r\n                    e.preventDefault();\r\n\r\n                    // Intercept the submission to adjust the POST params so that the quiz mod id is set and not the bank module id.\r\n                    document.querySelector('#questionscontainer input[name=\"cmid\"]').setAttribute('name', this.quizCmId);\r\n\r\n                    // Add Random questions if the add random button was clicked.\r\n                    const addRandomButton = e.target.closest(SELECTORS.ADD_RANDOM_BUTTON);\r\n                    if (addRandomButton) {\r\n                        const randomcount = document.querySelector(SELECTORS.SELECT_NUMBER_TO_ADD).value;\r\n                        const filtercondition = document.querySelector(SELECTORS.FILTER_CONDITION_ELEMENT).dataset?.filtercondition;\r\n\r\n                        this.addQuestions(quizcmid, addonpage, randomcount, filtercondition, '', '');\r\n                        return;\r\n                    }\r\n                    // Update the filter condition for the slot if the update button was clicked.\r\n                    const updateFilterButton = e.target.closest(SELECTORS.UPDATE_FILTER_BUTTON);\r\n                    if (updateFilterButton) {\r\n                        const filtercondition = document.querySelector(SELECTORS.FILTER_CONDITION_ELEMENT).dataset?.filtercondition;\r\n                        this.updateFilterCondition(quizcmid, this.getSlotId(), filtercondition);\r\n                        return;\r\n                    }\r\n                    // Add new category if the add category button was clicked.\r\n                    const addCategoryButton = e.target.closest(SELECTORS.ADD_NEW_CATEGORY_BUTTON);\r\n                    if (addCategoryButton) {\r\n                        this.addQuestions(\r\n                            quizcmid,\r\n                            addonpage,\r\n                            1,\r\n                            '',\r\n                            document.querySelector(SELECTORS.NEW_CATEGORY_ELEMENT).value,\r\n                            document.querySelector(SELECTORS.PARENT_CATEGORY_ELEMENT).value\r\n                        );\r\n                        return;\r\n                    }\r\n                });\r\n\r\n                this.getModal().on('click', SELECTORS.SWITCH_TO_OTHER_BANK, () => {\r\n                    this.setSavedFilterCondition(\r\n                        document.querySelector(SELECTORS.FILTER_CONDITION_ELEMENT).dataset?.filtercondition\r\n                    );\r\n                    this.handleSwitchBankContentReload(SELECTORS.BANK_SEARCH)\r\n                        .then(function(ModalQuizQuestionBank) {\r\n                            $(SELECTORS.BANK_SEARCH)?.on('change', (e) => {\r\n                                const bankCmId = $(e.currentTarget).val();\r\n                                // Have to recreate the modal as we have already used the body for the switch bank content.\r\n                                if (bankCmId > 0) {\r\n                                    ModalAddRandomQuestion.create({\r\n                                        'contextId': ModalQuizQuestionBank.getContextId(),\r\n                                        'bankCmId': bankCmId,\r\n                                        'category': ModalQuizQuestionBank.getCategory(),\r\n                                        'returnUrl': ModalQuizQuestionBank.getReturnUrl(),\r\n                                        'quizCmId': ModalQuizQuestionBank.quizCmId,\r\n                                        'title': ModalQuizQuestionBank.originalTitle,\r\n                                        'addOnPage': ModalQuizQuestionBank.getAddOnPageId(),\r\n                                        'templateContext': {hidden: ModalQuizQuestionBank.showNewCategory},\r\n                                        'showNewCategory': ModalQuizQuestionBank.showNewCategory,\r\n                                        'slotId': ModalQuizQuestionBank.getSlotId(),\r\n                                    })\r\n                                    .then(ModalQuizQuestionBank.destroy())\r\n                                    .catch(Notification.exception);\r\n                                }\r\n                            });\r\n                            return ModalQuizQuestionBank;\r\n                        });\r\n                });\r\n\r\n                this.getModal().on('click', SELECTORS.GO_BACK_BUTTON, (e) => {\r\n                    const anchorElement = $(e.currentTarget);\r\n                    // Have to recreate the modal as we have already used the body for the switch bank content.\r\n                    ModalAddRandomQuestion.create({\r\n                        'contextId': this.getContextId(),\r\n                        'bankCmId': anchorElement.attr('value'),\r\n                        'category': this.getCategory(),\r\n                        'returnUrl': this.getReturnUrl(),\r\n                        'quizCmId': this.quizCmId,\r\n                        'title': this.originalTitle,\r\n                        'addOnPage': this.getAddOnPageId(),\r\n                        'templateContext': {hidden: this.showNewCategory},\r\n                        'showNewCategory': this.showNewCategory,\r\n                        'savedFilterCondition': this.getSavedFilterCondition(),\r\n                        'slotId': this.getSlotId(),\r\n                    }).then(this.destroy()).catch(Notification.exception);\r\n                });\r\n\r\n                this.getModal().on('click', SELECTORS.ANCHOR, (e) => {\r\n                    const anchorElement = $(e.currentTarget);\r\n                    // Have to recreate the modal as we have already used the body for the switch bank content.\r\n                    if (anchorElement.closest('a[' + SELECTORS.NEW_BANKMOD_ID + ']').length) {\r\n                        ModalAddRandomQuestion.create({\r\n                            'contextId': this.getContextId(),\r\n                            'bankCmId': anchorElement.attr(SELECTORS.NEW_BANKMOD_ID),\r\n                            'category': this.getCategory(),\r\n                            'returnUrl': this.getReturnUrl(),\r\n                            'quizCmId': this.quizCmId,\r\n                            'title': this.originalTitle,\r\n                            'addOnPage': this.getAddOnPageId(),\r\n                            'templateContext': {hidden: this.showNewCategory},\r\n                            'showNewCategory': this.showNewCategory,\r\n                            'slotId': this.getSlotId(),\r\n                        }).then(this.destroy()).catch(Notification.exception);\r\n                    }\r\n                });\r\n            })\r\n            .catch(Notification.exception);\r\n    }\r\n\r\n    /**\r\n     * Call web service function to add random questions\r\n     *\r\n     * @param {number} quizcmid the course module id of the quiz to add questions to.\r\n     * @param {number} addonpage the page where random questions will be added to\r\n     * @param {number} randomcount Number of random questions\r\n     * @param {string} filtercondition Filter condition\r\n     * @param {string} newcategory add new category\r\n     * @param {string} parentcategory parent category of new category\r\n     */\r\n    async addQuestions(\r\n        quizcmid,\r\n        addonpage,\r\n        randomcount,\r\n        filtercondition,\r\n        newcategory,\r\n        parentcategory\r\n    ) {\r\n        // We do not need to resolve this Pending because the form submission will result in a page redirect.\r\n        new Pending('mod-quiz/modal_add_random_questions');\r\n        const call = {\r\n            methodname: 'mod_quiz_add_random_questions',\r\n            args: {\r\n                cmid: quizcmid,\r\n                addonpage,\r\n                randomcount,\r\n                filtercondition,\r\n                newcategory,\r\n                parentcategory,\r\n            }\r\n        };\r\n        try {\r\n            const response = await fetchMany([call])[0];\r\n            const form = document.querySelector(SELECTORS.FORM_ELEMENT);\r\n            const messageInput = form.querySelector(SELECTORS.MESSAGE_INPUT);\r\n            messageInput.value = response.message;\r\n            form.submit();\r\n        } catch (e) {\r\n            Notification.exception(e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Call web service function to update the filter condition for an existing slot.\r\n     *\r\n     * @param {number} quizcmid the course module id of the quiz.\r\n     * @param {number} slotid The slot the random question is in.\r\n     * @param {string} filtercondition The new filter condition.\r\n     */\r\n    async updateFilterCondition(\r\n        quizcmid,\r\n        slotid,\r\n        filtercondition,\r\n    ) {\r\n        // We do not need to resolve this Pending because the form submission will result in a page redirect.\r\n        new Pending('mod-quiz/modal_add_random_questions');\r\n        const call = {\r\n            methodname: 'mod_quiz_update_filter_condition',\r\n            args: {\r\n                cmid: quizcmid,\r\n                slotid,\r\n                filtercondition,\r\n            }\r\n        };\r\n        try {\r\n            const response = await fetchMany([call])[0];\r\n            const form = document.querySelector(SELECTORS.FORM_ELEMENT);\r\n            const messageInput = form.querySelector(SELECTORS.MESSAGE_INPUT);\r\n            messageInput.value = response.message;\r\n            form.submit();\r\n        } catch (e) {\r\n            Notification.exception(e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Override the modal show function to load the form when this modal is first\r\n     * shown.\r\n     *\r\n     * @method show\r\n     */\r\n    show() {\r\n        super.show(this);\r\n\r\n        if (!this.loadedForm) {\r\n            this.tabHtml = this.getBody();\r\n            this.loadForm(window.location.search);\r\n            this.loadedForm = true;\r\n        }\r\n    }\r\n}\r\n\r\nModalAddRandomQuestion.registerModalType();\r\n"],"names":["SELECTORS","ANCHOR","EXISTING_CATEGORY_CONTAINER","EXISTING_CATEGORY_TAB","NEW_CATEGORY_CONTAINER","NEW_CATEGORY_TAB","TAB_CONTENT","ADD_ON_PAGE_FORM_ELEMENT","ADD_RANDOM_BUTTON","ADD_NEW_CATEGORY_BUTTON","SUBMIT_BUTTON_ELEMENT","FORM_HEADER","SELECT_NUMBER_TO_ADD","NEW_CATEGORY_ELEMENT","PARENT_CATEGORY_ELEMENT","FILTER_CONDITION_ELEMENT","FORM_ELEMENT","MESSAGE_INPUT","SWITCH_TO_OTHER_BANK","NEW_BANKMOD_ID","BANK_SEARCH","GO_BACK_BUTTON","UPDATE_FILTER_BUTTON","ModalAddRandomQuestion","Modal","contextId","bankCmId","category","returnUrl","quizCmId","showNewCategory","document","addEventListener","e","trigger","target","closest","preventDefault","dataset","slotid","create","title","header","addOnPage","addonpage","slotId","templateContext","hidden","constructor","root","loadedForm","savedFilterCondition","configure","modalConfig","removeOnClose","setCategory","setReturnUrl","setSlotId","setSavedFilterCondition","setAddOnPageId","id","getBody","find","val","getCategory","this","url","getReturnUrl","getSlotId","filterCondition","getSavedFilterCondition","moveContentIntoTab","tabContent","tabElement","addClass","wrap","moveTabsIntoTabContent","form","empty","wrapAll","moveCancelButtonToTabs","cancelButton","CANCEL_BUTTON_ELEMENT","tabFooters","BUTTON_CONTAINER","remove","clone","appendTo","loadForm","getAddOnPageId","returnurl","quizcmid","bankcmid","savedfiltercondition","Fragment","loadFragment","getContextId","then","html","js","existingCategoryTabContent","existingCategoryTab","newCategoryTabContent","newCategoryTab","Templates","replaceNode","FormChangeChecker","disableAllChecks","querySelector","setAttribute","randomcount","value","filtercondition","_document$querySelect","addQuestions","_document$querySelect2","updateFilterCondition","getModal","on","_document$querySelect3","handleSwitchBankContentReload","ModalQuizQuestionBank","currentTarget","originalTitle","destroy","catch","Notification","exception","anchorElement","attr","length","newcategory","parentcategory","Pending","call","methodname","args","cmid","response","message","submit","show","tabHtml","window","location","search","registerModalType"],"mappings":"g5DAgCMA,UAAY,CACdC,OAAQ,UACRC,4BAA6B,8CAC7BC,sBAAuB,6BACvBC,uBAAwB,yCACxBC,iBAAkB,wBAClBC,YAAa,8BACbC,yBAA0B,qBAC1BC,kBAAmB,yCACnBC,wBAAyB,2CACzBC,sBAAuB,wHAGvBC,YAAa,SACbC,qBAAsB,mBACtBC,qBAAsB,gBACtBC,wBAAyB,kBACzBC,yBAA0B,yBAC1BC,aAAc,4BACdC,cAAe,mBACfC,qBAAsB,6CACtBC,eAAgB,gBAChBC,YAAa,eACbC,eAAgB,gCAChBC,qBAAsB,6CAGLC,+BAA+BC,wCAe5CC,UACAC,SACAC,SACAC,UACAC,cACAC,2EAGAC,SAASC,iBAAiB,SAAUC,UAC1BC,QAAUD,EAAEE,OAAOC,QAFZ,gFAGRF,UAGLD,EAAEI,iBAEEH,QAAQI,QAAQC,SAChBT,iBAAkB,GAGtBP,uBAAuBiB,OAAO,CAC1Bf,UAAAA,UACAC,SAAAA,SACAC,SAAAA,SACAC,UAAAA,UACAC,SAAAA,SACAC,gBAAAA,gBACAW,MAAOP,QAAQI,QAAQI,OACvBC,UAAWT,QAAQI,QAAQM,UAC3BC,OAAQX,QAAQI,QAAQC,OACxBO,gBAAiB,CACbC,OAAQjB,uBAWxBkB,YAAYC,YACFA,WACDtB,SAAW,UACXC,UAAY,UACZC,SAAW,UACXqB,YAAa,OACbL,OAAS,OACTM,qBAAuB,KAGhCC,UAAUC,2DACNA,YAAYC,eAAgB,OAEvBC,YAAYF,YAAY1B,eACxB6B,aAAaH,YAAYzB,gBACzBE,gBAAkBuB,YAAYvB,qBAC9B2B,sCAAUJ,YAAYR,0DAAU,QAChCa,sDAAwBL,YAAYF,4EAAwB,YAE3DC,UAAUC,aAUpBM,eAAeC,UACLD,eAAeC,SAChBC,UAAUC,KAAK9D,UAAUO,0BAA0BwD,IAAIH,IAUhEL,YAAY5B,eACHA,SAAWA,SASpBqC,qBACWC,KAAKtC,SAShB6B,aAAaU,UACJtC,UAAYsC,IASrBC,sBACWF,KAAKrC,UAQhB6B,UAAUZ,aACDA,OAASA,OAQlBuB,mBACWH,KAAKpB,OAQhBa,wBAAwBW,sBACflB,qBAAuBkB,gBAQhCC,iCACWL,KAAKd,qBAgBhBoB,mBAAmBC,WAAYC,YAG3BD,WAAWV,KAAK9D,UAAUW,aAAa+D,SAAS,UAEhDF,WAAWG,KAAKF,YAUpBG,uBAAuBC,YAEbL,WAAaP,KAAKJ,UAAUC,KAAK9D,UAAUM,aAAawE,QAE9DD,KAAKf,KAAK,qBAAqBiB,QAAQP,YAU3CQ,uBAAuBH,YACbI,aAAeJ,KAAKf,KAAK9D,UAAUkF,uBAAuBR,SAAS,QACnES,WAAaN,KAAKf,KAAK,0BAE7BmB,aAAa7C,QAAQpC,UAAUoF,kBAAkBC,SACjDJ,aAAaK,QAAQC,SAASJ,YAUlCK,iBACU5C,UAAYqB,KAAKwB,iBACjBC,UAAYzB,KAAKE,eACjBwB,SAAW1B,KAAKpC,SAChB+D,SAAW3B,KAAKvC,SAChBmE,qBAAuB5B,KAAKK,sCAC7BZ,wBAAwB,MAEtBoC,SAASC,aACZ,WACA,2BACA9B,KAAK+B,eACL,CACIpD,UAAWA,MAAAA,UAAAA,UAAa,KACxB8C,UAAAA,UACAC,SAAAA,SACAC,SAAAA,SACArD,OAAQ0B,KAAKG,YACbyB,qBAAAA,uBAGHI,MAAK,CAACC,KAAMC,YACHtB,MAAO,mBAAEqB,UACVjC,KAAKG,YAAa,OACbgC,2BAA6BvB,KAAKf,KAAK9D,UAAUG,uBACjDkG,oBAAsBpC,KAAKJ,UAAUC,KAAK9D,UAAUE,6BACpDoG,sBAAwBzB,KAAKf,KAAK9D,UAAUK,kBAC5CkG,eAAiBtC,KAAKJ,UAAUC,KAAK9D,UAAUI,6BAGhDmE,mBAAmB6B,2BAA4BC,0BAC/C9B,mBAAmB+B,sBAAuBC,qBAC1C3B,uBAAuBC,MAGhC2B,UAAUC,YAAYxC,KAAKJ,UAAUC,KAAK9D,UAAUM,aAAcuE,KAAMsB,OAG3EF,MAAK,KAGFS,kBAAkBC,wBAGb9C,UAAU,GAAG7B,iBAAiB,SAAUC,QAC1BA,EAAEE,OAAOC,QAAQpC,UAAUU,8BAI1CuB,EAAEI,iBAGFN,SAAS6E,cAAc,0CAA0CC,aAAa,OAAQ5C,KAAKpC,aAGnEI,EAAEE,OAAOC,QAAQpC,UAAUQ,mBAC9B,iCACXsG,YAAc/E,SAAS6E,cAAc5G,UAAUY,sBAAsBmG,MACrEC,8CAAkBjF,SAAS6E,cAAc5G,UAAUe,0BAA0BuB,gDAA3D2E,sBAAoED,iCAEvFE,aAAavB,SAAU/C,UAAWkE,YAAaE,gBAAiB,GAAI,OAIlD/E,EAAEE,OAAOC,QAAQpC,UAAUsB,sBAC9B,kCACd0F,+CAAkBjF,SAAS6E,cAAc5G,UAAUe,0BAA0BuB,iDAA3D6E,uBAAoEH,iCACvFI,sBAAsBzB,SAAU1B,KAAKG,YAAa4C,iBAIjC/E,EAAEE,OAAOC,QAAQpC,UAAUS,+BAE5CyG,aACDvB,SACA/C,UACA,EACA,GACAb,SAAS6E,cAAc5G,UAAUa,sBAAsBkG,MACvDhF,SAAS6E,cAAc5G,UAAUc,yBAAyBiG,eAMjEM,WAAWC,GAAG,QAAStH,UAAUkB,sBAAsB,qCACnDwC,uDACD3B,SAAS6E,cAAc5G,UAAUe,0BAA0BuB,iDAA3DiF,uBAAoEP,sBAEnEQ,8BAA8BxH,UAAUoB,aACxC6E,MAAK,SAASwB,oEACTzH,UAAUoB,+BAAckG,GAAG,UAAWrF,UAC9BP,UAAW,mBAAEO,EAAEyF,eAAe3D,MAEhCrC,SAAW,GACXH,uBAAuBiB,OAAO,WACbiF,sBAAsBzB,wBACvBtE,kBACA+F,sBAAsBzD,wBACrByD,sBAAsBtD,wBACvBsD,sBAAsB5F,eACzB4F,sBAAsBE,wBAClBF,sBAAsBhC,iCAChB,CAAC1C,OAAQ0E,sBAAsB3F,iCAC/B2F,sBAAsB3F,uBAC/B2F,sBAAsBrD,cAEnC6B,KAAKwB,sBAAsBG,WAC3BC,MAAMC,aAAaC,cAGrBN,iCAIdJ,WAAWC,GAAG,QAAStH,UAAUqB,gBAAiBY,UAC7C+F,eAAgB,mBAAE/F,EAAEyF,eAE1BnG,uBAAuBiB,OAAO,WACbyB,KAAK+B,wBACNgC,cAAcC,KAAK,kBACnBhE,KAAKD,wBACJC,KAAKE,wBACNF,KAAKpC,eACRoC,KAAK0D,wBACD1D,KAAKwB,iCACC,CAAC1C,OAAQkB,KAAKnC,iCACdmC,KAAKnC,qCACAmC,KAAKK,iCACnBL,KAAKG,cAChB6B,KAAKhC,KAAK2D,WAAWC,MAAMC,aAAaC,mBAG1CV,WAAWC,GAAG,QAAStH,UAAUC,QAASgC,UACrC+F,eAAgB,mBAAE/F,EAAEyF,eAEtBM,cAAc5F,QAAQ,KAAOpC,UAAUmB,eAAiB,KAAK+G,QAC7D3G,uBAAuBiB,OAAO,WACbyB,KAAK+B,wBACNgC,cAAcC,KAAKjI,UAAUmB,yBAC7B8C,KAAKD,wBACJC,KAAKE,wBACNF,KAAKpC,eACRoC,KAAK0D,wBACD1D,KAAKwB,iCACC,CAAC1C,OAAQkB,KAAKnC,iCACdmC,KAAKnC,uBACdmC,KAAKG,cAChB6B,KAAKhC,KAAK2D,WAAWC,MAAMC,aAAaC,iBAItDF,MAAMC,aAAaC,8BAcxBpC,SACA/C,UACAkE,YACAE,gBACAmB,YACAC,oBAGIC,iBAAQ,6CACNC,KAAO,CACTC,WAAY,gCACZC,KAAM,CACFC,KAAM9C,SACN/C,UAAAA,UACAkE,YAAAA,YACAE,gBAAAA,gBACAmB,YAAAA,YACAC,eAAAA,2BAIEM,eAAiB,cAAU,CAACJ,OAAO,GACnCzD,KAAO9C,SAAS6E,cAAc5G,UAAUgB,cACzB6D,KAAK+B,cAAc5G,UAAUiB,eACrC8F,MAAQ2B,SAASC,QAC9B9D,KAAK+D,SACP,MAAO3G,GACL6F,aAAaC,UAAU9F,gCAY3B0D,SACApD,OACAyE,qBAGIqB,iBAAQ,6CACNC,KAAO,CACTC,WAAY,mCACZC,KAAM,CACFC,KAAM9C,SACNpD,OAAAA,OACAyE,gBAAAA,4BAIE0B,eAAiB,cAAU,CAACJ,OAAO,GACnCzD,KAAO9C,SAAS6E,cAAc5G,UAAUgB,cACzB6D,KAAK+B,cAAc5G,UAAUiB,eACrC8F,MAAQ2B,SAASC,QAC9B9D,KAAK+D,SACP,MAAO3G,GACL6F,aAAaC,UAAU9F,IAU/B4G,aACUA,KAAK5E,MAENA,KAAKf,kBACD4F,QAAU7E,KAAKJ,eACf2B,SAASuD,OAAOC,SAASC,aACzB/F,YAAa,mEAldT3B,8BACH,qDADGA,kCAEC,sCAqdtBA,uBAAuB2H"}