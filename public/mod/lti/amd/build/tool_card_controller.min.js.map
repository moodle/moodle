{"version":3,"file":"tool_card_controller.min.js","sources":["../src/tool_card_controller.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Controls all of the behaviour and interaction with a tool type card. These are\r\n * listed on the LTI tool type management page.\r\n *\r\n * See template: mod_lti/tool_card\r\n *\r\n * @module     mod_lti/tool_card_controller\r\n * @copyright  2015 Ryan Wyllie <ryan@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @since      3.1\r\n */\r\n define(['jquery', 'core/ajax', 'core/notification', 'core/templates', 'core/modal',\r\n        'mod_lti/tool_type', 'mod_lti/events', 'mod_lti/keys',\r\n        'core/str'],\r\n        function($, ajax, notification, templates, Modal, toolType, ltiEvents, KEYS, str) {\r\n\r\n    var SELECTORS = {\r\n        DELETE_BUTTON: '.delete',\r\n        NAME_ELEMENT: '.name',\r\n        DESCRIPTION_ELEMENT: '.description',\r\n        CAPABILITIES_CONTAINER: '.capabilities-container',\r\n        ACTIVATE_BUTTON: '.tool-card-footer a.activate',\r\n    };\r\n\r\n    // Timeout in seconds.\r\n    var ANNOUNCEMENT_TIMEOUT = 2000;\r\n\r\n    /**\r\n     * Return the delete button element.\r\n     *\r\n     * @method getDeleteButton\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     * @return {JQuery} jQuery object\r\n     */\r\n    var getDeleteButton = function(element) {\r\n        return element.find(SELECTORS.DELETE_BUTTON);\r\n    };\r\n\r\n    /**\r\n     * Return the element representing the tool type name.\r\n     *\r\n     * @method getNameElement\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     * @return {JQuery} jQuery object\r\n     */\r\n    var getNameElement = function(element) {\r\n        return element.find(SELECTORS.NAME_ELEMENT);\r\n    };\r\n\r\n    /**\r\n     * Return the element representing the tool type description.\r\n     *\r\n     * @method getDescriptionElement\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     * @return {JQuery} jQuery object\r\n     */\r\n    var getDescriptionElement = function(element) {\r\n        return element.find(SELECTORS.DESCRIPTION_ELEMENT);\r\n    };\r\n\r\n    /**\r\n     * Return the activate button for the type.\r\n     *\r\n     * @method getActivateButton\r\n     * @private\r\n     * @param {Object} element jQuery object representing the tool card.\r\n     * @return {Object} jQuery object\r\n     */\r\n    var getActivateButton = function(element) {\r\n        return element.find(SELECTORS.ACTIVATE_BUTTON);\r\n    };\r\n\r\n    /**\r\n     * Checks if the type card has an activate button.\r\n     *\r\n     * @method hasActivateButton\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     * @return {Boolean} true if has active buton\r\n     */\r\n    var hasActivateButton = function(element) {\r\n        return getActivateButton(element).length ? true : false;\r\n    };\r\n\r\n    /**\r\n     * Return the element that contains the capabilities approval for\r\n     * the user.\r\n     *\r\n     * @method getCapabilitiesContainer\r\n     * @private\r\n     * @param {Object} element jQuery object representing the tool card.\r\n     * @return {Object} The element\r\n     */\r\n    var getCapabilitiesContainer = function(element) {\r\n        return element.find(SELECTORS.CAPABILITIES_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Checks if the tool type has capabilities that need approval. If it\r\n     * does then the container will be present.\r\n     *\r\n     * @method hasCapabilitiesContainer\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     * @return {Boolean} true if has capbilities.\r\n     */\r\n    var hasCapabilitiesContainer = function(element) {\r\n        return getCapabilitiesContainer(element).length ? true : false;\r\n    };\r\n\r\n    /**\r\n     * Get the type id.\r\n     *\r\n     * @method getTypeId\r\n     * @private\r\n     * @param {Object} element jQuery object representing the tool card.\r\n     * @return {String} Type ID\r\n     */\r\n    var getTypeId = function(element) {\r\n        return element.attr('data-type-id');\r\n    };\r\n\r\n    /**\r\n     * Stop any announcement currently visible on the card.\r\n     *\r\n     * @method clearAllAnnouncements\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     */\r\n    var clearAllAnnouncements = function(element) {\r\n        element.removeClass('announcement loading success fail capabilities');\r\n    };\r\n\r\n    /**\r\n     * Show the loading announcement.\r\n     *\r\n     * @method startLoading\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     */\r\n    var startLoading = function(element) {\r\n        clearAllAnnouncements(element);\r\n        element.addClass('announcement loading');\r\n    };\r\n\r\n    /**\r\n     * Hide the loading announcement.\r\n     *\r\n     * @method stopLoading\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     */\r\n    var stopLoading = function(element) {\r\n        element.removeClass('announcement loading');\r\n    };\r\n\r\n    /**\r\n     * Show the success announcement. The announcement is only\r\n     * visible for 2 seconds.\r\n     *\r\n     * @method announceSuccess\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     * @return {Promise} jQuery Deferred object\r\n     */\r\n    var announceSuccess = function(element) {\r\n        var promise = $.Deferred();\r\n\r\n        clearAllAnnouncements(element);\r\n        element.addClass('announcement success');\r\n        setTimeout(function() {\r\n            element.removeClass('announcement success');\r\n            promise.resolve();\r\n        }, ANNOUNCEMENT_TIMEOUT);\r\n\r\n        return promise;\r\n    };\r\n\r\n    /**\r\n     * Show the failure announcement. The announcement is only\r\n     * visible for 2 seconds.\r\n     *\r\n     * @method announceFailure\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     * @return {Promise} jQuery Deferred object\r\n     */\r\n    var announceFailure = function(element) {\r\n        var promise = $.Deferred();\r\n\r\n        clearAllAnnouncements(element);\r\n        element.addClass('announcement fail');\r\n        setTimeout(function() {\r\n            element.removeClass('announcement fail');\r\n            promise.resolve();\r\n        }, ANNOUNCEMENT_TIMEOUT);\r\n\r\n        return promise;\r\n    };\r\n\r\n    /**\r\n     * Delete the tool type from the Moodle server. Triggers a success\r\n     * or failure announcement depending on the result.\r\n     *\r\n     * @method deleteType\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     * @return {Promise} jQuery Deferred object\r\n     */\r\n    var deleteType = function(element) {\r\n        var promise = $.Deferred();\r\n        var typeId = getTypeId(element);\r\n        startLoading(element);\r\n\r\n        if (typeId === \"\") {\r\n            return $.Deferred().resolve();\r\n        }\r\n\r\n        str.get_strings([\r\n                {\r\n                    key: 'delete',\r\n                    component: 'mod_lti'\r\n                },\r\n                {\r\n                    key: 'delete_confirmation',\r\n                    component: 'mod_lti'\r\n                },\r\n                {\r\n                    key: 'delete',\r\n                    component: 'mod_lti'\r\n                },\r\n                {\r\n                    key: 'cancel',\r\n                    component: 'core'\r\n                },\r\n            ])\r\n            .done(function(strs) {\r\n                    notification.confirm(strs[0], strs[1], strs[2], strs[3], function() {\r\n                            toolType.delete(typeId)\r\n                                .done(function() {\r\n                                        stopLoading(element);\r\n                                        announceSuccess(element)\r\n                                            .done(function() {\r\n                                                    element.remove();\r\n                                                })\r\n                                            .fail(notification.exception)\r\n                                            .always(function() {\r\n                                                    // Always resolve because even if the announcement fails the type was deleted.\r\n                                                    promise.resolve();\r\n                                                });\r\n                                    })\r\n                                .fail(function(error) {\r\n                                        announceFailure(element);\r\n                                        promise.reject(error);\r\n                                    });\r\n                        }, function() {\r\n                                stopLoading(element);\r\n                                promise.resolve();\r\n                            });\r\n                })\r\n            .fail(function(error) {\r\n                    stopLoading(element);\r\n                    notification.exception(error);\r\n                    promise.reject(error);\r\n                });\r\n\r\n        return promise;\r\n    };\r\n\r\n    /**\r\n     * Save a given value in a data attribute on the element.\r\n     *\r\n     * @method setValueSnapshot\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the element.\r\n     * @param {String} value to be saved.\r\n     */\r\n    var setValueSnapshot = function(element, value) {\r\n        element.attr('data-val-snapshot', value);\r\n    };\r\n\r\n    /**\r\n     * Return the saved value from the element.\r\n     *\r\n     * @method getValueSnapshot\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the element.\r\n     * @return {String} the saved value.\r\n     */\r\n    var getValueSnapshot = function(element) {\r\n        return element.attr('data-val-snapshot');\r\n    };\r\n\r\n    /**\r\n     * Save the current value of the tool description.\r\n     *\r\n     * @method snapshotDescription\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     */\r\n    var snapshotDescription = function(element) {\r\n        var descriptionElement = getDescriptionElement(element);\r\n\r\n        if (descriptionElement.hasClass('loading')) {\r\n            return;\r\n        }\r\n\r\n        var description = descriptionElement.text().trim();\r\n        setValueSnapshot(descriptionElement, description);\r\n    };\r\n\r\n    /**\r\n     * Send a request to update the description value for this tool\r\n     * in the Moodle server.\r\n     *\r\n     * @method updateDescription\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     * @return {Promise} jQuery Deferred object\r\n     */\r\n    var updateDescription = function(element) {\r\n        var typeId = getTypeId(element);\r\n\r\n        // Return early if we don't have an id because it's\r\n        // required to save the changes.\r\n        if (typeId === \"\") {\r\n            return $.Deferred().resolve();\r\n        }\r\n\r\n        var descriptionElement = getDescriptionElement(element);\r\n\r\n        // Return early if we're already saving a value.\r\n        if (descriptionElement.hasClass('loading')) {\r\n            return $.Deferred().resolve();\r\n        }\r\n\r\n        var description = descriptionElement.text().trim();\r\n        var snapshotVal = getValueSnapshot(descriptionElement);\r\n\r\n        // If the value hasn't change then don't bother sending the\r\n        // update request.\r\n        if (snapshotVal == description) {\r\n            return $.Deferred().resolve();\r\n        }\r\n\r\n        descriptionElement.addClass('loading');\r\n\r\n        var promise = toolType.update({id: typeId, description: description});\r\n\r\n        promise.done(function(type) {\r\n            descriptionElement.removeClass('loading');\r\n            // Make sure the text is updated with the description from the\r\n            // server, just in case the update didn't work.\r\n            descriptionElement.text(type.description);\r\n        }).fail(notification.exception);\r\n\r\n        // Probably need to handle failures better so that we can revert\r\n        // the value in the input for the user.\r\n        promise.fail(function() {\r\n          descriptionElement.removeClass('loading');\r\n        });\r\n\r\n        return promise;\r\n    };\r\n\r\n    /**\r\n     * Save the current value of the tool name.\r\n     *\r\n     * @method snapshotName\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     */\r\n    var snapshotName = function(element) {\r\n        var nameElement = getNameElement(element);\r\n\r\n        if (nameElement.hasClass('loading')) {\r\n            return;\r\n        }\r\n\r\n        var name = nameElement.text().trim();\r\n        setValueSnapshot(nameElement, name);\r\n    };\r\n\r\n    /**\r\n     * Send a request to update the name value for this tool\r\n     * in the Moodle server.\r\n     *\r\n     * @method updateName\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     * @return {Promise} jQuery Deferred object\r\n     */\r\n    var updateName = function(element) {\r\n        var typeId = getTypeId(element);\r\n\r\n        // Return if we don't have an id.\r\n        if (typeId === \"\") {\r\n            return $.Deferred().resolve();\r\n        }\r\n\r\n        var nameElement = getNameElement(element);\r\n\r\n        // Return if we're already saving.\r\n        if (nameElement.hasClass('loading')) {\r\n            return $.Deferred().resolve();\r\n        }\r\n\r\n        var name = nameElement.text().trim();\r\n        var snapshotVal = getValueSnapshot(nameElement);\r\n\r\n        // If the value hasn't change then don't bother sending the\r\n        // update request.\r\n        if (snapshotVal == name) {\r\n            return $.Deferred().resolve();\r\n        }\r\n\r\n        nameElement.addClass('loading');\r\n        var promise = toolType.update({id: typeId, name: name});\r\n\r\n        promise.done(function(type) {\r\n            nameElement.removeClass('loading');\r\n            // Make sure the text is updated with the name from the\r\n            // server, just in case the update didn't work.\r\n            nameElement.text(type.name);\r\n        });\r\n\r\n        // Probably need to handle failures better so that we can revert\r\n        // the value in the input for the user.\r\n        promise.fail(function() {\r\n          nameElement.removeClass('loading');\r\n        });\r\n\r\n        return promise;\r\n    };\r\n\r\n    /**\r\n     * Send a request to update the state for this tool to be configured (active)\r\n     * in the Moodle server. A success or failure announcement is triggered depending\r\n     * on the result.\r\n     *\r\n     * @method setStatusActive\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     * @return {Promise} jQuery Deferred object\r\n     */\r\n    var setStatusActive = function(element) {\r\n        var id = getTypeId(element);\r\n\r\n        // Return if we don't have an id.\r\n        if (id === \"\") {\r\n            return $.Deferred().resolve();\r\n        }\r\n\r\n        startLoading(element);\r\n\r\n        var promise = toolType.update({\r\n            id: id,\r\n            state: toolType.constants.state.configured\r\n        });\r\n\r\n        promise.then(function(toolTypeData) {\r\n            stopLoading(element);\r\n            announceSuccess(element);\r\n            return toolTypeData;\r\n        }).then(function(toolTypeData) {\r\n            return templates.render('mod_lti/tool_card', toolTypeData);\r\n        }).then(function(html, js) {\r\n            templates.replaceNode(element, html, js);\r\n            return;\r\n        }).catch(function() {\r\n            stopLoading(element);\r\n            announceFailure(element);\r\n        });\r\n\r\n        return promise;\r\n    };\r\n\r\n    /**\r\n     * Show the capabilities approval screen to show which groups of data this\r\n     * type requires access to in Moodle (if any).\r\n     *\r\n     * @method displayCapabilitiesApproval\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     */\r\n    var displayCapabilitiesApproval = function(element) {\r\n        element.addClass('announcement capabilities');\r\n    };\r\n\r\n    /**\r\n     * Hide the capabilities approval screen.\r\n     *\r\n     * @method hideCapabilitiesApproval\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     */\r\n    var hideCapabilitiesApproval = function(element) {\r\n        element.removeClass('announcement capabilities');\r\n    };\r\n\r\n    /**\r\n     * The user wishes to activate this tool so show them the capabilities that\r\n     * they need to agree to or if there are none then set the tool type's state\r\n     * to active.\r\n     *\r\n     * @method activateToolType\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     */\r\n    var activateToolType = function(element) {\r\n        if (hasCapabilitiesContainer(element)) {\r\n            displayCapabilitiesApproval(element);\r\n        } else {\r\n            setStatusActive(element);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Sets up the listeners for user interaction on this tool type card.\r\n     *\r\n     * @method registerEventListeners\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     */\r\n    var registerEventListeners = function(element) {\r\n        var deleteButton = getDeleteButton(element);\r\n        deleteButton.click(function(e) {\r\n            e.preventDefault();\r\n            deleteType(element);\r\n        });\r\n        deleteButton.keypress(function(e) {\r\n            if (!e.metaKey && !e.shiftKey && !e.altKey && !e.ctrlKey) {\r\n                if (e.keyCode == KEYS.ENTER || e.keyCode == KEYS.SPACE) {\r\n                    e.preventDefault();\r\n                    deleteButton.click();\r\n                }\r\n            }\r\n        });\r\n\r\n        var descriptionElement = getDescriptionElement(element);\r\n        descriptionElement.focus(function(e) {\r\n            e.preventDefault();\r\n            // Save a copy of the current value for the description so that\r\n            // we can check if the user has changed it before sending a request to\r\n            // the server.\r\n            snapshotDescription(element);\r\n        });\r\n        descriptionElement.blur(function(e) {\r\n            e.preventDefault();\r\n            updateDescription(element);\r\n        });\r\n        descriptionElement.keypress(function(e) {\r\n            if (!e.metaKey && !e.shiftKey && !e.altKey && !e.ctrlKey) {\r\n                if (e.keyCode == KEYS.ENTER) {\r\n                    e.preventDefault();\r\n                    descriptionElement.blur();\r\n                }\r\n            }\r\n        });\r\n\r\n        var nameElement = getNameElement(element);\r\n        nameElement.focus(function(e) {\r\n            e.preventDefault();\r\n            // Save a copy of the current value for the name so that\r\n            // we can check if the user has changed it before sending a request to\r\n            // the server.\r\n            snapshotName(element);\r\n        });\r\n        nameElement.blur(function(e) {\r\n            e.preventDefault();\r\n            updateName(element);\r\n        });\r\n        nameElement.keypress(function(e) {\r\n            if (!e.metaKey && !e.shiftKey && !e.altKey && !e.ctrlKey) {\r\n                if (e.keyCode == KEYS.ENTER) {\r\n                    e.preventDefault();\r\n                    nameElement.blur();\r\n                }\r\n            }\r\n        });\r\n\r\n        // Only pending tool type cards have an activate button.\r\n        if (hasActivateButton(element)) {\r\n            var activateButton = getActivateButton(element);\r\n            activateButton.click(function(e) {\r\n                e.preventDefault();\r\n                activateToolType(element);\r\n            });\r\n            activateButton.keypress(function(e) {\r\n                if (!e.metaKey && !e.shiftKey && !e.altKey && !e.ctrlKey) {\r\n                    if (e.keyCode == KEYS.ENTER || e.keyCode == KEYS.SPACE) {\r\n                        e.preventDefault();\r\n                        activateButton.click();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (hasCapabilitiesContainer(element)) {\r\n            var capabilitiesContainer = getCapabilitiesContainer(element);\r\n\r\n            capabilitiesContainer.on(ltiEvents.CAPABILITIES_AGREE, function() {\r\n                setStatusActive(element);\r\n            });\r\n\r\n            capabilitiesContainer.on(ltiEvents.CAPABILITIES_DECLINE, function() {\r\n                hideCapabilitiesApproval(element);\r\n            });\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Sets up the templates for the tool configuration modal on this tool type card.\r\n     *\r\n     * @method registerModal\r\n     * @private\r\n     * @param {JQuery} element jQuery object representing the tool card.\r\n     */\r\n    var registerModal = function(element) {\r\n        const configurationLink = element.find('#' + element.data('uniqid') + '-' + element.data('deploymentid'));\r\n        if (!configurationLink.length) {\r\n            return;\r\n        }\r\n        const trigger = configurationLink.get(0);\r\n        trigger.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            var context = {\r\n                'uniqid': element.data('uniqid'),\r\n                'platformid': element.data('platformid'),\r\n                'clientid': element.data('clientid'),\r\n                'deploymentid': element.data('deploymentid'),\r\n                'urls': {\r\n                    'publickeyset': element.data('publickeyseturl'),\r\n                    'accesstoken': element.data('accesstokenurl'),\r\n                    'authrequest': element.data('authrequesturl')\r\n                }\r\n            };\r\n            var bodyPromise = templates.render('mod_lti/tool_config_modal_body', context);\r\n            var mailTo = 'mailto:?subject=' + encodeURIComponent(element.data('mailtosubject')) +\r\n                '&body=' + encodeURIComponent(element.data('platformidstr')) + ':%20' +\r\n                encodeURIComponent(element.data('platformid')) + '%0D%0A' +\r\n                encodeURIComponent(element.data('clientidstr')) + ':%20' +\r\n                encodeURIComponent(element.data('clientid')) + '%0D%0A' +\r\n                encodeURIComponent(element.data('deploymentidstr')) + ':%20' +\r\n                encodeURIComponent(element.data('deploymentid')) + '%0D%0A' +\r\n                encodeURIComponent(element.data('publickeyseturlstr')) + ':%20' +\r\n                encodeURIComponent(element.data('publickeyseturl')) + '%0D%0A' +\r\n                encodeURIComponent(element.data('accesstokenurlstr')) + ':%20' +\r\n                encodeURIComponent(element.data('accesstokenurl')) + '%0D%0A' +\r\n                encodeURIComponent(element.data('authrequesturlstr')) + ':%20' +\r\n                encodeURIComponent(element.data('authrequesturl')) + '%0D%0A';\r\n            context = {\r\n                'mailto': mailTo\r\n            };\r\n            var footerPromise = templates.render('mod_lti/tool_config_modal_footer', context);\r\n            Modal.create({\r\n                large: true,\r\n                title: element.data('modaltitle'),\r\n                body: bodyPromise,\r\n                footer: footerPromise,\r\n                show: true\r\n            });\r\n        });\r\n    };\r\n\r\n    return /** @alias module:mod_lti/tool_card_controller */ {\r\n\r\n        /**\r\n         * Initialise this module.\r\n         *\r\n         * @param {JQuery} element jQuery object representing the tool card.\r\n         */\r\n        init: function(element) {\r\n            registerEventListeners(element);\r\n            registerModal(element);\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","ajax","notification","templates","Modal","toolType","ltiEvents","KEYS","str","SELECTORS","getNameElement","element","find","getDescriptionElement","getActivateButton","getCapabilitiesContainer","hasCapabilitiesContainer","length","getTypeId","attr","clearAllAnnouncements","removeClass","startLoading","addClass","stopLoading","announceSuccess","promise","Deferred","setTimeout","resolve","announceFailure","setValueSnapshot","value","getValueSnapshot","setStatusActive","id","update","state","constants","configured","then","toolTypeData","render","html","js","replaceNode","catch","registerEventListeners","deleteButton","getDeleteButton","click","e","preventDefault","typeId","get_strings","key","component","done","strs","confirm","delete","remove","fail","exception","always","error","reject","deleteType","keypress","metaKey","shiftKey","altKey","ctrlKey","keyCode","ENTER","SPACE","descriptionElement","focus","hasClass","description","text","trim","snapshotDescription","blur","type","updateDescription","nameElement","name","snapshotName","updateName","hasActivateButton","activateButton","displayCapabilitiesApproval","activateToolType","capabilitiesContainer","on","CAPABILITIES_AGREE","CAPABILITIES_DECLINE","hideCapabilitiesApproval","init","configurationLink","data","get","addEventListener","context","bodyPromise","encodeURIComponent","footerPromise","create","large","title","body","footer","show","registerModal"],"mappings":"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"}