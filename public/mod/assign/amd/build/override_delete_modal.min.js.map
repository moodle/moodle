{"version":3,"file":"override_delete_modal.min.js","sources":["../src/override_delete_modal.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Modal for deleting an override with the option to recalculate penalties.\r\n *\r\n * @module     `mod_assign/override_delete_modal\r\n * @copyright  2025 Catalyst IT Australia Pty Ltd\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport * as CustomEvents from 'core/custom_interaction_events';\r\nimport Config from 'core/config';\r\nimport Modal from 'core/modal';\r\n\r\nconst SELECTORS = {\r\n    DELETE_BUTTONS: '.delete-override',\r\n    RECACULATION_CHECKBOX: '#recalculatepenalties',\r\n};\r\n\r\n/**\r\n * Custom Modal\r\n */\r\nexport default class OverrideDeleteModal extends Modal {\r\n    static TYPE = \"mod_assign/override_delete_modal\";\r\n    static TEMPLATE = \"mod_assign/override_delete_modal\";\r\n\r\n    /**\r\n     * Configure the modal.\r\n     *\r\n     * @param {Object} modalConfig\r\n     */\r\n    configure(modalConfig) {\r\n        // Add question modals are always large.\r\n        modalConfig.large = true;\r\n\r\n        // Always show on creation.\r\n        modalConfig.show = true;\r\n        modalConfig.removeOnClose = true;\r\n\r\n        // Apply standard configuration.\r\n        super.configure(modalConfig);\r\n\r\n        this.setOverrideId(modalConfig.overrideId);\r\n        this.setSessionKey(modalConfig.sessionKey);\r\n    }\r\n\r\n    /**\r\n     * Constructor.\r\n     * Set required data to null.\r\n     *\r\n     * @param {HTMLElement} root\r\n     */\r\n    constructor(root) {\r\n        super(root);\r\n\r\n        // Recalculate penalties checkbox.\r\n        this.recalculationCheckbox = this.getModal().find(SELECTORS.RECACULATION_CHECKBOX);\r\n\r\n        // Data.\r\n        this.setOverrideId(null);\r\n        this.setSessionKey(null);\r\n    }\r\n\r\n    /**\r\n     * Set the override id.\r\n     *\r\n     * @param {number} id The override id.\r\n     */\r\n    setOverrideId(id) {\r\n        this.overrideId = id;\r\n    }\r\n\r\n    /**\r\n     * Get the override id.\r\n     *\r\n     * @returns {*}\r\n     */\r\n    getOverrideId() {\r\n        return this.overrideId;\r\n    }\r\n\r\n    /**\r\n     * Set the session key.\r\n     *\r\n     * @param {string} key\r\n     */\r\n    setSessionKey(key) {\r\n        this.sessionKey = key;\r\n    }\r\n\r\n    /**\r\n     * Get the session key.\r\n     *\r\n     * @returns {*}\r\n     */\r\n    getSessionKey() {\r\n        return this.sessionKey;\r\n    }\r\n\r\n    /**\r\n     * Register events.\r\n     *\r\n     */\r\n    registerEventListeners() {\r\n        // Apply parent event listeners.\r\n        super.registerEventListeners(this);\r\n\r\n        // Register to close on cancel.\r\n        this.registerCloseOnCancel();\r\n\r\n        // Register the delete action.\r\n        this.getModal().on(CustomEvents.events.activate, this.getActionSelector('delete'), () => {\r\n            this.deleteOverride();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Delete a override.\r\n     *\r\n     */\r\n    deleteOverride() {\r\n        // Check if the recalculation checkbox is checked.\r\n        const recalculate = this.recalculationCheckbox.prop('checked');\r\n\r\n        // Redirect to the delete URL.\r\n        const targetUrl = new URL(`${Config.wwwroot}/mod/assign/overridedelete.php`);\r\n        targetUrl.searchParams.append('id', this.getOverrideId());\r\n        targetUrl.searchParams.append('sesskey', this.getSessionKey());\r\n        targetUrl.searchParams.append('confirm', 1);\r\n\r\n        if (recalculate) {\r\n            targetUrl.searchParams.append('recalculate', 1);\r\n        }\r\n\r\n        window.location.href = targetUrl.href;\r\n    }\r\n}\r\n"],"names":["SELECTORS","OverrideDeleteModal","Modal","configure","modalConfig","large","show","removeOnClose","setOverrideId","overrideId","setSessionKey","sessionKey","constructor","root","recalculationCheckbox","this","getModal","find","id","getOverrideId","key","getSessionKey","registerEventListeners","registerCloseOnCancel","on","CustomEvents","events","activate","getActionSelector","deleteOverride","recalculate","prop","targetUrl","URL","Config","wwwroot","searchParams","append","window","location","href"],"mappings":"u/CA2BMA,gCAEqB,8BAMNC,4BAA4BC,eAS7CC,UAAUC,aAENA,YAAYC,OAAQ,EAGpBD,YAAYE,MAAO,EACnBF,YAAYG,eAAgB,QAGtBJ,UAAUC,kBAEXI,cAAcJ,YAAYK,iBAC1BC,cAAcN,YAAYO,YASnCC,YAAYC,YACFA,WAGDC,sBAAwBC,KAAKC,WAAWC,KAAKjB,sCAG7CQ,cAAc,WACdE,cAAc,MAQvBF,cAAcU,SACLT,WAAaS,GAQtBC,uBACWJ,KAAKN,WAQhBC,cAAcU,UACLT,WAAaS,IAQtBC,uBACWN,KAAKJ,WAOhBW,+BAEUA,uBAAuBP,WAGxBQ,6BAGAP,WAAWQ,GAAGC,aAAaC,OAAOC,SAAUZ,KAAKa,kBAAkB,WAAW,UAC1EC,oBAQbA,uBAEUC,YAAcf,KAAKD,sBAAsBiB,KAAK,WAG9CC,UAAY,IAAIC,cAAOC,gBAAOC,2CACpCH,UAAUI,aAAaC,OAAO,KAAMtB,KAAKI,iBACzCa,UAAUI,aAAaC,OAAO,UAAWtB,KAAKM,iBAC9CW,UAAUI,aAAaC,OAAO,UAAW,GAErCP,aACAE,UAAUI,aAAaC,OAAO,cAAe,GAGjDC,OAAOC,SAASC,KAAOR,UAAUQ,kEAhHpBvC,2BACH,oDADGA,+BAEC"}