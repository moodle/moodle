{"version":3,"file":"bulk_actions.min.js","sources":["../../../src/bulkactions/grading/bulk_actions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Class for defining the bulk actions area in the assignment grading page.\r\n *\r\n * @module     mod_assign/bulkactions/grading/bulk_actions\r\n * @copyright  2024 Shamim Rezaie <shamim@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport BulkActions from 'core/bulkactions/bulk_actions';\r\nimport GeneralAction from './general_action';\r\nimport DeleteAction from './delete';\r\nimport ExtendAction from './extend';\r\nimport MessageAction from './message';\r\nimport SetMarkingAllocationAction from './setmarkingallocation';\r\nimport SetMarkingWorkflowStateAction from './setmarkingworkflowstate';\r\nimport Templates from 'core/templates';\r\nimport {getString} from 'core/str';\r\n\r\nconst Selectors = {\r\n    selectBulkItemCheckbox: 'input[type=\"checkbox\"][name=\"selectedusers\"]',\r\n    selectBulkItemTrigger: 'input[type=\"checkbox\"][name=\"selectedusers\"], input[type=\"checkbox\"][name=\"selectall\"]',\r\n};\r\n\r\nexport default class extends BulkActions {\r\n    /** @type {number} The course module ID. */\r\n    #cmid;\r\n\r\n    /** @type {boolean} Whether to show the extend action. */\r\n    #extend;\r\n\r\n    /** @type {boolean} Whether to show the grant extension action. */\r\n    #grantAttempt;\r\n\r\n    /** @type {boolean} Whether to show the set marking allocation action. */\r\n    #markingAllocation;\r\n\r\n    /** @type {string} Whether to show the message action. */\r\n    #message;\r\n\r\n    /** @type {Array} The list of plugin operations. */\r\n    #pluginOperations;\r\n\r\n    /** @type {boolean} Whether to show the remove submission action. */\r\n    #removeSubmission;\r\n\r\n    /** @type {string} The session key. */\r\n    #sesskey;\r\n\r\n    /** @type {boolean} Whether to show the revert to draft action. */\r\n    #submissionDrafts;\r\n\r\n    /** @type {boolean} Whether to show the set workflow state action. */\r\n    #workflowState;\r\n\r\n    /** @type {boolean} Whether this assignment supports submissions. */\r\n    #supportsSubmissions;\r\n\r\n    /** @type {boolean} Whether this assignment has submissions. */\r\n    #hasSubmissions;\r\n\r\n    /**\r\n     * Returns the instance of the class.\r\n     *\r\n     * @param {Object} options - The options object.\r\n     * @param {number} options.cmid - The course module ID.\r\n     * @param {string} options.message - Whether to show the message action.\r\n     * @param {boolean} options.submissiondrafts - Whether to show the revert to draft action.\r\n     * @param {boolean} options.removesubmission - Whether to show the remove submission action.\r\n     * @param {boolean} options.extend - Whether to show the grant extension action.\r\n     * @param {boolean} options.grantattempt - Whether to show the grant attempt action.\r\n     * @param {boolean} options.workflowstate - Whether to show the set workflow state action.\r\n     * @param {boolean} options.markingallocation - Whether to show the set marking allocation action.\r\n     * @param {Array} options.pluginoperations - The list of plugin operations.\r\n     * @param {string} options.sesskey - The session key.\r\n     * @param {boolean} options.supportssubmissions - Whether this assignment supports submissions.\r\n     * @param {boolean} options.hassubmissions - Whether this assignment has submissions.\r\n     * @returns {this} An instance of the anonymous class extending BulkActions.\r\n     */\r\n    static init(options) {\r\n        return new this(options);\r\n    }\r\n\r\n    /**\r\n     * The class constructor\r\n     *\r\n     * @param {Object} options - The options object.\r\n     * @param {number} options.cmid - The course module ID.\r\n     * @param {string} options.message - Whether to show the message action.\r\n     * @param {boolean} options.submissiondrafts - Whether to show the revert to draft action.\r\n     * @param {boolean} options.removesubmission - Whether to show the remove submission action.\r\n     * @param {boolean} options.extend - Whether to show the grant extension action.\r\n     * @param {boolean} options.grantattempt - Whether to show the grant attempt action.\r\n     * @param {boolean} options.workflowstate - Whether to show the set workflow state action.\r\n     * @param {boolean} options.markingallocation - Whether to show the set marking allocation action.\r\n     * @param {Array} options.pluginoperations - The list of plugin operations.\r\n     * @param {string} options.sesskey - The session key.\r\n     * @param {boolean} options.hassubmissions - Whether this assignment has any submissions.\r\n     * @param {boolean} options.supportssubmissions - Whether this assignment allows submissions.\r\n     */\r\n    constructor({\r\n        cmid, message, submissiondrafts, removesubmission, extend,\r\n        grantattempt, workflowstate, markingallocation, pluginoperations, sesskey,\r\n        hassubmissions, supportssubmissions\r\n    }) {\r\n        super();\r\n        this.#cmid = cmid;\r\n        this.#message = message;\r\n        this.#submissionDrafts = submissiondrafts;\r\n        this.#removeSubmission = removesubmission;\r\n        this.#extend = extend;\r\n        this.#grantAttempt = grantattempt;\r\n        this.#workflowState = workflowstate;\r\n        this.#markingAllocation = markingallocation;\r\n        this.#sesskey = sesskey;\r\n        this.#pluginOperations = pluginoperations;\r\n        this.#hasSubmissions = hassubmissions;\r\n        this.#supportsSubmissions = supportssubmissions;\r\n    }\r\n\r\n    getBulkActions() {\r\n        const actions = [];\r\n        if (this.#supportsSubmissions) {\r\n            actions.push(\r\n                new GeneralAction(\r\n                    this.#cmid,\r\n                    this.#sesskey,\r\n                    'lock',\r\n                    getString('batchoperationlock', 'mod_assign'),\r\n                    Templates.renderPix('i/lock', 'core'),\r\n                    getString('locksubmissions', 'mod_assign'),\r\n                    getString('batchoperationconfirmlock', 'mod_assign'),\r\n                    getString('batchoperationlock', 'mod_assign'),\r\n                ),\r\n                new GeneralAction(\r\n                    this.#cmid,\r\n                    this.#sesskey,\r\n                    'unlock',\r\n                    getString('batchoperationunlock', 'mod_assign'),\r\n                    Templates.renderPix('i/unlock', 'core'),\r\n                    getString('unlocksubmissions', 'mod_assign'),\r\n                    getString('batchoperationconfirmunlock', 'mod_assign'),\r\n                    getString('batchoperationunlock', 'mod_assign'),\r\n                ),\r\n            );\r\n        }\r\n        if (this.#supportsSubmissions && this.#hasSubmissions) {\r\n            actions.push(\r\n                new GeneralAction(\r\n                    this.#cmid,\r\n                    this.#sesskey,\r\n                    'downloadselected',\r\n                    getString('batchoperationdownloadselected', 'mod_assign'),\r\n                    Templates.renderPix('t/download', 'core'),\r\n                    getString('downloadselectedsubmissions', 'mod_assign'),\r\n                    getString('batchoperationconfirmdownloadselected', 'mod_assign'),\r\n                    getString('batchoperationdownloadselected', 'mod_assign'),\r\n                ),\r\n            );\r\n        }\r\n        if (this.#removeSubmission && this.#supportsSubmissions && this.#hasSubmissions) {\r\n            actions.push(new DeleteAction(this.#cmid, this.#sesskey));\r\n        }\r\n\r\n        if (this.#extend) {\r\n            actions.push(new ExtendAction(this.#cmid, this.#sesskey));\r\n        }\r\n\r\n        if (this.#grantAttempt) {\r\n            actions.push(\r\n                new GeneralAction(\r\n                    this.#cmid,\r\n                    this.#sesskey,\r\n                    'addattempt',\r\n                    getString('batchoperationaddattempt', 'mod_assign'),\r\n                    Templates.renderPix('t/add', 'core'),\r\n                    getString('addattempt', 'mod_assign'),\r\n                    getString('batchoperationconfirmaddattempt', 'mod_assign'),\r\n                    getString('batchoperationaddattempt', 'mod_assign'),\r\n                )\r\n            );\r\n        }\r\n\r\n        if (this.#workflowState) {\r\n            actions.push(new SetMarkingWorkflowStateAction(this.#cmid, this.#sesskey));\r\n        }\r\n\r\n        if (this.#markingAllocation) {\r\n            actions.push(new SetMarkingAllocationAction(this.#cmid, this.#sesskey));\r\n        }\r\n\r\n        if (this.#submissionDrafts) {\r\n            actions.push(\r\n                new GeneralAction(\r\n                    this.#cmid,\r\n                    this.#sesskey,\r\n                    'reverttodraft',\r\n                    getString('batchoperationreverttodraft', 'mod_assign'),\r\n                    Templates.renderPix('e/undo', 'core'),\r\n                    getString('reverttodraft', 'mod_assign'),\r\n                    getString('batchoperationconfirmreverttodraft', 'mod_assign'),\r\n                    getString('batchoperationreverttodraft', 'mod_assign'),\r\n                )\r\n            );\r\n        }\r\n\r\n        if (this.#message) {\r\n            actions.push(new MessageAction());\r\n        }\r\n\r\n        for (const operation of this.#pluginOperations) {\r\n            actions.push(\r\n                new GeneralAction(\r\n                    this.#cmid,\r\n                    this.#sesskey,\r\n                    operation.key,\r\n                    operation.label,\r\n                    operation.icon,\r\n                    operation.confirmationtitle,\r\n                    operation.confirmationquestion,\r\n                )\r\n            );\r\n        }\r\n        return actions;\r\n    }\r\n\r\n    getSelectedItems() {\r\n        return document.querySelectorAll(`${Selectors.selectBulkItemCheckbox}:checked`);\r\n    }\r\n\r\n    registerItemSelectChangeEvent(eventHandler) {\r\n        const itemSelectCheckboxes = document.querySelectorAll(Selectors.selectBulkItemTrigger);\r\n        itemSelectCheckboxes.forEach((checkbox) => {\r\n            checkbox.addEventListener('change', eventHandler.bind(this));\r\n        });\r\n    }\r\n\r\n    deselectItem(selectedItem) {\r\n        selectedItem.checked = false;\r\n        selectedItem.closest('tr').classList.replace('selectedrow', 'unselectedrow');\r\n    }\r\n}\r\n"],"names":["Selectors","BulkActions","options","this","constructor","cmid","message","submissiondrafts","removesubmission","extend","grantattempt","workflowstate","markingallocation","pluginoperations","sesskey","hassubmissions","supportssubmissions","getBulkActions","actions","push","GeneralAction","Templates","renderPix","_classPrivateFieldGet","DeleteAction","ExtendAction","SetMarkingWorkflowStateAction","SetMarkingAllocationAction","MessageAction","operation","key","label","icon","confirmationtitle","confirmationquestion","getSelectedItems","document","querySelectorAll","registerItemSelectChangeEvent","eventHandler","forEach","checkbox","addEventListener","bind","deselectItem","selectedItem","checked","closest","classList","replace"],"mappings":"i9DAiCMA,iCACsB,+CADtBA,gCAEqB,+aAGEC,kCAuDbC,gBACD,IAAIC,KAAKD,SAoBpBE,sBAAYC,KACRA,KADQC,QACFA,QADEC,iBACOA,iBADPC,iBACyBA,iBADzBC,OAC2CA,OAD3CC,aAERA,aAFQC,cAEMA,cAFNC,kBAEqBA,kBAFrBC,iBAEwCA,iBAFxCC,QAE0DA,QAF1DC,eAGRA,eAHQC,oBAGQA,87BAGHX,0CACGC,sDACSC,+DACAC,qDACVC,iDACMC,wDACCC,6DACIC,uDACVE,sDACSD,6DACFE,gEACKC,qBAGhCC,uBACUC,QAAU,yBACZf,4BACAe,QAAQC,KACJ,IAAIC,8CACAjB,kCACAA,eACA,QACA,kBAAU,qBAAsB,cAChCkB,mBAAUC,UAAU,SAAU,SAC9B,kBAAU,kBAAmB,eAC7B,kBAAU,4BAA6B,eACvC,kBAAU,qBAAsB,eAEpC,IAAIF,8CACAjB,kCACAA,eACA,UACA,kBAAU,uBAAwB,cAClCkB,mBAAUC,UAAU,WAAY,SAChC,kBAAU,oBAAqB,eAC/B,kBAAU,8BAA+B,eACzC,kBAAU,uBAAwB,gBAI1CC,wEAA6BpB,uBAC7Be,QAAQC,KACJ,IAAIC,8CACAjB,kCACAA,eACA,oBACA,kBAAU,iCAAkC,cAC5CkB,mBAAUC,UAAU,aAAc,SAClC,kBAAU,8BAA+B,eACzC,kBAAU,wCAAyC,eACnD,kBAAU,iCAAkC,gBAIpDC,qEAA0BpB,kDAA6BA,uBACvDe,QAAQC,KAAK,IAAIK,sCAAarB,kCAAYA,uCAG1CA,eACAe,QAAQC,KAAK,IAAIM,uCAAatB,kCAAYA,uCAG1CA,qBACAe,QAAQC,KACJ,IAAIC,8CACAjB,kCACAA,eACA,cACA,kBAAU,2BAA4B,cACtCkB,mBAAUC,UAAU,QAAS,SAC7B,kBAAU,aAAc,eACxB,kBAAU,kCAAmC,eAC7C,kBAAU,2BAA4B,sCAK9CnB,sBACAe,QAAQC,KAAK,IAAIO,uDAA8BvB,kCAAYA,uCAG3DA,0BACAe,QAAQC,KAAK,IAAIQ,oDAA2BxB,kCAAYA,uCAGxDA,yBACAe,QAAQC,KACJ,IAAIC,8CACAjB,kCACAA,eACA,iBACA,kBAAU,8BAA+B,cACzCkB,mBAAUC,UAAU,SAAU,SAC9B,kBAAU,gBAAiB,eAC3B,kBAAU,qCAAsC,eAChD,kBAAU,8BAA+B,sCAKjDnB,gBACAe,QAAQC,KAAK,IAAIS,uBAGhB,MAAMC,mCAAa1B,wBACpBe,QAAQC,KACJ,IAAIC,8CACAjB,kCACAA,eACA0B,UAAUC,IACVD,UAAUE,MACVF,UAAUG,KACVH,UAAUI,kBACVJ,UAAUK,8BAIfhB,QAGXiB,0BACWC,SAASC,2BAAoBrC,8CAGxCsC,8BAA8BC,cACGH,SAASC,iBAAiBrC,iCAClCwC,SAASC,WAC1BA,SAASC,iBAAiB,SAAUH,aAAaI,KAAKxC,UAI9DyC,aAAaC,cACTA,aAAaC,SAAU,EACvBD,aAAaE,QAAQ,MAAMC,UAAUC,QAAQ,cAAe"}