{"version":3,"file":"collapse.min.js","sources":["../src/collapse.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Allow the user to show and hide columns of the report at will.\r\n *\r\n * @module    gradereport_grader/collapse\r\n * @copyright 2023 Mathew May <mathew.solutions>\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\nimport * as Repository from 'gradereport_grader/collapse/repository';\r\nimport search_combobox from 'core/comboboxsearch/search_combobox';\r\nimport {renderForPromise, replaceNodeContents, replaceNode} from 'core/templates';\r\nimport {debounce} from 'core/utils';\r\nimport Dropdown from 'theme_boost/bootstrap/dropdown';\r\nimport {getStrings} from 'core/str';\r\nimport CustomEvents from \"core/custom_interaction_events\";\r\nimport storage from 'core/localstorage';\r\nimport {addIconToContainer} from 'core/loadingicon';\r\nimport Notification from 'core/notification';\r\nimport Pending from 'core/pending';\r\n\r\n// Contain our selectors within this file until they could be of use elsewhere.\r\nconst selectors = {\r\n    component: '.collapse-columns',\r\n    formDropdown: '.columnsdropdownform',\r\n    formItems: {\r\n        cancel: 'cancel',\r\n        save: 'save',\r\n        checked: 'input[type=\"checkbox\"]:checked',\r\n        currentlyUnchecked: 'input[type=\"checkbox\"]:not([data-action=\"selectall\"])',\r\n    },\r\n    hider: 'hide',\r\n    expand: 'expand',\r\n    colVal: '[data-col]',\r\n    itemVal: '[data-itemid]',\r\n    content: '[data-collapse=\"content\"]',\r\n    sort: '[data-collapse=\"sort\"]',\r\n    expandbutton: '[data-collapse=\"expandbutton\"]',\r\n    rangerowcell: '[data-collapse=\"rangerowcell\"]',\r\n    avgrowcell: '[data-collapse=\"avgrowcell\"]',\r\n    menu: '[data-collapse=\"menu\"]',\r\n    icons: '.data-collapse_gradeicons',\r\n    count: '[data-collapse=\"count\"]',\r\n    placeholder: '.collapsecolumndropdown [data-region=\"placeholder\"]',\r\n    fullDropdown: '.collapsecolumndropdown',\r\n    searchResultContainer: '.searchresultitemscontainer',\r\n    cellMenuButton: '.cellmenubtn',\r\n};\r\n\r\nconst countIndicator = document.querySelector(selectors.count);\r\n\r\nexport default class ColumnSearch extends search_combobox {\r\n\r\n    userID = -1;\r\n    courseID = null;\r\n    defaultSort = '';\r\n\r\n    nodes = [];\r\n\r\n    gradeStrings = null;\r\n    userStrings = null;\r\n    stringMap = [];\r\n\r\n    static init(userID, courseID, defaultSort) {\r\n        return new ColumnSearch(userID, courseID, defaultSort);\r\n    }\r\n\r\n    constructor(userID, courseID, defaultSort) {\r\n        super();\r\n        this.userID = userID;\r\n        this.courseID = courseID;\r\n        this.defaultSort = defaultSort;\r\n        this.component = document.querySelector(selectors.component);\r\n\r\n        const pendingPromise = new Pending();\r\n        // Display a loader whilst collapsing appropriate columns (based on the locally stored state for the current user).\r\n        addIconToContainer(document.querySelector('.gradeparent')).then((loader) => {\r\n            setTimeout(() => {\r\n                // Get the users' checked columns to change.\r\n                this.getDataset().forEach((item) => {\r\n                    this.nodesUpdate(item);\r\n                });\r\n                this.renderDefault();\r\n\r\n                // Once the grade categories have been re-collapsed, remove the loader and display the Gradebook setup content.\r\n                loader.remove();\r\n                document.querySelector('.gradereport-grader-table').classList.remove('d-none');\r\n            }, 10);\r\n        }).then(() => pendingPromise.resolve()).catch(Notification.exception);\r\n\r\n        this.component.addEventListener('hide.bs.dropdown', () => {\r\n            const searchResultContainer = this.component.querySelector(selectors.searchResultContainer);\r\n            searchResultContainer.scrollTop = 0;\r\n\r\n            // Use setTimeout to make sure the following code is executed after the click event is handled.\r\n            setTimeout(() => {\r\n                if (this.searchInput.value !== '') {\r\n                    this.searchInput.value = '';\r\n                    this.searchInput.dispatchEvent(new Event('input', {bubbles: true}));\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The overall div that contains the searching widget.\r\n     *\r\n     * @returns {string}\r\n     */\r\n    componentSelector() {\r\n        return '.collapse-columns';\r\n    }\r\n\r\n    /**\r\n     * The dropdown div that contains the searching widget result space.\r\n     *\r\n     * @returns {string}\r\n     */\r\n    dropdownSelector() {\r\n        return '.searchresultitemscontainer';\r\n    }\r\n\r\n    /**\r\n     * Return the dataset that we will be searching upon.\r\n     *\r\n     * @returns {Array}\r\n     */\r\n    getDataset() {\r\n        if (!this.dataset) {\r\n            const cols = this.fetchDataset();\r\n            this.dataset = JSON.parse(cols) ? JSON.parse(cols).split(',') : [];\r\n        }\r\n        this.datasetSize = this.dataset.length;\r\n        return this.dataset;\r\n    }\r\n\r\n    /**\r\n     * Get the data we will be searching against in this component.\r\n     *\r\n     * @returns {string}\r\n     */\r\n    fetchDataset() {\r\n        return storage.get(`gradereport_grader_collapseditems_${this.courseID}_${this.userID}`);\r\n    }\r\n\r\n    /**\r\n     * Given a user performs an action, update the users' preferences.\r\n     */\r\n    setPreferences() {\r\n        storage.set(`gradereport_grader_collapseditems_${this.courseID}_${this.userID}`,\r\n            JSON.stringify(this.getDataset().join(','))\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Register clickable event listeners.\r\n     */\r\n    registerClickHandlers() {\r\n        // Register click events within the component.\r\n        this.component.addEventListener('click', this.clickHandler.bind(this));\r\n\r\n        document.addEventListener('click', this.docClickHandler.bind(this));\r\n    }\r\n\r\n    /**\r\n     * The handler for when a user interacts with the component.\r\n     *\r\n     * @param {MouseEvent} e The triggering event that we are working with.\r\n     */\r\n    clickHandler(e) {\r\n        super.clickHandler(e);\r\n        // Prevent BS from closing the dropdown if they click elsewhere within the dropdown besides the form.\r\n        if (e.target.closest(selectors.fullDropdown)) {\r\n            e.stopPropagation();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Externally defined click function to improve memory handling.\r\n     *\r\n     * @param {MouseEvent} e\r\n     * @returns {Promise<void>}\r\n     */\r\n    async docClickHandler(e) {\r\n        if (e.target.dataset.hider === selectors.hider) {\r\n            e.preventDefault();\r\n            const pendingPromise = new Pending('gradereport_grader/collapse:docClickHandler:hide');\r\n            const desiredToHide = e.target.closest(selectors.colVal) ?\r\n                e.target.closest(selectors.colVal)?.dataset.col :\r\n                e.target.closest(selectors.itemVal)?.dataset.itemid;\r\n            const idx = this.getDataset().indexOf(desiredToHide);\r\n            if (idx === -1) {\r\n                this.getDataset().push(desiredToHide);\r\n            }\r\n            await this.prefcountpipe();\r\n\r\n            await this.nodesUpdate(desiredToHide);\r\n            pendingPromise.resolve();\r\n        }\r\n\r\n        if (e.target.closest('button')?.dataset.hider === selectors.expand) {\r\n            e.preventDefault();\r\n            const pendingPromise = new Pending('gradereport_grader/collapse:docClickHandler:expand');\r\n            const desiredToHide = e.target.closest(selectors.colVal) ?\r\n                e.target.closest(selectors.colVal)?.dataset.col :\r\n                e.target.closest(selectors.itemVal)?.dataset.itemid;\r\n            const idx = this.getDataset().indexOf(desiredToHide);\r\n            this.getDataset().splice(idx, 1);\r\n\r\n            await this.prefcountpipe();\r\n\r\n            await this.nodesUpdate(e.target.closest(selectors.colVal)?.dataset.col);\r\n            await this.nodesUpdate(e.target.closest(selectors.colVal)?.dataset.itemid);\r\n            pendingPromise.resolve();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle any keyboard inputs.\r\n     */\r\n    registerInputEvents() {\r\n        // Register & handle the text input.\r\n        this.searchInput.addEventListener('input', debounce(async() => {\r\n            if (this.getSearchTerm() === this.searchInput.value && this.searchResultsVisible()) {\r\n                window.console.warn(`Search term matches input value - skipping`);\r\n                // Debounce can happen multiple times quickly.\r\n                return;\r\n            }\r\n            this.setSearchTerms(this.searchInput.value);\r\n            // We can also require a set amount of input before search.\r\n            if (this.searchInput.value === '') {\r\n                // Hide the \"clear\" search button in the search bar.\r\n                this.clearSearchButton.classList.add('d-none');\r\n            } else {\r\n                // Display the \"clear\" search button in the search bar.\r\n                this.clearSearchButton.classList.remove('d-none');\r\n            }\r\n            const pendingPromise = new Pending();\r\n            // User has given something for us to filter against.\r\n            await this.filterrenderpipe().then(() => {\r\n                pendingPromise.resolve();\r\n                return true;\r\n            });\r\n        }, 300, {pending: true}));\r\n    }\r\n\r\n    /**\r\n     * Handle the form submission within the dropdown.\r\n     */\r\n    registerFormEvents() {\r\n        const form = this.component.querySelector(selectors.formDropdown);\r\n        const events = [\r\n            'click',\r\n            CustomEvents.events.activate,\r\n            CustomEvents.events.keyboardActivate\r\n        ];\r\n        CustomEvents.define(document, events);\r\n\r\n        const selectall = form.querySelector('[data-action=\"selectall\"]');\r\n\r\n        // Register clicks & keyboard form handling.\r\n        events.forEach((event) => {\r\n            const submitBtn = form.querySelector(`[data-action=\"${selectors.formItems.save}\"`);\r\n            form.addEventListener(event, (e) => {\r\n                // Stop Bootstrap from being clever.\r\n                e.stopPropagation();\r\n                const input = e.target.closest('input');\r\n                if (input) {\r\n                    // If the user is unchecking an item, we need to uncheck the select all if it's checked.\r\n                    if (selectall.checked && !input.checked) {\r\n                        selectall.checked = false;\r\n                    }\r\n                    const checkedCount = Array.from(form.querySelectorAll(selectors.formItems.checked)).length;\r\n                    // Check if any are clicked or not then change disabled.\r\n                    submitBtn.disabled = checkedCount <= 0;\r\n                }\r\n            }, false);\r\n\r\n            // Stop Bootstrap from being clever.\r\n            this.searchInput.addEventListener(event, e => e.stopPropagation());\r\n            this.clearSearchButton.addEventListener(event, async(e) => {\r\n                e.stopPropagation();\r\n                this.searchInput.value = '';\r\n                this.setSearchTerms(this.searchInput.value);\r\n                await this.filterrenderpipe();\r\n            });\r\n            selectall.addEventListener(event, (e) => {\r\n                // Stop Bootstrap from being clever.\r\n                e.stopPropagation();\r\n                if (!selectall.checked) {\r\n                    const touncheck = Array.from(form.querySelectorAll(selectors.formItems.checked));\r\n                    touncheck.forEach(item => {\r\n                        item.checked = false;\r\n                    });\r\n                    submitBtn.disabled = true;\r\n                } else {\r\n                    const currentUnchecked = Array.from(form.querySelectorAll(selectors.formItems.currentlyUnchecked));\r\n                    currentUnchecked.forEach(item => {\r\n                        item.checked = true;\r\n                    });\r\n                    submitBtn.disabled = false;\r\n                }\r\n            });\r\n        });\r\n\r\n        form.addEventListener('submit', async(e) => {\r\n            e.preventDefault();\r\n            if (e.submitter.dataset.action === selectors.formItems.cancel) {\r\n                Dropdown.getOrCreateInstance(this.component).toggle();\r\n                return;\r\n            }\r\n            // Get the users' checked columns to change.\r\n            const checkedItems = [...form.elements].filter(item => item.checked);\r\n            checkedItems.forEach((item) => {\r\n                const idx = this.getDataset().indexOf(item.dataset.collapse);\r\n                this.getDataset().splice(idx, 1);\r\n                this.nodesUpdate(item.dataset.collapse);\r\n            });\r\n            // Reset the check all & submit to false just in case.\r\n            selectall.checked = false;\r\n            e.submitter.disabled = true;\r\n            await this.prefcountpipe();\r\n        });\r\n    }\r\n\r\n    async nodesUpdate(item) {\r\n        const colNodesToHide = [...document.querySelectorAll(`[data-col=\"${item}\"]`)];\r\n        const itemIDNodesToHide = [...document.querySelectorAll(`[data-itemid=\"${item}\"]`)];\r\n        const elements = [...colNodesToHide, ...itemIDNodesToHide];\r\n        if (elements && elements.length) {\r\n            const pendingPromise = new Pending('gradereport_grader/collapse:nodesUpdate:' + item);\r\n            this.updateDisplay(elements).then(() => pendingPromise.resolve()).catch(Notification.exception);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update the user preferences, count display then render the results.\r\n     *\r\n     * @returns {Promise<void>}\r\n     */\r\n    async prefcountpipe() {\r\n        this.setPreferences();\r\n        this.countUpdate();\r\n        await this.filterrenderpipe();\r\n    }\r\n\r\n    /**\r\n     * Dictate to the search component how and what we want to match upon.\r\n     *\r\n     * @param {Array} filterableData\r\n     * @returns {Array} An array of objects containing the system reference and the user readable value.\r\n     */\r\n    async filterDataset(filterableData) {\r\n        const stringUserMap = await this.fetchRequiredUserStrings();\r\n        const stringGradeMap = await this.fetchRequiredGradeStrings();\r\n        // Custom user profile fields are not in our string map and need a bit of extra love.\r\n        const customFieldMap = this.fetchCustomFieldValues();\r\n        this.stringMap = new Map([...stringGradeMap, ...stringUserMap, ...customFieldMap]);\r\n\r\n        const searching = filterableData.map(s => {\r\n            const mapObj = this.stringMap.get(s);\r\n            if (mapObj === undefined) {\r\n                return {key: s, string: s};\r\n            }\r\n            return {\r\n                key: s,\r\n                string: mapObj.itemname ?? this.stringMap.get(s),\r\n                category: mapObj.category ?? '',\r\n            };\r\n        });\r\n        // Sometimes we just want to show everything.\r\n        if (this.getPreppedSearchTerm() === '') {\r\n            return searching;\r\n        }\r\n        // Other times we want to actually filter the content.\r\n        return searching.filter((col) => {\r\n            return col.string.toString().toLowerCase().includes(this.getPreppedSearchTerm());\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Given we have a subset of the dataset, set the field that we matched upon to inform the end user.\r\n     */\r\n    filterMatchDataset() {\r\n        this.setMatchedResults(\r\n            this.getMatchedResults().map((column) => {\r\n                return {\r\n                    name: column.key,\r\n                    displayName: column.string ?? column.key,\r\n                    category: column.category ?? '',\r\n                };\r\n            })\r\n        );\r\n    }\r\n\r\n    /**\r\n     * With an array of nodes, switch their classes and values.\r\n     *\r\n     * @param {Array} elements The elements to update.\r\n     */\r\n    async updateDisplay(elements) {\r\n        const promises = [];\r\n        elements.forEach((element) => {\r\n            promises.push(this.updateDisplayForElement(element));\r\n        });\r\n\r\n        await Promise.all(promises);\r\n    }\r\n\r\n    /**\r\n     * Update display for given element, switch its classes and values.\r\n     *\r\n     * @param {HTMLElement} element The element to update.\r\n     */\r\n    async updateDisplayForElement(element) {\r\n        const content = element.querySelector(selectors.content);\r\n        const sort = element.querySelector(selectors.sort);\r\n        const expandButton = element.querySelector(selectors.expandbutton);\r\n        const rangeRowCell = element.querySelector(selectors.rangerowcell);\r\n        const avgRowCell = element.querySelector(selectors.avgrowcell);\r\n        const cellMenuButton = element.querySelector(selectors.cellMenuButton);\r\n        const nodeSet = [\r\n            element.querySelector(selectors.menu),\r\n            element.querySelector(selectors.icons),\r\n            content\r\n        ];\r\n\r\n        // This can be further improved to reduce redundant similar calls.\r\n        if (element.classList.contains('cell')) {\r\n            // The column is actively being sorted, lets reset that and reload the page.\r\n            if (sort !== null) {\r\n                window.location = this.defaultSort;\r\n            }\r\n            if (content === null) {\r\n                // If it's not a content cell, it must be an overall average or a range cell.\r\n                const rowCell = avgRowCell ?? rangeRowCell;\r\n\r\n                rowCell?.classList.toggle('d-none');\r\n            } else if (content.classList.contains('d-none')) {\r\n                // We should always have content but some cells do not contain menus or other actions.\r\n                element.classList.remove('collapsed');\r\n                // If there are many nodes, apply the following.\r\n                if (content.childNodes.length > 1) {\r\n                    content.classList.add('d-flex');\r\n                }\r\n                nodeSet.forEach(node => {\r\n                    node?.classList.remove('d-none');\r\n                });\r\n                expandButton?.classList.add('d-none');\r\n                cellMenuButton?.focus();\r\n            } else {\r\n                element.classList.add('collapsed');\r\n                content.classList.remove('d-flex');\r\n                nodeSet.forEach(node => {\r\n                    node?.classList.add('d-none');\r\n                });\r\n                expandButton?.classList.remove('d-none');\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update the visual count of collapsed columns or hide the count all together.\r\n     */\r\n    countUpdate() {\r\n        countIndicator.textContent = this.getDatasetSize();\r\n        if (this.getDatasetSize() > 0) {\r\n            this.component.parentElement.classList.add('d-flex');\r\n            this.component.parentElement.classList.remove('d-none');\r\n        } else {\r\n            this.component.parentElement.classList.remove('d-flex');\r\n            this.component.parentElement.classList.add('d-none');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Build the content then replace the node by default we want our form to exist.\r\n     */\r\n    async renderDefault() {\r\n        this.setMatchedResults(await this.filterDataset(this.getDataset()));\r\n        this.filterMatchDataset();\r\n\r\n        // Update the collapsed button pill.\r\n        this.countUpdate();\r\n        const {html, js} = await renderForPromise('gradereport_grader/collapse/collapsebody', {\r\n            'instance': this.instance,\r\n            'results': this.getMatchedResults(),\r\n            'userid': this.userID,\r\n        });\r\n        replaceNode(selectors.placeholder, html, js);\r\n        this.updateNodes();\r\n\r\n        // Given we now have the body, we can set up more triggers.\r\n        this.registerFormEvents();\r\n        this.registerInputEvents();\r\n\r\n        // Add a small BS listener so that we can set the focus correctly on open.\r\n        this.component.addEventListener('shown.bs.dropdown', () => {\r\n            this.searchInput.focus({preventScroll: true});\r\n            this.selectallEnable();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Build the content then replace the node.\r\n     */\r\n    async renderDropdown() {\r\n        const {html, js} = await renderForPromise('gradereport_grader/collapse/collapseresults', {\r\n            instance: this.instance,\r\n            'results': this.getMatchedResults(),\r\n            'searchTerm': this.getSearchTerm(),\r\n        });\r\n        replaceNodeContents(this.getHTMLElements().searchDropdown, html, js);\r\n        this.selectallEnable();\r\n        // Reset the expand button to be disabled as we have re-rendered the dropdown.\r\n        const form = this.component.querySelector(selectors.formDropdown);\r\n        const expandButton = form.querySelector(`[data-action=\"${selectors.formItems.save}\"`);\r\n        expandButton.disabled = true;\r\n    }\r\n\r\n    /**\r\n     * Given we render the dropdown, Determine if we want to enable the select all checkbox.\r\n     */\r\n    selectallEnable() {\r\n        const form = this.component.querySelector(selectors.formDropdown);\r\n        const selectall = form.querySelector('[data-action=\"selectall\"]');\r\n        selectall.disabled = this.getMatchedResults().length === 0;\r\n    }\r\n\r\n    /**\r\n     * If we have any custom user profile fields, grab their system & readable names to add to our string map.\r\n     *\r\n     * @returns {array<string,*>} An array of associated string arrays ready for our map.\r\n     */\r\n    fetchCustomFieldValues() {\r\n        const customFields = document.querySelectorAll('[data-collapse-name]');\r\n        // Cast from NodeList to array to grab all the values.\r\n        return [...customFields].map(field => [field.parentElement.dataset.col, field.dataset.collapseName]);\r\n    }\r\n\r\n    /**\r\n     * Given the set of profile fields we can possibly search, fetch their strings,\r\n     * so we can report to screen readers the field that matched.\r\n     *\r\n     * @returns {Promise<void>}\r\n     */\r\n    fetchRequiredUserStrings() {\r\n        if (!this.userStrings) {\r\n            const requiredStrings = [\r\n                'username',\r\n                'firstname',\r\n                'lastname',\r\n                'email',\r\n                'city',\r\n                'country',\r\n                'department',\r\n                'institution',\r\n                'idnumber',\r\n                'phone1',\r\n                'phone2',\r\n            ];\r\n            this.userStrings = getStrings(requiredStrings.map((key) => ({key})))\r\n                .then((stringArray) => new Map(\r\n                    requiredStrings.map((key, index) => ([key, stringArray[index]]))\r\n                ));\r\n        }\r\n        return this.userStrings;\r\n    }\r\n\r\n    /**\r\n     * Given the set of gradable items we can possibly search, fetch their strings,\r\n     * so we can report to screen readers the field that matched.\r\n     *\r\n     * @returns {Promise<void>}\r\n     */\r\n    fetchRequiredGradeStrings() {\r\n        if (!this.gradeStrings) {\r\n            this.gradeStrings = Repository.gradeItems(this.courseID)\r\n                .then((result) => new Map(\r\n                    result.gradeItems.map(key => ([key.id, key]))\r\n                ));\r\n        }\r\n        return this.gradeStrings;\r\n    }\r\n}\r\n"],"names":["selectors","cancel","save","checked","currentlyUnchecked","countIndicator","document","querySelector","ColumnSearch","search_combobox","userID","courseID","defaultSort","constructor","component","pendingPromise","Pending","then","loader","setTimeout","getDataset","forEach","item","nodesUpdate","renderDefault","remove","classList","resolve","catch","Notification","exception","addEventListener","this","scrollTop","searchInput","value","dispatchEvent","Event","bubbles","componentSelector","dropdownSelector","dataset","cols","fetchDataset","JSON","parse","split","datasetSize","length","storage","get","setPreferences","set","stringify","join","registerClickHandlers","clickHandler","bind","docClickHandler","e","target","closest","stopPropagation","hider","preventDefault","desiredToHide","_e$target$closest","col","_e$target$closest2","itemid","indexOf","push","prefcountpipe","_e$target$closest4","_e$target$closest5","idx","splice","_e$target$closest6","_e$target$closest7","registerInputEvents","async","getSearchTerm","searchResultsVisible","window","console","warn","setSearchTerms","clearSearchButton","add","filterrenderpipe","pending","registerFormEvents","form","events","CustomEvents","activate","keyboardActivate","define","selectall","event","submitBtn","input","checkedCount","Array","from","querySelectorAll","disabled","submitter","action","getOrCreateInstance","toggle","elements","filter","collapse","updateDisplay","countUpdate","filterableData","stringUserMap","fetchRequiredUserStrings","stringGradeMap","fetchRequiredGradeStrings","customFieldMap","fetchCustomFieldValues","stringMap","Map","searching","map","s","mapObj","undefined","key","string","itemname","category","getPreppedSearchTerm","toString","toLowerCase","includes","filterMatchDataset","setMatchedResults","getMatchedResults","column","name","displayName","promises","element","updateDisplayForElement","Promise","all","content","sort","expandButton","rangeRowCell","avgRowCell","cellMenuButton","nodeSet","contains","location","rowCell","childNodes","node","focus","textContent","getDatasetSize","parentElement","filterDataset","html","js","instance","updateNodes","preventScroll","selectallEnable","getHTMLElements","searchDropdown","field","collapseName","userStrings","requiredStrings","stringArray","index","gradeStrings","Repository","gradeItems","result","id"],"mappings":"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"}