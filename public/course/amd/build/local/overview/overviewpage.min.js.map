{"version":3,"file":"overviewpage.min.js","sources":["../../../src/local/overview/overviewpage.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Controls the fragment overview loadings.\r\n *\r\n * @module     core_course/local/overview/overviewpage\r\n * @copyright  2025 Ferran Recio <ferran@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport CourseContent from 'core_courseformat/local/content';\r\nimport {eventTypes as collapsableSectionEventTypes} from 'core/local/collapsable_section/events';\r\nimport Fragment from 'core/fragment';\r\nimport {getCurrentCourseEditor} from 'core_courseformat/courseeditor';\r\nimport Pending from 'core/pending';\r\nimport Templates from 'core/templates';\r\n\r\n/**\r\n * Initialize the overview page.\r\n *\r\n * @param {String} selector The selector where the overview page is located.\r\n */\r\nexport const init = async(selector) => {\r\n    const pageElement = document.querySelector(selector);\r\n    if (!pageElement) {\r\n        throw new Error('No elements found with the selector: ' + selector);\r\n    }\r\n\r\n    pageElement.addEventListener(\r\n        collapsableSectionEventTypes.shown,\r\n        event => {\r\n            const fragmentElement = getFragmentContainer(event.target);\r\n            if (!fragmentElement) {\r\n                return;\r\n            }\r\n            loadFragmentContent(fragmentElement);\r\n        }\r\n    );\r\n\r\n    // The overview page is considered an alternative course view page so it must\r\n    // include the course content component to capture any possible action. For example,\r\n    // capturing manual completion toggles.\r\n    return new CourseContent({\r\n        element: pageElement,\r\n        reactive: getCurrentCourseEditor(),\r\n    });\r\n};\r\n\r\n/**\r\n * Load the fragment content.\r\n *\r\n * @private\r\n * @param {HTMLElement} element The element where the fragment content will be loaded.\r\n */\r\nconst loadFragmentContent = (element) => {\r\n    if (element.dataset.loaded) {\r\n        return;\r\n    }\r\n\r\n    const pendingReload = new Pending(`course_overviewtable_${element.dataset.modname}`);\r\n\r\n    const promise = Fragment.loadFragment(\r\n        'core_course',\r\n        'course_overview',\r\n        element.dataset.contextid,\r\n        {\r\n            courseid: element.dataset.courseid,\r\n            modname: element.dataset.modname,\r\n        }\r\n    );\r\n\r\n    promise.then(async(html, js) => {\r\n        Templates.runTemplateJS(js);\r\n        element.innerHTML = html;\r\n        // Templates.replaceNode(element, html, js);\r\n        element.dataset.loaded = true;\r\n        pendingReload.resolve();\r\n        return true;\r\n    }).catch(() => {\r\n        pendingReload.resolve();\r\n    });\r\n};\r\n\r\n/**\r\n * Get the fragment container.\r\n *\r\n * @private\r\n * @param {HTMLElement} element The element where the fragment container is located.\r\n * @return {HTMLElement|null} The fragment container.\r\n */\r\nconst getFragmentContainer = (element) => {\r\n    const result = element.querySelector('[data-region=\"loading-icon-container\"]');\r\n    if (!result) {\r\n        return null;\r\n    }\r\n    if (!result.dataset.contextid || !result.dataset.courseid || !result.dataset.modname) {\r\n        throw new Error('The element is missing required data attributes.');\r\n    }\r\n    return result;\r\n};\r\n"],"names":["async","pageElement","document","querySelector","selector","Error","addEventListener","collapsableSectionEventTypes","shown","event","fragmentElement","getFragmentContainer","target","loadFragmentContent","CourseContent","element","reactive","dataset","loaded","pendingReload","Pending","modname","Fragment","loadFragment","contextid","courseid","then","html","js","runTemplateJS","innerHTML","resolve","catch","result"],"mappings":";;;;;;;8QAmCoBA,MAAAA,iBACVC,YAAcC,SAASC,cAAcC,cACtCH,kBACK,IAAII,MAAM,wCAA0CD,iBAG9DH,YAAYK,iBACRC,mBAA6BC,OAC7BC,cACUC,gBAAkBC,qBAAqBF,MAAMG,QAC9CF,iBAGLG,oBAAoBH,oBAOrB,IAAII,iBAAc,CACrBC,QAASd,YACTe,UAAU,mDAUZH,oBAAuBE,aACrBA,QAAQE,QAAQC,oBAIdC,cAAgB,IAAIC,gDAAgCL,QAAQE,QAAQI,UAE1DC,kBAASC,aACrB,cACA,kBACAR,QAAQE,QAAQO,UAChB,CACIC,SAAUV,QAAQE,QAAQQ,SAC1BJ,QAASN,QAAQE,QAAQI,UAIzBK,MAAK1B,MAAM2B,KAAMC,yBACXC,cAAcD,IACxBb,QAAQe,UAAYH,KAEpBZ,QAAQE,QAAQC,QAAS,EACzBC,cAAcY,WACP,KACRC,OAAM,KACLb,cAAcY,cAWhBpB,qBAAwBI,gBACpBkB,OAASlB,QAAQZ,cAAc,8CAChC8B,cACM,SAENA,OAAOhB,QAAQO,YAAcS,OAAOhB,QAAQQ,WAAaQ,OAAOhB,QAAQI,cACnE,IAAIhB,MAAM,2DAEb4B"}