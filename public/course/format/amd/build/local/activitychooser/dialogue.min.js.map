{"version":3,"file":"dialogue.min.js","sources":["../../../src/local/activitychooser/dialogue.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * A type of dialogue used as for choosing options.\r\n *\r\n * @module     core_courseformat/local/activitychooser/dialogue\r\n * @copyright  2019 Mihail Geshoski <mihail@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n// import {addIconToContainer} from 'core/loadingicon';\r\nimport {debounce} from 'core/utils';\r\nimport DialogueDom from 'core_courseformat/local/activitychooser/dialoguedom';\r\nimport {end, arrowLeft, arrowRight, home, enter, space} from 'core/key_codes';\r\nimport Exporter from 'core_courseformat/local/activitychooser/exporter';\r\nimport {getFirst} from 'core/normalise';\r\nimport {getString} from 'core/str';\r\nimport Modal from 'core/modal';\r\nimport * as ModalEvents from 'core/modal_events';\r\nimport Notification from 'core/notification';\r\nimport * as Repository from 'core_courseformat/local/activitychooser/repository';\r\nimport selectors from 'core_courseformat/local/activitychooser/selectors';\r\nimport * as Templates from 'core/templates';\r\nconst getPlugin = pluginName => import(pluginName);\r\n\r\n/**\r\n * Display the activity chooser modal.\r\n *\r\n * @method displayActivityChooser\r\n * @param {Promise} footerDataPromise Promise for the footer data.\r\n * @param {Promise} modulesDataPromise Promise for the modules data.\r\n */\r\nexport async function displayActivityChooserModal(\r\n    footerDataPromise,\r\n    modulesDataPromise,\r\n) {\r\n    // We want to show the modal instantly but loading whilst waiting for our data.\r\n    let bodyPromiseResolver;\r\n    const bodyPromise = new Promise(resolve => {\r\n        bodyPromiseResolver = resolve;\r\n    });\r\n\r\n    const exporter = new Exporter();\r\n\r\n    const footerData = await footerDataPromise;\r\n\r\n    const footerPromise = Templates.render(\r\n        'core_courseformat/local/activitychooser/footer',\r\n        exporter.getFooterData(footerData),\r\n    );\r\n\r\n    const sectionModal = Modal.create({\r\n        body: bodyPromise,\r\n        title: getString('addresourceoractivity'),\r\n        footer: footerPromise,\r\n        large: true,\r\n        scrollable: false,\r\n        templateContext: {\r\n            classes: 'modchooser'\r\n        },\r\n        show: true,\r\n    });\r\n\r\n    try {\r\n        const modulesData = await modulesDataPromise;\r\n\r\n        if (!modulesData) {\r\n            return;\r\n        }\r\n\r\n        const modal = await sectionModal;\r\n        new ActivityChooserDialogue(modal, modulesData, footerData);\r\n\r\n        const templateData = await exporter.getModChooserTemplateData(modulesData);\r\n        bodyPromiseResolver(await Templates.render('core_courseformat/activitychooser', templateData));\r\n    } catch (error) {\r\n        const errorTemplateData = {\r\n            'errormessage': error.message\r\n        };\r\n        bodyPromiseResolver(\r\n            await Templates.render('core_courseformat/local/activitychooser/error', errorTemplateData)\r\n        );\r\n        return;\r\n    }\r\n}\r\n\r\n/**\r\n * Display the module chooser.\r\n *\r\n * @deprecated since Moodle 5.1\r\n * @todo Remove the method in Moodle 6.0 (MDL-85655).\r\n * @method displayChooser\r\n * @param {Promise} modalPromise Our created modal for the section\r\n * @param {Array} sectionModules An array of all of the built module information\r\n * @param {Function} partialFavourite Partially applied function we need to manage favourite status\r\n * @param {Object} footerData Our base footer object.\r\n */\r\nexport const displayChooser = (modalPromise, sectionModules, partialFavourite, footerData) => {\r\n    window.console.warn(\r\n        'The displayChooser function is deprecated. ' +\r\n        'Please displayActivityChooserModal instead.'\r\n    );\r\n\r\n    // Register event listeners.\r\n    modalPromise.then(modal => {\r\n        new ActivityChooserDialogue(modal, sectionModules, footerData);\r\n        return modal;\r\n    }).catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Activity Chooser Dialogue class.\r\n *\r\n * @private\r\n */\r\nclass ActivityChooserDialogue {\r\n    /**\r\n     * Constructor for the ActivityChooserDialogue class.\r\n     * @param {Modal} modal The modal object.\r\n     * @param {Object} modulesData The data for the modules.\r\n     * @param {Object} footerData The data for the footer.\r\n     */\r\n    constructor(modal, modulesData, footerData) {\r\n        this.modal = modal;\r\n        this.dialogueDom = null; // We cannot init until we have the modal body loaded.\r\n        this.footerData = footerData;\r\n        this.exporter = new Exporter();\r\n        this.selectedModule = null;\r\n        // This attribute marks when the tab content is dirty and needs to be refreshed when the user changes the tab.\r\n        // We don't want the content to be updated while the user is managing their favourites.\r\n        this.isFavouriteTabDirty = false;\r\n        // Make a map so we can quickly fetch a specific module's object for either rendering or searching.\r\n        this.mappedModules = new Map();\r\n        modulesData.forEach((module) => {\r\n            this.mappedModules.set(module.componentname + '_' + module.link, module);\r\n        });\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * Initialise the activity chooser dialogue.\r\n     *\r\n     * @return {Promise} A promise that resolves when the modal is ready.\r\n     */\r\n    async init() {\r\n        await this.modal.getBodyPromise();\r\n        await this.modal.getFooterPromise();\r\n        this.dialogueDom = new DialogueDom(this, this.modal, this.exporter);\r\n        this.registerModalListenerEvents();\r\n        this.setupKeyboardAccessibility();\r\n        // We want to focus on the action select when the dialog is closed.\r\n        this.modal.getRoot().on(ModalEvents.hidden, () => {\r\n            this.modal.destroy();\r\n        });\r\n        // When modal is open the add button should be disabled because there is no activity selected.\r\n        this.dialogueDom.unmarkAllChooserOptionAsSelected();\r\n    }\r\n\r\n    /**\r\n     * Register chooser related event listeners.\r\n     *\r\n     * @returns {Promise} A promise that resolves when events are registered\r\n     */\r\n    async registerModalListenerEvents() {\r\n        const modalRoot = getFirst(this.modal.getRoot());\r\n\r\n        // Changing the tab should cancel any active search.\r\n        modalRoot.addEventListener(\r\n            'shown.bs.tab',\r\n            (event) => {\r\n                this.dialogueDom.unmarkAllChooserOptionAsSelected();\r\n                // The all tab has the search result, so we do not want to clear the search input.\r\n                if (event.target.closest(selectors.regions.allTabNav)) {\r\n                    return;\r\n                }\r\n                const searchInput = this.dialogueDom.getSearchInputElement();\r\n                if (searchInput.value.length > 0) {\r\n                    searchInput.value = \"\";\r\n                    this.toggleSearchResultsView(searchInput.value);\r\n                }\r\n            },\r\n        );\r\n\r\n        // Add the listener for clicks on the full modal.\r\n        modalRoot.addEventListener(\r\n            'click',\r\n            this.handleModalClick.bind(this),\r\n        );\r\n        modalRoot.addEventListener(\r\n            'dblclick',\r\n            this.handleModalDoubleClick.bind(this),\r\n        );\r\n\r\n        // Add a listener for an input change in the activity chooser's search bar.\r\n        const searchInput = this.dialogueDom.getSearchInputElement();\r\n        searchInput.addEventListener(\r\n            'input',\r\n            debounce(\r\n                () => {\r\n                    this.toggleSearchResultsView(searchInput.value);\r\n                },\r\n                300,\r\n                {pending: true},\r\n            ),\r\n        );\r\n\r\n        this.dialogueDom.initBootstrapComponents();\r\n\r\n        // Handle focus when a new tab is shown.\r\n        modalRoot.addEventListener('shown.bs.tab', (event) => {\r\n            if (event.relatedTarget) {\r\n                this.dialogueDom.disableFocusAllChooserOptions(event.relatedTarget);\r\n            }\r\n            this.dialogueDom.initActiveTabNavigation();\r\n        });\r\n\r\n        // Update the favourite tab content when the user changes the tab.\r\n        modalRoot.addEventListener('shown.bs.tab', () => {\r\n            if (this.isFavouriteTabDirty && !this.dialogueDom.isFavoutiteTabActive()) {\r\n                this.refreshFavouritesTabContent();\r\n            }\r\n        });\r\n\r\n        this.dialogueDom.initActiveTabNavigation();\r\n\r\n        const modalFooter = getFirst(await this.modal.getFooterPromise());\r\n\r\n        // Add the listener for clicks on the footer.\r\n        modalFooter.addEventListener(\r\n            'click',\r\n            this.handleFooterClick.bind(this),\r\n        );\r\n\r\n        // Adapt modal footer depending on the displayed carousel page.\r\n        modalRoot.addEventListener('slide.bs.carousel', (event) => {\r\n            if (event.to === undefined) {\r\n                return;\r\n            }\r\n            // The boostrap carousel event.to contains the index of the newly active item.\r\n            // The zero index is the chooser options, the first index is the module help,\r\n            // any other index are custom footer pages.\r\n            this.dialogueDom.toggleActiveFooter(event.to === 0);\r\n            this.dialogueDom.toggleBackButton(event.to !== 0);\r\n            this.dialogueDom.toggleAddButton(event.to < 2);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Handle the click event on the footer of the modal.\r\n     *\r\n     * @param {Object} event The event object\r\n     * @return {Promise} A promise that resolves when the event is handled\r\n     */\r\n    async handleFooterClick(event) {\r\n        if (event.target.closest(selectors.actions.addSelectedChooserOption)) {\r\n            this.submitAddSelectedModule();\r\n        }\r\n\r\n        if (\r\n            event.target.closest(selectors.regions.activeFooter)\r\n            && this.footerData.footer === true\r\n        ) {\r\n            const footerjs = await getPlugin(this.footerData.customfooterjs);\r\n            await footerjs.footerClickListener(event, this.footerData, this.modal);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Modal click handler.\r\n     *\r\n     * @param {Object} event The event object\r\n     * @return {Promise} A promise that resolves when the event is handled\r\n     */\r\n    async handleModalClick(event) {\r\n        const target = event.target;\r\n\r\n        if (target.closest(selectors.actions.optionActions.showSummary)) {\r\n            event.preventDefault();\r\n            this.handleShowSummary(target);\r\n            return;\r\n        }\r\n\r\n        if (target.closest(selectors.actions.displayCategory)) {\r\n            event.preventDefault();\r\n            this.handleDisplayCategory(target);\r\n            return;\r\n        }\r\n\r\n        if (target.closest(selectors.actions.optionActions.manageFavourite)) {\r\n            event.preventDefault();\r\n            await this.handleFavouriteClick(target);\r\n            return;\r\n        }\r\n\r\n        // From the help screen go back to the module overview.\r\n        if (target.matches(selectors.actions.closeOption)) {\r\n            event.preventDefault();\r\n            this.dialogueDom.hideModuleHelp(target.dataset.modname);\r\n            return;\r\n        }\r\n\r\n        // The \"clear search\" button is triggered.\r\n        if (target.closest(selectors.actions.clearSearch)) {\r\n            this.handleClearSearch();\r\n            return;\r\n        }\r\n\r\n        if (target.closest(selectors.regions.chooserOption.info)) {\r\n            event.preventDefault();\r\n            this.handleOptionSelection(target);\r\n            return;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle the double click event on the modal.\r\n     * @param {Object} event The event object\r\n     */\r\n    handleModalDoubleClick(event) {\r\n        const option = this.dialogueDom.getClosestChooserOption(event.target);\r\n        if (option !== null) {\r\n            this.submitAddSelectedModule(this.selectedModule);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Show the summary of a module when the user clicks on the \"show summary\" button.\r\n     *\r\n     * @param {HTMLElement} target The target element that triggered the event\r\n     */\r\n    handleShowSummary(target) {\r\n        const module = this.dialogueDom.getClosestChooserOption(target);\r\n        const moduleName = module.dataset.modname;\r\n        const moduleData = this.mappedModules.get(moduleName);\r\n        // We select the module now. This way the back button will keep the module selected.\r\n        this.handleOptionSelection(target);\r\n        // We need to know if the overall modal has a footer so we know when to show a real / vs fake footer.\r\n        moduleData.showFooter = this.modal.hasFooterContent();\r\n        this.dialogueDom.setBackButtonModuleData(moduleData);\r\n        this.dialogueDom.showModuleHelp(moduleData, this.modal);\r\n    }\r\n\r\n    /**\r\n     * Handle the display of a category when the user clicks on the \"display category\" button.\r\n     * @param {HTMLElement} target The target element that triggered the event\r\n     */\r\n    handleDisplayCategory(target) {\r\n        const category = target.dataset.category;\r\n        if (!category) {\r\n            return;\r\n        }\r\n        this.dialogueDom.hideModuleHelp();\r\n        const tabNav = this.dialogueDom.showCategoryTab(category);\r\n        tabNav.focus();\r\n        tabNav.scrollIntoView();\r\n    }\r\n\r\n    /**\r\n     * Handle the favourite state of a module when the user clicks on the \"starred\" button.\r\n     *\r\n     * @param {HTMLElement} target The target element that triggered the event\r\n     * @return {Promise} A promise that resolves when the event is handled\r\n     */\r\n    async handleFavouriteClick(target) {\r\n        const caller = target.closest(selectors.actions.optionActions.manageFavourite);\r\n        const id = caller.dataset.id;\r\n        const name = caller.dataset.name;\r\n        const internal = caller.dataset.internal;\r\n        const isFavourite = caller.dataset.favourited;\r\n\r\n        // Switch on fave or not.\r\n        if (isFavourite === 'true') {\r\n            await Repository.unfavouriteModule(name, id);\r\n            this.updateFavouriteItemValue(internal, false);\r\n        } else {\r\n            await Repository.favouriteModule(name, id);\r\n            this.updateFavouriteItemValue(internal, true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle a clear search action.\r\n     */\r\n    handleClearSearch() {\r\n        const searchInput = this.dialogueDom.getSearchInputElement();\r\n        searchInput.value = \"\";\r\n        searchInput.focus();\r\n        this.toggleSearchResultsView(searchInput.value);\r\n    }\r\n\r\n    /**\r\n     * Handle the click on a chooser option.\r\n     *\r\n     * @param {HTMLElement} target The target element that triggered the event\r\n     */\r\n    handleOptionSelection(target) {\r\n        const option = this.dialogueDom.getClosestChooserOption(target);\r\n        if (option === null) {\r\n            return;\r\n        }\r\n        this.selectedModule = option;\r\n        this.dialogueDom.markChooserOptionAsSelected(option, getFirst(this.modal.getFooter()));\r\n    }\r\n\r\n    /**\r\n     * Submit the selected module to the chooser.\r\n     *\r\n     * This method will redirect the user to the URL of the selected module, if one is selected.\r\n     *\r\n     * @param {HTMLElement} newSelectedModule optional new selected module element.\r\n     * @return {void}\r\n     */\r\n    submitAddSelectedModule(newSelectedModule = null) {\r\n        if (newSelectedModule) {\r\n            this.handleOptionSelection(newSelectedModule);\r\n        }\r\n        if (this.selectedModule === null) {\r\n            return;\r\n        }\r\n        window.location.href = this.dialogueDom.getChooserOptionUrl(this.selectedModule);\r\n    }\r\n\r\n    /**\r\n     * Set up our tabindex information across the chooser.\r\n     *\r\n     * @method setupKeyboardAccessibility\r\n     */\r\n    setupKeyboardAccessibility() {\r\n        const mainElement = getFirst(this.modal.getModal());\r\n\r\n        mainElement.tabIndex = -1;\r\n\r\n        mainElement.addEventListener('keydown', (e) => {\r\n            const currentOption = this.dialogueDom.getClosestChooserOption(e.target);\r\n            if (currentOption === null) {\r\n                return;\r\n            }\r\n\r\n            if (e.keyCode === enter || e.keyCode === space) {\r\n                // Check first if the target is an internal control button (favourite or help).\r\n                // If that is the case, the regular click will handle the event.\r\n                if (e.target.closest(selectors.regions.chooserOption.actions)) {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            if (e.keyCode === space) {\r\n                e.preventDefault();\r\n                this.handleOptionSelection(currentOption);\r\n            }\r\n            if (e.keyCode === enter) {\r\n                e.preventDefault();\r\n                this.submitAddSelectedModule(currentOption);\r\n            }\r\n            if (e.keyCode === arrowRight) {\r\n                e.preventDefault();\r\n                this.dialogueDom.focusNextChooserOption(currentOption);\r\n            }\r\n            if (e.keyCode === arrowLeft) {\r\n                e.preventDefault();\r\n                this.dialogueDom.focusPreviousChooserOption(currentOption);\r\n            }\r\n            if (e.keyCode === home) {\r\n                e.preventDefault();\r\n                this.dialogueDom.focusFirstChooserOption(currentOption);\r\n            }\r\n            if (e.keyCode === end) {\r\n                e.preventDefault();\r\n                this.dialogueDom.focusLastChooserOption(currentOption);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Toggle (display/hide) the search results depending on the value of the search query\r\n     *\r\n     * @method toggleSearchResultsView\r\n     * @param {String} searchQuery The search query\r\n     */\r\n    async toggleSearchResultsView(searchQuery) {\r\n        const searchResultsData = this.searchModules(searchQuery);\r\n\r\n        if (searchQuery.length > 0) {\r\n            await this.dialogueDom.refreshSearchResults(searchQuery, searchResultsData);\r\n            this.dialogueDom.showAllActivitiesTab(true);\r\n        } else {\r\n            this.dialogueDom.cleanSearchResults();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Return the list of modules which have a name or description that matches the given search term.\r\n     *\r\n     * @method searchModules\r\n     * @param {String} searchTerm The search term to match\r\n     * @return {Array}\r\n     */\r\n    searchModules(searchTerm) {\r\n        if (searchTerm === '') {\r\n            return this.mappedModules;\r\n        }\r\n        searchTerm = searchTerm.toLowerCase();\r\n        const searchResults = [];\r\n        this.mappedModules.forEach((activity) => {\r\n            const activityName = activity.title.toLowerCase();\r\n            const activityDesc = activity.help.toLowerCase();\r\n            if (activityName.includes(searchTerm) || activityDesc.includes(searchTerm)) {\r\n                searchResults.push(activity);\r\n            }\r\n        });\r\n\r\n        return searchResults;\r\n    }\r\n\r\n    /**\r\n     * Update the favourite item value in the mapped modules.\r\n     *\r\n     * @param {String} internal The internal name of the module.\r\n     * @param {Boolean} favourite Whether the module is a favourite or not.\r\n     * @return {Promise} A promise that resolves when the item is updated.\r\n     */\r\n    async updateFavouriteItemValue(internal, favourite) {\r\n        const moduleItem = this.mappedModules.find(({name}) => name === internal);\r\n        if (!moduleItem) {\r\n            return;\r\n        }\r\n        moduleItem.favourite = favourite;\r\n\r\n        this.dialogueDom.updateItemStarredIcons(internal, favourite);\r\n\r\n        if (this.dialogueDom.isFavoutiteTabActive()) {\r\n            this.isFavouriteTabDirty = true;\r\n        } else {\r\n            this.refreshFavouritesTabContent();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Refresh the favourites tab content.\r\n     *\r\n     * Note: this method will also hide the favourites tab if there are no favourite modules\r\n     * to keep the modal consistent.\r\n     *\r\n     * @return {Promise} A promise that resolves when the content is refreshed.\r\n     */\r\n    async refreshFavouritesTabContent() {\r\n        this.isFavouriteTabDirty = false;\r\n        const favouriteCount = this.mappedModules.filter(mod => mod.favourite === true).size;\r\n        this.dialogueDom.toggleFavouriteTabDisplay(favouriteCount > 0);\r\n        await this.dialogueDom.refreshFavouritesTabContent(this.mappedModules);\r\n    }\r\n}\r\n"],"names":["footerDataPromise","modulesDataPromise","bodyPromiseResolver","bodyPromise","Promise","resolve","exporter","Exporter","footerData","footerPromise","Templates","render","getFooterData","sectionModal","Modal","create","body","title","footer","large","scrollable","templateContext","classes","show","modulesData","modal","ActivityChooserDialogue","templateData","getModChooserTemplateData","error","errorTemplateData","message","modalPromise","sectionModules","partialFavourite","window","console","warn","then","catch","Notification","exception","constructor","dialogueDom","selectedModule","isFavouriteTabDirty","mappedModules","Map","forEach","module","set","componentname","link","init","this","getBodyPromise","getFooterPromise","DialogueDom","registerModalListenerEvents","setupKeyboardAccessibility","getRoot","on","ModalEvents","hidden","destroy","unmarkAllChooserOptionAsSelected","modalRoot","addEventListener","event","target","closest","selectors","regions","allTabNav","searchInput","getSearchInputElement","value","length","toggleSearchResultsView","handleModalClick","bind","handleModalDoubleClick","pending","initBootstrapComponents","relatedTarget","disableFocusAllChooserOptions","initActiveTabNavigation","isFavoutiteTabActive","refreshFavouritesTabContent","handleFooterClick","undefined","to","toggleActiveFooter","toggleBackButton","toggleAddButton","actions","addSelectedChooserOption","submitAddSelectedModule","activeFooter","footerjs","pluginName","customfooterjs","footerClickListener","optionActions","showSummary","preventDefault","handleShowSummary","displayCategory","handleDisplayCategory","manageFavourite","handleFavouriteClick","matches","closeOption","hideModuleHelp","dataset","modname","clearSearch","handleClearSearch","chooserOption","info","handleOptionSelection","getClosestChooserOption","moduleName","moduleData","get","showFooter","hasFooterContent","setBackButtonModuleData","showModuleHelp","category","tabNav","showCategoryTab","focus","scrollIntoView","caller","id","name","internal","favourited","Repository","unfavouriteModule","updateFavouriteItemValue","favouriteModule","option","markChooserOptionAsSelected","getFooter","newSelectedModule","location","href","getChooserOptionUrl","mainElement","getModal","tabIndex","e","currentOption","keyCode","enter","space","arrowRight","focusNextChooserOption","arrowLeft","focusPreviousChooserOption","home","focusFirstChooserOption","end","focusLastChooserOption","searchQuery","searchResultsData","searchModules","refreshSearchResults","showAllActivitiesTab","cleanSearchResults","searchTerm","toLowerCase","searchResults","activity","activityName","activityDesc","help","includes","push","favourite","moduleItem","find","_ref","updateItemStarredIcons","favouriteCount","filter","mod","size","toggleFavouriteTabDisplay"],"mappings":"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"}