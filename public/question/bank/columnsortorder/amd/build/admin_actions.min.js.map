{"version":3,"file":"admin_actions.min.js","sources":["../src/admin_actions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript for handling actions on the admin page\r\n *\r\n * @module     qbank_columnsortorder/admin_actions\r\n * @copyright  2023 onwards Catalyst IT Europe Ltd\r\n * @author     Mark Johnson <mark.johnson@catalyst-eu.net>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport * as actions from 'qbank_columnsortorder/actions';\r\nimport * as repository from 'qbank_columnsortorder/repository';\r\nimport Notification from \"core/notification\";\r\nimport Pending from 'core/pending';\r\n\r\n/**\r\n * Event handler to save the custom column widths when a field is edited.\r\n *\r\n * @param {Element} listRoot The root element of the list of columns.\r\n */\r\nconst setupSaveWidths = listRoot => {\r\n    listRoot.addEventListener('change', async() => {\r\n        const pendingPromise = new Pending('saveWidths');\r\n        const columns = listRoot.querySelectorAll(actions.SELECTORS.sortableColumn);\r\n        const widths = [];\r\n        columns.forEach(column => {\r\n            const widthInput = column.querySelector('.width-input');\r\n            const valid = widthInput.checkValidity();\r\n            widthInput.closest('.has-validation').classList.add('was-validated');\r\n            if (!valid) {\r\n                return;\r\n            }\r\n            widths.push({\r\n                column: column.dataset.columnid,\r\n                width: widthInput.value,\r\n            });\r\n        });\r\n        await repository.setColumnSize(JSON.stringify(widths), true).catch(Notification.exception);\r\n        pendingPromise.resolve();\r\n    });\r\n};\r\n\r\n/**\r\n * Initialize module\r\n *\r\n * Set up event handlers for the action buttons, width fields and initialise column sorting.\r\n *\r\n * @param {String} id ID for the admin UI root element.\r\n */\r\nexport const init = id => {\r\n    const uiRoot = document.getElementById(id);\r\n    const listRoot = uiRoot.querySelector(actions.SELECTORS.columnList);\r\n    actions.setupSortableLists(listRoot, true, true);\r\n    actions.setupActionButtons(uiRoot, true);\r\n    setupSaveWidths(listRoot);\r\n};\r\n"],"names":["id","uiRoot","document","getElementById","listRoot","querySelector","actions","SELECTORS","columnList","setupSortableLists","setupActionButtons","addEventListener","async","pendingPromise","Pending","columns","querySelectorAll","sortableColumn","widths","forEach","column","widthInput","valid","checkValidity","closest","classList","add","push","dataset","columnid","width","value","repository","setColumnSize","JSON","stringify","catch","Notification","exception","resolve","setupSaveWidths"],"mappings":";;;;;;;;sRA+DoBA,WACVC,OAASC,SAASC,eAAeH,IACjCI,SAAWH,OAAOI,cAAcC,QAAQC,UAAUC,YACxDF,QAAQG,mBAAmBL,UAAU,GAAM,GAC3CE,QAAQI,mBAAmBT,QAAQ,GAjCfG,CAAAA,WACpBA,SAASO,iBAAiB,UAAUC,gBAC1BC,eAAiB,IAAIC,iBAAQ,cAC7BC,QAAUX,SAASY,iBAAiBV,QAAQC,UAAUU,gBACtDC,OAAS,GACfH,QAAQI,SAAQC,eACNC,WAAaD,OAAOf,cAAc,gBAClCiB,MAAQD,WAAWE,gBACzBF,WAAWG,QAAQ,mBAAmBC,UAAUC,IAAI,iBAC/CJ,OAGLJ,OAAOS,KAAK,CACRP,OAAQA,OAAOQ,QAAQC,SACvBC,MAAOT,WAAWU,iBAGpBC,WAAWC,cAAcC,KAAKC,UAAUjB,SAAS,GAAMkB,MAAMC,sBAAaC,WAChFzB,eAAe0B,cAgBnBC,CAAgBpC"}