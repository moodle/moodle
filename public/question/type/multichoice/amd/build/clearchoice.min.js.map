{"version":3,"file":"clearchoice.min.js","sources":["../src/clearchoice.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Manages 'Clear my choice' functionality actions.\r\n *\r\n * @module     qtype_multichoice/clearchoice\r\n * @copyright  2019 Simey Lameze <simey@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @since      3.7\r\n */\r\ndefine(['jquery', 'core/custom_interaction_events'], function($, CustomEvents) {\r\n\r\n    var SELECTORS = {\r\n        CHOICE_ELEMENT: '.answer input',\r\n        LINK: 'a',\r\n        RADIO: 'input[type=\"radio\"]'\r\n    };\r\n\r\n    /**\r\n     * Mark clear choice radio as enabled and checked.\r\n     *\r\n     * @param {Object} clearChoiceContainer The clear choice option container.\r\n     */\r\n    var checkClearChoiceRadio = function(clearChoiceContainer) {\r\n        clearChoiceContainer.find(SELECTORS.RADIO).prop('disabled', false).prop('checked', true);\r\n    };\r\n\r\n    /**\r\n     * Get the clear choice div container.\r\n     *\r\n     * @param {Object} root The question root element.\r\n     * @param {string} fieldPrefix The question outer div prefix.\r\n     * @returns {Object} The clear choice div container.\r\n     */\r\n    var getClearChoiceElement = function(root, fieldPrefix) {\r\n        return root.find('div[id=\"' + fieldPrefix + '\"]');\r\n    };\r\n\r\n    /**\r\n     * Hide clear choice option.\r\n     *\r\n     * @param {Object} clearChoiceContainer The clear choice option container.\r\n     */\r\n    var hideClearChoiceOption = function(clearChoiceContainer) {\r\n        // We are using .visually-hidden and aria-hidden together so while the element is hidden\r\n        // from both the monitor and the screen-reader, it is still tabbable.\r\n        clearChoiceContainer.addClass('visually-hidden');\r\n        clearChoiceContainer.attr('aria-hidden', true);\r\n        clearChoiceContainer.find(SELECTORS.LINK).attr('tabindex', -1);\r\n    };\r\n\r\n    /**\r\n     * Shows clear choice option.\r\n     *\r\n     * @param {Object} clearChoiceContainer The clear choice option container.\r\n     */\r\n    var showClearChoiceOption = function(clearChoiceContainer) {\r\n        clearChoiceContainer.removeClass('visually-hidden');\r\n        clearChoiceContainer.removeAttr('aria-hidden');\r\n        clearChoiceContainer.find(SELECTORS.LINK).attr('tabindex', 0);\r\n        clearChoiceContainer.find(SELECTORS.RADIO).prop('disabled', true);\r\n    };\r\n\r\n    /**\r\n     * Register event listeners for the clear choice module.\r\n     *\r\n     * @param {Object} root The question outer div prefix.\r\n     * @param {string} fieldPrefix The \"Clear choice\" div prefix.\r\n     */\r\n    var registerEventListeners = function(root, fieldPrefix) {\r\n        var clearChoiceContainer = getClearChoiceElement(root, fieldPrefix);\r\n\r\n        clearChoiceContainer.on(CustomEvents.events.activate, SELECTORS.LINK, function(e, data) {\r\n\r\n                // Mark the clear choice radio element as checked.\r\n                checkClearChoiceRadio(clearChoiceContainer);\r\n                // Now that the hidden radio has been checked, hide the clear choice option.\r\n                hideClearChoiceOption(clearChoiceContainer);\r\n\r\n                data.originalEvent.preventDefault();\r\n        });\r\n\r\n        root.on('change', SELECTORS.CHOICE_ELEMENT, function() {\r\n            // If the event has been triggered by any other choice, show the clear choice option.\r\n            showClearChoiceOption(clearChoiceContainer);\r\n        });\r\n\r\n        // If the clear choice radio receives focus from using the tab key, return the focus\r\n        // to the first answer option.\r\n        clearChoiceContainer.find(SELECTORS.RADIO).focus(function() {\r\n            var firstChoice = root.find(SELECTORS.CHOICE_ELEMENT).first();\r\n            firstChoice.focus();\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Initialise clear choice module.\r\n     *\r\n     * @param {string} root The question outer div prefix.\r\n     * @param {string} fieldPrefix The \"Clear choice\" div prefix.\r\n     */\r\n    var init = function(root, fieldPrefix) {\r\n        root = $('#' + root);\r\n        registerEventListeners(root, fieldPrefix);\r\n    };\r\n\r\n    return {\r\n        init: init\r\n    };\r\n});\r\n"],"names":["define","$","CustomEvents","SELECTORS","registerEventListeners","root","fieldPrefix","clearChoiceContainer","find","getClearChoiceElement","on","events","activate","e","data","prop","checkClearChoiceRadio","addClass","attr","hideClearChoiceOption","originalEvent","preventDefault","removeClass","removeAttr","showClearChoiceOption","focus","first","init"],"mappings":";;;;;;;;AAuBAA,uCAAO,CAAC,SAAU,mCAAmC,SAASC,EAAGC,kBAEzDC,yBACgB,gBADhBA,eAEM,IAFNA,gBAGO,sBAsDPC,uBAAyB,SAASC,KAAMC,iBACpCC,qBApCoB,SAASF,KAAMC,oBAChCD,KAAKG,KAAK,WAAaF,YAAc,MAmCjBG,CAAsBJ,KAAMC,aAEvDC,qBAAqBG,GAAGR,aAAaS,OAAOC,SAAUT,gBAAgB,SAASU,EAAGC,OAjD1D,SAASP,sBACjCA,qBAAqBC,KAAKL,iBAAiBY,KAAK,YAAY,GAAOA,KAAK,WAAW,GAmD3EC,CAAsBT,sBAhCN,SAASA,sBAGjCA,qBAAqBU,SAAS,mBAC9BV,qBAAqBW,KAAK,eAAe,GACzCX,qBAAqBC,KAAKL,gBAAgBe,KAAK,YAAa,GA6BpDC,CAAsBZ,sBAEtBO,KAAKM,cAAcC,oBAG3BhB,KAAKK,GAAG,SAAUP,0BAA0B,YA1BpB,SAASI,sBACjCA,qBAAqBe,YAAY,mBACjCf,qBAAqBgB,WAAW,eAChChB,qBAAqBC,KAAKL,gBAAgBe,KAAK,WAAY,GAC3DX,qBAAqBC,KAAKL,iBAAiBY,KAAK,YAAY,GAwBxDS,CAAsBjB,yBAK1BA,qBAAqBC,KAAKL,iBAAiBsB,OAAM,WAC3BpB,KAAKG,KAAKL,0BAA0BuB,QAC1CD,kBAeb,CACHE,KANO,SAAStB,KAAMC,aACtBD,KAAOJ,EAAE,IAAMI,MACfD,uBAAuBC,KAAMC"}