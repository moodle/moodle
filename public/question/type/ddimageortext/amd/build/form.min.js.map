{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/*\r\n * JavaScript to allow dragging options to slots (using mouse down or touch) or tab through slots using keyboard.\r\n *\r\n * @module     qtype_ddimageortext/form\r\n * @copyright  2018 The Open University\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(['jquery', 'core/dragdrop'], function($, dragDrop) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Singleton object to handle progressive enhancement of the\r\n     * drag-drop onto image question editing form.\r\n     * @type {Object}\r\n     */\r\n    var dragDropToImageForm = {\r\n        /**\r\n         * @var {Object} maxBgImageSize Properties width and height.\r\n         * @private\r\n         */\r\n        maxBgImageSize: null,\r\n\r\n        /**\r\n         * @var {Object} maxDragImageSize with properties width and height.\r\n         * @private\r\n         */\r\n        maxDragImageSize: null,\r\n\r\n        /**\r\n         * @property {object} fp for interacting with the file pickers.\r\n         * @private\r\n         */\r\n        fp: null, // Object containing functions associated with the file picker.\r\n\r\n        /**\r\n         * Initialise the form javascript features.\r\n         *\r\n         * @method\r\n         */\r\n        init: function() {\r\n            dragDropToImageForm.fp = dragDropToImageForm.filePickers();\r\n            dragDropToImageForm.updateVisibilityOfFilePickers();\r\n            dragDropToImageForm.setOptionsForDragItemSelectors();\r\n            dragDropToImageForm.setupEventHandlers();\r\n            dragDropToImageForm.waitForFilePickerToInitialise();\r\n        },\r\n\r\n        /**\r\n         * Add html for the preview area.\r\n         */\r\n        setupPreviewArea: function() {\r\n            $('#id_previewareaheader').append(\r\n                '<div class=\"ddarea que ddimageortext\">' +\r\n                '  <div id=\"id_droparea\" class=\"droparea\">' +\r\n                '    <img class=\"dropbackground\" />' +\r\n                '    <div class=\"dropzones\"></div>' +\r\n                '  </div>' +\r\n                '  <div class=\"dragitems\"></div>' +\r\n                '</div>');\r\n        },\r\n\r\n        /**\r\n         * Waits for the file-pickers to be sufficiently ready before initialising the preview.\r\n         */\r\n        waitForFilePickerToInitialise: function() {\r\n            if (dragDropToImageForm.fp.file('bgimage').href === null) {\r\n                // It would be better to use an onload or onchange event rather than this timeout.\r\n                // Unfortunately attempts to do this early are overwritten by filepicker during its loading.\r\n                setTimeout(dragDropToImageForm.waitForFilePickerToInitialise, 1000);\r\n                return;\r\n            }\r\n            M.util.js_pending('dragDropToImageForm');\r\n\r\n            // From now on, when a new file gets loaded into the filepicker, update the preview.\r\n            // This is not in the setupEventHandlers section as it needs to be delayed until\r\n            // after filepicker's javascript has finished.\r\n            $('form.mform[data-qtype=\"ddimageortext\"]').on('change', '.filepickerhidden', function() {\r\n                M.util.js_pending('dragDropToImageForm');\r\n                dragDropToImageForm.loadPreviewImage();\r\n            });\r\n            if ($('#id_droparea').length) {\r\n                dragDropToImageForm.loadPreviewImage();\r\n            } else {\r\n                // Setup preview area when the background image is uploaded the first time.\r\n                dragDropToImageForm.setupPreviewArea();\r\n                dragDropToImageForm.loadPreviewImage();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Loads the preview background image.\r\n         */\r\n        loadPreviewImage: function() {\r\n            $('fieldset#id_previewareaheader .dropbackground')\r\n                .one('load', dragDropToImageForm.afterPreviewImageLoaded)\r\n                .attr('src', dragDropToImageForm.fp.file('bgimage').href);\r\n        },\r\n\r\n        /**\r\n         * After the background image is loaded, continue setting up the preview.\r\n         */\r\n        afterPreviewImageLoaded: function() {\r\n            dragDropToImageForm.createDropZones();\r\n            M.util.js_complete('dragDropToImageForm');\r\n        },\r\n\r\n        /**\r\n         * Create, or recreate all the drop zones.\r\n         */\r\n        createDropZones: function() {\r\n            var dropZoneHolder = $('.dropzones');\r\n            dropZoneHolder.empty();\r\n\r\n            var bgimageurl = dragDropToImageForm.fp.file('bgimage').href;\r\n            if (bgimageurl === null) {\r\n                return; // There is not currently a valid preview to update.\r\n            }\r\n\r\n            var numDrops = dragDropToImageForm.form.getFormValue('nodropzone', []);\r\n            var dropzonevisibility = dragDropToImageForm.form.getFormValue('dropzonevisibility', []);\r\n            var dropzonevisibilitystyle = dropzonevisibility === '1' ? 'background: transparent;' : '';\r\n            for (var dropNo = 0; dropNo < numDrops; dropNo++) {\r\n                var dragNo = dragDropToImageForm.form.getFormValue('drops', [dropNo, 'choice']);\r\n                if (dragNo === '0') {\r\n                    continue;\r\n                }\r\n                dragNo = dragNo - 1;\r\n                var group = dragDropToImageForm.form.getFormValue('drags', [dragNo, 'draggroup']),\r\n                    label = dragDropToImageForm.form.getFormValue('draglabel', [dragNo]);\r\n                if ('image' === dragDropToImageForm.form.getFormValue('drags', [dragNo, 'dragitemtype'])) {\r\n                    var imgUrl = dragDropToImageForm.fp.file('dragitem[' + dragNo + ']').href;\r\n                    if (imgUrl === null) {\r\n                        continue;\r\n                    }\r\n                    // Althoug these are previews of drops, we also add the class name 'drag',\r\n                    dropZoneHolder.append('<img class=\"droppreview group' + group + ' drop' + dropNo +\r\n                        '\" src=\"' + imgUrl + '\" alt=\"' + label + '\" data-drop-no=\"' + dropNo +\r\n                        '\" style=\"' + dropzonevisibilitystyle + '\" >');\r\n\r\n                } else if (label !== '') {\r\n                    dropZoneHolder.append('<div class=\"droppreview group' + group + ' drop' + dropNo +\r\n                        '\"  data-drop-no=\"' + dropNo + '\">' + label + '</div>');\r\n                }\r\n            }\r\n\r\n            dragDropToImageForm.waitForAllDropImagesToBeLoaded();\r\n        },\r\n\r\n        /**\r\n         * This polls until all the drop-zone images have loaded, and then calls updateDropZones().\r\n         */\r\n        waitForAllDropImagesToBeLoaded: function() {\r\n            var notYetLoadedImages = $('.dropzones img').not(function(i, imgNode) {\r\n                return dragDropToImageForm.imageIsLoaded(imgNode);\r\n            });\r\n\r\n            if (notYetLoadedImages.length > 0) {\r\n                setTimeout(function() {\r\n                    dragDropToImageForm.waitForAllDropImagesToBeLoaded();\r\n                }, 100);\r\n                return;\r\n            }\r\n\r\n            dragDropToImageForm.updateDropZones();\r\n        },\r\n\r\n        /**\r\n         * Check if an image has loaded without errors.\r\n         *\r\n         * @param {HTMLImageElement} imgElement an image.\r\n         * @returns {boolean} true if this image has loaded without errors.\r\n         */\r\n        imageIsLoaded: function(imgElement) {\r\n            return imgElement.complete && imgElement.naturalHeight !== 0;\r\n        },\r\n\r\n        /**\r\n         * Set the size and position of all the drop zones.\r\n         */\r\n        updateDropZones: function() {\r\n            var bgimageurl = dragDropToImageForm.fp.file('bgimage').href;\r\n            if (bgimageurl === null) {\r\n                return; // There is not currently a valid preview to update.\r\n            }\r\n\r\n            var dropBackgroundPosition = $('fieldset#id_previewareaheader .dropbackground').offset(),\r\n                numDrops = dragDropToImageForm.form.getFormValue('nodropzone', []);\r\n\r\n            // Move each drop to the right position and update the text.\r\n            for (var dropNo = 0; dropNo < numDrops; dropNo++) {\r\n                var drop = $('.dropzones .drop' + dropNo);\r\n                if (drop.length === 0) {\r\n                    continue;\r\n                }\r\n                var dragNo = dragDropToImageForm.form.getFormValue('drops', [dropNo, 'choice']) - 1;\r\n\r\n                drop.offset({\r\n                    left: dropBackgroundPosition.left +\r\n                            parseInt(dragDropToImageForm.form.getFormValue('drops', [dropNo, 'xleft'])),\r\n                    top: dropBackgroundPosition.top +\r\n                            parseInt(dragDropToImageForm.form.getFormValue('drops', [dropNo, 'ytop']))\r\n                });\r\n\r\n                var label = dragDropToImageForm.form.getFormValue('draglabel', [dragNo]);\r\n                if (drop.is('img')) {\r\n                    drop.attr('alt', label);\r\n                } else {\r\n                    drop.html(label);\r\n                }\r\n            }\r\n\r\n            // Resize them to the same size.\r\n            $('.dropzones .droppreview').css('padding', '0');\r\n            var numGroups = $('.draggroup select').first().find('option').length;\r\n            for (var group = 1; group <= numGroups; group++) {\r\n                dragDropToImageForm.resizeAllDragsAndDropsInGroup(group);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * In a given group, set all the drags and drops to be the same size.\r\n         *\r\n         * @param {int} group the group number.\r\n         */\r\n        resizeAllDragsAndDropsInGroup: function(group) {\r\n            var drops = $('.dropzones .droppreview.group' + group),\r\n                maxWidth = 0,\r\n                maxHeight = 0;\r\n\r\n            // Find the maximum size of any drag in this groups.\r\n            drops.each(function(i, drop) {\r\n                maxWidth = Math.max(maxWidth, Math.ceil(drop.offsetWidth));\r\n                maxHeight = Math.max(maxHeight, Math.ceil(drop.offsetHeight));\r\n            });\r\n\r\n            // The size we will want to set is a bit bigger than this.\r\n            maxWidth += 10;\r\n            maxHeight += 10;\r\n\r\n            // Set each drag home to that size.\r\n            drops.each(function(i, drop) {\r\n                var left = Math.round((maxWidth - drop.offsetWidth) / 2),\r\n                    top = Math.floor((maxHeight - drop.offsetHeight) / 2);\r\n                // Set top and left padding so the item is centred.\r\n                $(drop).css({\r\n                    'padding-left': left + 'px',\r\n                    'padding-right': (maxWidth - drop.offsetWidth - left) + 'px',\r\n                    'padding-top': top + 'px',\r\n                    'padding-bottom': (maxHeight - drop.offsetHeight - top) + 'px'\r\n                });\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Events linked to form actions.\r\n         */\r\n        setupEventHandlers: function() {\r\n            // Changes to settings in the draggable items section.\r\n            $('fieldset#id_draggableitemheader')\r\n                .on('change input', 'input, select', function(e) {\r\n                    var input = $(e.target).closest('select, input');\r\n                    if (input.hasClass('dragitemtype')) {\r\n                        dragDropToImageForm.updateVisibilityOfFilePickers();\r\n                    }\r\n\r\n                    dragDropToImageForm.setOptionsForDragItemSelectors();\r\n\r\n                    if (input.is('.dragitemtype, .draggroup')) {\r\n                        dragDropToImageForm.createDropZones();\r\n                    } else if (input.is('.draglabel')) {\r\n                        dragDropToImageForm.updateDropZones();\r\n                    }\r\n                });\r\n\r\n            // Changes to Drop zones section: left, top and drag item.\r\n            $('fieldset#id_dropzoneheader').on('change input', 'input, select', function(e) {\r\n                var input = $(e.target).closest('select, input');\r\n                if (input.attr('id') === 'id_dropzonevisibility') {\r\n                    return;\r\n                }\r\n\r\n                if (input.is('select')) {\r\n                    dragDropToImageForm.createDropZones();\r\n                } else {\r\n                    dragDropToImageForm.updateDropZones();\r\n                }\r\n            });\r\n\r\n            // Moving drop zones in the preview.\r\n            $('fieldset#id_previewareaheader').on('mousedown touchstart', '.droppreview', function(e) {\r\n                dragDropToImageForm.dragStart(e);\r\n            });\r\n\r\n            $(window).on('resize', function() {\r\n                dragDropToImageForm.updateDropZones();\r\n            });\r\n\r\n            $('#id_dropzonevisibility').on('change', function() {\r\n                let selectedvalue = $(this).val();\r\n                if (selectedvalue === \"1\") {\r\n                    $('.droppreview').css('background', 'transparent');\r\n                } else if (selectedvalue === \"0\") {\r\n                    $('.droppreview').css('background', '');\r\n                }\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Update all the drag item filepickers, so they are only shown for\r\n         */\r\n        updateVisibilityOfFilePickers: function() {\r\n            var numDrags = dragDropToImageForm.form.getFormValue('noitems', []);\r\n            for (var dragNo = 0; dragNo < numDrags; dragNo++) {\r\n                var picker = $('input#id_dragitem_' + dragNo).closest('.fitem_ffilepicker');\r\n                if ('image' === dragDropToImageForm.form.getFormValue('drags', [dragNo, 'dragitemtype'])) {\r\n                    picker.show();\r\n                } else {\r\n                    picker.hide();\r\n                }\r\n            }\r\n        },\r\n\r\n\r\n        setOptionsForDragItemSelectors: function() {\r\n            var dragItemOptions = {'0': ''},\r\n                numDrags = dragDropToImageForm.form.getFormValue('noitems', []),\r\n                numDrops = dragDropToImageForm.form.getFormValue('nodropzone', []);\r\n\r\n            // Work out the list of options.\r\n            for (var dragNo = 0; dragNo < numDrags; dragNo++) {\r\n                var label = dragDropToImageForm.form.getFormValue('draglabel', [dragNo]);\r\n                var file = dragDropToImageForm.fp.file(dragDropToImageForm.form.toNameWithIndex('dragitem', [dragNo]));\r\n                if ('image' === dragDropToImageForm.form.getFormValue('drags', [dragNo, 'dragitemtype']) && file.name !== null) {\r\n                    dragItemOptions[dragNo + 1] = (dragNo + 1) + '. ' + label + ' (' + file.name + ')';\r\n                } else if (label !== '') {\r\n                    dragItemOptions[dragNo + 1] = (dragNo + 1) + '. ' + label;\r\n                }\r\n            }\r\n\r\n            // Initialise each select.\r\n            for (var dropNo = 0; dropNo < numDrops; dropNo++) {\r\n                var selector = $('#id_drops_' + dropNo + '_choice');\r\n\r\n                var selectedvalue = selector.val();\r\n                selector.find('option').remove();\r\n                for (var value in dragItemOptions) {\r\n                    if (!dragItemOptions.hasOwnProperty(value)) {\r\n                        continue;\r\n                    }\r\n                    selector.append('<option value=\"' + value + '\">' + dragItemOptions[value] + '</option>');\r\n                    var optionnode = selector.find('option[value=\"' + value + '\"]');\r\n                    if (parseInt(value) === parseInt(selectedvalue)) {\r\n                        optionnode.attr('selected', true);\r\n                    } else if (dragDropToImageForm.isItemUsed(parseInt(value))) {\r\n                        optionnode.attr('disabled', true);\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Checks if the specified drag option is already used somewhere.\r\n         *\r\n         * @param {Number} value of the drag item to check\r\n         * @return {Boolean} true if item is allocated to dropzone\r\n         */\r\n        isItemUsed: function(value) {\r\n            if (value === 0) {\r\n                return false; // None option can always be selected.\r\n            }\r\n\r\n            if (dragDropToImageForm.form.getFormValue('drags', [value - 1, 'infinite'])) {\r\n                return false; // Infinite, so can't be used up.\r\n            }\r\n\r\n            return $('fieldset#id_dropzoneheader select[name^=\"drops\"]').filter(function(i, selectNode) {\r\n                return parseInt($(selectNode).val()) === value;\r\n            }).length !== 0;\r\n        },\r\n\r\n        /**\r\n         * Handles when a dropzone in dragged in the preview.\r\n         * @param {Object} e Event object\r\n         */\r\n        dragStart: function(e) {\r\n            var drop = $(e.target).closest('.droppreview');\r\n\r\n            var info = dragDrop.prepare(e);\r\n            if (!info.start) {\r\n                return;\r\n            }\r\n\r\n            dragDrop.start(e, drop, function(x, y, drop) {\r\n                dragDropToImageForm.dragMove(drop);\r\n            }, function() {\r\n                dragDropToImageForm.dragEnd();\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Handles update while a drop is being dragged.\r\n         *\r\n         * @param {jQuery} drop the drop preview being moved.\r\n         */\r\n        dragMove: function(drop) {\r\n            var backgroundImage = $('fieldset#id_previewareaheader .dropbackground'),\r\n                backgroundPosition = backgroundImage.offset(),\r\n                dropNo = drop.data('dropNo'),\r\n                dropPosition = drop.offset(),\r\n                left = Math.round(dropPosition.left - backgroundPosition.left),\r\n                top = Math.round(dropPosition.top - backgroundPosition.top);\r\n\r\n            // Constrain coordinates to be inside the background.\r\n            left = Math.round(Math.max(0, Math.min(left, backgroundImage.outerWidth() - drop.outerWidth())));\r\n            top = Math.round(Math.max(0, Math.min(top, backgroundImage.outerHeight() - drop.outerHeight())));\r\n\r\n            // Update the form.\r\n            dragDropToImageForm.form.setFormValue('drops', [dropNo, 'xleft'], left);\r\n            dragDropToImageForm.form.setFormValue('drops', [dropNo, 'ytop'], top);\r\n        },\r\n\r\n        /**\r\n         * Handles when the drag ends.\r\n         */\r\n        dragEnd: function() {\r\n            // Redraw, in case the position was constrained.\r\n            dragDropToImageForm.updateDropZones();\r\n        },\r\n\r\n        /**\r\n         * Low level operations on form.\r\n         */\r\n        form: {\r\n            toNameWithIndex: function(name, indexes) {\r\n                var indexString = name;\r\n                for (var i = 0; i < indexes.length; i++) {\r\n                    indexString = indexString + '[' + indexes[i] + ']';\r\n                }\r\n                return indexString;\r\n            },\r\n\r\n            getEl: function(name, indexes) {\r\n                var form = $('form.mform[data-qtype=\"ddimageortext\"]')[0];\r\n                return form.elements[this.toNameWithIndex(name, indexes)];\r\n            },\r\n\r\n            /**\r\n             * Helper to get the value of a form elements with name like \"drops[0][xleft]\".\r\n             *\r\n             * @param {String} name the base name, e.g. 'drops'.\r\n             * @param {String[]} indexes the indexes, e.g. ['0', 'xleft'].\r\n             * @return {String} the value of that field.\r\n             */\r\n            getFormValue: function(name, indexes) {\r\n                var el = this.getEl(name, indexes);\r\n                if (!el.type) {\r\n                    el = el[el.length - 1];\r\n                }\r\n                if (el.type === 'checkbox') {\r\n                    return el.checked;\r\n                } else {\r\n                    return el.value;\r\n                }\r\n            },\r\n\r\n            /**\r\n             * Helper to get the value of a form elements with name like \"drops[0][xleft]\".\r\n             *\r\n             * @param {String} name the base name, e.g. 'drops'.\r\n             * @param {String[]} indexes the indexes, e.g. ['0', 'xleft'].\r\n             * @param {String|Number} value the value to set.\r\n             */\r\n            setFormValue: function(name, indexes, value) {\r\n                var el = this.getEl(name, indexes);\r\n                if (el.type === 'checkbox') {\r\n                    el.checked = value;\r\n                } else {\r\n                    el.value = value;\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Utility to get the file name and url from the filepicker.\r\n         * @returns {Object} object containing functions {file, name}\r\n         */\r\n        filePickers: function() {\r\n            var draftItemIdsToName;\r\n            var nameToParentNode;\r\n\r\n            if (draftItemIdsToName === undefined) {\r\n                draftItemIdsToName = {};\r\n                nameToParentNode = {};\r\n                var fp = $('form.mform[data-qtype=\"ddimageortext\"] input.filepickerhidden');\r\n                fp.each(function(index, filepicker) {\r\n                    draftItemIdsToName[filepicker.value] = filepicker.name;\r\n                    nameToParentNode[filepicker.name] = filepicker.parentNode;\r\n                });\r\n            }\r\n\r\n            return {\r\n                file: function(name) {\r\n                    var parentNode = $(nameToParentNode[name]);\r\n                    var fileAnchor = parentNode.find('div.filepicker-filelist a');\r\n                    if (fileAnchor.length) {\r\n                        return {href: fileAnchor.get(0).href, name: fileAnchor.get(0).innerHTML};\r\n                    } else {\r\n                        return {href: null, name: null};\r\n                    }\r\n                },\r\n\r\n                name: function(draftitemid) {\r\n                    return draftItemIdsToName[draftitemid];\r\n                }\r\n            };\r\n        }\r\n    };\r\n\r\n    return {\r\n        init: dragDropToImageForm.init\r\n    };\r\n});\r\n"],"names":["define","$","dragDrop","dragDropToImageForm","maxBgImageSize","maxDragImageSize","fp","init","filePickers","updateVisibilityOfFilePickers","setOptionsForDragItemSelectors","setupEventHandlers","waitForFilePickerToInitialise","setupPreviewArea","append","file","href","M","util","js_pending","on","loadPreviewImage","length","setTimeout","one","afterPreviewImageLoaded","attr","createDropZones","js_complete","dropZoneHolder","empty","numDrops","form","getFormValue","dropzonevisibilitystyle","dropNo","dragNo","group","label","imgUrl","waitForAllDropImagesToBeLoaded","not","i","imgNode","imageIsLoaded","updateDropZones","imgElement","complete","naturalHeight","dropBackgroundPosition","offset","drop","left","parseInt","top","is","html","css","numGroups","first","find","resizeAllDragsAndDropsInGroup","drops","maxWidth","maxHeight","each","Math","max","ceil","offsetWidth","offsetHeight","round","floor","e","input","target","closest","hasClass","dragStart","window","selectedvalue","this","val","numDrags","picker","show","hide","dragItemOptions","toNameWithIndex","name","selector","value","remove","hasOwnProperty","optionnode","isItemUsed","filter","selectNode","prepare","start","x","y","dragMove","dragEnd","backgroundImage","backgroundPosition","data","dropPosition","min","outerWidth","outerHeight","setFormValue","indexes","indexString","getEl","elements","el","type","checked","draftItemIdsToName","nameToParentNode","undefined","index","filepicker","parentNode","fileAnchor","get","innerHTML","draftitemid"],"mappings":"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"}