{"version":3,"file":"questioncount.min.js","sources":["../src/questioncount.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Question count badge with asynchronous loading.\n *\n * @module     core_question/questioncount\n * @copyright  2024 Catalyst IT Europe Ltd.\n * @author     Mark Johnson <mark.johnson@catalyst-eu.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {getString} from 'core/str';\nimport Fetch from 'core/fetch';\nimport Notification from 'core/notification';\nimport LoadingIcon from 'core/loadingicon';\n\nconst SELECTORS = {\n    COUNT_CONTAINER: '.questioncount',\n    COUNT_BADGE: (cmid) => `.questioncount[data-cmid='${cmid}'] .badge`,\n};\n\nexport const fetchCounts = async(courseId) => {\n    const countContainer = document.querySelector(SELECTORS.COUNT_CONTAINER);\n    const endpoint = ['bank', courseId, 'question_counts'];\n    const loadingPromise = LoadingIcon.addIconToContainerWithPromise(countContainer);\n    try {\n        const response = await Fetch.performGet('core_question', endpoint.join('/'));\n        const questionCounts = await response.json();\n        for (const [cmid, count] of Object.entries(questionCounts.counts)) {\n            const countBadge = document.querySelector(SELECTORS.COUNT_BADGE(cmid));\n            if (countBadge) {\n                countBadge.innerText = await getString('questioncount', 'question', count);\n                countBadge.classList.remove('d-none');\n            }\n        }\n    } catch (ex) {\n        if (typeof ex === 'string') {\n            Notification.alert(getString('error', 'error'), ex);\n        } else {\n            Notification.exception(ex);\n        }\n    } finally {\n        loadingPromise.resolve();\n    }\n};\n"],"names":["SELECTORS","cmid","async","countContainer","document","querySelector","endpoint","courseId","loadingPromise","LoadingIcon","addIconToContainerWithPromise","response","Fetch","performGet","join","questionCounts","json","count","Object","entries","counts","countBadge","innerText","classList","remove","ex","alert","exception","resolve"],"mappings":";;;;;;;;2OA6BMA,0BACe,iBADfA,sBAEYC,0CAAsCA,uCAG7BC,MAAAA,iBACjBC,eAAiBC,SAASC,cAAcL,2BACxCM,SAAW,CAAC,OAAQC,SAAU,mBAC9BC,eAAiBC,qBAAYC,8BAA8BP,0BAEvDQ,eAAiBC,eAAMC,WAAW,gBAAiBP,SAASQ,KAAK,MACjEC,qBAAuBJ,SAASK,WACjC,MAAOf,KAAMgB,SAAUC,OAAOC,QAAQJ,eAAeK,QAAS,OACzDC,WAAajB,SAASC,cAAcL,sBAAsBC,OAC5DoB,aACAA,WAAWC,gBAAkB,kBAAU,gBAAiB,WAAYL,OACpEI,WAAWE,UAAUC,OAAO,YAGtC,MAAOC,IACa,iBAAPA,yBACMC,OAAM,kBAAU,QAAS,SAAUD,0BAEnCE,UAAUF,YAG3BjB,eAAeoB"}