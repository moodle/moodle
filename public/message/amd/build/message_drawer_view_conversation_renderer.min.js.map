{"version":3,"file":"message_drawer_view_conversation_renderer.min.js","sources":["../src/message_drawer_view_conversation_renderer.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * This module updates the UI for the conversation page in the message\r\n * drawer.\r\n *\r\n * The module will take a patch from the message_drawer_view_conversation_patcher\r\n * module and update the UI to reflect the changes.\r\n *\r\n * This is the only module that ever modifies the UI of the conversation page.\r\n *\r\n * @module     core_message/message_drawer_view_conversation_renderer\r\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(\r\n[\r\n    'jquery',\r\n    'core/notification',\r\n    'core/str',\r\n    'core/templates',\r\n    'core/user_date',\r\n    'core_message/message_drawer_view_conversation_constants',\r\n    'core/aria',\r\n    'core/truncate',\r\n],\r\nfunction(\r\n    $,\r\n    Notification,\r\n    Str,\r\n    Templates,\r\n    UserDate,\r\n    Constants,\r\n    Aria,\r\n    Truncate,\r\n) {\r\n    var SELECTORS = Constants.SELECTORS;\r\n    var TEMPLATES = Constants.TEMPLATES;\r\n    var CONVERSATION_TYPES = Constants.CONVERSATION_TYPES;\r\n\r\n    /**\r\n     * Get the messages container element.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     * @return {Object} The messages container element.\r\n     */\r\n    var getMessagesContainer = function(body) {\r\n        return body.find(SELECTORS.CONTENT_MESSAGES_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Show the messages container element.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     */\r\n    var showMessagesContainer = function(body) {\r\n        getMessagesContainer(body).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the messages container element.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     */\r\n    var hideMessagesContainer = function(body) {\r\n        getMessagesContainer(body).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Get the self-conversation message container element.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     * @return {Object} The messages container element.\r\n     */\r\n    var getSelfConversationMessageContainer = function(body) {\r\n        return body.find(SELECTORS.SELF_CONVERSATION_MESSAGE_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Get the unable to message container element.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     * @return {Object} The unable to message container element.\r\n     */\r\n    const getUnableToMessageContainer = (body) => {\r\n        return body.find(SELECTORS.UNABLE_TO_MESSAGE_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Get the message text area element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     * @return {Object} The message text area element.\r\n     */\r\n    const getMessageTextArea = (footer) => {\r\n        return footer.find(SELECTORS.MESSAGE_TEXT_AREA);\r\n    };\r\n\r\n    /**\r\n     * Get the send message button element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     * @return {Object} The send message button element.\r\n     */\r\n    const getSendMessageButton = (footer) => {\r\n        return footer.find(SELECTORS.SEND_MESSAGE_BUTTON);\r\n    };\r\n\r\n    /**\r\n     * Get the emoji picker button element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     * @return {Object} The emoji picker button element.\r\n     */\r\n    const getEmojiPickerButton = (footer) => {\r\n        return footer.find(SELECTORS.TOGGLE_EMOJI_PICKER_BUTTON);\r\n    };\r\n\r\n    /**\r\n     * Hide the self-conversation message container element.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     * @return {Object} The messages container element.\r\n     */\r\n    var hideSelfConversationMessageContainer = function(body) {\r\n        return getSelfConversationMessageContainer(body).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Get the contact request sent container element.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     * @return {Object} The messages container element.\r\n     */\r\n    var getContactRequestSentContainer = function(body) {\r\n        return body.find(SELECTORS.CONTACT_REQUEST_SENT_MESSAGE_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Hide the contact request sent container element.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     * @return {Object} The messages container element.\r\n     */\r\n    var hideContactRequestSentContainer = function(body) {\r\n        return getContactRequestSentContainer(body).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Get the footer container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     * @return {Object} The footer container element.\r\n     */\r\n    var getFooterContentContainer = function(footer) {\r\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Show the footer container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    var showFooterContent = function(footer) {\r\n        getFooterContentContainer(footer).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the footer container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    var hideFooterContent = function(footer) {\r\n        getFooterContentContainer(footer).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Get the footer edit mode container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     * @return {Object} The footer container element.\r\n     */\r\n    var getFooterEditModeContainer = function(footer) {\r\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Show the footer edit mode container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    var showFooterEditMode = function(footer) {\r\n        getFooterEditModeContainer(footer).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the footer edit mode container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    var hideFooterEditMode = function(footer) {\r\n        getFooterEditModeContainer(footer).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Get the footer placeholder.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     * @return {Object} The footer placeholder container element.\r\n     */\r\n    var getFooterPlaceholderContainer = function(footer) {\r\n        return footer.find(SELECTORS.PLACEHOLDER_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Show the footer placeholder\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    var showFooterPlaceholder = function(footer) {\r\n        getFooterPlaceholderContainer(footer).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the footer placeholder\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    var hideFooterPlaceholder = function(footer) {\r\n        getFooterPlaceholderContainer(footer).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Get the footer Require add as contact container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     * @return {Object} The footer Require add as contact container element.\r\n     */\r\n    var getFooterRequireContactContainer = function(footer) {\r\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Show the footer add as contact dialogue.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    var showFooterRequireContact = function(footer) {\r\n        getFooterRequireContactContainer(footer).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the footer add as contact dialogue.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    var hideFooterRequireContact = function(footer) {\r\n        getFooterRequireContactContainer(footer).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Get the footer Required to unblock contact container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     * @return {Object} The footer Required to unblock contact container element.\r\n     */\r\n    var getFooterRequireUnblockContainer = function(footer) {\r\n        return footer.find(SELECTORS.CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Show the footer Required to unblock contact container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    var showFooterRequireUnblock = function(footer) {\r\n        getFooterRequireUnblockContainer(footer).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the footer Required to unblock contact container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    var hideFooterRequireUnblock = function(footer) {\r\n        getFooterRequireUnblockContainer(footer).addClass('hidden');\r\n    };\r\n\r\n\r\n    /**\r\n     * Hide all header elements.\r\n     *\r\n     * @param  {Object} header Conversation header container element.\r\n     */\r\n    var hideAllHeaderElements = function(header) {\r\n        hideHeaderContent(header);\r\n        hideHeaderEditMode(header);\r\n        hideHeaderPlaceholder(header);\r\n    };\r\n\r\n    /**\r\n     * Hide all footer dialogues and messages.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    var hideAllFooterElements = function(footer) {\r\n        hideFooterContent(footer);\r\n        hideFooterEditMode(footer);\r\n        hideFooterPlaceholder(footer);\r\n        hideFooterRequireContact(footer);\r\n        hideFooterRequireUnblock(footer);\r\n    };\r\n\r\n    /**\r\n     * Get the content placeholder container element.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     * @return {Object} The body placeholder container element.\r\n     */\r\n    var getContentPlaceholderContainer = function(body) {\r\n        return body.find(SELECTORS.CONTENT_PLACEHOLDER_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Show the content placeholder.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     */\r\n    var showContentPlaceholder = function(body) {\r\n        getContentPlaceholderContainer(body).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the content placeholder.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     */\r\n    var hideContentPlaceholder = function(body) {\r\n        getContentPlaceholderContainer(body).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Get the header content container element.\r\n     *\r\n     * @param  {Object} header Conversation header container element.\r\n     * @return {Object} The header content container element.\r\n     */\r\n    var getHeaderContent = function(header) {\r\n        return header.find(SELECTORS.HEADER);\r\n    };\r\n\r\n    /**\r\n     * Show the header content.\r\n     *\r\n     * @param  {Object} header Conversation header container element.\r\n     */\r\n    var showHeaderContent = function(header) {\r\n        getHeaderContent(header).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the header content.\r\n     *\r\n     * @param  {Object} header Conversation header container element.\r\n     */\r\n    var hideHeaderContent = function(header) {\r\n        getHeaderContent(header).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show the unable to message container.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     */\r\n    const showUnableToMessage = (body) => {\r\n        getUnableToMessageContainer(body).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the unable to message container.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     */\r\n    const hideUnableToMessage = (body) => {\r\n        getUnableToMessageContainer(body).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Enable the emoji picker button.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    const enableEmojiPickerButton = (footer) => {\r\n        getEmojiPickerButton(footer).prop('disabled', false);\r\n    };\r\n\r\n    /**\r\n     * Enable the send message button.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    const enableSendMessageButton = (footer) => {\r\n        getSendMessageButton(footer).prop('disabled', false);\r\n    };\r\n\r\n    /**\r\n     * Enable the message text area.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    const enableMessageTextArea = (footer) => {\r\n        const messageTextArea = getMessageTextArea(footer);\r\n        messageTextArea.prop('disabled', false);\r\n        Aria.unhide(messageTextArea.get());\r\n\r\n        Str.get_string('writeamessage', 'core_message').done(function(string) {\r\n            if (!messageTextArea.prop('disabled')) {\r\n                messageTextArea.prop('placeholder', string);\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Enable all footer content elements.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    const enableAllFooterContentElements = (footer) => {\r\n        enableEmojiPickerButton(footer);\r\n        enableSendMessageButton(footer);\r\n        enableMessageTextArea(footer);\r\n    };\r\n\r\n    /**\r\n     * Disable the emoji picker button.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    const disableEmojiPickerButton = (footer) => {\r\n        getEmojiPickerButton(footer).prop('disabled', true);\r\n    };\r\n\r\n    /**\r\n     * Disable the send message button.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    const disableSendMessageButton = (footer) => {\r\n        getSendMessageButton(footer).prop('disabled', true);\r\n    };\r\n\r\n    /**\r\n     * Disable the message text area.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    const disableMessageTextArea = (footer) => {\r\n        const messageTextArea = getMessageTextArea(footer);\r\n        messageTextArea.prop('disabled', true);\r\n        messageTextArea.removeAttr('placeholder');\r\n        Aria.unhide(messageTextArea.get());\r\n    };\r\n\r\n    /**\r\n     * Disable all footer content elements.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     */\r\n    const disableAllFooterContentElements = (footer) => {\r\n        disableEmojiPickerButton(footer);\r\n        disableSendMessageButton(footer);\r\n        disableMessageTextArea(footer);\r\n    };\r\n\r\n    /**\r\n     * Get the header edit mode container element.\r\n     *\r\n     * @param  {Object} header Conversation header container element.\r\n     * @return {Object} The header content container element.\r\n     */\r\n    var getHeaderEditMode = function(header) {\r\n        return header.find(SELECTORS.HEADER_EDIT_MODE);\r\n    };\r\n\r\n    /**\r\n     * Show the header edit mode container.\r\n     *\r\n     * @param  {Object} header Conversation header container element.\r\n     */\r\n    var showHeaderEditMode = function(header) {\r\n        getHeaderEditMode(header).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the header edit mode container.\r\n     *\r\n     * @param  {Object} header Conversation header container element.\r\n     */\r\n    var hideHeaderEditMode = function(header) {\r\n        getHeaderEditMode(header).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Get the header placeholder container element.\r\n     *\r\n     * @param  {Object} header Conversation header container element.\r\n     * @return {Object} The header placeholder container element.\r\n     */\r\n    var getHeaderPlaceholderContainer = function(header) {\r\n        return header.find(SELECTORS.HEADER_PLACEHOLDER_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Show the header placeholder.\r\n     *\r\n     * @param  {Object} header Conversation header container element.\r\n     */\r\n    var showHeaderPlaceholder = function(header) {\r\n        getHeaderPlaceholderContainer(header).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the header placeholder.\r\n     *\r\n     * @param  {Object} header Conversation header container element.\r\n     */\r\n    var hideHeaderPlaceholder = function(header) {\r\n        getHeaderPlaceholderContainer(header).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Get the emoji picker container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     * @return {Object} The emoji picker container element.\r\n     */\r\n    var getEmojiPickerContainer = function(footer) {\r\n        return footer.find(SELECTORS.EMOJI_PICKER_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Get the emoji picker container element.\r\n     *\r\n     * @param  {Object} footer Conversation footer container element.\r\n     * @return {Object} The emoji picker container element.\r\n     */\r\n    var getEmojiAutoCompleteContainer = function(footer) {\r\n        return footer.find(SELECTORS.EMOJI_AUTO_COMPLETE_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Get a message element.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     * @param  {Number} messageId the Message id.\r\n     * @return {Object} A message element from the conversation.\r\n     */\r\n    var getMessageElement = function(body, messageId) {\r\n        var messagesContainer = getMessagesContainer(body);\r\n        return messagesContainer.find('[data-message-id=\"' + messageId + '\"]');\r\n    };\r\n\r\n    /**\r\n     * Get the day container element. The day container element holds a list of messages for that day.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     * @param  {Number} dayTimeCreated Midnight timestamp for the day.\r\n     * @return {Object} jQuery object\r\n     */\r\n    var getDayElement = function(body, dayTimeCreated) {\r\n        var messagesContainer = getMessagesContainer(body);\r\n        return messagesContainer.find('[data-day-id=\"' + dayTimeCreated + '\"]');\r\n    };\r\n\r\n    /**\r\n     * Get the more messages loading icon container element.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     * @return {Object} The more messages loading container element.\r\n     */\r\n    var getMoreMessagesLoadingIconContainer = function(body) {\r\n        return body.find(SELECTORS.MORE_MESSAGES_LOADING_ICON_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Show the more messages loading icon.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     */\r\n    var showMoreMessagesLoadingIcon = function(body) {\r\n        getMoreMessagesLoadingIconContainer(body).removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the more messages loading icon.\r\n     *\r\n     * @param  {Object} body Conversation body container element.\r\n     */\r\n    var hideMoreMessagesLoadingIcon = function(body) {\r\n        getMoreMessagesLoadingIconContainer(body).addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Get the confirm dialogue container element.\r\n     *\r\n     * @param  {Object} root The container element to search.\r\n     * @return {Object} The confirm dialogue container element.\r\n     */\r\n    var getConfirmDialogueContainer = function(root) {\r\n        return root.find(SELECTORS.CONFIRM_DIALOGUE_CONTAINER);\r\n    };\r\n\r\n    /**\r\n     * Show the confirm dialogue container element.\r\n     *\r\n     * @param  {Object} root The container element containing a dialogue.\r\n     */\r\n    var showConfirmDialogueContainer = function(root) {\r\n        var container = getConfirmDialogueContainer(root);\r\n        var siblings = container.siblings(':not(.hidden)');\r\n        Aria.hide(siblings.get());\r\n        siblings.attr('data-confirm-dialogue-hidden', true);\r\n\r\n        container.removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the confirm dialogue container element.\r\n     *\r\n     * @param  {Object} root The container element containing a dialogue.\r\n     */\r\n    var hideConfirmDialogueContainer = function(root) {\r\n        var container = getConfirmDialogueContainer(root);\r\n        var siblings = container.siblings('[data-confirm-dialogue-hidden=\"true\"]');\r\n        Aria.unhide(siblings.get());\r\n        siblings.removeAttr('data-confirm-dialogue-hidden');\r\n\r\n        container.addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Set the number of selected messages.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Number} value The new number to display.\r\n     */\r\n    var setMessagesSelectedCount = function(header, value) {\r\n        getHeaderEditMode(header).find(SELECTORS.MESSAGES_SELECTED_COUNT).text(value);\r\n    };\r\n\r\n    /**\r\n     * Format message for the mustache template, transform camelCase properties to lowercase properties.\r\n     *\r\n     * @param  {Array} messages Array of message objects.\r\n     * @param  {Object} datesCache Cache timestamps and their formatted date string.\r\n     * @return {Array} Messages formated for mustache template.\r\n     */\r\n    var formatMessagesForTemplate = function(messages, datesCache) {\r\n        return messages.map(function(message) {\r\n            return {\r\n                id: message.id,\r\n                isread: message.isRead,\r\n                fromloggedinuser: message.fromLoggedInUser,\r\n                userfrom: message.userFrom,\r\n                text: message.text,\r\n                formattedtime: message.timeCreated ? datesCache[message.timeCreated] : null\r\n            };\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Create rendering promises for each day containing messages.\r\n     *\r\n     * @param  {Object} header The header container element.\r\n     * @param  {Object} body The body container element.\r\n     * @param  {Object} footer The footer container element.\r\n     * @param  {Array} days Array of days containing messages.\r\n     * @param  {Object} datesCache Cache timestamps and their formatted date string.\r\n     * @param  {Boolean} isAbleToMessage Whether the user can send a message to the conversation.\r\n     * @return {Promise} Days rendering promises.\r\n     */\r\n    var renderAddDays = function(header, body, footer, days, datesCache, isAbleToMessage) {\r\n        var messagesContainer = getMessagesContainer(body);\r\n        var daysRenderPromises = days.map(function(data) {\r\n            var timestampDate = new Date(data.value.timestamp * 1000);\r\n            return Templates.render(TEMPLATES.DAY, {\r\n                timestamp: data.value.timestamp,\r\n                currentyear: timestampDate.getFullYear() === (new Date()).getFullYear(),\r\n                messages: formatMessagesForTemplate(data.value.messages, datesCache)\r\n            });\r\n        });\r\n\r\n        return $.when.apply($, daysRenderPromises).then(function() {\r\n            // Wait until all of the rendering is done for each of the days\r\n            // to ensure they are added to the page in the correct order.\r\n            days.forEach(function(data, index) {\r\n                // eslint-disable-next-line promise/no-nesting\r\n                daysRenderPromises[index]\r\n                    .then(function(html) {\r\n                        if (data.before) {\r\n                            var element = getDayElement(body, data.before.timestamp);\r\n                            return $(html).insertBefore(element);\r\n                        } else {\r\n                            return messagesContainer.append(html);\r\n                        }\r\n                    })\r\n                    .always(function() {\r\n                        const showUnableToMessage = !isAbleToMessage && index === days.length - 1;\r\n                        messagesContainer.find(SELECTORS.DAY_MESSAGE_UNABLE_TO_SEND_CONTAINER)\r\n                            .last().toggleClass('hidden', !showUnableToMessage);\r\n                        hideUnableToMessage(body);\r\n                    })\r\n                    .catch(function() {\r\n                        // Fail silently.\r\n                    });\r\n            });\r\n\r\n            return;\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Add (more) messages to day containers.\r\n     *\r\n     * @param  {Object} header The header container element.\r\n     * @param  {Object} body The body container element.\r\n     * @param  {Object} footer The footer container element.\r\n     * @param  {Array} messages List of messages.\r\n     * @param  {Object} datesCache Cache timestamps and their formatted date string.\r\n     * @return {Promise} Messages rendering promises.\r\n     */\r\n    var renderAddMessages = function(header, body, footer, messages, datesCache) {\r\n        var messagesData = messages.map(function(data) {\r\n            return data.value;\r\n        });\r\n        var formattedMessages = formatMessagesForTemplate(messagesData, datesCache);\r\n\r\n        return Templates.render(TEMPLATES.MESSAGES, {messages: formattedMessages})\r\n            .then(function(html) {\r\n                var messageList = $(html);\r\n                messages.forEach(function(data) {\r\n                    var messageHtml = messageList.find('[data-message-id=\"' + data.value.id + '\"]');\r\n                    if (data.before) {\r\n                        var element = getMessageElement(body, data.before.id);\r\n                        return messageHtml.insertBefore(element);\r\n                    } else {\r\n                        var dayContainer = getDayElement(body, data.day.timestamp);\r\n                        var dayMessagesContainer = dayContainer.find(SELECTORS.DAY_MESSAGES_CONTAINER);\r\n                        return dayMessagesContainer.append(messageHtml);\r\n                    }\r\n                });\r\n\r\n                return;\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Update existing messages.\r\n     *\r\n     * @param  {Object} header The header container element.\r\n     * @param  {Object} body The body container element.\r\n     * @param  {Object} footer The footer container element.\r\n     * @param  {Array} messages List of messages.\r\n     * @param  {Object} datesCache Cache timestamps and their formatted date string.\r\n     */\r\n    var renderUpdateMessages = function(header, body, footer, messages, datesCache) {\r\n        messages.forEach(function(message) {\r\n            var before = message.before;\r\n            var after = message.after;\r\n            var element = getMessageElement(body, before.id);\r\n\r\n            if (before.id != after.id) {\r\n                element.attr('data-message-id', after.id);\r\n            }\r\n\r\n            if (before.timeCreated != after.timeCreated) {\r\n                var formattedTime = datesCache[after.timeCreated];\r\n                element.find(SELECTORS.LOADING_ICON_CONTAINER).addClass('hidden');\r\n                element.find(SELECTORS.TIME_CREATED).text(formattedTime).removeClass('hidden');\r\n            }\r\n\r\n            if (before.sendState != after.sendState) {\r\n                var loading = element.find(SELECTORS.LOADING_ICON_CONTAINER);\r\n                var time = element.find(SELECTORS.TIME_CREATED);\r\n                var retry = element.find(SELECTORS.RETRY_SEND);\r\n\r\n                loading.addClass('hidden');\r\n                Aria.hide(loading.get());\r\n\r\n                time.addClass('hidden');\r\n                Aria.hide(time.get());\r\n\r\n                retry.addClass('hidden');\r\n                Aria.hide(retry.get());\r\n\r\n                element.removeClass('border border-danger');\r\n\r\n                switch (after.sendState) {\r\n                    case 'pending':\r\n                        loading.removeClass('hidden');\r\n                        Aria.unhide(loading.get());\r\n                        break;\r\n                    case 'error':\r\n                        retry.removeClass('hidden');\r\n                        Aria.unhide(retry.get());\r\n                        element.addClass('border border-danger');\r\n                        break;\r\n                    case 'sent':\r\n                        time.removeClass('hidden');\r\n                        Aria.unhide(time.get());\r\n                        break;\r\n                }\r\n            }\r\n\r\n            if (before.text != after.text) {\r\n                element.find(SELECTORS.TEXT_CONTAINER).html(after.text);\r\n            }\r\n\r\n            if (before.errorMessage != after.errorMessage) {\r\n                var messageContainer = element.find(SELECTORS.ERROR_MESSAGE_CONTAINER);\r\n                var message = messageContainer.find(SELECTORS.ERROR_MESSAGE);\r\n\r\n                if (after.errorMessage) {\r\n                    messageContainer.removeClass('hidden');\r\n                    Aria.unhide(messageContainer.get());\r\n                    message.text(after.errorMessage);\r\n                } else {\r\n                    messageContainer.addClass('hidden');\r\n                    Aria.unhide(messageContainer.get());\r\n                    message.text('');\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Remove days from conversation.\r\n     *\r\n     * @param  {Object} body The body container element.\r\n     * @param  {Array} days Array of days to be removed.\r\n     */\r\n    var renderRemoveDays = function(body, days) {\r\n        days.forEach(function(data) {\r\n            getDayElement(body, data.timestamp).remove();\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Remove messages from conversation.\r\n     *\r\n     * @param  {Object} body The body container element.\r\n     * @param  {Array} messages Array of messages to be removed.\r\n     */\r\n    var renderRemoveMessages = function(body, messages) {\r\n        messages.forEach(function(data) {\r\n            getMessageElement(body, data.id).remove();\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Render the full conversation base on input from the statemanager.\r\n     *\r\n     * This will pre-load all of the formatted timestamps for each message that\r\n     * needs to render to reduce the number of networks requests.\r\n     *\r\n     * @param  {Object} header The header container element.\r\n     * @param  {Object} body The body container element.\r\n     * @param  {Object} footer The footer container element.\r\n     * @param  {Object} data The conversation diff.\r\n     * @return {Object} jQuery promise.\r\n     */\r\n    var renderConversation = function(header, body, footer, data) {\r\n        var renderingPromises = [];\r\n        var hasAddDays = data.days.add.length > 0;\r\n        var hasAddMessages = data.messages.add.length > 0;\r\n        var hasUpdateMessages = data.messages.update.length > 0;\r\n        var timestampsToFormat = [];\r\n        var datesCachePromise = $.Deferred().resolve({}).promise();\r\n\r\n        if (hasAddDays) {\r\n            // Search for all of the timeCreated values in all of the messages in all of\r\n            // the days that we need to render.\r\n            timestampsToFormat = timestampsToFormat.concat(data.days.add.reduce(function(carry, day) {\r\n                return carry.concat(day.value.messages.reduce(function(timestamps, message) {\r\n                    if (message.timeCreated) {\r\n                        timestamps.push(message.timeCreated);\r\n                    }\r\n                    return timestamps;\r\n                }, []));\r\n            }, []));\r\n        }\r\n\r\n        if (hasAddMessages) {\r\n            // Search for all of the timeCreated values in all of the messages that we\r\n            // need to render.\r\n            timestampsToFormat = timestampsToFormat.concat(data.messages.add.reduce(function(timestamps, message) {\r\n                if (message.value.timeCreated) {\r\n                    timestamps.push(message.value.timeCreated);\r\n                }\r\n                return timestamps;\r\n            }, []));\r\n        }\r\n\r\n        if (hasUpdateMessages) {\r\n            timestampsToFormat = timestampsToFormat.concat(data.messages.update.reduce(function(timestamps, message) {\r\n                if (message.before.timeCreated != message.after.timeCreated) {\r\n                    timestamps.push(message.after.timeCreated);\r\n                }\r\n                return timestamps;\r\n            }, []));\r\n        }\r\n\r\n        if (timestampsToFormat.length) {\r\n            // If we have timestamps then pre-load the formatted version of each of them\r\n            // in a single request to the server. This saves the templates doing multiple\r\n            // individual requests.\r\n            datesCachePromise = Str.get_string('strftimetime24', 'core_langconfig')\r\n                .then(function(format) {\r\n                    var requests = timestampsToFormat.map(function(timestamp) {\r\n                        return {\r\n                            timestamp: timestamp,\r\n                            format: format\r\n                        };\r\n                    });\r\n\r\n                    return UserDate.get(requests);\r\n                })\r\n                .then(function(formattedTimes) {\r\n                    return timestampsToFormat.reduce(function(carry, timestamp, index) {\r\n                        carry[timestamp] = formattedTimes[index];\r\n                        return carry;\r\n                    }, {});\r\n                });\r\n        }\r\n\r\n        if (hasAddDays) {\r\n            renderingPromises.push(datesCachePromise.then(function(datesCache) {\r\n                return renderAddDays(header, body, footer, data.days.add, datesCache, !data.unableToMessage);\r\n            }));\r\n        }\r\n\r\n        if (hasAddMessages) {\r\n            renderingPromises.push(datesCachePromise.then(function(datesCache) {\r\n                return renderAddMessages(header, body, footer, data.messages.add, datesCache);\r\n            }));\r\n        }\r\n\r\n        if (hasUpdateMessages) {\r\n            renderingPromises.push(datesCachePromise.then(function(datesCache) {\r\n                return renderUpdateMessages(header, body, footer, data.messages.update, datesCache);\r\n            }));\r\n        }\r\n\r\n        if (data.days.remove.length > 0) {\r\n            renderRemoveDays(body, data.days.remove);\r\n        }\r\n\r\n        if (data.messages.remove.length > 0) {\r\n            renderRemoveMessages(body, data.messages.remove);\r\n        }\r\n\r\n        return $.when.apply($, renderingPromises);\r\n    };\r\n\r\n    /**\r\n     * Render the conversation header.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} data Data for header.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var renderHeader = function(header, body, footer, data) {\r\n        var headerContainer = getHeaderContent(header);\r\n        var template = TEMPLATES.HEADER_PUBLIC;\r\n        data.context.showrouteback = (header.attr('data-from-panel') === \"false\");\r\n        if (data.type == CONVERSATION_TYPES.PRIVATE) {\r\n            template = data.showControls ? TEMPLATES.HEADER_PRIVATE : TEMPLATES.HEADER_PRIVATE_NO_CONTROLS;\r\n        } else if (data.type == CONVERSATION_TYPES.SELF) {\r\n            template = TEMPLATES.HEADER_SELF;\r\n        }\r\n\r\n        return Templates.render(template, data.context)\r\n            .then(function(html, js) {\r\n                Templates.replaceNodeContents(headerContainer, html, js);\r\n                return;\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Render the conversation footer.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} data Data for footer.\r\n     * @return {Object} jQuery promise.\r\n     */\r\n    var renderFooter = function(header, body, footer, data) {\r\n        hideAllFooterElements(footer);\r\n\r\n        switch (data.type) {\r\n            case 'placeholder':\r\n                return showFooterPlaceholder(footer);\r\n            case 'add-contact':\r\n                return Str.get_strings([\r\n                        {\r\n                            key: 'requirecontacttomessage',\r\n                            component: 'core_message',\r\n                            param: data.user.fullname\r\n                        },\r\n                        {\r\n                            key: 'isnotinyourcontacts',\r\n                            component: 'core_message',\r\n                            param: data.user.fullname\r\n                        }\r\n                    ])\r\n                    .then(function(strings) {\r\n                        var title = strings[1];\r\n                        var text = strings[0];\r\n                        var footerContainer = getFooterRequireContactContainer(footer);\r\n                        footerContainer.find(SELECTORS.TITLE).text(title);\r\n                        footerContainer.find(SELECTORS.TEXT).text(text);\r\n                        showFooterRequireContact(footer);\r\n                        return strings;\r\n                    });\r\n            case 'edit-mode':\r\n                return showFooterEditMode(footer);\r\n            case 'content':\r\n                return showFooterContent(footer);\r\n            case 'unblock':\r\n                return showFooterRequireUnblock(footer);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Scroll to a message in the conversation.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Number} messageId Message id.\r\n     */\r\n    var renderScrollToMessage = function(header, body, footer, messageId) {\r\n        var messagesContainer = getMessagesContainer(body);\r\n        var messageElement = getMessageElement(body, messageId);\r\n        var position = messageElement.position();\r\n        // Scroll the message container down to the top of the message element.\r\n        if (position) {\r\n            var scrollTop = messagesContainer.scrollTop() + position.top;\r\n            messagesContainer.scrollTop(scrollTop);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hide or show the conversation header.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Bool} isLoadingMembers Members loading.\r\n     */\r\n    var renderLoadingMembers = function(header, body, footer, isLoadingMembers) {\r\n        if (isLoadingMembers) {\r\n            hideHeaderContent(header);\r\n            showHeaderPlaceholder(header);\r\n        } else {\r\n            showHeaderContent(header);\r\n            hideHeaderPlaceholder(header);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hide or show loading conversation messages.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Bool} isLoadingFirstMessages Messages loading.\r\n     */\r\n    var renderLoadingFirstMessages = function(header, body, footer, isLoadingFirstMessages) {\r\n        if (isLoadingFirstMessages) {\r\n            hideMessagesContainer(body);\r\n            showContentPlaceholder(body);\r\n        } else {\r\n            showMessagesContainer(body);\r\n            hideContentPlaceholder(body);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hide or show loading more messages.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Bool} isLoading Messages loading.\r\n     */\r\n    var renderLoadingMessages = function(header, body, footer, isLoading) {\r\n        if (isLoading) {\r\n            showMoreMessagesLoadingIcon(body);\r\n        } else {\r\n            hideMoreMessagesLoadingIcon(body);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hide or show the emoji picker.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Bool} show Should the emoji picker be visible.\r\n     */\r\n    var renderShowEmojiPicker = function(header, body, footer, show) {\r\n        var container = getEmojiPickerContainer(footer);\r\n\r\n        if (show) {\r\n            container.removeClass('hidden');\r\n            Aria.unhide(container.get());\r\n            container.find(SELECTORS.EMOJI_PICKER_SEARCH_INPUT).focus();\r\n        } else {\r\n            container.addClass('hidden');\r\n            Aria.hide(container.get());\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hide or show the emoji auto complete.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Bool} show Should the emoji picker be visible.\r\n     */\r\n    var renderShowEmojiAutoComplete = function(header, body, footer, show) {\r\n        var container = getEmojiAutoCompleteContainer(footer);\r\n\r\n        if (show) {\r\n            container.removeClass('hidden');\r\n            Aria.unhide(container.get());\r\n        } else {\r\n            container.addClass('hidden');\r\n            Aria.hide(container.get());\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Show a confirmation dialogue\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {String} buttonSelectors Selectors for the buttons to show.\r\n     * @param {String} bodyText Text to show in dialogue.\r\n     * @param {String} headerText Text to show in dialogue header.\r\n     * @param {Bool} canCancel Can this dialogue be cancelled.\r\n     * @param {Bool} skipHeader Skip blanking out the header\r\n     * @param {Bool} showOk Show an 'Okay' button for a dialogue which will close it\r\n     */\r\n    var showConfirmDialogue = function(\r\n        header,\r\n        body,\r\n        footer,\r\n        buttonSelectors,\r\n        bodyText,\r\n        headerText,\r\n        canCancel,\r\n        skipHeader,\r\n        showOk\r\n    ) {\r\n        var dialogue = getConfirmDialogueContainer(body);\r\n        var buttons = buttonSelectors.map(function(selector) {\r\n            return dialogue.find(selector);\r\n        });\r\n        var cancelButton = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON);\r\n        var okayButton = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_OKAY_BUTTON);\r\n        var text = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT);\r\n        var dialogueHeader = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);\r\n\r\n        dialogue.find('button').addClass('hidden');\r\n\r\n        if (canCancel) {\r\n            cancelButton.removeClass('hidden');\r\n        } else {\r\n            cancelButton.addClass('hidden');\r\n        }\r\n\r\n        if (showOk) {\r\n            okayButton.removeClass('hidden');\r\n        } else {\r\n            okayButton.addClass('hidden');\r\n        }\r\n\r\n        if (headerText) {\r\n            // Create the dialogue header.\r\n            dialogueHeader = $('<h3 class=\"h6\" data-region=\"dialogue-header\"></h3>');\r\n            dialogueHeader.text(headerText);\r\n            // Prepend it to the confirmation body.\r\n            var confirmDialogue = dialogue.find(SELECTORS.CONFIRM_DIALOGUE);\r\n            confirmDialogue.prepend(dialogueHeader);\r\n        } else if (dialogueHeader.length) {\r\n            // Header text is empty but dialogue header is present, so remove it.\r\n            dialogueHeader.remove();\r\n        }\r\n\r\n        buttons.forEach(function(button) {\r\n            button.removeClass('hidden');\r\n        });\r\n        text.text(bodyText);\r\n        showConfirmDialogueContainer(footer);\r\n        showConfirmDialogueContainer(body);\r\n\r\n        if (!skipHeader) {\r\n            showConfirmDialogueContainer(header);\r\n        }\r\n\r\n        dialogue.find(SELECTORS.CAN_RECEIVE_FOCUS).filter(':visible').first().focus();\r\n    };\r\n\r\n    /**\r\n     * Hide the dialogue\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @return {Bool} always true.\r\n     */\r\n    var hideConfirmDialogue = function(header, body, footer) {\r\n        var dialogue = getConfirmDialogueContainer(body);\r\n        var cancelButton = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_CANCEL_BUTTON);\r\n        var okayButton = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_OKAY_BUTTON);\r\n        var text = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_TEXT);\r\n        var dialogueHeader = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_HEADER);\r\n\r\n        hideCheckDeleteDialogue(body);\r\n        hideConfirmDialogueContainer(body);\r\n        hideConfirmDialogueContainer(footer);\r\n        hideConfirmDialogueContainer(header);\r\n        dialogue.find('button').addClass('hidden');\r\n        cancelButton.removeClass('hidden');\r\n        okayButton.removeClass('hidden');\r\n        text.text('');\r\n\r\n        // Remove dialogue header if present.\r\n        if (dialogueHeader.length) {\r\n            dialogueHeader.remove();\r\n        }\r\n\r\n        header.find(SELECTORS.CAN_RECEIVE_FOCUS).first().focus();\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Render the confirm block user dialogue.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} user User to block.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var renderConfirmBlockUser = function(header, body, footer, user) {\r\n        if (user) {\r\n            const username = truncateUsername(user.fullname);\r\n            if (user.canmessageevenifblocked) {\r\n                return Str.get_string('cantblockuser', 'core_message', username)\r\n                    .then(function(string) {\r\n                        return showConfirmDialogue(header, body, footer, [], string, '', false, false, true);\r\n                    });\r\n            } else {\r\n                return Str.get_string('blockuserconfirm', 'core_message', username)\r\n                    .then(function(string) {\r\n                        return showConfirmDialogue(header, body, footer, [SELECTORS.ACTION_CONFIRM_BLOCK], string, '', true, false);\r\n                    });\r\n            }\r\n        } else {\r\n            return hideConfirmDialogue(header, body, footer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Render the confirm unblock user dialogue.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} user User to unblock.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var renderConfirmUnblockUser = function(header, body, footer, user) {\r\n        if (user) {\r\n            return Str.get_string('unblockuserconfirm', 'core_message', truncateUsername(user.fullname))\r\n                .then(function(string) {\r\n                    return showConfirmDialogue(header, body, footer, [SELECTORS.ACTION_CONFIRM_UNBLOCK], string, '', true, false);\r\n                });\r\n        } else {\r\n            return hideConfirmDialogue(header, body, footer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Render the add user as contact dialogue.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} user User to add as contact.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var renderConfirmAddContact = function(header, body, footer, user) {\r\n        if (user) {\r\n            // Truncate long usernames.\r\n            const userFullName = Truncate.truncate(user.fullname, {\r\n                length: 30,\r\n                words: true,\r\n                ellipsis: '...'\r\n            });\r\n            return Str.get_string('addcontactconfirm', 'core_message', userFullName)\r\n                .then(function(string) {\r\n                    return showConfirmDialogue(\r\n                        header,\r\n                        body,\r\n                        footer,\r\n                        [SELECTORS.ACTION_CONFIRM_ADD_CONTACT],\r\n                        string,\r\n                        '',\r\n                        true,\r\n                        false\r\n                    );\r\n                });\r\n        } else {\r\n            return hideConfirmDialogue(header, body, footer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Render the remove user from contacts dialogue.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} user User to remove from contacts.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var renderConfirmRemoveContact = function(header, body, footer, user) {\r\n        if (user) {\r\n            return Str.get_string('removecontactconfirm', 'core_message', truncateUsername(user.fullname))\r\n                .then(function(string) {\r\n                    return showConfirmDialogue(\r\n                        header,\r\n                        body,\r\n                        footer,\r\n                        [SELECTORS.ACTION_CONFIRM_REMOVE_CONTACT],\r\n                        string,\r\n                        '',\r\n                        true,\r\n                        false\r\n                    );\r\n                });\r\n        } else {\r\n            return hideConfirmDialogue(header, body, footer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Render the delete selected messages dialogue.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} data If the dialogue should show and checkbox shows to delete message for all users.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var renderConfirmDeleteSelectedMessages = function(header, body, footer, data) {\r\n        var showmessage = null;\r\n        if (data.type == CONVERSATION_TYPES.SELF) {\r\n            // Message displayed to self-conversations is slighly different.\r\n            showmessage = 'deleteselectedmessagesconfirmselfconversation';\r\n        } else {\r\n            // This other message should be displayed.\r\n            if (data.canDeleteMessagesForAllUsers) {\r\n                showCheckDeleteDialogue(body);\r\n                showmessage = 'deleteforeveryoneselectedmessagesconfirm';\r\n            } else {\r\n                showmessage = 'deleteselectedmessagesconfirm';\r\n            }\r\n        }\r\n\r\n        if (data.show) {\r\n            return Str.get_string(showmessage, 'core_message')\r\n                .then(function(string) {\r\n                    return showConfirmDialogue(\r\n                        header,\r\n                        body,\r\n                        footer,\r\n                        [SELECTORS.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES],\r\n                        string,\r\n                        '',\r\n                        true,\r\n                        false\r\n                    );\r\n                });\r\n        } else {\r\n            return hideConfirmDialogue(header, body, footer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Render the confirm delete conversation dialogue.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {int|Null} type The conversation type to be removed.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var renderConfirmDeleteConversation = function(header, body, footer, type) {\r\n        var showmessage = null;\r\n        if (type == CONVERSATION_TYPES.SELF) {\r\n            // Message displayed to self-conversations is slighly different.\r\n            showmessage = 'deleteallselfconfirm';\r\n        } else if (type) {\r\n            // This other message should be displayed.\r\n            showmessage = 'deleteallconfirm';\r\n        }\r\n\r\n        if (showmessage) {\r\n            return Str.get_string(showmessage, 'core_message')\r\n                .then(function(string) {\r\n                    return showConfirmDialogue(\r\n                        header,\r\n                        body,\r\n                        footer,\r\n                        [SELECTORS.ACTION_CONFIRM_DELETE_CONVERSATION],\r\n                        string,\r\n                        '',\r\n                        true,\r\n                        false\r\n                    );\r\n                });\r\n        } else {\r\n            return hideConfirmDialogue(header, body, footer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Render the confirm delete conversation dialogue.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} user The other user object.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var renderConfirmContactRequest = function(header, body, footer, user) {\r\n        if (user) {\r\n            return Str.get_string('userwouldliketocontactyou', 'core_message', truncateUsername(user.fullname))\r\n                .then(function(string) {\r\n                    var buttonSelectors = [\r\n                        SELECTORS.ACTION_ACCEPT_CONTACT_REQUEST,\r\n                        SELECTORS.ACTION_DECLINE_CONTACT_REQUEST\r\n                    ];\r\n                    return showConfirmDialogue(header, body, footer, buttonSelectors, string, '', false, true);\r\n                });\r\n        } else {\r\n            return hideConfirmDialogue(header, body, footer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Show the checkbox to allow delete message for all.\r\n     *\r\n     * @param {Object} body The body container element.\r\n     */\r\n    var showCheckDeleteDialogue = function(body) {\r\n        var dialogue = getConfirmDialogueContainer(body);\r\n        var checkboxRegion = dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER);\r\n        checkboxRegion.removeClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Hide the checkbox to allow delete message for all.\r\n     *\r\n     * @param {Object} body The body container element.\r\n     */\r\n    var hideCheckDeleteDialogue = function(body) {\r\n        var dialogue = getConfirmDialogueContainer(body);\r\n        var checkboxRegion = dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER);\r\n        var checkbox = dialogue.find(SELECTORS.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE);\r\n        checkbox.prop('checked', false);\r\n        checkboxRegion.addClass('hidden');\r\n    };\r\n\r\n    /**\r\n     * Show or hide the block / unblock option in the header dropdown menu.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Bool} isBlocked is user blocked.\r\n     */\r\n    var renderIsBlocked = function(header, body, footer, isBlocked) {\r\n        if (isBlocked) {\r\n            header.find(SELECTORS.ACTION_REQUEST_BLOCK).addClass('hidden');\r\n            header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).removeClass('hidden');\r\n        } else {\r\n            header.find(SELECTORS.ACTION_REQUEST_BLOCK).removeClass('hidden');\r\n            header.find(SELECTORS.ACTION_REQUEST_UNBLOCK).addClass('hidden');\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Show or hide the favourite / unfavourite option in the header dropdown menu\r\n     * and the favourite star in the header title.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Bool} state is this conversation a favourite.\r\n     */\r\n    var renderIsFavourite = function(header, body, footer, state) {\r\n        var favouriteIcon = header.find(SELECTORS.FAVOURITE_ICON_CONTAINER);\r\n        var addFavourite = header.find(SELECTORS.ACTION_CONFIRM_FAVOURITE);\r\n        var removeFavourite = header.find(SELECTORS.ACTION_CONFIRM_UNFAVOURITE);\r\n\r\n        switch (state) {\r\n            case 'hide':\r\n                favouriteIcon.addClass('hidden');\r\n                addFavourite.addClass('hidden');\r\n                removeFavourite.addClass('hidden');\r\n                break;\r\n            case 'show-add':\r\n                favouriteIcon.addClass('hidden');\r\n                addFavourite.removeClass('hidden');\r\n                removeFavourite.addClass('hidden');\r\n                break;\r\n            case 'show-remove':\r\n                favouriteIcon.removeClass('hidden');\r\n                addFavourite.addClass('hidden');\r\n                removeFavourite.removeClass('hidden');\r\n                break;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Show or hide the mute / unmute option in the header dropdown menu\r\n     * and the muted icon in the header title.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {string} state The state of the conversation as defined by the patcher.\r\n     */\r\n    var renderIsMuted = function(header, body, footer, state) {\r\n        var muteIcon = header.find(SELECTORS.MUTED_ICON_CONTAINER);\r\n        var setMuted = header.find(SELECTORS.ACTION_CONFIRM_MUTE);\r\n        var unsetMuted = header.find(SELECTORS.ACTION_CONFIRM_UNMUTE);\r\n\r\n        switch (state) {\r\n            case 'hide':\r\n                muteIcon.addClass('hidden');\r\n                setMuted.addClass('hidden');\r\n                unsetMuted.addClass('hidden');\r\n                break;\r\n            case 'show-mute':\r\n                muteIcon.addClass('hidden');\r\n                setMuted.removeClass('hidden');\r\n                unsetMuted.addClass('hidden');\r\n                break;\r\n            case 'show-unmute':\r\n                muteIcon.removeClass('hidden');\r\n                setMuted.addClass('hidden');\r\n                unsetMuted.removeClass('hidden');\r\n                break;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Show or hide the add / remove user as contact option in the header dropdown menu.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Bool} state the contact state.\r\n     */\r\n    var renderIsContact = function(header, body, footer, state) {\r\n        var addContact = header.find(SELECTORS.ACTION_REQUEST_ADD_CONTACT);\r\n        var removeContact = header.find(SELECTORS.ACTION_REQUEST_REMOVE_CONTACT);\r\n\r\n        switch (state) {\r\n            case 'pending-contact':\r\n                addContact.addClass('hidden');\r\n                removeContact.addClass('hidden');\r\n                break;\r\n            case 'contact':\r\n                addContact.addClass('hidden');\r\n                removeContact.removeClass('hidden');\r\n                break;\r\n            case 'non-contact':\r\n                addContact.removeClass('hidden');\r\n                removeContact.addClass('hidden');\r\n                break;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Show or hide confirm action from confirm dialogue is loading.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Bool} isLoading confirm action is loading.\r\n     */\r\n    var renderLoadingConfirmAction = function(header, body, footer, isLoading) {\r\n        var dialogue = getConfirmDialogueContainer(body);\r\n        var buttons = dialogue.find('button');\r\n        var buttonText = dialogue.find(SELECTORS.CONFIRM_DIALOGUE_BUTTON_TEXT);\r\n        var loadingIcon = dialogue.find(SELECTORS.LOADING_ICON_CONTAINER);\r\n\r\n        if (isLoading) {\r\n            buttons.prop('disabled', true);\r\n            buttonText.addClass('hidden');\r\n            loadingIcon.removeClass('hidden');\r\n        } else {\r\n            buttons.prop('disabled', false);\r\n            buttonText.removeClass('hidden');\r\n            loadingIcon.addClass('hidden');\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Show or hide the header and footer content for edit mode.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Bool} inEditMode In edit mode or not.\r\n     */\r\n    var renderInEditMode = function(header, body, footer, inEditMode) {\r\n        var messages = null;\r\n\r\n        if (inEditMode) {\r\n            messages = body.find(SELECTORS.MESSAGE_NOT_SELECTED);\r\n            messages.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass('hidden');\r\n            hideHeaderContent(header);\r\n            showHeaderEditMode(header);\r\n        } else {\r\n            messages = getMessagesContainer(body);\r\n            messages.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass('hidden');\r\n            messages.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass('hidden');\r\n            showHeaderContent(header);\r\n            hideHeaderEditMode(header);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Select or unselect messages.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} data The messages to select or unselect.\r\n     */\r\n    var renderSelectedMessages = function(header, body, footer, data) {\r\n        var hasSelectedMessages = data.count > 0;\r\n\r\n        if (data.add.length) {\r\n            data.add.forEach(function(messageId) {\r\n                var message = getMessageElement(body, messageId);\r\n                message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).addClass('hidden');\r\n                message.find(SELECTORS.MESSAGE_SELECTED_ICON).removeClass('hidden');\r\n                message.attr('aria-checked', true);\r\n            });\r\n        }\r\n\r\n        if (data.remove.length) {\r\n            data.remove.forEach(function(messageId) {\r\n                var message = getMessageElement(body, messageId);\r\n\r\n                if (hasSelectedMessages) {\r\n                    message.find(SELECTORS.MESSAGE_NOT_SELECTED_ICON).removeClass('hidden');\r\n                }\r\n\r\n                message.find(SELECTORS.MESSAGE_SELECTED_ICON).addClass('hidden');\r\n                message.attr('aria-checked', false);\r\n            });\r\n        }\r\n\r\n        setMessagesSelectedCount(header, data.count);\r\n    };\r\n\r\n    /**\r\n     * Show or hide the require add contact panel.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} data Whether the user has to be added a a contact.\r\n     * @return {Object} jQuery promise\r\n     */\r\n    var renderRequireAddContact = function(header, body, footer, data) {\r\n        if (data.show && !data.hasMessages) {\r\n            return Str.get_strings([\r\n                    {\r\n                        key: 'requirecontacttomessage',\r\n                        component: 'core_message',\r\n                        param: data.user.fullname\r\n                    },\r\n                    {\r\n                        key: 'isnotinyourcontacts',\r\n                        component: 'core_message',\r\n                        param: data.user.fullname\r\n                    }\r\n                ])\r\n                .then(function(strings) {\r\n                    var title = strings[1];\r\n                    var text = strings[0];\r\n                    return showConfirmDialogue(\r\n                        header,\r\n                        body,\r\n                        footer,\r\n                        [SELECTORS.ACTION_REQUEST_ADD_CONTACT],\r\n                        text,\r\n                        title,\r\n                        false,\r\n                        true\r\n                    );\r\n                });\r\n        } else {\r\n            return hideConfirmDialogue(header, body, footer);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Show or hide the self-conversation message.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} displayMessage should the message be displayed?.\r\n     * @return {Object|true} jQuery promise\r\n     */\r\n    var renderSelfConversationMessage = function(header, body, footer, displayMessage) {\r\n        var container = getSelfConversationMessageContainer(body);\r\n        if (displayMessage) {\r\n            container.removeClass('hidden');\r\n        } else {\r\n            container.addClass('hidden');\r\n        }\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Show or hide the unable to message container and enable or disable the footer messaging controls.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {Object} disable should the message be displayed?.\r\n     * @return {Object|true} jQuery promise\r\n     */\r\n    var renderUnableToMessage = function(header, body, footer, disable) {\r\n        if (disable) {\r\n            disableAllFooterContentElements(footer);\r\n            if (!body.find(SELECTORS.DAY_MESSAGE_UNABLE_TO_SEND_CONTAINER).length) {\r\n                showUnableToMessage(body);\r\n            }\r\n        } else {\r\n            enableAllFooterContentElements(footer);\r\n            hideUnableToMessage(body);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Show or hide the require add contact panel.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @param {String} userFullName Full name of the other user.\r\n     * @return {Object|true} jQuery promise\r\n     */\r\n    var renderContactRequestSent = function(header, body, footer, userFullName) {\r\n        var container = getContactRequestSentContainer(body);\r\n        if (userFullName) {\r\n            return Str.get_string('yourcontactrequestpending', 'core_message', truncateUsername(userFullName))\r\n                .then(function(string) {\r\n                    container.find(SELECTORS.TEXT).text(string);\r\n                    container.removeClass('hidden');\r\n                    return string;\r\n                });\r\n        } else {\r\n            container.addClass('hidden');\r\n            return true;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Reset the UI to the initial state.\r\n     *\r\n     * @param {Object} header The header container element.\r\n     * @param {Object} body The body container element.\r\n     * @param {Object} footer The footer container element.\r\n     * @return {Bool}\r\n     */\r\n    var renderReset = function(header, body, footer) {\r\n        hideConfirmDialogue(header, body, footer);\r\n        hideContactRequestSentContainer(body);\r\n        hideSelfConversationMessageContainer(body);\r\n        hideAllHeaderElements(header);\r\n        showHeaderPlaceholder(header);\r\n        hideAllFooterElements(footer);\r\n        showFooterPlaceholder(footer);\r\n        enableAllFooterContentElements(footer);\r\n        hideUnableToMessage(body);\r\n        return true;\r\n    };\r\n\r\n    var render = function(header, body, footer, patch) {\r\n        var configs = [\r\n            {\r\n                // Resetting the UI needs to come first, if it's required.\r\n                reset: renderReset\r\n            },\r\n            {\r\n                // Any async rendering (stuff that requires templates, strings etc) should\r\n                // go in here.\r\n                conversation: renderConversation,\r\n                header: renderHeader,\r\n                footer: renderFooter,\r\n                confirmBlockUser: renderConfirmBlockUser,\r\n                confirmUnblockUser: renderConfirmUnblockUser,\r\n                confirmAddContact: renderConfirmAddContact,\r\n                confirmRemoveContact: renderConfirmRemoveContact,\r\n                confirmDeleteSelectedMessages: renderConfirmDeleteSelectedMessages,\r\n                confirmDeleteConversation: renderConfirmDeleteConversation,\r\n                confirmContactRequest: renderConfirmContactRequest,\r\n                requireAddContact: renderRequireAddContact,\r\n                selfConversationMessage: renderSelfConversationMessage,\r\n                contactRequestSent: renderContactRequestSent,\r\n                unableToMessage: renderUnableToMessage,\r\n            },\r\n            {\r\n                loadingMembers: renderLoadingMembers,\r\n                loadingFirstMessages: renderLoadingFirstMessages,\r\n                loadingMessages: renderLoadingMessages,\r\n                isBlocked: renderIsBlocked,\r\n                isContact: renderIsContact,\r\n                isFavourite: renderIsFavourite,\r\n                isMuted: renderIsMuted,\r\n                loadingConfirmAction: renderLoadingConfirmAction,\r\n                inEditMode: renderInEditMode,\r\n                showEmojiPicker: renderShowEmojiPicker,\r\n                showEmojiAutoComplete: renderShowEmojiAutoComplete,\r\n            },\r\n            {\r\n                // Scrolling should be last to make sure everything\r\n                // on the page is visible.\r\n                scrollToMessage: renderScrollToMessage,\r\n                selectedMessages: renderSelectedMessages\r\n            }\r\n        ];\r\n        // Helper function to process each of the configs above.\r\n        var processConfig = function(config) {\r\n            var results = [];\r\n\r\n            for (var key in patch) {\r\n                if (config.hasOwnProperty(key)) {\r\n                    var renderFunc = config[key];\r\n                    var patchValue = patch[key];\r\n                    results.push(renderFunc(header, body, footer, patchValue));\r\n                }\r\n            }\r\n\r\n            return results;\r\n        };\r\n\r\n        // The first config is special because it resets the UI.\r\n        var renderingPromises = processConfig(configs[0]);\r\n        // The second config is special because it contains async rendering.\r\n        renderingPromises = renderingPromises.concat(processConfig(configs[1]));\r\n\r\n        // Wait for the async rendering to complete before processing the\r\n        // rest of the configs, in order.\r\n        return $.when.apply($, renderingPromises)\r\n            .then(function() {\r\n                for (var i = 2; i < configs.length; i++) {\r\n                    processConfig(configs[i]);\r\n                }\r\n\r\n                return;\r\n            })\r\n            .catch(Notification.exception);\r\n    };\r\n\r\n    /**\r\n     * Truncate long usernames.\r\n     *\r\n     * @param {String} username Text to truncate.\r\n     * @return {String} Truncated string.\r\n     */\r\n    var truncateUsername = function(username) {\r\n        return Truncate.truncate(username, {\r\n            length: 30,\r\n            words: true,\r\n            ellipsis: '...'\r\n        });\r\n    };\r\n\r\n    return {\r\n        render: render,\r\n    };\r\n});\r\n"],"names":["define","$","Notification","Str","Templates","UserDate","Constants","Aria","Truncate","SELECTORS","TEMPLATES","CONVERSATION_TYPES","getMessagesContainer","body","find","CONTENT_MESSAGES_CONTAINER","getSelfConversationMessageContainer","SELF_CONVERSATION_MESSAGE_CONTAINER","getUnableToMessageContainer","UNABLE_TO_MESSAGE_CONTAINER","getMessageTextArea","footer","MESSAGE_TEXT_AREA","getSendMessageButton","SEND_MESSAGE_BUTTON","getEmojiPickerButton","TOGGLE_EMOJI_PICKER_BUTTON","getContactRequestSentContainer","CONTACT_REQUEST_SENT_MESSAGE_CONTAINER","getFooterContentContainer","CONTENT_MESSAGES_FOOTER_CONTAINER","getFooterEditModeContainer","CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER","getFooterPlaceholderContainer","PLACEHOLDER_CONTAINER","showFooterPlaceholder","removeClass","getFooterRequireContactContainer","CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER","getFooterRequireUnblockContainer","CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER","hideAllFooterElements","addClass","hideFooterContent","hideFooterEditMode","hideFooterPlaceholder","hideFooterRequireContact","hideFooterRequireUnblock","getContentPlaceholderContainer","CONTENT_PLACEHOLDER_CONTAINER","getHeaderContent","header","HEADER","showHeaderContent","hideHeaderContent","hideUnableToMessage","enableAllFooterContentElements","prop","enableEmojiPickerButton","enableSendMessageButton","messageTextArea","unhide","get","get_string","done","string","enableMessageTextArea","disableAllFooterContentElements","disableEmojiPickerButton","disableSendMessageButton","removeAttr","disableMessageTextArea","getHeaderEditMode","HEADER_EDIT_MODE","hideHeaderEditMode","getHeaderPlaceholderContainer","HEADER_PLACEHOLDER_CONTAINER","showHeaderPlaceholder","hideHeaderPlaceholder","getMessageElement","messageId","getDayElement","dayTimeCreated","getMoreMessagesLoadingIconContainer","MORE_MESSAGES_LOADING_ICON_CONTAINER","getConfirmDialogueContainer","root","CONFIRM_DIALOGUE_CONTAINER","showConfirmDialogueContainer","container","siblings","hide","attr","hideConfirmDialogueContainer","formatMessagesForTemplate","messages","datesCache","map","message","id","isread","isRead","fromloggedinuser","fromLoggedInUser","userfrom","userFrom","text","formattedtime","timeCreated","renderConversation","data","renderingPromises","hasAddDays","days","add","length","hasAddMessages","hasUpdateMessages","update","timestampsToFormat","datesCachePromise","Deferred","resolve","promise","concat","reduce","carry","day","value","timestamps","push","before","after","then","format","requests","timestamp","formattedTimes","index","isAbleToMessage","messagesContainer","daysRenderPromises","timestampDate","Date","render","DAY","currentyear","getFullYear","when","apply","forEach","html","element","insertBefore","append","always","showUnableToMessage","DAY_MESSAGE_UNABLE_TO_SEND_CONTAINER","last","toggleClass","catch","renderAddDays","unableToMessage","messagesData","formattedMessages","MESSAGES","messageList","messageHtml","DAY_MESSAGES_CONTAINER","renderAddMessages","formattedTime","LOADING_ICON_CONTAINER","TIME_CREATED","sendState","loading","time","retry","RETRY_SEND","TEXT_CONTAINER","errorMessage","messageContainer","ERROR_MESSAGE_CONTAINER","ERROR_MESSAGE","renderUpdateMessages","remove","renderRemoveDays","renderRemoveMessages","renderHeader","headerContainer","template","HEADER_PUBLIC","context","showrouteback","type","PRIVATE","showControls","HEADER_PRIVATE","HEADER_PRIVATE_NO_CONTROLS","SELF","HEADER_SELF","js","replaceNodeContents","renderFooter","get_strings","key","component","param","user","fullname","strings","title","footerContainer","TITLE","TEXT","showFooterRequireContact","showFooterEditMode","showFooterContent","showFooterRequireUnblock","renderScrollToMessage","position","scrollTop","top","renderLoadingMembers","isLoadingMembers","renderLoadingFirstMessages","isLoadingFirstMessages","hideMessagesContainer","showContentPlaceholder","showMessagesContainer","hideContentPlaceholder","renderLoadingMessages","isLoading","showMoreMessagesLoadingIcon","hideMoreMessagesLoadingIcon","renderShowEmojiPicker","show","EMOJI_PICKER_CONTAINER","getEmojiPickerContainer","EMOJI_PICKER_SEARCH_INPUT","focus","renderShowEmojiAutoComplete","EMOJI_AUTO_COMPLETE_CONTAINER","getEmojiAutoCompleteContainer","showConfirmDialogue","buttonSelectors","bodyText","headerText","canCancel","skipHeader","showOk","dialogue","buttons","selector","cancelButton","CONFIRM_DIALOGUE_CANCEL_BUTTON","okayButton","CONFIRM_DIALOGUE_OKAY_BUTTON","CONFIRM_DIALOGUE_TEXT","dialogueHeader","CONFIRM_DIALOGUE_HEADER","CONFIRM_DIALOGUE","prepend","button","CAN_RECEIVE_FOCUS","filter","first","hideConfirmDialogue","hideCheckDeleteDialogue","renderConfirmBlockUser","username","truncateUsername","canmessageevenifblocked","ACTION_CONFIRM_BLOCK","renderConfirmUnblockUser","ACTION_CONFIRM_UNBLOCK","renderConfirmAddContact","userFullName","truncate","words","ellipsis","ACTION_CONFIRM_ADD_CONTACT","renderConfirmRemoveContact","ACTION_CONFIRM_REMOVE_CONTACT","renderConfirmDeleteSelectedMessages","showmessage","canDeleteMessagesForAllUsers","showCheckDeleteDialogue","ACTION_CONFIRM_DELETE_SELECTED_MESSAGES","renderConfirmDeleteConversation","ACTION_CONFIRM_DELETE_CONVERSATION","renderConfirmContactRequest","ACTION_ACCEPT_CONTACT_REQUEST","ACTION_DECLINE_CONTACT_REQUEST","DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER","checkboxRegion","DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE","renderIsBlocked","isBlocked","ACTION_REQUEST_BLOCK","ACTION_REQUEST_UNBLOCK","renderIsFavourite","state","favouriteIcon","FAVOURITE_ICON_CONTAINER","addFavourite","ACTION_CONFIRM_FAVOURITE","removeFavourite","ACTION_CONFIRM_UNFAVOURITE","renderIsMuted","muteIcon","MUTED_ICON_CONTAINER","setMuted","ACTION_CONFIRM_MUTE","unsetMuted","ACTION_CONFIRM_UNMUTE","renderIsContact","addContact","ACTION_REQUEST_ADD_CONTACT","removeContact","ACTION_REQUEST_REMOVE_CONTACT","renderLoadingConfirmAction","buttonText","CONFIRM_DIALOGUE_BUTTON_TEXT","loadingIcon","renderInEditMode","inEditMode","MESSAGE_NOT_SELECTED","MESSAGE_NOT_SELECTED_ICON","showHeaderEditMode","MESSAGE_SELECTED_ICON","renderSelectedMessages","hasSelectedMessages","count","MESSAGES_SELECTED_COUNT","setMessagesSelectedCount","renderRequireAddContact","hasMessages","renderSelfConversationMessage","displayMessage","renderUnableToMessage","disable","renderContactRequestSent","renderReset","hideContactRequestSentContainer","hideSelfConversationMessageContainer","hideAllHeaderElements","patch","configs","reset","conversation","confirmBlockUser","confirmUnblockUser","confirmAddContact","confirmRemoveContact","confirmDeleteSelectedMessages","confirmDeleteConversation","confirmContactRequest","requireAddContact","selfConversationMessage","contactRequestSent","loadingMembers","loadingFirstMessages","loadingMessages","isContact","isFavourite","isMuted","loadingConfirmAction","showEmojiPicker","showEmojiAutoComplete","scrollToMessage","selectedMessages","processConfig","config","results","hasOwnProperty","renderFunc","patchValue","i","exception"],"mappings":"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"}