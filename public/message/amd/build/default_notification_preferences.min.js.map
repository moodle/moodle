{"version":3,"file":"default_notification_preferences.min.js","sources":["../src/default_notification_preferences.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Controls the default settings for the list of notification types on the\r\n * notifications admin page\r\n *\r\n * @module     core_message/default_notification_preferences\r\n * @class      default_notification_preferences\r\n * @copyright  2021 Moodle\r\n * @author     Pau Ferrer Oca√±a <pau@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\nimport * as Ajax from 'core/ajax';\r\nimport Notification from 'core/notification';\r\nimport {add as addToast} from 'core/toast';\r\n\r\nconst selectors = {\r\n    provider: '.defaultmessageoutputs .provider_enabled',\r\n    lockSetting: '.locked_message_setting',\r\n    enabledSetting: '.enabled_message_setting',\r\n    allSettings: '.locked_message_setting, .enabled_message_setting'\r\n};\r\n\r\n/**\r\n * Register event listeners for the default_notification_preferences page.\r\n */\r\nconst registerEventListeners = () => {\r\n\r\n    /**\r\n     * Update the dimmed status of the \"enabled\" toggle on the notification setting.\r\n     *\r\n     * @param {HTMLElement} lockedElement Element that receives the event.\r\n     */\r\n    const toggleLockSetting = (lockedElement) => {\r\n        const isEnabled = lockedElement.checked || false;\r\n        const enabledId = lockedElement.id.replace('_locked[', '_enabled[');\r\n\r\n        const enabledElement = document.getElementById(enabledId).closest('div.form-check');\r\n        enabledElement.classList.toggle('dimmed_text', isEnabled);\r\n    };\r\n\r\n    /**\r\n     * Enable/Disable all settings of the provider.\r\n     *\r\n     * @param {HTMLElement} providerEnabledElement Element that receives the event.\r\n     */\r\n    const toggleEnableProviderSettings = (providerEnabledElement) => {\r\n        const isEnabled = providerEnabledElement.checked || false;\r\n        const parentRow = providerEnabledElement.closest('tr');\r\n\r\n        const elements = parentRow.querySelectorAll(selectors.allSettings);\r\n        elements.forEach((element) => {\r\n            element.toggleAttribute('disabled', !isEnabled);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * AJAX call to update the default notification element status on the server.\r\n     *\r\n     * @param {Boolean} isEnabled\r\n     * @param {string} preference\r\n     */\r\n    const setDefaultNotification = (isEnabled, preference) => {\r\n        // AJAX call to update the provider's enable status on the server.\r\n        Ajax.call([{\r\n            methodname: 'core_message_set_default_notification',\r\n            args: {\r\n                preference: preference,\r\n                state: isEnabled ? 1 : 0\r\n            }\r\n        }])[0]\r\n        .then((data) => addToast(data.successmessage))\r\n        .catch(Notification.exception);\r\n    };\r\n\r\n    const container = document.querySelector('.preferences-container');\r\n\r\n    container.querySelectorAll(selectors.provider).forEach((providerEnabledElement) => {\r\n        // Set the initial statuses.\r\n        if (!providerEnabledElement.checked) {\r\n            toggleEnableProviderSettings(providerEnabledElement);\r\n        }\r\n\r\n        providerEnabledElement.addEventListener('change', (e) => {\r\n            toggleEnableProviderSettings(e.target);\r\n\r\n            setDefaultNotification(\r\n                e.target.checked,\r\n                providerEnabledElement.parentElement.parentElement.dataset.preference);\r\n        });\r\n    });\r\n\r\n    container.querySelectorAll(selectors.lockSetting).forEach((lockedElement) => {\r\n        // Set the initial statuses.\r\n        if (lockedElement.checked) {\r\n            toggleLockSetting(lockedElement);\r\n        }\r\n\r\n        lockedElement.addEventListener('change', (e) => {\r\n            toggleLockSetting(e.target);\r\n\r\n            setDefaultNotification(\r\n                e.target.checked,\r\n                lockedElement.parentElement.parentElement.dataset.preference);\r\n        });\r\n    });\r\n\r\n    container.querySelectorAll(selectors.enabledSetting).forEach((enabledElement) => {\r\n        enabledElement.addEventListener('change', (e) => {\r\n            setDefaultNotification(\r\n                e.target.checked,\r\n                enabledElement.parentElement.parentElement.dataset.preference);\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * Initialize the page.\r\n */\r\nconst init = () => {\r\n    registerEventListeners();\r\n};\r\n\r\nexport default {\r\n    init: init,\r\n};\r\n"],"names":["selectors","init","toggleLockSetting","lockedElement","isEnabled","checked","enabledId","id","replace","document","getElementById","closest","classList","toggle","toggleEnableProviderSettings","providerEnabledElement","querySelectorAll","forEach","element","toggleAttribute","setDefaultNotification","preference","Ajax","call","methodname","args","state","then","data","successmessage","catch","Notification","exception","container","querySelector","addEventListener","e","target","parentElement","dataset","enabledElement","registerEventListeners"],"mappings":";;;;;;;;;;sFA6BMA,mBACQ,2CADRA,sBAEW,0BAFXA,yBAGc,2BAHdA,sBAIW,iEAuGF,CACXC,KALS,KA7FkB,YAOrBC,kBAAqBC,sBACjBC,UAAYD,cAAcE,UAAW,EACrCC,UAAYH,cAAcI,GAAGC,QAAQ,WAAY,aAEhCC,SAASC,eAAeJ,WAAWK,QAAQ,kBACnDC,UAAUC,OAAO,cAAeT,YAQ7CU,6BAAgCC,+BAC5BX,UAAYW,uBAAuBV,UAAW,EAClCU,uBAAuBJ,QAAQ,MAEtBK,iBAAiBhB,uBACnCiB,SAASC,UACdA,QAAQC,gBAAgB,YAAaf,eAUvCgB,uBAAyB,CAAChB,UAAWiB,cAEvCC,KAAKC,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFJ,WAAYA,WACZK,MAAOtB,UAAY,EAAI,MAE3B,GACHuB,MAAMC,OAAS,cAASA,KAAKC,kBAC7BC,MAAMC,sBAAaC,YAGlBC,UAAYxB,SAASyB,cAAc,0BAEzCD,UAAUjB,iBAAiBhB,oBAAoBiB,SAASF,yBAE/CA,uBAAuBV,SACxBS,6BAA6BC,wBAGjCA,uBAAuBoB,iBAAiB,UAAWC,IAC/CtB,6BAA6BsB,EAAEC,QAE/BjB,uBACIgB,EAAEC,OAAOhC,QACTU,uBAAuBuB,cAAcA,cAAcC,QAAQlB,kBAIvEY,UAAUjB,iBAAiBhB,uBAAuBiB,SAASd,gBAEnDA,cAAcE,SACdH,kBAAkBC,eAGtBA,cAAcgC,iBAAiB,UAAWC,IACtClC,kBAAkBkC,EAAEC,QAEpBjB,uBACIgB,EAAEC,OAAOhC,QACTF,cAAcmC,cAAcA,cAAcC,QAAQlB,kBAI9DY,UAAUjB,iBAAiBhB,0BAA0BiB,SAASuB,iBAC1DA,eAAeL,iBAAiB,UAAWC,IACvChB,uBACIgB,EAAEC,OAAOhC,QACTmC,eAAeF,cAAcA,cAAcC,QAAQlB,mBAS/DoB"}