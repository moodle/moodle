# Class Hierarchy in `classes.php`

This document outlines the object-oriented structure of the Smart File Importer, defined in `classes.php`. The plugin uses a class-based system to handle various file formats.

## The `SmartFileBase` Abstract Class

`SmartFileBase` is the foundation for all file importer classes. It defines the common interface and provides shared functionality for validating files, extracting data, and importing grades into the Moodle gradebook.

### Properties

- `protected $filecontents`: An array of lines from the uploaded file.
- `protected $name`: A localized string for the name of the file type.
- `public $ids_to_grades`: An associative array mapping student identifiers (e.g., pawsid, lsuid) to grades.
- `public $bad_lines`: An array of lines from the file that failed validation.
- `public $bad_ids`: An array of student identifiers that were not found in the course.
- `protected $courseid`: The ID of the course the grades are being imported into.
- `protected $moodleidstogrades`: An associative array mapping Moodle user IDs to grades.

### Key Methods

- `__construct($filecontents)`: The constructor, which takes the file content and splits it into lines.
- `validate()`: Iterates through each line of the file and calls the `validate_line()` method to check for validity.
- `extract_data()`: An abstract method that must be implemented by subclasses to parse the file and populate the `$ids_to_grades` array.
- `convert_ids()`: Converts the student identifiers in `$ids_to_grades` to Moodle user IDs and stores them in `$moodleidstogrades`.
- `insert_grades()`: Inserts the grades from `$moodleidstogrades` into the Moodle gradebook.
- `validate_line($line)`: A static method that must be implemented by subclasses to determine if a given line matches the expected format.

---

## `SmartFile*` Subclasses

Each subclass of `SmartFileBase` is designed to handle a specific file format. The core responsibility of each subclass is to implement the `validate_line()` and `extract_data()` methods.

- **`SmartFileFixed`**: Handles fixed-width files with an 8-digit LSU ID and a grade.
- **`SmartFileInsane`**: A more flexible version of `SmartFileFixed` that allows for extra text between the ID and the grade.
- **`SmartFileMEC`**: For files from the Measurement and Evaluation Center, with an 11-digit MEC LSU ID.
- **`SmartFileAnonymous`**: Handles files with a 4-digit anonymous number and a grade, for anonymous grading.
- **`SmartFileTabLongLsuid` / `SmartFileTabLongPawsid`**: For tab-delimited files with extra columns, keyed by LSU ID or pawsid.
- **`SmartFileTabShortLsuid` / `SmartFileTabShortPawsid`**: For simple tab-delimited files with an LSU ID or pawsid and a grade.
- **`SmartFileCSVLsuid` / `SmartFileCSVPawsid`**: For comma-separated files with an LSU ID or pawsid and a grade.
- **`SmartFileCommaLongLsuid` / `SmartFileCommaLongPawsid`**: For comma-separated files with extra columns, keyed by LSU ID or pawsid.
- **`SmartFileMaple`**: Handles a specific format exported from the Maple software package.
- **`SmartFileTurning`**: For files generated by the Turning Technologies software.
- **`SmartFileEmail`**: A generic format with an email and a grade.
- **`SmartFileKeypadidCSV`**: For comma-separated files with a keypad ID and a grade.
- **`SmartFile89NumberCSV`**: Handles comma-separated files with a 9-digit "89" number.
- **`SmartFileKeypadidTabbed`**: For tab- or space-delimited files with a keypad ID and a grade.
