{"version":3,"sources":["../src/managedocsactions.js"],"names":["define","$","Log","Config","Str","ModalFactory","ModalEvents","ACTION","LINKS","MAKE_CURRENT","INACTIVATE","DELETE","ManageDocsActions","base","initEvents","prototype","self","on","e","stopPropagation","link","currentTarget","promise","strings","is","get_strings","key","component","param","name","closest","attr","revision","error","preventDefault","then","strs","create","title","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","save","window","location","href","sesskey","hidden","destroy","show","catch","init","baseid","document","getElementById","length","Error"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Adds support for confirmation via JS modal for some management actions at the Manage policies page.\n *\n * @module      tool_policy/managedocsactions\n * @copyright   2018 David Mudr√°k <david@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/log',\n    'core/config',\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events'\n], function($, Log, Config, Str, ModalFactory, ModalEvents) {\n\n    \"use strict\";\n\n    /**\n     * List of action selectors.\n     *\n     * @property {string} LINKS - Selector for all action links\n     * @property {string} MAKE_CURRENT\n     */\n    var ACTION = {\n        LINKS: '[data-action]',\n        MAKE_CURRENT: '[data-action=\"makecurrent\"]',\n        INACTIVATE: '[data-action=\"inactivate\"]',\n        DELETE: '[data-action=\"delete\"]'\n    };\n\n    /**\n     * @constructor\n     * @param {Element} base - Management area wrapping element\n     */\n    function ManageDocsActions(base) {\n        this.base = base;\n\n        this.initEvents();\n    }\n\n    /**\n     * Register event listeners.\n     */\n    ManageDocsActions.prototype.initEvents = function() {\n        var self = this;\n\n        self.base.on('click', ACTION.LINKS, function(e) {\n            e.stopPropagation();\n\n            var link = $(e.currentTarget);\n            var promise;\n            var strings;\n\n            if (link.is(ACTION.MAKE_CURRENT)) {\n                promise = Str.get_strings([\n                    {key: 'activating', component: 'tool_policy'},\n                    {key: 'activateconfirm', component: 'tool_policy', param: {\n                        name: link.closest('[data-policy-name]').attr('data-policy-name'),\n                        revision: link.closest('[data-policy-revision]').attr('data-policy-revision')\n                    }},\n                    {key: 'activateconfirmyes', component: 'tool_policy'}\n                ]);\n\n            } else if (link.is(ACTION.INACTIVATE)) {\n                promise = Str.get_strings([\n                    {key: 'inactivating', component: 'tool_policy'},\n                    {key: 'inactivatingconfirm', component: 'tool_policy', param: {\n                        name: link.closest('[data-policy-name]').attr('data-policy-name'),\n                        revision: link.closest('[data-policy-revision]').attr('data-policy-revision')\n                    }},\n                    {key: 'inactivatingconfirmyes', component: 'tool_policy'}\n                ]);\n\n            } else if (link.is(ACTION.DELETE)) {\n                promise = Str.get_strings([\n                    {key: 'deleting', component: 'tool_policy'},\n                    {key: 'deleteconfirm', component: 'tool_policy', param: {\n                        name: link.closest('[data-policy-name]').attr('data-policy-name'),\n                        revision: link.closest('[data-policy-revision]').attr('data-policy-revision')\n                    }},\n                    {key: 'delete', component: 'core'}\n                ]);\n\n            } else {\n                Log.error('unknown action type detected', 'tool_policy/managedocsactions');\n                return;\n            }\n\n            e.preventDefault();\n\n            promise.then(function(strs) {\n                strings = strs;\n                return ModalFactory.create({\n                    title: strings[0],\n                    body: strings[1],\n                    type: ModalFactory.types.SAVE_CANCEL\n                });\n\n            }).then(function(modal) {\n                modal.setSaveButtonText(strings[2]);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    window.location.href = link.attr('href') + '&sesskey=' + Config.sesskey + '&confirm=1';\n                });\n\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n\n                modal.show();\n                return true;\n\n            }).catch(function(e) {\n                Log.error(e);\n                return false;\n            });\n        });\n    };\n\n    return {\n        /**\n         * Factory method returning instance of the ManageDocsActions\n         *\n         * @param {String} baseid - ID of the management area wrapping element\n         * @return {ManageDocsActions}\n         */\n        init: function(baseid) {\n            var base = $(document.getElementById(baseid));\n\n            if (base.length) {\n                return new ManageDocsActions(base);\n\n            } else {\n                throw new Error(\"managedocsactions: Invalid base element identifier\");\n            }\n        }\n    };\n});\n"],"file":"managedocsactions.min.js"}