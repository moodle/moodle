define(["jquery","core/notification","core/templates","core/ajax","tool_lp/dialogue","tool_lp/scalevalues"],function(a,b,c,d,e,f){var g=null,h=0,i=0,j=function(){if(i=a("#id_scaleid").val(),!(0>=i)){var d=a("#id_scaleid option:selected").text();n(i).done(function(){var a={scalename:d,scales:g};c.render("tool_lp/scale_configuration_page",a).done(function(a){new e(d,a,l)}).fail(b.exception)}).fail(b.exception)}},k=function(){var b=a("#tool_lp_scaleconfiguration").val();if(""!==b){var c=a.parseJSON(b),d=c.shift();if(d.scaleid===h)return c}return""},l=function(b){var c=a(b.getContent());if(h===i){var d=k();""!==d&&d.forEach(function(b){1===b.scaledefault&&a("#tool_lp_scale_default_"+b.id).attr("checked",!0),1===b.proficient&&a("#tool_lp_scale_proficient_"+b.id).attr("checked",!0)})}c.on("click",'[data-action="close"]',function(){m(),b.close()}),c.on("click",'[data-action="cancel"]',function(){b.close()})},m=function(){var b=[{scaleid:i}];g.forEach(function(c){var d=0,e=0;a("#tool_lp_scale_default_"+c.id).is(":checked")&&(d=1),a("#tool_lp_scale_proficient_"+c.id).is(":checked")&&(e=1),b.push({name:c.name,id:c.id,scaledefault:d,proficient:e})});var c=JSON.stringify(b);a("#tool_lp_scaleconfiguration").val(c),h=i},n=function(a){return f.get_values(a).then(function(a){return g=a,a})},o=function(b){a(b.target).val()<=0?a("#id_scaleconfigbutton").prop("disabled",!0):a("#id_scaleconfigbutton").prop("disabled",!1)};return{init:function(){h=a("#id_scaleid").val(),a("#id_scaleid").on("change",o).change(),a("#id_scaleconfigbutton").click(j)}}});