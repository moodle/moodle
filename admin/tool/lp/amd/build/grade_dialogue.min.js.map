{"version":3,"file":"grade_dialogue.min.js","sources":["../src/grade_dialogue.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Grade dialogue.\n *\n * @package    tool_lp\n * @copyright  2016 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery',\n        'core/notification',\n        'core/templates',\n        'tool_lp/dialogue',\n        'tool_lp/event_base',\n        'core/str'],\n        function($, Notification, Templates, Dialogue, EventBase, Str) {\n\n    /**\n     * Grade dialogue class.\n     * @param {Array} ratingOptions\n     */\n    var Grade = function(ratingOptions) {\n        EventBase.prototype.constructor.apply(this, []);\n        this._ratingOptions = ratingOptions;\n    };\n    Grade.prototype = Object.create(EventBase.prototype);\n\n    /** @type {Dialogue} The dialogue. */\n    Grade.prototype._popup = null;\n    /** @type {Array} Array of objects containing, 'value', 'name' and optionally 'selected'. */\n    Grade.prototype._ratingOptions = null;\n\n    /**\n     * After render hook.\n     *\n     * @method _afterRender\n     * @protected\n     */\n    Grade.prototype._afterRender = function() {\n        var btnRate = this._find('[data-action=\"rate\"]'),\n            lstRating = this._find('[name=\"rating\"]'),\n            txtComment = this._find('[name=\"comment\"]');\n\n        this._find('[data-action=\"cancel\"]').click(function(e) {\n            e.preventDefault();\n            this._trigger('cancelled');\n            this.close();\n        }.bind(this));\n\n        lstRating.change(function() {\n            var node = $(this);\n            if (!node.val()) {\n                btnRate.prop('disabled', true);\n            } else {\n                btnRate.prop('disabled', false);\n            }\n        }).change();\n\n        btnRate.click(function(e) {\n            e.preventDefault();\n            var val = lstRating.val();\n            if (!val) {\n                return;\n            }\n            this._trigger('rated', {\n                'rating': val,\n                'note': txtComment.val()\n            });\n            this.close();\n        }.bind(this));\n    };\n\n    /**\n     * Close the dialogue.\n     *\n     * @method close\n     */\n    Grade.prototype.close = function() {\n        this._popup.close();\n        this._popup = null;\n    };\n\n    /**\n     * Opens the picker.\n     *\n     * @param {Number} competencyId The competency ID of the competency to work on.\n     * @method display\n     * @return {Promise}\n     */\n    Grade.prototype.display = function() {\n        M.util.js_pending('tool_lp/grade_dialogue:display');\n        return $.when(\n            Str.get_string('rate', 'tool_lp'),\n            this._render()\n        )\n        .then(function(title, templateResult) {\n            this._popup = new Dialogue(\n                title,\n                templateResult[0],\n                function() {\n                    this._afterRender();\n                    M.util.js_complete('tool_lp/grade_dialogue:display');\n                }.bind(this)\n            );\n\n            return this._popup;\n        }.bind(this))\n        .catch(Notification.exception);\n    };\n\n    /**\n     * Find a node in the dialogue.\n     *\n     * @param {String} selector\n     * @method _find\n     * @returns {node} The node\n     * @protected\n     */\n    Grade.prototype._find = function(selector) {\n        return $(this._popup.getContent()).find(selector);\n    };\n\n    /**\n     * Render the dialogue.\n     *\n     * @method _render\n     * @protected\n     * @return {Promise}\n     */\n    Grade.prototype._render = function() {\n        var context = {\n            cangrade: this._canGrade,\n            ratings: this._ratingOptions\n        };\n        return Templates.render('tool_lp/competency_grader', context);\n    };\n\n    return /** @alias module:tool_lp/grade_dialogue */ Grade;\n\n});\n"],"names":["define","$","Notification","Templates","Dialogue","EventBase","Str","Grade","ratingOptions","prototype","constructor","apply","this","_ratingOptions","Object","create","_popup","_afterRender","btnRate","_find","lstRating","txtComment","click","e","preventDefault","_trigger","close","bind","change","val","prop","rating","display","M","util","js_pending","when","get_string","_render","then","title","templateResult","js_complete","catch","exception","selector","getContent","find","context","cangrade","_canGrade","ratings","render"],"mappings":";;;;;;;AAuBAA,OAAM,yBAAC,CAAC,SACA,oBACA,iBACA,mBACA,qBACA,aACA,SAASC,EAAGC,aAAcC,UAAWC,SAAUC,UAAWC,KAM9D,IAAIC,MAAQ,SAASC,eACjBH,UAAUI,UAAUC,YAAYC,MAAMC,KAAM,IACvCC,KAAAA,eAAiBL,aACzB,EAiHD,OAhHAD,MAAME,UAAYK,OAAOC,OAAOV,UAAUI,YAG1BO,OAAS,KAEzBT,MAAME,UAAUI,eAAiB,KAQjCN,MAAME,UAAUQ,aAAe,WAC3B,IAAIC,QAAUN,KAAKO,MAAM,wBACrBC,UAAYR,KAAKO,MAAM,mBACvBE,WAAaT,KAAKO,MAAM,oBAEvBA,KAAAA,MAAM,0BAA0BG,MAAM,SAASC,GAChDA,EAAEC,iBACGC,KAAAA,SAAS,aACdb,KAAKc,OACR,EAACC,KAAKf,OAEPQ,UAAUQ,QAAO,WACF3B,EAAEW,MACHiB,MAGNX,QAAQY,KAAK,YAAY,GAFzBZ,QAAQY,KAAK,YAAY,EAIhC,IAAEF,SAEHV,QAAQI,MAAM,SAASC,GACnBA,EAAEC,iBACF,IAAIK,IAAMT,UAAUS,MACfA,MAGAJ,KAAAA,SAAS,QAAS,CACnBM,OAAUF,IACFR,KAAAA,WAAWQ,QAEvBjB,KAAKc,QACR,EAACC,KAAKf,MACV,EAODL,MAAME,UAAUiB,MAAQ,WACfV,KAAAA,OAAOU,QACPV,KAAAA,OAAS,IACjB,EASDT,MAAME,UAAUuB,QAAU,WAEf/B,OADPgC,EAAEC,KAAKC,WAAW,kCACXlC,EAAEmC,KACL9B,IAAI+B,WAAW,OAAQ,WACvBzB,KAAK0B,WAERC,KAAK,SAASC,MAAOC,gBAUlB,OATA7B,KAAKI,OAAS,IAAIZ,SACdoC,MACAC,eAAe,GACf,WACI7B,KAAKK,eACLgB,EAAEC,KAAKQ,YAAY,iCACtB,EAACf,KAAKf,OAGJA,KAAKI,MACf,EAACW,KAAKf,OACN+B,MAAMzC,aAAa0C,UACvB,EAUDrC,MAAME,UAAUU,MAAQ,SAAS0B,UAC7B,OAAO5C,EAAEW,KAAKI,OAAO8B,cAAcC,KAAKF,SAC3C,EASDtC,MAAME,UAAU6B,QAAU,WACtB,IAAIU,QAAU,CACVC,SAAUrC,KAAKsC,UACfC,QAASvC,KAAKC,gBAElB,OAAOV,UAAUiD,OAAO,4BAA6BJ,QACxD,EAEkDzC,KAEtD"}