define(["jquery"],function(a){var b=function(){a(".tool-lp-menu .tool-lp-sub-menu").attr("aria-hidden","true")},c=function(a,b){this.menuRoot=a,this.handlers=b,this.rootMenus=this.menuRoot.children("li"),this.subMenus=this.rootMenus.children("ul"),this.subMenuItems=this.subMenus.children("li"),this.allItems=this.rootMenus.add(this.subMenuItems),this.activeItem=null,this.isChildOpen=!1,this.keys={tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40},this.addAriaAttributes(),this.addEventListeners()};return c.prototype.openSubMenu=function(a){this.setOpenDirection(),b(),a.attr("aria-hidden","false")},c.prototype.addEventListeners=function(){var b=this;this.subMenuItems.mouseenter(function(){return a(this).addClass("menu-hover"),!0}),this.subMenuItems.mouseout(function(){return a(this).removeClass("menu-hover"),!0}),this.allItems.click(function(c){return b.handleClick(a(this),c)}),this.allItems.keydown(function(c){return b.handleKeyDown(a(this),c)}),this.allItems.focus(function(){return b.handleFocus(a(this))}),this.allItems.blur(function(){return b.handleBlur(a(this))})},c.prototype.handleClick=function(b,c){var d=b.parent();if(!d.is(".tool-lp-menu")){this.allItems.removeClass("menu-hover menu-focus"),this.menuRoot.find("ul").not(".root-level").attr("aria-hidden","true");var e=b.find("a").first(),f=new a.Event("click");f.target=e;var g=!1;return this.handlers&&a.each(this.handlers,function(c,d){if(g)return!1;if(b.find(c).length>0){var h=a.proxy(d,e);g=h(f)===!1||f.isDefaultPrevented()}}),g||"#"===e.attr("href")||(window.location.href=e.attr("href")),!0}return"true"==b.children("ul").first().attr("aria-hidden")?this.openSubMenu(b.children("ul").first()):b.children("ul").first().attr("aria-hidden","true"),c.stopPropagation(),!1},c.prototype.handleFocus=function(a){if(null===this.activeItem)this.activeItem=a;else if(a[0]!=this.activeItem[0])return!0;var b=this.activeItem.parentsUntil("ul.tool-lp-menu").filter("li");if(this.allItems.removeClass("menu-focus"),this.activeItem.addClass("menu-focus"),b.addClass("menu-focus"),this.isChildOpen===!0){var c=a.parent();c.is(".tool-lp-menu")&&"true"==a.attr("aria-haspopup")&&this.openSubMenu(a.children("ul").first())}return!0},c.prototype.handleBlur=function(a){return a.removeClass("menu-focus"),!0},c.prototype.setOpenDirection=function(){var b=this.menuRoot.offset(),c=a(document.body).hasClass("dir-rtl"),d=160,e=!1;c?b.left-d<0&&(e=!0):b.left+d>a(window).width()&&(e=!0),e?this.menuRoot.addClass("tool-lp-menu-open-left"):this.menuRoot.removeClass("tool-lp-menu-open-left")},c.prototype.handleKeyDown=function(b,c){if(c.altKey||c.ctrlKey)return!0;switch(c.keyCode){case this.keys.tab:this.menuRoot.find("ul").attr("aria-hidden","true"),this.allItems.removeClass("menu-focus"),this.activeItem=null,this.isChildOpen=!1;break;case this.keys.esc:var d=b.parent();return d.is(".tool-lp-menu")?b.children("ul").first().attr("aria-hidden","true"):(this.activeItem=d.parent(),this.isChildOpen=!1,this.activeItem.focus(),d.attr("aria-hidden","true")),c.stopPropagation(),!1;case this.keys.enter:case this.keys.space:var e=b.parent();if(!e.is(".tool-lp-menu")){this.allItems.removeClass("menu-hover"),this.allItems.removeClass("menu-focus"),this.menuRoot.find("ul").not(".tool-lp-menu").attr("aria-hidden","true"),this.activeItem=null;var f=b.find("a").first(),g=new a.Event("click");g.target=f;var h=!1;return this.handlers&&a.each(this.handlers,function(c,d){if(h)return!1;if(b.find(c).length>0){var e=a.proxy(d,f);h=e(g)===!1||g.isDefaultPrevented()}}),h||(window.location.href=f.attr("href")),!0}return this.openSubMenu(b.children("ul").first()),c.stopPropagation(),!1;case this.keys.left:return this.activeItem=this.moveToPrevious(b),this.activeItem.focus(),c.stopPropagation(),!1;case this.keys.right:return this.activeItem=this.moveToNext(b),this.activeItem.focus(),c.stopPropagation(),!1;case this.keys.up:return this.activeItem=this.moveUp(b),this.activeItem.focus(),c.stopPropagation(),!1;case this.keys.down:return this.activeItem=this.moveDown(b),this.activeItem.focus(),c.stopPropagation(),!1}return!0},c.prototype.moveToNext=function(a){var b=a.parent(),c=b.children("li"),d=c.length,e=c.index(a),f=null,g=null;if(b.is(".tool-lp-menu"))f=d-1>e?a.next():c.first(),"true"==a.attr("aria-haspopup")&&(g=a.children("ul").first(),"false"==g.attr("aria-hidden")&&(g.attr("aria-hidden","true"),this.isChildOpen=!0)),a.removeClass("menu-focus"),"true"===f.attr("aria-haspopup")&&this.isChildOpen===!0&&(g=f.children("ul").first(),this.openSubMenu(g));else if("true"==a.attr("aria-haspopup"))g=a.children("ul").first(),f=g.children("li").first(),this.openSubMenu(g);else{var h=null,i=null;h=a.parentsUntil("ul.tool-lp-menu").filter("ul").not(".tool-lp-menu"),h.attr("aria-hidden","true"),h.find("li").removeClass("menu-focus"),h.last().parent().removeClass("menu-focus"),i=h.last().parent(),e=this.rootMenus.index(i),f=e<this.rootMenus.length-1?i.next():this.rootMenus.first(),f.addClass("menu-focus"),"true"==f.attr("aria-haspopup")&&(g=f.children("ul").first(),f=g.children("li").first(),this.openSubMenu(g),this.isChildOpen=!0)}return f},c.prototype.moveToPrevious=function(a){var b=a.parent(),c=b.children("li"),d=c.index(a),e=null,f=null;if(b.is(".tool-lp-menu"))e=d>0?a.prev():c.last(),"true"==a.attr("aria-haspopup")&&(f=a.children("ul").first(),"false"==f.attr("aria-hidden")&&(f.attr("aria-hidden","true"),this.isChildOpen=!0)),a.removeClass("menu-focus"),"true"===e.attr("aria-haspopup")&&this.isChildOpen===!0&&(f=e.children("ul").first(),this.openSubMenu(f));else{var g=b.parent(),h=g.parent();h.is(".tool-lp-menu")?(b.attr("aria-hidden","true"),a.removeClass("menu-focus"),g.removeClass("menu-focus"),d=this.rootMenus.index(g),e=d>0?g.prev():this.rootMenus.last(),e.addClass("menu-focus"),"true"==e.attr("aria-haspopup")&&(f=e.children("ul").first(),this.openSubMenu(f),this.isChildOpen=!0,e=f.children("li").first())):(e=b.parent(),b.attr("aria-hidden","true"),a.removeClass("menu-focus"))}return e},c.prototype.moveDown=function(a,b){var c=a.parent(),d=c.children("li").not(".separator"),e=d.length,f=d.index(a),g=null,h=null;if(c.is(".tool-lp-menu"))return"true"!=a.attr("aria-haspopup")?a:(h=a.children("ul").first(),g=h.children("li").first(),this.openSubMenu(h),g);if(b){var i=!1,j=f+1;for(j==e&&(j=0);j!=f;){var k=d.eq(j).html().charAt(0);if(k.toLowerCase()==b){i=!0;break}j+=1,j==e&&(j=0)}return i===!0?(g=d.eq(j),a.removeClass("menu-focus"),g):a}return g=e-1>f?d.eq(f+1):d.first(),a.removeClass("menu-focus"),g},c.prototype.moveUp=function(a){var b=a.parent(),c=b.children("li").not(".separator"),d=c.index(a),e=null;return b.is(".tool-lp-menu")?a:(e=d>0?c.eq(d-1):c.last(),a.removeClass("menu-focus"),e)},c.prototype.addAriaAttributes=function(){this.menuRoot.attr("role","menubar"),this.rootMenus.attr("role","menuitem"),this.rootMenus.attr("tabindex","0"),this.rootMenus.attr("aria-haspopup","true"),this.subMenus.attr("role","menu"),this.subMenus.attr("aria-hidden","true"),this.subMenuItems.attr("role","menuitem"),this.subMenuItems.attr("tabindex","-1"),this.menuRoot.addClass("tool-lp-menu"),this.allItems.addClass("tool-lp-menu-item"),this.rootMenus.addClass("tool-lp-root-menu"),this.subMenus.addClass("tool-lp-sub-menu")},{enhance:function(b,d){a(b).each(function(b,e){var f=a(e);f.data("menubarEnhanced")!==!0&&(new c(f,d),f.data("menubarEnhanced",!0))})},closeAll:b}});