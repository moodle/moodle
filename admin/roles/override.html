            <form action="override.php" method="post">     
            <input type="hidden" name="contextid" value="<?php echo $contextid; ?>">
            <input type="hidden" name="roleid" value="<?php echo $roleid; ?>">
<?php
if ($userid) {
    print ('<input type="hidden" name="userid" value="'.$userid.'"/>');
}
if ($courseid) {
    print ('<input type="hidden" name="courseid" value="'.$courseid.'" />');
}?>
            <table class="override">
            <tr>
                <td>Capability Name</td>
                <td>Inherit</td>
                <td>Allow</td>
                <td>Prevent</td>
                <td>Prohibit</td>
            </tr>
            <?php 
            
            // init these 2
            $contextlevel = 0;
            $component = '';
            
            foreach ($capabilities as $capability) {
            // prints a breaker if component or name or context level  
                if ($capability->component != $component or $capability->contextlevel != $contextlevel) {
                    echo ('<tr><td colspan="5"><b>'.get_component_string($capability->component, $capability->contextlevel).'</b></td></tr>');  
                }
                
                // these 2 are used to see to group same mod/core capabilities together
                $contextlevel = $capability->contextlevel;
                $component = $capability->component;
                
                // check the capability override for this cap, this role in this context
                
                $SQL = "select * from {$CFG->prefix}role_capabilities where
                        roleid = $roleid and capability = '$capability->name' and contextid = $contextid";
                        
                $localoverride = get_record_sql($SQL);
                
                if (isset($r_caps[$capability->name])) {
                    $isallow = $r_caps[$capability->name] > 0;
                    $isprevent = $r_caps[$capability->name] < 0 && $r_caps[$capability->name] > -500;
                    $isprohibit = $r_caps[$capability->name] <= -500;
                } else {
                    $isallow = 0;
                    $isprevent = 0;
                    $isprohibit = 0;  
                }
                
            ?>
                
            <tr>
              <td><?php echo get_capability_string($capability->name); ?></td>
                 <td><input type="radio" name="<?php echo $capability->name; ?>" VALUE="0" <?php if (!isset($localoverride->permission) || $localoverride->permission==0){ echo 'checked="checked"';} if ($isprohibit || islegacy($capability->name)) {echo 'disabled="disabled"'; }?>></td>
                 <td <?php if ($isallow) {echo "bgcolor=#ffffff";} ?>><INPUT TYPE=radio NAME="<?php echo $capability->name; ?>" VALUE="1" <?php if (isset($localoverride->permission) && $localoverride->permission==1){ echo 'checked="checked"'; } if ($isprohibit || islegacy($capability->name)) {echo 'disabled="disabled"'; }?>></td>
                 <td <?php if ($isprevent) {echo "bgcolor=#ffffff";} ?>><INPUT TYPE=radio NAME="<?php echo $capability->name; ?>" VALUE="-1" <?php if (isset($localoverride->permission) && $localoverride->permission==-1){ echo 'checked="checked"'; } if ($isprohibit || islegacy($capability->name)) {echo 'disabled="disabled"'; }?>></td>
                 <td <?php if ($isprohibit) {echo "bgcolor=#ffffff";} ?>><INPUT TYPE=radio NAME="<?php echo $capability->name; ?>" VALUE="-1000" <?php if (isset($localoverride->permission) && $localoverride->permission==-1000){ echo 'checked="checked"'; } if ($isprohibit || islegacy($capability->name)) {echo 'disabled="disabled"'; }?>></td>
            </tr>
            
            <?php } ?>    
            </table>     
            <input type="submit" value="modify">
            </form>
