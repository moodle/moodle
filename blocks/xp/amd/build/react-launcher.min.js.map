{"version":3,"file":"react-launcher.min.js","sources":["../src/react-launcher.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.lup.plus\n\n/**\n * React app launcher.\n *\n * @copyright  2024 Frédéric Massart\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Pending from 'core/pending';\nimport Log from 'core/log';\nimport Notification from 'core/notification';\n\n/**\n * App launcher.\n *\n * @param {String} mod The module name.\n * @param {String} rootId The root ID.\n * @param {String} propsId The props ID.\n */\nexport function launch(mod, rootId, propsId) {\n    const props = JSON.parse(document.getElementById(propsId).textContent);\n    launchWithProps(mod, rootId, props);\n}\n\n/**\n * App launcher with props.\n *\n * @param {String} mod The module name.\n * @param {String} rootId The root ID.\n * @param {Object} props The props.\n */\nasync function launchWithProps(mod, rootId, props = {}) {\n    const {startApp} = await loadModule(mod);\n    startApp(document.getElementById(rootId), props);\n}\n\n/**\n * Load the module.\n *\n * @param {String} mod The react module.\n * @returns {Promise} Resolving with the module exported values.\n */\nasync function loadModule(mod) {\n    const loader = $.Deferred();\n    const pending = new Pending('block_xp/react-launcher:launch');\n\n    // Load the app module. By convension a module app needs to return\n    // an object with (at least) two properties: `dependencies`, and `startApp`.\n    require([mod], function(mod) {\n        var dependencies = [];\n        var optionalDependencies = [];\n        var dependenciesLoadedCallback = function() {\n            return;\n        };\n\n        // If the module defines dependencies, set them up..\n        if (mod.dependencies) {\n            dependencies = mod.dependencies.list;\n            dependenciesLoadedCallback = mod.dependencies.loader;\n            optionalDependencies = mod.dependencies.optional || [];\n        }\n\n        // Load the dependencies.\n        require([].concat(dependencies), function() {\n            const deps = [...arguments];\n            dependenciesLoadedCallback(deps);\n            loader.resolve(mod);\n        }, function(err) {\n\n            // Modules that failed to load that are not optional are mocked.\n            err.requireModules\n                .filter((m) => optionalDependencies.includes(m))\n                .forEach((module) => {\n                    Log.warn(`block_xp launcher: Mocking optional module ${module} as it was not found.`);\n                    require.undef(module);\n                    // Don't ask why, but calling define directly confuses rollup...\n                    const fn = define;\n                    fn(module, function() {\n                        return null;\n                    });\n                });\n\n            // Retrigger the module loading.\n            require(err.requireModules, function() {\n                // Noop.\n            });\n        });\n    });\n\n    return loader.then((mod) => {\n        pending.resolve();\n        return mod;\n    }).catch(Notification.exception);\n}\n"],"names":["loadModule","mod","loader","$","Deferred","pending","Pending","require","dependencies","optionalDependencies","dependenciesLoadedCallback","list","optional","concat","deps","arguments","resolve","err","requireModules","filter","m","includes","forEach","module","warn","undef","define","then","catch","Notification","exception","rootId","propsId","props","JSON","parse","document","getElementById","textContent","startApp","launchWithProps"],"mappings":";;;;;;;oBA0DeA,WAAWC,WAChBC,OAASC,gBAAEC,WACXC,QAAU,IAAIC,iBAAQ,yCAI5BC,QAAQ,CAACN,MAAM,SAASA,SAChBO,aAAe,GACfC,qBAAuB,GACvBC,2BAA6B,aAK7BT,IAAIO,eACJA,aAAeP,IAAIO,aAAaG,KAChCD,2BAA6BT,IAAIO,aAAaN,OAC9CO,qBAAuBR,IAAIO,aAAaI,UAAY,IAIxDL,QAAQ,GAAGM,OAAOL,eAAe,iBACvBM,KAAO,IAAIC,WACjBL,2BAA2BI,MAC3BZ,OAAOc,QAAQf,QAChB,SAASgB,KAGRA,IAAIC,eACCC,QAAQC,GAAMX,qBAAqBY,SAASD,KAC5CE,SAASC,sBACFC,0DAAmDD,iCACvDhB,QAAQkB,MAAMF,QAEHG,OACRH,QAAQ,kBACA,WAKnBhB,QAAQU,IAAIC,gBAAgB,qBAM7BhB,OAAOyB,MAAM1B,MAChBI,QAAQW,UACDf,OACR2B,MAAMC,sBAAaC,4FAzEH7B,IAAK8B,OAAQC,eAC1BC,MAAQC,KAAKC,MAAMC,SAASC,eAAeL,SAASM,6BAW/BrC,IAAK8B,YAAQE,6DAAQ,SAC1CM,SAACA,gBAAkBvC,WAAWC,KACpCsC,SAASH,SAASC,eAAeN,QAASE,OAZ1CO,CAAgBvC,IAAK8B,OAAQE"}