{"version":3,"sources":["../src/lsreportconfig.js"],"names":["define","Ajax","$","lsreportconfig","slideIndex","currentSlide","currentSlideIndex","lsreportslideshow","progressbar","i","slides","document","getElementsByClassName","dots","length","style","display","setTimeout","lsconfigimportprogress","args","val","total","current","errorreportspositiondata","lastreportposition","promise","call","methodname","done","response","resp","parseJSON","percent","lsconfigresetprogress","step","window","location","href","M","cfg","wwwroot","next","lsreportconfigimport","init","status","value","change","complete","show","onbeforeunload"],"mappings":"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","sourcesContent":["define(['core/ajax',\r\n    'jquery',\r\n    'jqueryui'\r\n], function(Ajax, $) {\r\n    var lsreportconfig = {\r\n        slideIndex: 1,\r\n        currentSlide: function(currentSlideIndex) {\r\n            lsreportconfig.lsreportslideshow(lsreportconfig.slideIndex = currentSlideIndex);\r\n        },\r\n\r\n        progressbar: $( \"#progressbar\" ),\r\n\r\n        lsreportslideshow: function(currentSlideIndex) {\r\n            var i;\r\n            var slides = document.getElementsByClassName(\"mySlides\");\r\n            var dots = document.getElementsByClassName(\"demo\");\r\n            if (currentSlideIndex > slides.length) {lsreportconfig.slideIndex = 1}\r\n            if (currentSlideIndex < 1) {lsreportconfig.slideIndex = slides.length}\r\n            for (i = 0; i < slides.length; i++) {\r\n                slides[i].style.display = \"none\";\r\n            }\r\n            slides[lsreportconfig.slideIndex-1].style.display = \"block\";\r\n            setTimeout(function(){\r\n                if (lsreportconfig.slideIndex >= slides.length) {\r\n                    lsreportconfig.currentSlide(1);\r\n                } else {\r\n                    lsreportconfig.lsreportslideshow(lsreportconfig.slideIndex++) ;\r\n                }\r\n            }, 3000);\r\n        },\r\n        lsconfigimportprogress: function(args){\r\n            var val = lsreportconfig.progressbar.progressbar( \"value\" ) || 0;\r\n            var total = args.total;\r\n            var current = args.current;\r\n            var errorreportspositiondata = args.errorreportspositiondata;\r\n            var lastreportposition = args.lastreportposition;\r\n            var promise = Ajax.call([{\r\n                methodname: 'block_learnerscript_importreports',\r\n                    args: {\r\n                        total: total,\r\n                        current: current,\r\n                        errorreportspositiondata: errorreportspositiondata,\r\n                        lastreportposition: lastreportposition\r\n                    },\r\n                }], false);\r\n            promise[0].done(function(response){\r\n                resp = $.parseJSON(response);\r\n                lsreportconfig.progressbar.progressbar(\"value\", resp.percent);\r\n                if(resp.percent < 100) {\r\n                    if(resp.current && resp.current > 0) {\r\n                        args.current = resp.current;\r\n                    } else {\r\n                        args.current = args.current + 1;\r\n                    }\r\n                    setTimeout(function(){\r\n                        lsreportconfig.lsconfigimportprogress(args);\r\n                    }, 500);\r\n                }\r\n            });\r\n        },\r\n        lsconfigresetprogress: function(step) {\r\n            var promise = Ajax.call([{\r\n                methodname: 'block_learnerscript_resetlsconfig',\r\n                    args: {\r\n                        step : step\r\n                    },\r\n                }], false);\r\n            promise[0].done(function(response){\r\n                resp = $.parseJSON(response);\r\n                lsreportconfig.progressbar.progressbar(\"value\", resp.percent);\r\n                if (resp.percent == 100) {\r\n                    window.location.href = M.cfg.wwwroot + '/blocks/learnerscript/lsconfig.php?import=1';\r\n                }\r\n                if (resp.percent < 100) {\r\n                    if (resp.next && resp.next > 0) {\r\n                        step = resp.next;\r\n                    }\r\n                    setTimeout(function(){\r\n                        lsreportconfig.lsconfigresetprogress(step);\r\n                    }, 500);\r\n                }\r\n            });\r\n        },\r\n        lsreportconfigimport: function (){\r\n            var promise = Ajax.call([{\r\n                methodname: 'block_learnerscript_lsreportconfigimport',\r\n                    args: {\r\n                    },\r\n                }]);\r\n            promise[0].done(function(response){\r\n                return \"Message from onbeforeunload handler\";\r\n            });\r\n        }\r\n    };\r\n    return {\r\n        init: function(args, status) {\r\n            lsreportconfig.progressbar.progressbar({\r\n                    value: false,\r\n                    change: function() {\r\n                    },\r\n                    complete: function() {\r\n                        $('#reportdashboardnav').show(500);\r\n                    }\r\n                });\r\n            if ($('.mySlides').length > 0) {\r\n                lsreportconfig.lsreportslideshow(1);\r\n            }\r\n            if (status == 'import') {\r\n                lsreportconfig.lsconfigimportprogress(args);\r\n            } else if (status == 'reset') {\r\n                lsreportconfig.lsconfigresetprogress(1);\r\n            }\r\n            window.onbeforeunload = lsreportconfig.lsreportconfigimport;\r\n        },\r\n    };\r\n});"],"file":"lsreportconfig.min.js"}