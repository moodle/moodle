define ("block_timestat/screentime",["jquery"],function(a){var c={fields:[],percentOnScreen:"50%",reportInterval:10,googleAnalytics:!1,callback:function callback(){}};a.screentime=function(d){d=a.extend({},c,d);d.percentOnScreen=parseInt(d.percentOnScreen.replace("%",""),10);var n={},o={},p={},q=null,r=!1,s,t;if(!d.fields.length){return}if(d.googleAnalytics){if("function"==typeof ga){s=!0}if("undefined"!=typeof _gaq&&"function"==typeof _gaq.push){t=!0}}(function(){window.visibly={q:document,p:void 0,prefixes:["webkit","ms","o","moz","khtml"],props:["VisibilityState","visibilitychange","Hidden"],m:["focus","blur"],visibleCallbacks:[],hiddenCallbacks:[],genericCallbacks:[],_callbacks:[],cachedPrefix:"",fn:null,onVisible:function onVisible(a){if("function"==typeof a){this.visibleCallbacks.push(a)}},onHidden:function onHidden(a){if("function"==typeof a){this.hiddenCallbacks.push(a)}},getPrefix:function getPrefix(){if(!this.cachedPrefix){for(var a=0;b=this.prefixes[a++];){if(b+this.props[2]in this.q){this.cachedPrefix=b;return this.cachedPrefix}}}},visibilityState:function visibilityState(){return this._getProp(0)},hidden:function hidden(){return this._getProp(2)},visibilitychange:function visibilitychange(a){if("function"==typeof a){this.genericCallbacks.push(a)}var c=this.genericCallbacks.length;if(c){if(this.cachedPrefix){while(c--){this.genericCallbacks[c].call(this,this.visibilityState())}}else{while(c--){this.genericCallbacks[c].call(this,arguments[0])}}}},isSupported:function isSupported(){return this.cachedPrefix+this.props[2]in this.q},_getProp:function _getProp(a){return this.q[this.cachedPrefix+this.props[a]]},_execute:function _execute(a){if(a){this._callbacks=1==a?this.visibleCallbacks:this.hiddenCallbacks;var c=this._callbacks.length;while(c--){this._callbacks[c]()}}},_visible:function _visible(){window.visibly._execute(1);window.visibly.visibilitychange.call(window.visibly,"visible")},_hidden:function _hidden(){window.visibly._execute(2);window.visibly.visibilitychange.call(window.visibly,"hidden")},_nativeSwitch:function _nativeSwitch(){this[this._getProp(2)?"_hidden":"_visible"]()},_listen:function _listen(){try{if(!this.isSupported()){if(this.q.addEventListener){window.addEventListener(this.m[0],this._visible,1);window.addEventListener(this.m[1],this._hidden,1)}else{if(this.q.attachEvent){this.q.attachEvent("onfocusin",this._visible);this.q.attachEvent("onfocusout",this._hidden)}}}else{this.q.addEventListener(this.cachedPrefix+this.props[1],function(){window.visibly._nativeSwitch.apply(window.visibly,arguments)},1)}}catch(a){}},init:function(){this.getPrefix();this._listen()}};this.visibly.init()})();function e(c){this.selector=c.selector;$elem=this.$elem=a(c.selector);this.name=c.name;this.top=$elem.offset().top;this.height=$elem.height();this.bottom=this.top+this.height;this.width=$elem.width()}function f(){var c=a(window);this.top=c.scrollTop();this.height=c.height();this.bottom=this.top+this.height;this.width=c.width()}function g(a,c){if(s){ga("send","event","Screentime","Time on Screen",a,parseInt(c,10),{nonInteraction:!0})}if(t){_gaq.push(["_trackEvent","Screentime","Time on Screen",a,parseInt(c,10),!0])}}function h(c,e){var f,g,h;if(a(e.selector).is(":hidden")){return!1}if(e.bottom<=c.bottom&&e.top>=c.top){return!0}if(e.height>c.height){f=c.bottom-e.top>c.height/2&&e.bottom-c.top>c.height/2;if(f){return!0}}g=e.height*(d.percentOnScreen/100);h=c.bottom-g>=e.top&&e.bottom-g>c.top;return h}function i(){var c=new f;a.each(o,function(a,d){if(h(c,d)){p[a]+=1;n[a]+=1}})}function j(){var c={};a.each(n,function(a,e){if(0<e){c[a]=e;n[a]=0;if(d.googleAnalytics){g(a,e)}}});if(!a.isEmptyObject(c)){d.callback.call(this,c,p)}}function k(){if(!r){i();r=!0}q=setInterval(function(){i()},1e3);reporter=setInterval(function(){j()},1e3*d.reportInterval)}function l(){clearInterval(q);clearInterval(reporter)}a.screentime.reset=function(){l();a.each(o,function(a){p[a]=0;n[a]=0});k()};function m(){a.each(d.fields,function(c,d){if(a(d.selector).length){var f=new e(d);o[f.name]=f;n[f.name]=0;p[f.name]=0}});k();visibly.onHidden(function(){l()});visibly.onVisible(function(){l();k()})}m()}});
//# sourceMappingURL=screentime.min.js.map
