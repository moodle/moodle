/**
 * This plugin provides access to Moodle data in form of analytics and reports in real time.
 *
 * @copyright  2020 IntelliBoard, Inc
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @see    https://intelliboard.net/
 */
define("local_intellidata/tracking",["jquery","core/log","local_intellidata/tracking_repository","local_intellidata/cookies_helper"],(function($,log,TrackingRepository,CookiesHelper){var PARAMS={AJAXFREQUENCY:30,INACTIVITY:60,PERIOD:1e3,INTERVAL:null,PAGE:"",PARAM:"",MEDIATRACK:0},TRACKING={COUNTER:0,AJAXCOUNTER:0,WARNINGTIME:0,LOGOUTTIME:0},clearCounter=function(){TRACKING.COUNTER=0,TRACKING.WARNINGTIME=0,TRACKING.LOGOUTTIME=0},resetParams=function(){CookiesHelper.setCookie("intellidatapage",PARAMS.PAGE),CookiesHelper.setCookie("intellidataparam",PARAMS.PARAM),CookiesHelper.setCookie("intellidatatime",PARAMS.AJAXFREQUENCY)},track=function(){PARAMS.MEDIATRACK&&(mediaTracking()&&!document.hidden&&clearCounter());TRACKING.COUNTER<=PARAMS.INACTIVITY&&(TRACKING.COUNTER++,TRACKING.AJAXCOUNTER++,TRACKING.AJAXCOUNTER==PARAMS.AJAXFREQUENCY&&PARAMS.AJAXFREQUENCY&&(TrackingRepository.sendRequest(PARAMS.PAGE,PARAMS.PARAM),TRACKING.AJAXCOUNTER=0))},mediaTracking=function(){var media=[],status=!1,internal=document.querySelectorAll("audio,video"),frames=document.querySelectorAll("iframe");return frames.length&&frames.forEach((function(frame){var elements=frame.contentWindow.document.querySelectorAll("audio,video");elements.length&&elements.forEach((function(element){media.push(element)}))})),internal.length&&internal.forEach((function(element){media.push(element)})),media.length&&media.forEach((function(element){element.paused||(status=!0)})),status};return{init:function(params){!function(params){PARAMS.INACTIVITY=params.inactivity||PARAMS.INACTIVITY,PARAMS.AJAXFREQUENCY=params.ajaxfrequency||PARAMS.AJAXFREQUENCY,PARAMS.PERIOD=params.period||PARAMS.PERIOD,PARAMS.PAGE=params.page||PARAMS.PAGE,PARAMS.PARAM=params.param||PARAMS.PARAM,PARAMS.MEDIATRACK=params.mediatrack||PARAMS.MEDIATRACK,log.debug("IntelliData: Set Params",[PARAMS,TRACKING])}(params),$(document).on("mousemove",clearCounter),$(document).on("keypress",clearCounter),$(document).on("scroll",clearCounter),$(window).on("unload",resetParams),setInterval(track,PARAMS.PERIOD),log.debug("IntelliData: Start Tracking",[PARAMS,TRACKING])}}}));

//# sourceMappingURL=tracking.min.js.map