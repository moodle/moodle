define(["jquery","local_customgrader/bootstrap","local_customgrader/sweetalert","local_customgrader/jqueryui"],function(a,b){return{init:function(){function b(b,c,d){a.ajax({type:"POST",data:{course:b,element:c,type_e:d,type:"loadParentCat"},url:"managers/ajax_processing.php",success:function(b){console.log(b),a("#padre").html(b.html)},dataType:"json",cache:"false",error:function(a){console.log("ajax error"),console.log(a)}})}function c(b,c,d){a.ajax({type:"POST",data:{type_ajax:"deleteElement",id:b,courseid:c,type:d},url:"managers/ajax_processing.php",success:function(a){swal({title:"Listo",text:a.msg,type:"success",showCancelButton:!1,showConfirmButton:!1,timer:1200}),e(c)},dataType:"json",cache:"false",error:function(a){console.log(a)}})}function d(){for(var a=window.location.search.split("="),b=0;b<a.length;b+=2)if("?id"==a[b])var c=a[b+1];return c}function e(b){a.ajax({type:"POST",data:{course:b,type:"loadCat"},url:"managers/ajax_processing.php",success:function(b){a("#mymodalbody").html(b)},dataType:"text",cache:"false",error:function(a){console.log(a)}})}function f(b,c){var f=a("#tipoItem").val(),k=d();if("CATEGORÍA"==f){if(j(b)){var l=a.trim(a("#inputNombre").val()),m=a("#inputValor").val(),n=g(a("#tipoCalificacion").prop("selectedIndex"));a.ajax({type:"POST",data:{course:k,parent:c,fullname:l,agregation:n,tipo:f,peso:m},url:"managers/ajax_processing.php",success:function(a){1==a?(swal({title:"Categoria añadida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),e(k)):0==a&&swal({title:"Error al añadir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(a){swal({title:"Error al intentar añadir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"}),console.log(a)}})}}else if("ÍTEM"==f){if(h(b)){var l=a.trim(a("#inputNombre").val()),m=a("#inputValor").val();a.ajax({type:"POST",data:{course:k,parent:c,fullname:l,tipo:f,peso:m},url:"managers/ajax_processing.php",success:function(a){1==a?(swal({title:"item añadido con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),e(k)):0==a&&swal({title:"Error al añadir el item (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(a){swal({title:"Error al intentar añadir el item",html:!0,type:"error",confirmButtonColor:"#d51b23"}),console.log(a)}})}}else if("PARCIAL"==f){if(i(b)){var l=a.trim(a("#inputNombre").val()),m=a("#inputValor").val();a.ajax({type:"POST",data:{course:k,parent:c,fullname:l,agregation:6,tipo:f,peso:m},url:"managers/ajax_processing.php",success:function(a){1==a?(swal({title:"Categoria añadida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),e(k)):0==a&&swal({title:"Error al añadir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(a){swal({title:"Error al intentar añadir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"}),console.log(a)}})}}else swal({title:"Seleccione el tipo de elemento que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}function g(a){switch(a){case 1:return 0;case 2:return 10}}function h(b){var c=a.trim(a("#inputNombre").val());if(""==c)return swal({title:"Ingrese el nombre del ítem que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==b){var d=a("#inputValor").val();if(""==d)return swal({title:"Ingrese un peso válido entre 0 y "+l,html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}function i(b){var c=a.trim(a("#inputNombre").val());if(""==c)return swal({title:"Ingrese el nombre del parcial que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==b){var d=a("#inputValor").val();if(""==d)return swal({title:"Ingrese un peso válido entre 0 y "+l,html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}function j(b){if(0==a("#tipoCalificacion").prop("selectedIndex"))return swal({title:"Seleccione el tipo de calificación de la categoría que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;var c=a.trim(a("#inputNombre").val());if(""==c)return swal({title:"Ingrese el nombre de la categoría que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==b){var d=a("#inputValor").val();if(""==d)return swal({title:"Ingrese un peso válido entre 0 y "+l,html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}var k,l;a(document).on("click","#wizard_button",function(){a("#modalCategories").modal({backdrop:!1}),a(".fondo").show()}),a(document).on("click","#cancel",function(){a(".fondo").hide()}),a(document).on("click",".mymodal-close",function(){location.reload()}),a(document).on("click",".edit",function(){var c=a(this).attr("title");a("#titulo").text(c);var e=!1;a("#nombre_editar").show(),a("#label_nombre").show(),a("#alta").show(),a("#div_padres").show(),a(this).hasClass("curso")&&(e=!0,a("#alta").hide(),a("#nombre_editar").hide(),a("#label_nombre").hide(),a("#div_padres").hide());var f=d(),g=a(this).attr("id");if(a("#save_edit").attr("name",g),"Editar Categoría"===c){a("#type_cal").show();var h=a(this).parent().parent().attr("id");a("#otro").hide(),10!=h&&0!=h&&6!=h&&(h=99,a("#otro").show()),a("#calific").prop("value",h);var i="cat",j=a(this).parent().parent().text();if(j.search("-")==-1){var l=j.split("(");j=l[0],n=l[1],e||a("#peso").show(),n=n.replace("(",""),n=n.replace(")",""),n=n.replace(" ",""),n=n.replace("%",""),k=n,a("#peso_editar").val(n);var m=a(this).attr("data-maxweight");a(".maxweight-edit").attr("id",m)}else j=j.split("-")[0],a("#peso").hide()}else{a("#type_cal").hide();var n=a(this).parent().parent().prev().text();if("-"==n)a("#peso").hide(),a("#peso_editar").val(n);else{a("#peso").show(),n=n.replace("(",""),n=n.replace(")",""),n=n.replace(" ",""),n=n.replace("%",""),k=n,a("#peso_editar").val(n);var m=a(this).parent().attr("id");a(".maxweight-edit").attr("id",m)}var i="it",j=a(this).parent().parent().prev().prev().attr("title");"Enlazar a la actividad Tarea"==j&&(a("#nombre_editar").hide(),a("#label_nombre").hide())}a("#nombre_editar").val(j),b(f,g,i),a("#edit").modal({backdrop:!1}),a(".fondo").show()}),a(document).on("click","#save_edit",function(){var b=a(this).attr("name"),c=a("#nombre_editar").val(),f=a("#peso_editar").val(),g=parseFloat(a(".maxweight-edit").attr("id"))+parseFloat(k),h=a("#calific").val(),i=a("#padre").val();if("-"==f&&(f=0),"99"==h)return void swal({title:"Tipo de Calificacion no valida.",text:"No es posible editar una categoria con un tipo de calificacion diferente a Promedio Simple, Promedio Ponderado, o Calificacion mas alta.\n Por favor seleccione uno de estos tipos de calificacion",html:!0,type:"warning",confirmButtonColor:"#d51b23"});if(f>g)return void swal({title:"Peso no valido.",text:"El peso ingresado supera el peso máximo posible de la categoria padre que es: "+g+"% \n Para crear un nuevo elemento primero configure los pesos de los demas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"});if(""==c)return void swal({title:"Ingrese el nuevo nombre del elemento",html:!0,type:"warning",confirmButtonColor:"#d51b23"});var j=a("#titulo").text();if("Ítem"==j.split(" ")[1]){var l="it";h=!1}else l="cat";var m=d();a.ajax({type:"POST",data:{course:m,element:b,type_e:l,newNombre:c,newPeso:f,newCalific:h,type:"editElement",parent:i},url:"managers/ajax_processing.php",success:function(b){b.error?swal("Error",b.error,"error"):(swal({title:"Listo",text:b.msg,type:"success",showCancelButton:!1,showConfirmButton:!1,timer:1300}),a("#edit").modal("hide"),a(".fondo").hide(),e(m),console.log(b))},dataType:"json",cache:"false",error:function(a){swal("Server Error",a.error,"error"),console.log("AJAXerror"),console.log(a)}})}),a(document).on("click",".delete",function(){var b=a(this).parent().parent().parent().attr("id").split("_"),e=d(),f=a(this).attr("data-name"),g=b[1],h=b[0];if("cat"===h)var i="la categoria: "+f;else var i="el item: "+f;var j="Esta seguro que desea eliminar "+i+"?";swal({title:j,text:"Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Aceptar, Borrar "+i,cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(a){a?c(g,e,h):swal({title:"Cancelado",type:"error",showCancelButton:!1,showConfirmButton:!1,timer:1200})})}),a(document).on("click",".new",function(){if(l=a(this).parent().parent().children().next(".maxweight").attr("id"),l<=0)return void swal({title:"No se pueden crear mas categorías o ítems en la categoria seleccionada.",text:"\n\r El peso de los elementos dentro de ésta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"});a(".new").prop("disabled",!0),a(".delete").prop("disabled",!0),a(".edit").prop("disabled",!0);var b=a("<div class = 'divForm' style= 'display:none'>");b.load("templates/categories_form.html"),b.toggle("slow","swing");var c=a(this).parent().parent();c.append('<hr style = "margin: 6px 0;border-top: 1px solid #ddd">'),c.append(b),window.setTimeout(function(){var b=c.attr("id");10==b&&(a("#divPeso").show(),a("#inputValor").on("blur",function(){var b=a(this).val(),c=parseInt(a(this).parent().parent().parent().parent().children().next(".maxweight").attr("id"));(b<0||b>c)&&(swal({title:"El valor debe estar entre 0 y el peso máximo: "+c,text:"\n\rUsted ingresó: "+b,html:!0,type:"warning",confirmButtonColor:"#d51b23"}),a(this).val(""))}),a("#inputValor").on("keypress",function(a){var b=document.all?a.keyCode:a.which;if(8==b||46==b)return!0;var c=/[0-9]/,d=String.fromCharCode(b);return c.test(d)})),a("#tipoItem").on("change",function(){var b=a(this).prop("selectedIndex");1==b?a("#divTipeC").show():a("#divTipeC").hide()}),a("#save").on("click",function(){var b=a(this).parent().parent().parent().parent().attr("id"),c=a(this).parent().parent().parent().parent().parent().attr("id");c=c.split("_")[1],f(b,c)}),a("#cancel").on("click",function(){var a=d();e(a)})},400)})}}});