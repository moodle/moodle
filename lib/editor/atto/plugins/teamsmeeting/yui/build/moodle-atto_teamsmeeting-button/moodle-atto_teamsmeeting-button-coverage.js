
var __cov__3A0NvTgdEoIoqXY36ZPuw = (Function('return this'))();
if (!__cov__3A0NvTgdEoIoqXY36ZPuw.__coverage__) { __cov__3A0NvTgdEoIoqXY36ZPuw.__coverage__ = {}; }
__cov__3A0NvTgdEoIoqXY36ZPuw = __cov__3A0NvTgdEoIoqXY36ZPuw.__coverage__;
if (!(__cov__3A0NvTgdEoIoqXY36ZPuw['build/moodle-atto_teamsmeeting-button/moodle-atto_teamsmeeting-button.js'])) {
   __cov__3A0NvTgdEoIoqXY36ZPuw['build/moodle-atto_teamsmeeting-button/moodle-atto_teamsmeeting-button.js'] = {"path":"build/moodle-atto_teamsmeeting-button/moodle-atto_teamsmeeting-button.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"fnMap":{"1":{"name":"(anonymous_1)","line":1,"loc":{"start":{"line":1,"column":43},"end":{"line":1,"column":62}}},"2":{"name":"(anonymous_2)","line":125,"loc":{"start":{"line":125,"column":17},"end":{"line":125,"column":28}}},"3":{"name":"(anonymous_3)","line":146,"loc":{"start":{"line":146,"column":22},"end":{"line":146,"column":33}}},"4":{"name":"(anonymous_4)","line":175,"loc":{"start":{"line":175,"column":21},"end":{"line":175,"column":32}}},"5":{"name":"(anonymous_5)","line":225,"loc":{"start":{"line":225,"column":19},"end":{"line":225,"column":30}}},"6":{"name":"(anonymous_6)","line":244,"loc":{"start":{"line":244,"column":20},"end":{"line":244,"column":39}}},"7":{"name":"(anonymous_7)","line":263,"loc":{"start":{"line":263,"column":23},"end":{"line":263,"column":47}}},"8":{"name":"(anonymous_8)","line":281,"loc":{"start":{"line":281,"column":22},"end":{"line":281,"column":34}}},"9":{"name":"(anonymous_9)","line":317,"loc":{"start":{"line":317,"column":33},"end":{"line":317,"column":47}}},"10":{"name":"(anonymous_10)","line":350,"loc":{"start":{"line":350,"column":34},"end":{"line":350,"column":55}}},"11":{"name":"(anonymous_11)","line":370,"loc":{"start":{"line":370,"column":26},"end":{"line":370,"column":41}}},"12":{"name":"(anonymous_12)","line":381,"loc":{"start":{"line":381,"column":27},"end":{"line":381,"column":39}}},"13":{"name":"(anonymous_13)","line":404,"loc":{"start":{"line":404,"column":25},"end":{"line":404,"column":36}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":464,"column":61}},"2":{"start":{"line":36,"column":0},"end":{"line":67,"column":22}},"3":{"start":{"line":68,"column":0},"end":{"line":461,"column":3}},"4":{"start":{"line":126,"column":8},"end":{"line":126,"column":54}},"5":{"start":{"line":127,"column":8},"end":{"line":127,"column":42}},"6":{"start":{"line":128,"column":8},"end":{"line":128,"column":42}},"7":{"start":{"line":129,"column":8},"end":{"line":129,"column":46}},"8":{"start":{"line":131,"column":8},"end":{"line":137,"column":11}},"9":{"start":{"line":148,"column":8},"end":{"line":148,"column":65}},"10":{"start":{"line":149,"column":8},"end":{"line":151,"column":9}},"11":{"start":{"line":150,"column":12},"end":{"line":150,"column":19}},"12":{"start":{"line":153,"column":8},"end":{"line":158,"column":11}},"13":{"start":{"line":161,"column":8},"end":{"line":161,"column":64}},"14":{"start":{"line":164,"column":8},"end":{"line":164,"column":31}},"15":{"start":{"line":165,"column":8},"end":{"line":165,"column":24}},"16":{"start":{"line":177,"column":8},"end":{"line":181,"column":19}},"17":{"start":{"line":184,"column":8},"end":{"line":186,"column":9}},"18":{"start":{"line":185,"column":12},"end":{"line":185,"column":19}},"19":{"start":{"line":188,"column":8},"end":{"line":188,"column":69}},"20":{"start":{"line":189,"column":8},"end":{"line":215,"column":9}},"21":{"start":{"line":190,"column":12},"end":{"line":190,"column":40}},"22":{"start":{"line":191,"column":12},"end":{"line":191,"column":87}},"23":{"start":{"line":192,"column":12},"end":{"line":192,"column":50}},"24":{"start":{"line":193,"column":12},"end":{"line":193,"column":55}},"25":{"start":{"line":194,"column":12},"end":{"line":209,"column":13}},"26":{"start":{"line":195,"column":16},"end":{"line":195,"column":69}},"27":{"start":{"line":197,"column":16},"end":{"line":197,"column":95}},"28":{"start":{"line":198,"column":16},"end":{"line":200,"column":18}},"29":{"start":{"line":201,"column":16},"end":{"line":208,"column":19}},"30":{"start":{"line":210,"column":12},"end":{"line":214,"column":13}},"31":{"start":{"line":211,"column":16},"end":{"line":211,"column":83}},"32":{"start":{"line":213,"column":16},"end":{"line":213,"column":75}},"33":{"start":{"line":226,"column":8},"end":{"line":233,"column":9}},"34":{"start":{"line":227,"column":12},"end":{"line":227,"column":85}},"35":{"start":{"line":228,"column":12},"end":{"line":232,"column":13}},"36":{"start":{"line":229,"column":16},"end":{"line":229,"column":63}},"37":{"start":{"line":230,"column":16},"end":{"line":230,"column":54}},"38":{"start":{"line":231,"column":16},"end":{"line":231,"column":41}},"39":{"start":{"line":245,"column":8},"end":{"line":252,"column":9}},"40":{"start":{"line":246,"column":12},"end":{"line":246,"column":59}},"41":{"start":{"line":247,"column":12},"end":{"line":251,"column":13}},"42":{"start":{"line":248,"column":16},"end":{"line":249,"column":68}},"43":{"start":{"line":250,"column":16},"end":{"line":250,"column":65}},"44":{"start":{"line":264,"column":8},"end":{"line":264,"column":44}},"45":{"start":{"line":265,"column":8},"end":{"line":265,"column":36}},"46":{"start":{"line":266,"column":8},"end":{"line":271,"column":9}},"47":{"start":{"line":267,"column":12},"end":{"line":267,"column":42}},"48":{"start":{"line":268,"column":12},"end":{"line":270,"column":13}},"49":{"start":{"line":269,"column":16},"end":{"line":269,"column":51}},"50":{"start":{"line":282,"column":8},"end":{"line":283,"column":18}},"51":{"start":{"line":285,"column":8},"end":{"line":285,"column":27}},"52":{"start":{"line":286,"column":8},"end":{"line":288,"column":18}},"53":{"start":{"line":290,"column":8},"end":{"line":290,"column":42}},"54":{"start":{"line":292,"column":8},"end":{"line":292,"column":35}},"55":{"start":{"line":293,"column":8},"end":{"line":306,"column":9}},"56":{"start":{"line":296,"column":12},"end":{"line":296,"column":33}},"57":{"start":{"line":297,"column":12},"end":{"line":297,"column":68}},"58":{"start":{"line":298,"column":12},"end":{"line":300,"column":13}},"59":{"start":{"line":299,"column":16},"end":{"line":299,"column":42}},"60":{"start":{"line":303,"column":12},"end":{"line":303,"column":52}},"61":{"start":{"line":305,"column":12},"end":{"line":305,"column":31}},"62":{"start":{"line":318,"column":8},"end":{"line":322,"column":24}},"63":{"start":{"line":324,"column":8},"end":{"line":324,"column":28}},"64":{"start":{"line":325,"column":8},"end":{"line":325,"column":50}},"65":{"start":{"line":327,"column":8},"end":{"line":341,"column":9}},"66":{"start":{"line":329,"column":12},"end":{"line":329,"column":63}},"67":{"start":{"line":330,"column":12},"end":{"line":330,"column":51}},"68":{"start":{"line":333,"column":12},"end":{"line":333,"column":89}},"69":{"start":{"line":334,"column":12},"end":{"line":334,"column":71}},"70":{"start":{"line":336,"column":12},"end":{"line":336,"column":56}},"71":{"start":{"line":337,"column":12},"end":{"line":337,"column":59}},"72":{"start":{"line":340,"column":12},"end":{"line":340,"column":57}},"73":{"start":{"line":344,"column":8},"end":{"line":346,"column":9}},"74":{"start":{"line":345,"column":12},"end":{"line":345,"column":19}},"75":{"start":{"line":348,"column":8},"end":{"line":348,"column":69}},"76":{"start":{"line":350,"column":8},"end":{"line":357,"column":17}},"77":{"start":{"line":351,"column":12},"end":{"line":351,"column":53}},"78":{"start":{"line":352,"column":12},"end":{"line":356,"column":13}},"79":{"start":{"line":353,"column":16},"end":{"line":353,"column":60}},"80":{"start":{"line":355,"column":16},"end":{"line":355,"column":53}},"81":{"start":{"line":359,"column":8},"end":{"line":359,"column":28}},"82":{"start":{"line":371,"column":8},"end":{"line":372,"column":22}},"83":{"start":{"line":375,"column":8},"end":{"line":377,"column":9}},"84":{"start":{"line":376,"column":12},"end":{"line":376,"column":26}},"85":{"start":{"line":380,"column":8},"end":{"line":380,"column":18}},"86":{"start":{"line":381,"column":8},"end":{"line":385,"column":17}},"87":{"start":{"line":382,"column":12},"end":{"line":384,"column":13}},"88":{"start":{"line":383,"column":16},"end":{"line":383,"column":29}},"89":{"start":{"line":386,"column":8},"end":{"line":388,"column":9}},"90":{"start":{"line":387,"column":12},"end":{"line":387,"column":24}},"91":{"start":{"line":390,"column":8},"end":{"line":390,"column":33}},"92":{"start":{"line":391,"column":8},"end":{"line":393,"column":9}},"93":{"start":{"line":392,"column":12},"end":{"line":392,"column":25}},"94":{"start":{"line":394,"column":8},"end":{"line":394,"column":18}},"95":{"start":{"line":405,"column":8},"end":{"line":405,"column":54}},"96":{"start":{"line":407,"column":8},"end":{"line":414,"column":12}},"97":{"start":{"line":416,"column":8},"end":{"line":416,"column":78}},"98":{"start":{"line":418,"column":8},"end":{"line":418,"column":73}},"99":{"start":{"line":420,"column":8},"end":{"line":420,"column":29}}},"branchMap":{"1":{"line":149,"type":"if","locations":[{"start":{"line":149,"column":8},"end":{"line":149,"column":8}},{"start":{"line":149,"column":8},"end":{"line":149,"column":8}}]},"2":{"line":184,"type":"if","locations":[{"start":{"line":184,"column":8},"end":{"line":184,"column":8}},{"start":{"line":184,"column":8},"end":{"line":184,"column":8}}]},"3":{"line":189,"type":"if","locations":[{"start":{"line":189,"column":8},"end":{"line":189,"column":8}},{"start":{"line":189,"column":8},"end":{"line":189,"column":8}}]},"4":{"line":194,"type":"if","locations":[{"start":{"line":194,"column":12},"end":{"line":194,"column":12}},{"start":{"line":194,"column":12},"end":{"line":194,"column":12}}]},"5":{"line":210,"type":"if","locations":[{"start":{"line":210,"column":12},"end":{"line":210,"column":12}},{"start":{"line":210,"column":12},"end":{"line":210,"column":12}}]},"6":{"line":226,"type":"if","locations":[{"start":{"line":226,"column":8},"end":{"line":226,"column":8}},{"start":{"line":226,"column":8},"end":{"line":226,"column":8}}]},"7":{"line":228,"type":"if","locations":[{"start":{"line":228,"column":12},"end":{"line":228,"column":12}},{"start":{"line":228,"column":12},"end":{"line":228,"column":12}}]},"8":{"line":228,"type":"binary-expr","locations":[{"start":{"line":228,"column":16},"end":{"line":228,"column":26}},{"start":{"line":228,"column":30},"end":{"line":228,"column":71}}]},"9":{"line":245,"type":"if","locations":[{"start":{"line":245,"column":8},"end":{"line":245,"column":8}},{"start":{"line":245,"column":8},"end":{"line":245,"column":8}}]},"10":{"line":247,"type":"if","locations":[{"start":{"line":247,"column":12},"end":{"line":247,"column":12}},{"start":{"line":247,"column":12},"end":{"line":247,"column":12}}]},"11":{"line":268,"type":"if","locations":[{"start":{"line":268,"column":12},"end":{"line":268,"column":12}},{"start":{"line":268,"column":12},"end":{"line":268,"column":12}}]},"12":{"line":293,"type":"if","locations":[{"start":{"line":293,"column":8},"end":{"line":293,"column":8}},{"start":{"line":293,"column":8},"end":{"line":293,"column":8}}]},"13":{"line":298,"type":"if","locations":[{"start":{"line":298,"column":12},"end":{"line":298,"column":12}},{"start":{"line":298,"column":12},"end":{"line":298,"column":12}}]},"14":{"line":327,"type":"if","locations":[{"start":{"line":327,"column":8},"end":{"line":327,"column":8}},{"start":{"line":327,"column":8},"end":{"line":327,"column":8}}]},"15":{"line":344,"type":"if","locations":[{"start":{"line":344,"column":8},"end":{"line":344,"column":8}},{"start":{"line":344,"column":8},"end":{"line":344,"column":8}}]},"16":{"line":352,"type":"if","locations":[{"start":{"line":352,"column":12},"end":{"line":352,"column":12}},{"start":{"line":352,"column":12},"end":{"line":352,"column":12}}]},"17":{"line":375,"type":"if","locations":[{"start":{"line":375,"column":8},"end":{"line":375,"column":8}},{"start":{"line":375,"column":8},"end":{"line":375,"column":8}}]},"18":{"line":375,"type":"binary-expr","locations":[{"start":{"line":375,"column":12},"end":{"line":375,"column":19}},{"start":{"line":375,"column":23},"end":{"line":375,"column":52}}]},"19":{"line":382,"type":"if","locations":[{"start":{"line":382,"column":12},"end":{"line":382,"column":12}},{"start":{"line":382,"column":12},"end":{"line":382,"column":12}}]},"20":{"line":382,"type":"binary-expr","locations":[{"start":{"line":382,"column":16},"end":{"line":382,"column":20}},{"start":{"line":382,"column":24},"end":{"line":382,"column":65}}]},"21":{"line":386,"type":"if","locations":[{"start":{"line":386,"column":8},"end":{"line":386,"column":8}},{"start":{"line":386,"column":8},"end":{"line":386,"column":8}}]},"22":{"line":391,"type":"if","locations":[{"start":{"line":391,"column":8},"end":{"line":391,"column":8}},{"start":{"line":391,"column":8},"end":{"line":391,"column":8}}]}},"code":["(function () { YUI.add('moodle-atto_teamsmeeting-button', function (Y, NAME) {","","// This file is part of Moodle - http://moodle.org/","//","// Moodle is free software: you can redistribute it and/or modify","// it under the terms of the GNU General Public License as published by","// the Free Software Foundation, either version 3 of the License, or","// (at your option) any later version.","//","// Moodle is distributed in the hope that it will be useful,","// but WITHOUT ANY WARRANTY; without even the implied warranty of","// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the","// GNU General Public License for more details.","//","// You should have received a copy of the GNU General Public License","// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.","","/*"," * @package    atto_teamsmeeting"," * @copyright  2020 Enovation"," * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */","","/**"," * @module moodle-atto_teamsmeeting-button"," */","","/**"," * Atto text editor teamsmeeting plugin."," *"," * @namespace M.atto_teamsmeeting"," * @class button"," * @extends M.editor_atto.EditorPlugin"," */","","var COMPONENTNAME = 'atto_teamsmeeting',","    CSS = {","        NEWWINDOW: 'atto_teamsmeeting_openinnewwindow',","        URLINPUT: 'atto_teamsmeeting_urlentry'","    },","    SELECTORS = {","        URLINPUT: '.atto_teamsmeeting_urlentry'","    },","    TEMPLATE = '' +","            '<form class=\"atto_form\">' +","                '<div class=\"meeting-app\">' +","                    '<label class=\"meeting-app-label\" for=\"meetingapp\">' +","                    '{{get_string \"createteamsmeeting\" component}}' +","                    '</label>' +","                    '<iframe id=\"meetingapp\" src=\"{{appurl}}?url={{clientdomain}}&locale={{locale}}&msession={{msession}}\"></iframe>' +","                '</div>' +","                '<div class=\"mb-1\">' +","                    '<label for=\"{{elementid}}_atto_teamsmeeting_urlentry\">{{get_string \"meetingurl\" component}}</label>' +","                    '<input class=\"form-control fullwidth url {{CSS.URLINPUT}}\" type=\"url\" ' +","                    'id=\"{{elementid}}_atto_teamsmeeting_urlentry\" size=\"32\" disabled=\"disabled\"/>' +","                '</div>' +","                '<div class=\"form-check\">' +","                    '<input type=\"checkbox\" class=\"form-check-input newwindow\" id=\"{{elementid}}_{{CSS.NEWWINDOW}}\"/>' +","                    '<label class=\"form-check-label\" for=\"{{elementid}}_{{CSS.NEWWINDOW}}\">' +","                    '{{get_string \"openinnewwindow\" component}}' +","                    '</label>' +","                '</div>' +","                '<div class=\"mdl-align\">' +","                    '<br/>' +","                    '<button type=\"submit\" class=\"btn btn-secondary submit\">{{get_string \"addlink\" component}}</button>' +","                '</div>' +","            '</form>';","Y.namespace('M.atto_teamsmeeting').Button = Y.Base.create('button', Y.M.editor_atto.EditorPlugin, [], {","","    /**","     * A reference to the current selection at the time that the dialogue","     * was opened.","     *","     * @property _currentSelection","     * @type Range","     * @private","     */","    _currentSelection: null,","","    /**","     * A reference to the dialogue content.","     *","     * @property _content","     * @type Node","     * @private","     */","    _content: null,","","    /**","     * Moodle base url to pass for Meetings app.","     *","     * @param _clientdomain","     * @type String","     * @private","     */","    _clientdomain: null,","","    /**","     * The Meetings app url.","     *","     * @param _appurl","     * @type String","     * @private","     */","    _appurl: null,","","    /**","     * Moodle user language to pass for Meetings app.","     *","     * @param _locale","     * @type String","     * @private","     */","    _locale: null,","","    /**","     * Moodle sessionkey to pass for Meetings app.","     *","     * @param _msession","     * @type String","     * @private","     */","    _msession: null,","","    initializer: function() {","        this._clientdomain = this.get('clientdomain');","        this._appurl = this.get('appurl');","        this._locale = this.get('locale');","        this._msession = this.get('msession');","        // Add the teamsmeeting button first.","        this.addButton({","            icon: 'icon',","            iconComponent: 'atto_teamsmeeting',","            callback: this._displayDialogue,","            tags: 'a',","            tagMatchRequiresAll: false","        });","    },","","    /**","     * Display the teamsmeeting editor.","     *","     * @method _displayDialogue","     * @private","     */","    _displayDialogue: function() {","        // Store the current selection.","        this._currentSelection = this.get('host').getSelection();","        if (this._currentSelection === false) {","            return;","        }","","        var dialogue = this.getDialogue({","            headerContent: M.util.get_string('createteamsmeeting', COMPONENTNAME),","            width: 'auto',","            focusAfterHide: true,","            focusOnShowSelector: SELECTORS.URLINPUT","        });","","        // Set the dialogue content, and then show the dialogue.","        dialogue.set('bodyContent', this._getDialogueContent());","","        // Resolve anchors in the selected text.","        this._resolveAnchors();","        dialogue.show();","    },","","    /**","     * If there is selected text and it is part of an anchor teamsmeeting,","     * extract the url (and target) from the teamsmeeting (and set them in the form).","     *","     * @method _resolveAnchors","     * @private","     */","    _resolveAnchors: function() {","        // Find the first anchor tag in the selection.","        var selectednode = this.get('host').getSelectionParentNode(),","            anchornodes,","            anchornode,","            url,","            target;","","        // Note this is a document fragment and YUI doesn't like them.","        if (!selectednode) {","            return;","        }","","        anchornodes = this._findSelectedAnchors(Y.one(selectednode));","        if (anchornodes.length > 0) {","            anchornode = anchornodes[0];","            this._currentSelection = this.get('host').getSelectionFromNode(anchornode);","            url = anchornode.getAttribute('href');","            target = anchornode.getAttribute('target');","            if (url !== '') {","                this._content.one('.url').setAttribute('value', url);","                // Make an ajax request to db for links.","                var ajaxurl = M.cfg.wwwroot + '/lib/editor/atto/plugins/teamsmeeting/ajax.php';","                var params = {","                    url: url","                };","                Y.io(ajaxurl, {","                    context: this,","                    data: params,","                    timeout: 500,","                    on: {","                        complete: this._updateIframe","                    }","                });","            }","            if (target === '_blank') {","                this._content.one('.newwindow').setAttribute('checked', 'checked');","            } else {","                this._content.one('.newwindow').removeAttribute('checked');","            }","        }","    },","","    /**","     * The teamsmeeting iframe check to get meeting link.","     *","     * @method _meetingCheck","     * @param {EventFacade} e","     * @private","     */","    _meetingcheck: function() {","        if(document.getElementById('meetingapp').contentDocument) {","            var url = document.getElementById('meetingapp').contentDocument.location;","            if (url !== '' && url.pathname.indexOf(\"teamsmeeting\") > -1) {","                var link = this._getqueryvariable('link', url);","                var input = this._content.one('.url');","                input.set('value', link);","            }","        }","    },","","    /**","     * The teamsmeeting iframe update.","     *","     * @method _meetingCheck","     * @param {String} id","     * @param {EventFacade} e","     * @private","     */","    _updateIframe:  function(id, data) {","        if (data.status === 200) {","            var dataobject = JSON.parse(data.responseText);","            if (dataobject[2] !== null) {","                var url = dataobject[0]+'?title=' + dataobject[1] + '&link=' + encodeURIComponent(dataobject[2]) +","                    '&options=' + encodeURIComponent(dataobject[3]);","                this._content.one('#meetingapp').set('src', url);","            }","        }","    },","","    /**","     * Gets parameter from url.","     *","     * @method _getqueryvariable","     * @param {string} variable","     * @param {object} url","     * @private","     */","    _getqueryvariable: function(variable, url) {","        var query = url.search.substring(1);","        var vars = query.split('&');","        for (var i = 0; i < vars.length; i++) {","            var pair = vars[i].split('=');","            if (decodeURIComponent(pair[0]) == variable) {","                return decodeURIComponent(pair[1]);","            }","        }","    },","","    /**","     * The teamsmeeting was inserted, so make changes to the editor source.","     *","     * @method _setteamsmeeting","     * @param {EventFacade} e","     * @private","     */","    _setteamsmeeting: function(e) {","        var input,","            value;","","        e.preventDefault();","        this.getDialogue({","            focusAfterHide: null","        }).hide();","","        input = this._content.one('.url');","","        value = input.get('value');","        if (value !== '') {","","            // We add a prefix if it is not already prefixed.","            value = value.trim();","            var expr = new RegExp(/^[a-zA-Z]*\\.*\\/|^#|^[a-zA-Z]*:/);","            if (!expr.test(value)) {","                value = 'http://' + value;","            }","","            // Add the teamsmeeting.","            this._setteamsmeetingOnSelection(value);","","            this.markUpdated();","        }","    },","","    /**","     * Final step setting the anchor on the selection.","     *","     * @private","     * @method _setteamsmeetingOnSelection","     * @param  {String} url URL the teamsmeeting will point to.","     * @return {Node} The added Node.","     */","    _setteamsmeetingOnSelection: function(url) {","        var host = this.get('host'),","            teamsmeeting,","            selectednode,","            target,","            anchornodes;","","        this.editor.focus();","        host.setSelection(this._currentSelection);","","        if (this._currentSelection[0].collapsed) {","            // Firefox cannot add teamsmeetings when the selection is empty so we will add it manually.","            teamsmeeting = Y.Node.create('<a>' + url + '</a>');","            teamsmeeting.setAttribute('href', url);","","            // Add the node and select it to replicate the behaviour of execCommand.","            selectednode = host.insertContentAtFocusPoint(teamsmeeting.get('outerHTML'));","            host.setSelection(host.getSelectionFromNode(selectednode));","        } else {","            document.execCommand('unlink', false, null);","            document.execCommand('createlink', false, url);","","            // Now set the target.","            selectednode = host.getSelectionParentNode();","        }","","        // Note this is a document fragment and YUI doesn't like them.","        if (!selectednode) {","            return;","        }","","        anchornodes = this._findSelectedAnchors(Y.one(selectednode));","        // Add new window attributes if requested.","        Y.Array.each(anchornodes, function(anchornode) {","            target = this._content.one('.newwindow');","            if (target.get('checked')) {","                anchornode.setAttribute('target', '_blank');","            } else {","                anchornode.removeAttribute('target');","            }","        }, this);","","        return selectednode;","    },","","    /**","     * Look up and down for the nearest anchor tags that are least partly contained in the selection.","     *","     * @method _findSelectedAnchors","     * @param {Node} node The node to search under for the selected anchor.","     * @return {Node|Boolean} The Node, or false if not found.","     * @private","     */","    _findSelectedAnchors: function(node) {","        var tagname = node.get('tagName'),","            hit, hits;","","        // Direct hit.","        if (tagname && tagname.toLowerCase() === 'a') {","            return [node];","        }","","        // Search down but check that each node is part of the selection.","        hits = [];","        node.all('a').each(function(n) {","            if (!hit && this.get('host').selectionContainsNode(n)) {","                hits.push(n);","            }","        }, this);","        if (hits.length > 0) {","            return hits;","        }","        // Search up.","        hit = node.ancestor('a');","        if (hit) {","            return [hit];","        }","        return [];","    },","","    /**","     * Generates the content of the dialogue.","     *","     * @method _getDialogueContent","     * @return {Node} Node containing the dialogue content","     * @private","     */","    _getDialogueContent: function() {","        var template = Y.Handlebars.compile(TEMPLATE);","","        this._content = Y.Node.create(template({","            clientdomain: this._clientdomain,","            appurl: this._appurl,","            locale: this._locale,","            msession: this._msession,","            component: COMPONENTNAME,","            CSS: CSS","        }));","","        this._content.one('.submit').on('click', this._setteamsmeeting, this);","","        this._content.one('iframe').on('load', this._meetingcheck, this);","","        return this._content;","    }","}, {","    ATTRS: {","        /**","         * The domain of client.","         *","         * @attribute allowedmethods","         * @type String","         */","        clientdomain: {","            value: null","        },","        /**","         * The meeting app url.","         *","         * @attribute allowedmethods","         * @type String","         */","        appurl: {","            value: null","        },","        /**","         * User locale.","         *","         * @attribute allowedmethods","         * @type String","         */","        locale: {","            value: null","        },","        /**","         * User locale.","         *","         * @attribute allowedmethods","         * @type String","         */","        msession: {","            value: null","        }","    }","});","","","}, '@VERSION@', {\"requires\": [\"moodle-editor_atto-plugin\"]});","","}());"]};
}
__cov__3A0NvTgdEoIoqXY36ZPuw = __cov__3A0NvTgdEoIoqXY36ZPuw['build/moodle-atto_teamsmeeting-button/moodle-atto_teamsmeeting-button.js'];
__cov__3A0NvTgdEoIoqXY36ZPuw.s['1']++;YUI.add('moodle-atto_teamsmeeting-button',function(Y,NAME){__cov__3A0NvTgdEoIoqXY36ZPuw.f['1']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['2']++;var COMPONENTNAME='atto_teamsmeeting',CSS={NEWWINDOW:'atto_teamsmeeting_openinnewwindow',URLINPUT:'atto_teamsmeeting_urlentry'},SELECTORS={URLINPUT:'.atto_teamsmeeting_urlentry'},TEMPLATE=''+'<form class="atto_form">'+'<div class="meeting-app">'+'<label class="meeting-app-label" for="meetingapp">'+'{{get_string "createteamsmeeting" component}}'+'</label>'+'<iframe id="meetingapp" src="{{appurl}}?url={{clientdomain}}&locale={{locale}}&msession={{msession}}&editor=atto"></iframe>'+'</div>'+'<div class="mb-1">'+'<label for="{{elementid}}_atto_teamsmeeting_urlentry">{{get_string "meetingurl" component}}</label>'+'<input class="form-control fullwidth url {{CSS.URLINPUT}}" type="url" '+'id="{{elementid}}_atto_teamsmeeting_urlentry" size="32" disabled="disabled"/>'+'</div>'+'<div class="form-check">'+'<input type="checkbox" class="form-check-input newwindow" id="{{elementid}}_{{CSS.NEWWINDOW}}"/>'+'<label class="form-check-label" for="{{elementid}}_{{CSS.NEWWINDOW}}">'+'{{get_string "openinnewwindow" component}}'+'</label>'+'</div>'+'<div class="mdl-align">'+'<br/>'+'<button type="submit" class="btn btn-secondary submit">{{get_string "addlink" component}}</button>'+'</div>'+'</form>';__cov__3A0NvTgdEoIoqXY36ZPuw.s['3']++;Y.namespace('M.atto_teamsmeeting').Button=Y.Base.create('button',Y.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_content:null,_clientdomain:null,_appurl:null,_locale:null,_msession:null,initializer:function(){__cov__3A0NvTgdEoIoqXY36ZPuw.f['2']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['4']++;this._clientdomain=this.get('clientdomain');__cov__3A0NvTgdEoIoqXY36ZPuw.s['5']++;this._appurl=this.get('appurl');__cov__3A0NvTgdEoIoqXY36ZPuw.s['6']++;this._locale=this.get('locale');__cov__3A0NvTgdEoIoqXY36ZPuw.s['7']++;this._msession=this.get('msession');__cov__3A0NvTgdEoIoqXY36ZPuw.s['8']++;this.addButton({icon:'icon',iconComponent:'atto_teamsmeeting',callback:this._displayDialogue,tags:'a',tagMatchRequiresAll:false});},_displayDialogue:function(){__cov__3A0NvTgdEoIoqXY36ZPuw.f['3']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['9']++;this._currentSelection=this.get('host').getSelection();__cov__3A0NvTgdEoIoqXY36ZPuw.s['10']++;if(this._currentSelection===false){__cov__3A0NvTgdEoIoqXY36ZPuw.b['1'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['11']++;return;}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['1'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['12']++;var dialogue=this.getDialogue({headerContent:M.util.get_string('createteamsmeeting',COMPONENTNAME),width:'auto',focusAfterHide:true,focusOnShowSelector:SELECTORS.URLINPUT});__cov__3A0NvTgdEoIoqXY36ZPuw.s['13']++;dialogue.set('bodyContent',this._getDialogueContent());__cov__3A0NvTgdEoIoqXY36ZPuw.s['14']++;this._resolveAnchors();__cov__3A0NvTgdEoIoqXY36ZPuw.s['15']++;dialogue.show();},_resolveAnchors:function(){__cov__3A0NvTgdEoIoqXY36ZPuw.f['4']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['16']++;var selectednode=this.get('host').getSelectionParentNode(),anchornodes,anchornode,url,target;__cov__3A0NvTgdEoIoqXY36ZPuw.s['17']++;if(!selectednode){__cov__3A0NvTgdEoIoqXY36ZPuw.b['2'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['18']++;return;}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['2'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['19']++;anchornodes=this._findSelectedAnchors(Y.one(selectednode));__cov__3A0NvTgdEoIoqXY36ZPuw.s['20']++;if(anchornodes.length>0){__cov__3A0NvTgdEoIoqXY36ZPuw.b['3'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['21']++;anchornode=anchornodes[0];__cov__3A0NvTgdEoIoqXY36ZPuw.s['22']++;this._currentSelection=this.get('host').getSelectionFromNode(anchornode);__cov__3A0NvTgdEoIoqXY36ZPuw.s['23']++;url=anchornode.getAttribute('href');__cov__3A0NvTgdEoIoqXY36ZPuw.s['24']++;target=anchornode.getAttribute('target');__cov__3A0NvTgdEoIoqXY36ZPuw.s['25']++;if(url!==''){__cov__3A0NvTgdEoIoqXY36ZPuw.b['4'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['26']++;this._content.one('.url').setAttribute('value',url);__cov__3A0NvTgdEoIoqXY36ZPuw.s['27']++;var ajaxurl=M.cfg.wwwroot+'/lib/editor/atto/plugins/teamsmeeting/ajax.php';__cov__3A0NvTgdEoIoqXY36ZPuw.s['28']++;var params={url:url};__cov__3A0NvTgdEoIoqXY36ZPuw.s['29']++;Y.io(ajaxurl,{context:this,data:params,timeout:500,on:{complete:this._updateIframe}});}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['4'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['30']++;if(target==='_blank'){__cov__3A0NvTgdEoIoqXY36ZPuw.b['5'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['31']++;this._content.one('.newwindow').setAttribute('checked','checked');}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['5'][1]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['32']++;this._content.one('.newwindow').removeAttribute('checked');}}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['3'][1]++;}},_meetingcheck:function(){__cov__3A0NvTgdEoIoqXY36ZPuw.f['5']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['33']++;if(document.getElementById('meetingapp').contentDocument){__cov__3A0NvTgdEoIoqXY36ZPuw.b['6'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['34']++;var url=document.getElementById('meetingapp').contentDocument.location;__cov__3A0NvTgdEoIoqXY36ZPuw.s['35']++;if((__cov__3A0NvTgdEoIoqXY36ZPuw.b['8'][0]++,url!=='')&&(__cov__3A0NvTgdEoIoqXY36ZPuw.b['8'][1]++,url.pathname.indexOf('teamsmeeting')>-1)){__cov__3A0NvTgdEoIoqXY36ZPuw.b['7'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['36']++;var link=this._getqueryvariable('link',url);__cov__3A0NvTgdEoIoqXY36ZPuw.s['37']++;var input=this._content.one('.url');__cov__3A0NvTgdEoIoqXY36ZPuw.s['38']++;input.set('value',link);}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['7'][1]++;}}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['6'][1]++;}},_updateIframe:function(id,data){__cov__3A0NvTgdEoIoqXY36ZPuw.f['6']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['39']++;if(data.status===200){__cov__3A0NvTgdEoIoqXY36ZPuw.b['9'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['40']++;var dataobject=JSON.parse(data.responseText);__cov__3A0NvTgdEoIoqXY36ZPuw.s['41']++;if(dataobject[2]!==null){__cov__3A0NvTgdEoIoqXY36ZPuw.b['10'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['42']++;var url=dataobject[0]+'?title='+dataobject[1]+'&link='+encodeURIComponent(dataobject[2])+'&options='+encodeURIComponent(dataobject[3]);__cov__3A0NvTgdEoIoqXY36ZPuw.s['43']++;this._content.one('#meetingapp').set('src',url);}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['10'][1]++;}}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['9'][1]++;}},_getqueryvariable:function(variable,url){__cov__3A0NvTgdEoIoqXY36ZPuw.f['7']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['44']++;var query=url.search.substring(1);__cov__3A0NvTgdEoIoqXY36ZPuw.s['45']++;var vars=query.split('&');__cov__3A0NvTgdEoIoqXY36ZPuw.s['46']++;for(var i=0;i<vars.length;i++){__cov__3A0NvTgdEoIoqXY36ZPuw.s['47']++;var pair=vars[i].split('=');__cov__3A0NvTgdEoIoqXY36ZPuw.s['48']++;if(decodeURIComponent(pair[0])==variable){__cov__3A0NvTgdEoIoqXY36ZPuw.b['11'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['49']++;return decodeURIComponent(pair[1]);}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['11'][1]++;}}},_setteamsmeeting:function(e){__cov__3A0NvTgdEoIoqXY36ZPuw.f['8']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['50']++;var input,value;__cov__3A0NvTgdEoIoqXY36ZPuw.s['51']++;e.preventDefault();__cov__3A0NvTgdEoIoqXY36ZPuw.s['52']++;this.getDialogue({focusAfterHide:null}).hide();__cov__3A0NvTgdEoIoqXY36ZPuw.s['53']++;input=this._content.one('.url');__cov__3A0NvTgdEoIoqXY36ZPuw.s['54']++;value=input.get('value');__cov__3A0NvTgdEoIoqXY36ZPuw.s['55']++;if(value!==''){__cov__3A0NvTgdEoIoqXY36ZPuw.b['12'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['56']++;value=value.trim();__cov__3A0NvTgdEoIoqXY36ZPuw.s['57']++;var expr=new RegExp(/^[a-zA-Z]*\.*\/|^#|^[a-zA-Z]*:/);__cov__3A0NvTgdEoIoqXY36ZPuw.s['58']++;if(!expr.test(value)){__cov__3A0NvTgdEoIoqXY36ZPuw.b['13'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['59']++;value='http://'+value;}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['13'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['60']++;this._setteamsmeetingOnSelection(value);__cov__3A0NvTgdEoIoqXY36ZPuw.s['61']++;this.markUpdated();}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['12'][1]++;}},_setteamsmeetingOnSelection:function(url){__cov__3A0NvTgdEoIoqXY36ZPuw.f['9']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['62']++;var host=this.get('host'),teamsmeeting,selectednode,target,anchornodes;__cov__3A0NvTgdEoIoqXY36ZPuw.s['63']++;this.editor.focus();__cov__3A0NvTgdEoIoqXY36ZPuw.s['64']++;host.setSelection(this._currentSelection);__cov__3A0NvTgdEoIoqXY36ZPuw.s['65']++;if(this._currentSelection[0].collapsed){__cov__3A0NvTgdEoIoqXY36ZPuw.b['14'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['66']++;teamsmeeting=Y.Node.create('<a>'+url+'</a>');__cov__3A0NvTgdEoIoqXY36ZPuw.s['67']++;teamsmeeting.setAttribute('href',url);__cov__3A0NvTgdEoIoqXY36ZPuw.s['68']++;selectednode=host.insertContentAtFocusPoint(teamsmeeting.get('outerHTML'));__cov__3A0NvTgdEoIoqXY36ZPuw.s['69']++;host.setSelection(host.getSelectionFromNode(selectednode));}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['14'][1]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['70']++;document.execCommand('unlink',false,null);__cov__3A0NvTgdEoIoqXY36ZPuw.s['71']++;document.execCommand('createlink',false,url);__cov__3A0NvTgdEoIoqXY36ZPuw.s['72']++;selectednode=host.getSelectionParentNode();}__cov__3A0NvTgdEoIoqXY36ZPuw.s['73']++;if(!selectednode){__cov__3A0NvTgdEoIoqXY36ZPuw.b['15'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['74']++;return;}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['15'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['75']++;anchornodes=this._findSelectedAnchors(Y.one(selectednode));__cov__3A0NvTgdEoIoqXY36ZPuw.s['76']++;Y.Array.each(anchornodes,function(anchornode){__cov__3A0NvTgdEoIoqXY36ZPuw.f['10']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['77']++;target=this._content.one('.newwindow');__cov__3A0NvTgdEoIoqXY36ZPuw.s['78']++;if(target.get('checked')){__cov__3A0NvTgdEoIoqXY36ZPuw.b['16'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['79']++;anchornode.setAttribute('target','_blank');}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['16'][1]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['80']++;anchornode.removeAttribute('target');}},this);__cov__3A0NvTgdEoIoqXY36ZPuw.s['81']++;return selectednode;},_findSelectedAnchors:function(node){__cov__3A0NvTgdEoIoqXY36ZPuw.f['11']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['82']++;var tagname=node.get('tagName'),hit,hits;__cov__3A0NvTgdEoIoqXY36ZPuw.s['83']++;if((__cov__3A0NvTgdEoIoqXY36ZPuw.b['18'][0]++,tagname)&&(__cov__3A0NvTgdEoIoqXY36ZPuw.b['18'][1]++,tagname.toLowerCase()==='a')){__cov__3A0NvTgdEoIoqXY36ZPuw.b['17'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['84']++;return[node];}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['17'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['85']++;hits=[];__cov__3A0NvTgdEoIoqXY36ZPuw.s['86']++;node.all('a').each(function(n){__cov__3A0NvTgdEoIoqXY36ZPuw.f['12']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['87']++;if((__cov__3A0NvTgdEoIoqXY36ZPuw.b['20'][0]++,!hit)&&(__cov__3A0NvTgdEoIoqXY36ZPuw.b['20'][1]++,this.get('host').selectionContainsNode(n))){__cov__3A0NvTgdEoIoqXY36ZPuw.b['19'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['88']++;hits.push(n);}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['19'][1]++;}},this);__cov__3A0NvTgdEoIoqXY36ZPuw.s['89']++;if(hits.length>0){__cov__3A0NvTgdEoIoqXY36ZPuw.b['21'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['90']++;return hits;}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['21'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['91']++;hit=node.ancestor('a');__cov__3A0NvTgdEoIoqXY36ZPuw.s['92']++;if(hit){__cov__3A0NvTgdEoIoqXY36ZPuw.b['22'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['93']++;return[hit];}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['22'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['94']++;return[];},_getDialogueContent:function(){__cov__3A0NvTgdEoIoqXY36ZPuw.f['13']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['95']++;var template=Y.Handlebars.compile(TEMPLATE);__cov__3A0NvTgdEoIoqXY36ZPuw.s['96']++;this._content=Y.Node.create(template({clientdomain:this._clientdomain,appurl:this._appurl,locale:this._locale,msession:this._msession,component:COMPONENTNAME,CSS:CSS}));__cov__3A0NvTgdEoIoqXY36ZPuw.s['97']++;this._content.one('.submit').on('click',this._setteamsmeeting,this);__cov__3A0NvTgdEoIoqXY36ZPuw.s['98']++;this._content.one('iframe').on('load',this._meetingcheck,this);__cov__3A0NvTgdEoIoqXY36ZPuw.s['99']++;return this._content;}},{ATTRS:{clientdomain:{value:null},appurl:{value:null},locale:{value:null},msession:{value:null}}});},'@VERSION@',{'requires':['moodle-editor_atto-plugin']});
