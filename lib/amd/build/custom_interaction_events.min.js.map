{"version":3,"sources":["../src/custom_interaction_events.js"],"names":["define","$","keyCodes","events","activate","keyboardActivate","escape","down","up","home","end","next","previous","asterix","scrollLock","scrollTop","scrollBottom","ctrlPageUp","ctrlPageDown","enter","accessibleChange","triggeredEvents","shouldAddEvent","eventType","include","length","indexOf","isModifierPressed","e","shiftKey","metaKey","altKey","ctrlKey","triggerEvent","eventName","eventTypeKey","hasOwnProperty","type","timeStamp","target","trigger","originalEvent","addKeyboardEvent","element","event","keyCode","off","on","addActivateListener","space","addKeyboardActivateListener","addEscapeListener","addDownListener","arrowDown","addUpListener","arrowUp","addHomeListener","addEndListener","addNextListener","attr","arrowLeft","arrowRight","addPreviousListener","addAsterixListener","addScrollTopListener","addScrollBottomListener","innerHeight","scrollHeight","addScrollLockListener","height","delta","detail","wheelDelta","stopPropagation","preventDefault","returnValue","addCtrlPageUpListener","pageUp","addCtrlPageDownListener","pageDown","addEnterListener","addAccessibleChangeListener","onMac","navigator","userAgent","touchEnabled","window","msMaxTouchPoints","setInitialValue","dataset","initValue","value","resetToInitialValue","checkAndTriggerAccessibleChange","nativeElement","get","addEventListener","which","ignoreChange","getHandlers","handlers","each","handler"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module provides a wrapper to encapsulate a lot of the common combinations of\n * user interaction we use in Moodle.\n *\n * @module     core/custom_interaction_events\n * @copyright  2016 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.2\n */\ndefine(['jquery', 'core/key_codes'], function($, keyCodes) {\n    // The list of events provided by this module. Namespaced to avoid clashes.\n    var events = {\n        activate: 'cie:activate',\n        keyboardActivate: 'cie:keyboardactivate',\n        escape: 'cie:escape',\n        down: 'cie:down',\n        up: 'cie:up',\n        home: 'cie:home',\n        end: 'cie:end',\n        next: 'cie:next',\n        previous: 'cie:previous',\n        asterix: 'cie:asterix',\n        scrollLock: 'cie:scrollLock',\n        scrollTop: 'cie:scrollTop',\n        scrollBottom: 'cie:scrollBottom',\n        ctrlPageUp: 'cie:ctrlPageUp',\n        ctrlPageDown: 'cie:ctrlPageDown',\n        enter: 'cie:enter',\n        accessibleChange: 'cie:accessibleChange',\n    };\n    // Static cache of jQuery events that have been handled. This should\n    // only be populated by JavaScript generated events (which will keep it\n    // fairly small).\n    var triggeredEvents = {};\n\n    /**\n     * Check if the caller has asked for the given event type to be\n     * registered.\n     *\n     * @method shouldAddEvent\n     * @private\n     * @param {string} eventType name of the event (see events above)\n     * @param {array} include the list of events to be added\n     * @return {bool} true if the event should be added, false otherwise.\n     */\n    var shouldAddEvent = function(eventType, include) {\n        include = include || [];\n\n        if (include.length && include.indexOf(eventType) !== -1) {\n            return true;\n        }\n\n        return false;\n    };\n\n    /**\n     * Check if any of the modifier keys have been pressed on the event.\n     *\n     * @method isModifierPressed\n     * @private\n     * @param {event} e jQuery event\n     * @return {bool} true if shift, meta (command on Mac), alt or ctrl are pressed\n     */\n    var isModifierPressed = function(e) {\n        return (e.shiftKey || e.metaKey || e.altKey || e.ctrlKey);\n    };\n\n    /**\n     * Trigger the custom event for the given jQuery event.\n     *\n     * This function will only fire the custom event if one hasn't already been\n     * fired for the jQuery event.\n     *\n     * This is to prevent multiple custom event handlers triggering multiple\n     * custom events for a single jQuery event as it bubbles up the stack.\n     *\n     * @param  {string} eventName The name of the custom event\n     * @param  {event} e          The jQuery event\n     * @return {void}\n     */\n    var triggerEvent = function(eventName, e) {\n        var eventTypeKey = \"\";\n\n        if (!e.hasOwnProperty('originalEvent')) {\n            // This is a jQuery event generated from JavaScript not a browser event so\n            // we need to build the cache key for the event.\n            eventTypeKey = \"\" + eventName + e.type + e.timeStamp;\n\n            if (!triggeredEvents.hasOwnProperty(eventTypeKey)) {\n                // If we haven't seen this jQuery event before then fire a custom\n                // event for it and remember the event for later.\n                triggeredEvents[eventTypeKey] = true;\n                $(e.target).trigger(eventName, [{originalEvent: e}]);\n            }\n            return;\n        }\n\n        eventTypeKey = \"triggeredCustom_\" + eventName;\n        if (!e.originalEvent.hasOwnProperty(eventTypeKey)) {\n            // If this is a jQuery event generated by the browser then set a\n            // property on the original event to track that we've seen it before.\n            // The property is set on the original event because it's the only part\n            // of the jQuery event that is maintained through multiple event handlers.\n            e.originalEvent[eventTypeKey] = true;\n            $(e.target).trigger(eventName, [{originalEvent: e}]);\n            return;\n        }\n    };\n\n    /**\n     * Register a keyboard event that ignores modifier keys.\n     *\n     * @method addKeyboardEvent\n     * @private\n     * @param {object} element A jQuery object of the element to bind events to\n     * @param {string} event The custom interaction event name\n     * @param {int} keyCode The key code.\n     */\n    var addKeyboardEvent = function(element, event, keyCode) {\n        element.off('keydown.' + event).on('keydown.' + event, function(e) {\n            if (!isModifierPressed(e)) {\n                if (e.keyCode == keyCode) {\n                    triggerEvent(event, e);\n                }\n            }\n        });\n    };\n\n    /**\n     * Trigger the activate event on the given element if it is clicked or the enter\n     * or space key are pressed without a modifier key.\n     *\n     * @method addActivateListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addActivateListener = function(element) {\n        element.off('click.cie.activate').on('click.cie.activate', function(e) {\n            triggerEvent(events.activate, e);\n        });\n        element.off('keydown.cie.activate').on('keydown.cie.activate', function(e) {\n            if (!isModifierPressed(e)) {\n                if (e.keyCode == keyCodes.enter || e.keyCode == keyCodes.space) {\n                    triggerEvent(events.activate, e);\n                }\n            }\n        });\n    };\n\n    /**\n     * Trigger the keyboard activate event on the given element if the enter\n     * or space key are pressed without a modifier key.\n     *\n     * @method addKeyboardActivateListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addKeyboardActivateListener = function(element) {\n        element.off('keydown.cie.keyboardactivate').on('keydown.cie.keyboardactivate', function(e) {\n            if (!isModifierPressed(e)) {\n                if (e.keyCode == keyCodes.enter || e.keyCode == keyCodes.space) {\n                    triggerEvent(events.keyboardActivate, e);\n                }\n            }\n        });\n    };\n\n    /**\n     * Trigger the escape event on the given element if the escape key is pressed\n     * without a modifier key.\n     *\n     * @method addEscapeListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addEscapeListener = function(element) {\n        addKeyboardEvent(element, events.escape, keyCodes.escape);\n    };\n\n    /**\n     * Trigger the down event on the given element if the down arrow key is pressed\n     * without a modifier key.\n     *\n     * @method addDownListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addDownListener = function(element) {\n        addKeyboardEvent(element, events.down, keyCodes.arrowDown);\n    };\n\n    /**\n     * Trigger the up event on the given element if the up arrow key is pressed\n     * without a modifier key.\n     *\n     * @method addUpListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addUpListener = function(element) {\n        addKeyboardEvent(element, events.up, keyCodes.arrowUp);\n    };\n\n    /**\n     * Trigger the home event on the given element if the home key is pressed\n     * without a modifier key.\n     *\n     * @method addHomeListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addHomeListener = function(element) {\n        addKeyboardEvent(element, events.home, keyCodes.home);\n    };\n\n    /**\n     * Trigger the end event on the given element if the end key is pressed\n     * without a modifier key.\n     *\n     * @method addEndListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addEndListener = function(element) {\n        addKeyboardEvent(element, events.end, keyCodes.end);\n    };\n\n    /**\n     * Trigger the next event on the given element if the right arrow key is pressed\n     * without a modifier key in LTR mode or left arrow key in RTL mode.\n     *\n     * @method addNextListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addNextListener = function(element) {\n        // Left and right are flipped in RTL mode.\n        var keyCode = $('html').attr('dir') == \"rtl\" ? keyCodes.arrowLeft : keyCodes.arrowRight;\n\n        addKeyboardEvent(element, events.next, keyCode);\n    };\n\n    /**\n     * Trigger the previous event on the given element if the left arrow key is pressed\n     * without a modifier key in LTR mode or right arrow key in RTL mode.\n     *\n     * @method addPreviousListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addPreviousListener = function(element) {\n        // Left and right are flipped in RTL mode.\n        var keyCode = $('html').attr('dir') == \"rtl\" ? keyCodes.arrowRight : keyCodes.arrowLeft;\n\n        addKeyboardEvent(element, events.previous, keyCode);\n    };\n\n    /**\n     * Trigger the asterix event on the given element if the asterix key is pressed\n     * without a modifier key.\n     *\n     * @method addAsterixListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addAsterixListener = function(element) {\n        addKeyboardEvent(element, events.asterix, keyCodes.asterix);\n    };\n\n\n    /**\n     * Trigger the scrollTop event on the given element if the user scrolls to\n     * the top of the given element.\n     *\n     * @method addScrollTopListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addScrollTopListener = function(element) {\n        element.off('scroll.cie.scrollTop').on('scroll.cie.scrollTop', function(e) {\n            var scrollTop = element.scrollTop();\n            if (scrollTop === 0) {\n                triggerEvent(events.scrollTop, e);\n            }\n        });\n    };\n\n    /**\n     * Trigger the scrollBottom event on the given element if the user scrolls to\n     * the bottom of the given element.\n     *\n     * @method addScrollBottomListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addScrollBottomListener = function(element) {\n        element.off('scroll.cie.scrollBottom').on('scroll.cie.scrollBottom', function(e) {\n            var scrollTop = element.scrollTop();\n            var innerHeight = element.innerHeight();\n            var scrollHeight = element[0].scrollHeight;\n\n            if (scrollTop + innerHeight >= scrollHeight) {\n                triggerEvent(events.scrollBottom, e);\n            }\n        });\n    };\n\n    /**\n     * Trigger the scrollLock event on the given element if the user scrolls to\n     * the bottom or top of the given element.\n     *\n     * @method addScrollLockListener\n     * @private\n     * @param {jQuery} element jQuery object to add event listeners to\n     */\n    var addScrollLockListener = function(element) {\n        // Lock mousewheel scrolling within the element to stop the annoying window scroll.\n        element.off('DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock')\n            .on('DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock', function(e) {\n                var scrollTop = element.scrollTop();\n                var scrollHeight = element[0].scrollHeight;\n                var height = element.height();\n                var delta = (e.type == 'DOMMouseScroll' ?\n                    e.originalEvent.detail * -40 :\n                    e.originalEvent.wheelDelta);\n                var up = delta > 0;\n\n                if (!up && -delta > scrollHeight - height - scrollTop) {\n                    // Scrolling down past the bottom.\n                    element.scrollTop(scrollHeight);\n                    e.stopPropagation();\n                    e.preventDefault();\n                    e.returnValue = false;\n                    // Fire the scroll lock event.\n                    triggerEvent(events.scrollLock, e);\n\n                    return false;\n                } else if (up && delta > scrollTop) {\n                    // Scrolling up past the top.\n                    element.scrollTop(0);\n                    e.stopPropagation();\n                    e.preventDefault();\n                    e.returnValue = false;\n                    // Fire the scroll lock event.\n                    triggerEvent(events.scrollLock, e);\n\n                    return false;\n                }\n\n                return true;\n            });\n    };\n\n    /**\n     * Trigger the ctrlPageUp event on the given element if the user presses the\n     * control and page up key.\n     *\n     * @method addCtrlPageUpListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addCtrlPageUpListener = function(element) {\n        element.off('keydown.cie.ctrlpageup').on('keydown.cie.ctrlpageup', function(e) {\n            if (e.ctrlKey) {\n                if (e.keyCode == keyCodes.pageUp) {\n                    triggerEvent(events.ctrlPageUp, e);\n                }\n            }\n        });\n    };\n\n    /**\n     * Trigger the ctrlPageDown event on the given element if the user presses the\n     * control and page down key.\n     *\n     * @method addCtrlPageDownListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addCtrlPageDownListener = function(element) {\n        element.off('keydown.cie.ctrlpagedown').on('keydown.cie.ctrlpagedown', function(e) {\n            if (e.ctrlKey) {\n                if (e.keyCode == keyCodes.pageDown) {\n                    triggerEvent(events.ctrlPageDown, e);\n                }\n            }\n        });\n    };\n\n    /**\n     * Trigger the enter event on the given element if the enter key is pressed\n     * without a modifier key.\n     *\n     * @method addEnterListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addEnterListener = function(element) {\n        addKeyboardEvent(element, events.enter, keyCodes.enter);\n    };\n\n    /**\n     * Trigger the AccessibleChange event on the given element if the value of the element is changed.\n     *\n     * @method addAccessibleChangeListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addAccessibleChangeListener = function(element) {\n        var onMac = navigator.userAgent.indexOf('Macintosh') !== -1;\n        var touchEnabled = ('ontouchstart' in window) || (('msMaxTouchPoints' in navigator) && (navigator.msMaxTouchPoints > 0));\n        if (onMac || touchEnabled) {\n            // On Mac devices, and touch-enabled devices, the change event seems to be handled correctly and\n            // consistently at this time.\n            element.on('change', function(e) {\n                triggerEvent(events.accessibleChange, e);\n            });\n        } else {\n            // Some browsers have non-normalised behaviour for handling the selection of values in a <select> element.\n            // When using Chrome on Linux (and possibly others), a 'change' event is fired when pressing the Escape key.\n            // When using Firefox on Linux (and possibly others), a 'change' event is fired when navigating through the\n            // list with a keyboard.\n            //\n            // To normalise these behaviours:\n            // - the initial value is stored in a data attribute when focusing the element\n            // - the current value is checked against the stored initial value when and the accessibleChange event fired when:\n            // --- blurring the element\n            // --- the 'Enter' key is pressed\n            // --- the element is clicked\n            // --- the 'change' event is fired, except where it is from a keyboard interaction\n            //\n            // To facilitate the change event keyboard interaction check, the 'keyDown' handler sets a flag to ignore\n            // the change event handler which is unset on the 'keyUp' event.\n            //\n            // Unfortunately we cannot control this entirely as some browsers (Chrome) trigger a change event when\n            // pressign the Escape key, and this is considered to be the correct behaviour.\n            // Chrome https://bugs.chromium.org/p/chromium/issues/detail?id=839717\n            //\n            // Our longer-term solution to this should be to switch away from using <select> boxes as a single-select,\n            // and make use of a dropdown of action links like the Bootstrap Dropdown menu.\n            var setInitialValue = function(target) {\n                target.dataset.initValue = target.value;\n            };\n            var resetToInitialValue = function(target) {\n                if ('initValue' in target.dataset) {\n                    target.value = target.dataset.initValue;\n                }\n            };\n            var checkAndTriggerAccessibleChange = function(e) {\n                if (!('initValue' in e.target.dataset)) {\n                    // Some browsers trigger click before focus, therefore it is possible that initValue is undefined.\n                    // In this case it's likely that it's being focused for the first time and we should therefore not submit.\n                    return;\n                }\n\n                if (e.target.value !== e.target.dataset.initValue) {\n                    // Update the initValue when the event is triggered.\n                    // This means that if the click handler fires before the focus handler on a subsequent interaction\n                    // with the element, the currently dispalyed value will be the best guess current value.\n                    e.target.dataset.initValue = e.target.value;\n                    triggerEvent(events.accessibleChange, e);\n                }\n            };\n            var nativeElement = element.get()[0];\n            // The `focus` and `blur` events do not support bubbling. Use Event Capture instead.\n            nativeElement.addEventListener('focus', function(e) {\n                setInitialValue(e.target);\n            }, true);\n            nativeElement.addEventListener('blur', function(e) {\n                checkAndTriggerAccessibleChange(e);\n            }, true);\n            element.on('keydown', function(e) {\n                if ((e.which === keyCodes.enter)) {\n                    checkAndTriggerAccessibleChange(e);\n                } else if (e.which === keyCodes.escape) {\n                    resetToInitialValue(e.target);\n                    e.target.dataset.ignoreChange = true;\n                } else {\n                    // Firefox triggers a change event when using the keyboard to scroll through the selection.\n                    // Set a data- attribute that the change listener can use to ignore the change event where it was\n                    // generated from a keyboard change such as typing to complete a value, or using arrow keys.\n                    e.target.dataset.ignoreChange = true;\n\n                }\n            });\n            element.on('change', function(e) {\n                if (e.target.dataset.ignoreChange) {\n                    // This change event was triggered from a keyboard change which is not yet complete.\n                    // Do not trigger the accessibleChange event until the selection is completed using the [return]\n                    // key.\n                    return;\n                }\n\n                checkAndTriggerAccessibleChange(e);\n            });\n            element.on('keyup', function(e) {\n                // The key has been lifted. Stop ignoring the change event.\n                delete e.target.dataset.ignoreChange;\n            });\n            element.on('click', function(e) {\n                checkAndTriggerAccessibleChange(e);\n            });\n        }\n    };\n\n    /**\n     * Get the list of events and their handlers.\n     *\n     * @method getHandlers\n     * @private\n     * @return {object} object key of event names and value of handler functions\n     */\n    var getHandlers = function() {\n        var handlers = {};\n\n        handlers[events.activate] = addActivateListener;\n        handlers[events.keyboardActivate] = addKeyboardActivateListener;\n        handlers[events.escape] = addEscapeListener;\n        handlers[events.down] = addDownListener;\n        handlers[events.up] = addUpListener;\n        handlers[events.home] = addHomeListener;\n        handlers[events.end] = addEndListener;\n        handlers[events.next] = addNextListener;\n        handlers[events.previous] = addPreviousListener;\n        handlers[events.asterix] = addAsterixListener;\n        handlers[events.scrollLock] = addScrollLockListener;\n        handlers[events.scrollTop] = addScrollTopListener;\n        handlers[events.scrollBottom] = addScrollBottomListener;\n        handlers[events.ctrlPageUp] = addCtrlPageUpListener;\n        handlers[events.ctrlPageDown] = addCtrlPageDownListener;\n        handlers[events.enter] = addEnterListener;\n        handlers[events.accessibleChange] = addAccessibleChangeListener;\n\n        return handlers;\n    };\n\n    /**\n     * Add all of the listeners on the given element for the requested events.\n     *\n     * @method define\n     * @public\n     * @param {object} element the DOM element to register event listeners on\n     * @param {array} include the array of events to be triggered\n     */\n    var define = function(element, include) {\n        element = $(element);\n        include = include || [];\n\n        if (!element.length || !include.length) {\n            return;\n        }\n\n        $.each(getHandlers(), function(eventType, handler) {\n            if (shouldAddEvent(eventType, include)) {\n                handler(element);\n            }\n        });\n    };\n\n    return {\n        define: define,\n        events: events,\n    };\n});\n"],"file":"custom_interaction_events.min.js"}