function _typeof2(e){"@babel/helpers - typeof";return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof2(e)}define ("core/adapter",[],function(){return function r(d,t,n){function a(i,o){if(!t[i]){if(!d[i]){var s="function"==typeof require&&require;if(!o&&s)return s(i,!0);if(e)return e(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var p=t[i]={exports:{}};d[i][0].call(p.exports,function(t){var e=d[i][1][t];return a(e?e:t)},p,p.exports,r,d,t,n)}return t[i].exports}for(var e="function"==typeof require&&require,i=0;i<n.length;i++){a(n[i])}return a}({1:[function(e,t){"use strict";var r=e("./adapter_factory.js"),a=(0,r.adapterFactory)({window:window});t.exports=a},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.adapterFactory=function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},t=e.window,r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},a=n.log,i=n.detectBrowser(t),s={browserDetails:i,commonShim:h,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(i.browser){case"chrome":if(!o||!o.shimPeerConnection||!r.shimChrome){a("Chrome shim is not included in this adapter release.");return s}a("adapter.js shimming chrome.");s.browserShim=o;o.shimGetUserMedia(t);o.shimMediaStream(t);o.shimPeerConnection(t);o.shimOnTrack(t);o.shimAddTrackRemoveTrack(t);o.shimGetSendersWithDtmf(t);o.shimGetStats(t);o.shimSenderReceiverGetStats(t);o.fixNegotiationNeeded(t);h.shimRTCIceCandidate(t);h.shimConnectionState(t);h.shimMaxMessageSize(t);h.shimSendThrowTypeError(t);h.removeAllowExtmapMixed(t);break;case"firefox":if(!p||!p.shimPeerConnection||!r.shimFirefox){a("Firefox shim is not included in this adapter release.");return s}a("adapter.js shimming firefox.");s.browserShim=p;p.shimGetUserMedia(t);p.shimPeerConnection(t);p.shimOnTrack(t);p.shimRemoveStream(t);p.shimSenderGetStats(t);p.shimReceiverGetStats(t);p.shimRTCDataChannel(t);p.shimAddTransceiver(t);p.shimCreateOffer(t);p.shimCreateAnswer(t);h.shimRTCIceCandidate(t);h.shimConnectionState(t);h.shimMaxMessageSize(t);h.shimSendThrowTypeError(t);break;case"edge":if(!d||!d.shimPeerConnection||!r.shimEdge){a("MS edge shim is not included in this adapter release.");return s}a("adapter.js shimming edge.");s.browserShim=d;d.shimGetUserMedia(t);d.shimGetDisplayMedia(t);d.shimPeerConnection(t);d.shimReplaceTrack(t);h.shimMaxMessageSize(t);h.shimSendThrowTypeError(t);break;case"safari":if(!m||!r.shimSafari){a("Safari shim is not included in this adapter release.");return s}a("adapter.js shimming safari.");s.browserShim=m;m.shimRTCIceServerUrls(t);m.shimCreateOfferLegacy(t);m.shimCallbacksAPI(t);m.shimLocalStreamsAPI(t);m.shimRemoteStreamsAPI(t);m.shimTrackEventTransceiver(t);m.shimGetUserMedia(t);h.shimRTCIceCandidate(t);h.shimMaxMessageSize(t);h.shimSendThrowTypeError(t);h.removeAllowExtmapMixed(t);break;default:a("Unsupported browser!");break;}return s};var a=e("./utils"),n=g(a),i=e("./chrome/chrome_shim"),o=g(i),s=e("./edge/edge_shim"),d=g(s),c=e("./firefox/firefox_shim"),p=g(c),l=e("./safari/safari_shim"),m=g(l),f=e("./common_shim"),h=g(f);function g(e){if(e&&e.__esModule){return e}else{var t={};if(null!=e){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)},n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}});r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream};r.shimOnTrack=c;r.shimGetSendersWithDtmf=p;r.shimGetStats=function(e){if(!e.RTCPeerConnection){return}var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=Array.prototype.slice.call(arguments),a=r[0],n=r[1],i=r[2];if(0<arguments.length&&"function"==typeof a){return t.apply(this,arguments)}if(0===t.length&&(0===arguments.length||"function"!=typeof a)){return t.apply(this,[])}var o=function(e){var t={},r=e.result();r.forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)});t[r.id]=r});return t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(2<=arguments.length){var d=function(e){n(s(o(e)))};return t.apply(this,[d,a])}return new Promise(function(r,a){t.apply(e,[function(e){r(s(o(e)))},a])}).then(n,i)}};r.shimSenderReceiverGetStats=l;r.shimAddTrackRemoveTrackWithNative=m;r.shimAddTrackRemoveTrack=function(e){if(!e.RTCPeerConnection){return}var t=s.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&65<=t.version){return m(e)}var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);this._reverseStreams=this._reverseStreams||{};return t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};t.getTracks().forEach(function(e){var t=r.getSenders().find(function(t){return t.track===e});if(t){throw new DOMException("Track already exists.","InvalidAccessError")}});if(!this._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());this._streams[t.id]=n;this._reverseStreams[n.id]=t;t=n}a.apply(this,[t])};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};n.apply(this,[this._streams[e.id]||e]);delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id];delete this._streams[e.id]};e.RTCPeerConnection.prototype.addTrack=function(r,a){var n=this;if("closed"===this.signalingState){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===r})){throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError")}var o=this.getSenders().find(function(e){return e.track===r});if(o){throw new DOMException("Track already exists.","InvalidAccessError")}this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};var s=this._streams[a.id];if(s){s.addTrack(r);Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))})}else{var d=new e.MediaStream([r]);this._streams[a.id]=d;this._reverseStreams[d.id]=a;this.addStream(d)}return this.getSenders().find(function(e){return e.track===r})};function i(e,t){var r=t.sdp;Object.keys(e._reverseStreams||[]).forEach(function(t){var a=e._reverseStreams[t],n=e._streams[a.id];r=r.replace(new RegExp(n.id,"g"),a.id)});return new RTCSessionDescription({type:t.type,sdp:r})}function o(e,t){var r=t.sdp;Object.keys(e._reverseStreams||[]).forEach(function(t){var a=e._reverseStreams[t],n=e._streams[a.id];r=r.replace(new RegExp(a.id,"g"),n.id)});return new RTCSessionDescription({type:t.type,sdp:r})}["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],a=d({},t,function(){var e=this,t=arguments,a=arguments.length&&"function"==typeof arguments[0];if(a){return r.apply(this,[function(r){var a=i(e,r);t[0].apply(null,[a])},function(e){if(t[1]){t[1].apply(null,e)}},arguments[2]])}return r.apply(this,arguments).then(function(t){return i(e,t)})});e.RTCPeerConnection.prototype[t]=a[t]});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){if(!arguments.length||!arguments[0].type){return c.apply(this,arguments)}arguments[0]=o(this,arguments[0]);return c.apply(this,arguments)};var p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=p.get.apply(this);if(""===e.type){return e}return i(this,e)}});e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}if(!e._pc){throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError")}var r=e._pc===this;if(!r){throw new DOMException("Sender was not created by this connection.","InvalidAccessError")}this._streams=this._streams||{};var a;Object.keys(this._streams).forEach(function(r){var n=t._streams[r].getTracks().find(function(t){return e.track===t});if(n){a=t._streams[r]}});if(a){if(1===a.getTracks().length){this.removeStream(this._reverseStreams[a.id])}else{a.removeTrack(e.track)}this.dispatchEvent(new Event("negotiationneeded"))}}};r.shimPeerConnection=function(e){var t=s.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection){e.RTCPeerConnection=e.webkitRTCPeerConnection}if(!e.RTCPeerConnection){return}if(53>t.version){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],a=d({},t,function(){arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]);return r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=a[t]})}var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}if(78>t.version&&arguments[0]&&""===arguments[0].candidate){return Promise.resolve()}return r.apply(this,arguments)}};r.fixNegotiationNeeded=function(e){s.wrapPeerConnectionEvent(e,"negotiationneeded",function(t){var e=t.target;if("stable"!==e.signalingState){return}return t})};var o=e("../utils.js"),s=function(e){if(e&&e.__esModule){return e}else{var t={};if(null!=e){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}(o);function d(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0})}else{e[t]=r}return e}function c(t){if("object"===("undefined"==typeof t?"undefined":a(t))&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){if(this._ontrack){this.removeEventListener("track",this._ontrack)}this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;if(!this._ontrackpoly){this._ontrackpoly=function(r){r.stream.addEventListener("addtrack",function(e){var n;if(t.RTCPeerConnection.prototype.getReceivers){n=a.getReceivers().find(function(t){return t.track&&t.track.id===e.track.id})}else{n={track:e.track}}var i=new Event("track");i.track=e.track;i.receiver=n;i.transceiver={receiver:n};i.streams=[r.stream];a.dispatchEvent(i)});r.stream.getTracks().forEach(function(e){var n;if(t.RTCPeerConnection.prototype.getReceivers){n=a.getReceivers().find(function(t){return t.track&&t.track.id===e.id})}else{n={track:e}}var i=new Event("track");i.track=e;i.receiver=n;i.transceiver={receiver:n};i.streams=[r.stream];a.dispatchEvent(i)})};this.addEventListener("addstream",this._ontrackpoly)}return r.apply(this,arguments)}}else{s.wrapPeerConnectionEvent(t,"track",function(t){if(!t.transceiver){Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}})}return t})}}function p(e){if("object"===("undefined"==typeof e?"undefined":a(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){if(this._dtmf===void 0){if("audio"===t.kind){this._dtmf=e.createDTMFSender(t)}else{this._dtmf=null}}return this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e){var a=r.apply(this,arguments);if(!a){a=t(this,e);this._senders.push(a)}return a};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);if(-1!==t){this._senders.splice(t,1)}}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[];i.apply(this,[e]);e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[];o.apply(this,[e]);e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});if(r){t._senders.splice(t._senders.indexOf(r),1)}})}}else if("object"===("undefined"==typeof e?"undefined":a(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);t.forEach(function(t){return t._pc=e});return t};Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===void 0){if("audio"===this.track.kind){this._dtmf=this._pc.createDTMFSender(this.track)}else{this._dtmf=null}}return this._dtmf}})}}function l(e){if(!("object"===("undefined"==typeof e?"undefined":a(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver)){return}if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;if(t){e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);r.forEach(function(t){return t._pc=e});return r}}var r=e.RTCPeerConnection.prototype.addTrack;if(r){e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);e._pc=this;return e}}e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return s.filterStats(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;if(n){e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);t.forEach(function(t){return t._pc=e});return t}}s.wrapPeerConnectionEvent(e,"track",function(t){t.receiver._pc=t.srcElement;return t});e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return s.filterStats(t,e.track,!1)})}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype)){return}var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,a=void 0,n=void 0;this.getSenders().forEach(function(e){if(e.track===t){if(r){n=!0}else{r=e}}});this.getReceivers().forEach(function(e){if(e.track===t){if(a){n=!0}else{a=e}}return e.track===t});if(n||r&&a){return Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError"))}else if(r){return r.getStats()}else if(a){return a.getStats()}return Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function m(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};return Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r){return t.apply(this,arguments)}this._shimmedLocalStreams=this._shimmedLocalStreams||{};var a=t.apply(this,arguments);if(!this._shimmedLocalStreams[r.id]){this._shimmedLocalStreams[r.id]=[r,a]}else if(-1===this._shimmedLocalStreams[r.id].indexOf(a)){this._shimmedLocalStreams[r.id].push(a)}return a};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});if(r){throw new DOMException("Track already exists.","InvalidAccessError")}});var a=this.getSenders();r.apply(this,arguments);var n=this.getSenders().filter(function(e){return-1===a.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(n)};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{};delete this._shimmedLocalStreams[e.id];return a.apply(this,arguments)};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};if(e){Object.keys(this._shimmedLocalStreams).forEach(function(r){var a=t._shimmedLocalStreams[r].indexOf(e);if(-1!==a){t._shimmedLocalStreams[r].splice(a,1)}if(1===t._shimmedLocalStreams[r].length){delete t._shimmedLocalStreams[r]}})}return n.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.shimGetDisplayMedia=a;function a(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices){return}if(!e.navigator.mediaDevices){return}if("function"!=typeof t){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(function(t){var a=r.video&&r.video.width,n=r.video&&r.video.height,i=r.video&&r.video.frameRate;r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}};if(a){r.video.mandatory.maxWidth=a}if(n){r.video.mandatory.maxHeight=n}return e.navigator.mediaDevices.getUserMedia(r)})}}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)};r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(!t.mediaDevices){return}var r=i.detectBrowser(e),n=function(e){if("object"!==("undefined"==typeof e?"undefined":a(e))||e.mandatory||e.optional){return e}var t={};Object.keys(e).forEach(function(n){if("require"===n||"advanced"===n||"mediaSource"===n){return}var i="object"===a(e[n])?e[n]:{ideal:e[n]};if(i.exact!==void 0&&"number"==typeof i.exact){i.min=i.max=i.exact}var r=function(e,t){if(e){return e+t.charAt(0).toUpperCase()+t.slice(1)}return"deviceId"===t?"sourceId":t};if(i.ideal!==void 0){t.optional=t.optional||[];var o={};if("number"==typeof i.ideal){o[r("min",n)]=i.ideal;t.optional.push(o);o={};o[r("max",n)]=i.ideal;t.optional.push(o)}else{o[r("",n)]=i.ideal;t.optional.push(o)}}if(i.exact!==void 0&&"number"!=typeof i.exact){t.mandatory=t.mandatory||{};t.mandatory[r("",n)]=i.exact}else{["min","max"].forEach(function(e){if(i[e]!==void 0){t.mandatory=t.mandatory||{};t.mandatory[r(e,n)]=i[e]}})}});if(e.advanced){t.optional=(t.optional||[]).concat(e.advanced)}return t},s=function(e,i){if(61<=r.version){return i(e)}e=JSON.parse(JSON.stringify(e));if(e&&"object"===a(e.audio)){var s=function(e,t,r){if(t in e&&!(r in e)){e[r]=e[t];delete e[t]}};e=JSON.parse(JSON.stringify(e));s(e.audio,"autoGainControl","googAutoGainControl");s(e.audio,"noiseSuppression","googNoiseSuppression");e.audio=n(e.audio)}if(e&&"object"===a(e.video)){var d=e.video.facingMode;d=d&&("object"===("undefined"==typeof d?"undefined":a(d))?d:{ideal:d});var c=66>r.version;if(d&&("user"===d.exact||"environment"===d.exact||"user"===d.ideal||"environment"===d.ideal)&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete e.video.facingMode;var p;if("environment"===d.exact||"environment"===d.ideal){p=["back","rear"]}else if("user"===d.exact||"user"===d.ideal){p=["front"]}if(p){return t.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var r=t.find(function(e){return p.some(function(t){return e.label.toLowerCase().includes(t)})});if(!r&&t.length&&p.includes("back")){r=t[t.length-1]}if(r){e.video.deviceId=d.exact?{exact:r.deviceId}:{ideal:r.deviceId}}e.video=n(e.video);o("chrome: "+JSON.stringify(e));return i(e)})}}e.video=n(e.video)}o("chrome: "+JSON.stringify(e));return i(e)},d=function(t){if(64<=r.version){return t}return{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[t.name]||t.name,message:t.message,constraint:t.constraint||t.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};t.getUserMedia=function(e,r,a){s(e,function(e){t.webkitGetUserMedia(e,r,function(t){if(a){a(d(t))}})})}.bind(t);if(t.mediaDevices.getUserMedia){var p=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return s(e,function(e){return p(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(e){e.stop()});throw new DOMException("","NotFoundError")}return t},function(t){return Promise.reject(d(t))})})}}};var n=e("../utils.js"),i=function(e){if(e&&e.__esModule){return e}else{var t={};if(null!=e){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}(n);var o=i.log},{"../utils.js":15}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)};r.shimRTCIceCandidate=d;r.shimMaxMessageSize=c;r.shimSendThrowTypeError=p;r.shimConnectionState=l;r.removeAllowExtmapMixed=function(e){if(!e.RTCPeerConnection){return}var t=s.detectBrowser(e);if("chrome"===t.browser&&71<=t.version){return}var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){if(e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")){e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")}return r.apply(this,arguments)}};var n=e("sdp"),i=function(e){return e&&e.__esModule?e:{default:e}}(n),o=e("./utils"),s=function(e){if(e&&e.__esModule){return e}else{var t={};if(null!=e){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}(o);function d(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype){return}var r=t.RTCIceCandidate;t.RTCIceCandidate=function(e){if("object"===("undefined"==typeof e?"undefined":a(e))&&e.candidate&&0===e.candidate.indexOf("a=")){e=JSON.parse(JSON.stringify(e));e.candidate=e.candidate.substr(2)}if(e.candidate&&e.candidate.length){var t=new r(e),n=i.default.parseCandidate(e.candidate),o=Object.assign(t,n);o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}};return o}return new r(e)};t.RTCIceCandidate.prototype=r.prototype;s.wrapPeerConnectionEvent(t,"icecandidate",function(r){if(r.candidate){Object.defineProperty(r,"candidate",{value:new t.RTCIceCandidate(r.candidate),writable:"false"})}return r})}function c(e){if(!e.RTCPeerConnection){return}var t=s.detectBrowser(e);if(!("sctp"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"==typeof this._sctp?null:this._sctp}})}var r=function(e){if(!e||!e.sdp){return!1}var t=i.default.splitSections(e.sdp);t.shift();return t.some(function(e){var t=i.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},a=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||2>t.length){return-1}var r=parseInt(t[1],10);return r!==r?-1:r},n=function(e){var r=65536;if("firefox"===t.browser){if(57>t.version){if(-1===e){r=16384}else{r=2147483637}}else if(60>t.version){r=57===t.version?65535:65536}else{r=2147483637}}return r},o=function(e,r){var a=65536;if("firefox"===t.browser&&57===t.version){a=65535}var n=i.default.matchPrefix(e.sdp,"a=max-message-size:");if(0<n.length){a=parseInt(n[0].substr(19),10)}else if("firefox"===t.browser&&-1!==r){a=2147483637}return a},d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){this._sctp=null;if("chrome"===t.browser&&76<=t.version){var e=this.getConfiguration(),i=e.sdpSemantics;if("plan-b"===i){Object.defineProperty(this,"sctp",{get:function(){return"undefined"==typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}}if(r(arguments[0])){var s=a(arguments[0]),c=n(s),p=o(arguments[0],s),l=void 0;if(0===c&&0===p){l=Number.POSITIVE_INFINITY}else if(0===c||0===p){l=Math.max(c,p)}else{l=Math.min(c,p)}var m={};Object.defineProperty(m,"maxMessageSize",{get:function(){return l}});this._sctp=m}return d.apply(this,arguments)}}function p(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype)){return}function t(e,t){var r=e.send;e.send=function(){var a=arguments[0],n=a.length||a.size||a.byteLength;if("open"===e.readyState&&t.sctp&&n>t.sctp.maxMessageSize){throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)")}return r.apply(e,arguments)}}var r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=r.apply(this,arguments);t(e,this);return e};s.wrapPeerConnectionEvent(e,"datachannel",function(r){t(r.channel,r.target);return r})}function l(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype){return}var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0});Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){if(this._onconnectionstatechange){this.removeEventListener("connectionstatechange",this._onconnectionstatechange);delete this._onconnectionstatechange}if(e){this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)}},enumerable:!0,configurable:!0});["setLocalDescription","setRemoteDescription"].forEach(function(e){var r=t[e];t[e]=function(){if(!this._connectionstatechangepoly){this._connectionstatechangepoly=function(t){var e=t.target;if(e._lastConnectionState!==e.connectionState){e._lastConnectionState=e.connectionState;var r=new Event("connectionstatechange",t);e.dispatchEvent(r)}return t};this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)}return r.apply(this,arguments)}})}},{"./utils":15,sdp:17}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var a=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return a.shimGetUserMedia}});var n=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return n.shimGetDisplayMedia}});r.shimPeerConnection=p;r.shimReplaceTrack=l;var i=e("../utils"),o=function(e){if(e&&e.__esModule){return e}else{var t={};if(null!=e){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}(i),s=e("./filtericeservers"),d=e("rtcpeerconnection-shim"),c=function(e){return e&&e.__esModule?e:{default:e}}(d);function p(e){var t=o.detectBrowser(e);if(e.RTCIceGatherer){if(!e.RTCIceCandidate){e.RTCIceCandidate=function(e){return e}}if(!e.RTCSessionDescription){e.RTCSessionDescription=function(e){return e}}if(15025>t.version){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e;this.dispatchEvent(t)}})}}if(e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===void 0){if("audio"===this.track.kind){this._dtmf=new e.RTCDtmfSender(this)}else if("video"===this.track.kind){this._dtmf=null}}return this._dtmf}})}if(e.RTCDtmfSender&&!e.RTCDTMFSender){e.RTCDTMFSender=e.RTCDtmfSender}var a=(0,c.default)(e,t.version);e.RTCPeerConnection=function(e){if(e&&e.iceServers){e.iceServers=(0,s.filterIceServers)(e.iceServers,t.version);o.log("ICE servers after filtering:",e.iceServers)}return new a(e)};e.RTCPeerConnection.prototype=a.prototype}function l(e){if(e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)){e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack}}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.filterIceServers=function(e){var t=!1;e=JSON.parse(JSON.stringify(e));return e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;if(e.url&&!e.urls){n.deprecated("RTCIceServer.url","RTCIceServer.urls")}var a="string"==typeof r;if(a){r=[r]}r=r.filter(function(e){if(0===e.indexOf("stun:")){return!1}var r=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");if(r&&!t){t=!0;return!0}return r&&!t});delete e.url;e.urls=a?r[0]:r;return!!r.length}})};var a=e("../utils"),n=function(e){if(e&&e.__esModule){return e}else{var t={};if(null!=e){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}(a)},{"../utils":15}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.shimGetDisplayMedia=a;function a(e){if(!("getDisplayMedia"in e.navigator)){return}if(!e.navigator.mediaDevices){return}if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices){return}e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.shimGetUserMedia=function(e){var t=e&&e.navigator,r=function(t){return{name:{PermissionDeniedError:"NotAllowedError"}[t.name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}}},a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e).catch(function(t){return Promise.reject(r(t))})}}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)},n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}});r.shimOnTrack=c;r.shimPeerConnection=function(e){var t=s.detectBrowser(e);if("object"!==("undefined"==typeof e?"undefined":a(e))||!(e.RTCPeerConnection||e.mozRTCPeerConnection)){return}if(!e.RTCPeerConnection&&e.mozRTCPeerConnection){e.RTCPeerConnection=e.mozRTCPeerConnection}if(53>t.version){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],a=d({},t,function(){arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]);return r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=a[t]})}if(68>t.version){var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}if(arguments[0]&&""===arguments[0].candidate){return Promise.resolve()}return r.apply(this,arguments)}}var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),r=e[0],a=e[1],o=e[2];return i.apply(this,[r||null]).then(function(r){if(53>t.version&&!a){try{r.forEach(function(e){e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name){throw t}r.forEach(function(e,t){r.set(t,Object.assign({},e,{type:n[e.type]||e.type}))})}}return r}).then(a,o)}};r.shimSenderGetStats=p;r.shimReceiverGetStats=l;r.shimRemoveStream=m;r.shimRTCDataChannel=function(e){if(e.DataChannel&&!e.RTCDataChannel){e.RTCDataChannel=e.DataChannel}};r.shimAddTransceiver=function(e){if(!("object"===("undefined"==typeof e?"undefined":a(e))&&e.RTCPeerConnection)){return}var t=e.RTCPeerConnection.prototype.addTransceiver;if(t){e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],r=e&&"sendEncodings"in e;if(r){e.sendEncodings.forEach(function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid)){throw new TypeError("Invalid RID value provided.")}}if("scaleResolutionDownBy"in e){if(!(1<=parseFloat(e.scaleResolutionDownBy))){throw new RangeError("scale_resolution_down_by must be >= 1.0")}}if("maxFramerate"in e){if(!(0<=parseFloat(e.maxFramerate))){throw new RangeError("max_framerate must be >= 0.0")}}})}var a=t.apply(this,arguments);if(r){var n=a.sender,i=n.getParameters();if(!("encodings"in i)){i.encodings=e.sendEncodings;this.setParametersPromises.push(n.setParameters(i).catch(function(){}))}}return a}}};r.shimCreateOffer=function(e){if(!("object"===("undefined"==typeof e?"undefined":a(e))&&e.RTCPeerConnection)){return}var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,r=arguments;if(this.setParametersPromises&&this.setParametersPromises.length){return Promise.all(this.setParametersPromises).then(function(){return t.apply(e,r)}).finally(function(){e.setParametersPromises=[]})}return t.apply(this,arguments)}};r.shimCreateAnswer=function(e){if(!("object"===("undefined"==typeof e?"undefined":a(e))&&e.RTCPeerConnection)){return}var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,r=arguments;if(this.setParametersPromises&&this.setParametersPromises.length){return Promise.all(this.setParametersPromises).then(function(){return t.apply(e,r)}).finally(function(){e.setParametersPromises=[]})}return t.apply(this,arguments)}};var o=e("../utils"),s=function(e){if(e&&e.__esModule){return e}else{var t={};if(null!=e){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}(o);function d(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0})}else{e[t]=r}return e}function c(e){if("object"===("undefined"==typeof e?"undefined":a(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)){Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}}function p(e){if(!("object"===("undefined"==typeof e?"undefined":a(e))&&e.RTCPeerConnection&&e.RTCRtpSender)){return}if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype){return}var t=e.RTCPeerConnection.prototype.getSenders;if(t){e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);r.forEach(function(t){return t._pc=e});return r}}var r=e.RTCPeerConnection.prototype.addTrack;if(r){e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);e._pc=this;return e}}e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function l(e){if(!("object"===("undefined"==typeof e?"undefined":a(e))&&e.RTCPeerConnection&&e.RTCRtpSender)){return}if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype){return}var t=e.RTCPeerConnection.prototype.getReceivers;if(t){e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);r.forEach(function(t){return t._pc=e});return r}}s.wrapPeerConnectionEvent(e,"track",function(t){t.receiver._pc=t.srcElement;return t});e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function m(e){if(!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype){return}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;s.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(r){if(r.track&&e.getTracks().includes(r.track)){t.removeTrack(r)}})}}},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.shimGetDisplayMedia=a;function a(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices){return}if(!e.navigator.mediaDevices){return}e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){var a=new DOMException("getDisplayMedia without video constraints is undefined");a.name="NotFoundError";a.code=8;return Promise.reject(a)}if(!0===r.video){r.video={mediaSource:t}}else{r.video.mediaSource=t}return e.navigator.mediaDevices.getUserMedia(r)}}},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)};r.shimGetUserMedia=o;var n=e("../utils"),i=function(e){if(e&&e.__esModule){return e}else{var t={};if(null!=e){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}(n);function o(e){var t=i.detectBrowser(e),r=e&&e.navigator,n=e&&e.MediaStreamTrack;r.getUserMedia=function(e,t,a){i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");r.mediaDevices.getUserMedia(e).then(t,a)};if(!(55<t.version&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var o=function(e,t,r){if(t in e&&!(r in e)){e[r]=e[t];delete e[t]}},s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){if("object"===("undefined"==typeof e?"undefined":a(e))&&"object"===a(e.audio)){e=JSON.parse(JSON.stringify(e));o(e.audio,"autoGainControl","mozAutoGainControl");o(e.audio,"noiseSuppression","mozNoiseSuppression")}return s(e)};if(n&&n.prototype.getSettings){var d=n.prototype.getSettings;n.prototype.getSettings=function(){var e=d.apply(this,arguments);o(e,"mozAutoGainControl","autoGainControl");o(e,"mozNoiseSuppression","noiseSuppression");return e}}if(n&&n.prototype.applyConstraints){var p=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){if("audio"===this.kind&&"object"===("undefined"==typeof e?"undefined":a(e))){e=JSON.parse(JSON.stringify(e));o(e,"autoGainControl","mozAutoGainControl");o(e,"noiseSuppression","mozNoiseSuppression")}return p.apply(this,[e])}}}}},{"../utils":15}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)};r.shimLocalStreamsAPI=o;r.shimRemoteStreamsAPI=s;r.shimCallbacksAPI=function(e){if("object"!==("undefined"==typeof e?"undefined":a(e))||!e.RTCPeerConnection){return}var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var a=2<=arguments.length?arguments[2]:arguments[0],n=r.apply(this,[a]);if(!t){return n}n.then(e,t);return Promise.resolve()};t.createAnswer=function(e,t){var r=2<=arguments.length?arguments[2]:arguments[0],a=n.apply(this,[r]);if(!t){return a}a.then(e,t);return Promise.resolve()};var d=function(e,t,r){var a=i.apply(this,[e]);if(!r){return a}a.then(t,r);return Promise.resolve()};t.setLocalDescription=d;d=function(e,t,r){var a=o.apply(this,[e]);if(!r){return a}a.then(t,r);return Promise.resolve()};t.setRemoteDescription=d;d=function(e,t,r){var a=s.apply(this,[e]);if(!r){return a}a.then(t,r);return Promise.resolve()};t.addIceCandidate=d};r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,a=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return a(d(e))}}if(!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia){t.getUserMedia=function(e,r,a){t.mediaDevices.getUserMedia(e).then(r,a)}.bind(t)}};r.shimConstraints=d;r.shimRTCIceServerUrls=c;r.shimTrackEventTransceiver=p;r.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){if("undefined"!=typeof e.offerToReceiveAudio){e.offerToReceiveAudio=!!e.offerToReceiveAudio}var r=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});if(!1===e.offerToReceiveAudio&&r){if("sendrecv"===r.direction){if(r.setDirection){r.setDirection("sendonly")}else{r.direction="sendonly"}}else if("recvonly"===r.direction){if(r.setDirection){r.setDirection("inactive")}else{r.direction="inactive"}}}else if(!0===e.offerToReceiveAudio&&!r){this.addTransceiver("audio")}if("undefined"!=typeof e.offerToReceiveVideo){e.offerToReceiveVideo=!!e.offerToReceiveVideo}var a=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});if(!1===e.offerToReceiveVideo&&a){if("sendrecv"===a.direction){if(a.setDirection){a.setDirection("sendonly")}else{a.direction="sendonly"}}else if("recvonly"===a.direction){if(a.setDirection){a.setDirection("inactive")}else{a.direction="inactive"}}}else if(!0===e.offerToReceiveVideo&&!a){this.addTransceiver("video")}}return t.apply(this,arguments)}};var n=e("../utils"),i=function(e){if(e&&e.__esModule){return e}else{var t={};if(null!=e){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}(n);function o(e){if("object"!==("undefined"==typeof e?"undefined":a(e))||!e.RTCPeerConnection){return}if(!("getLocalStreams"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getLocalStreams=function(){if(!this._localStreams){this._localStreams=[]}return this._localStreams}}if(!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;if(!this._localStreams){this._localStreams=[]}if(!this._localStreams.includes(e)){this._localStreams.push(e)}e.getAudioTracks().forEach(function(a){return t.call(r,a,e)});e.getVideoTracks().forEach(function(a){return t.call(r,a,e)})};e.RTCPeerConnection.prototype.addTrack=function(){var e=arguments[1];if(e){if(!this._localStreams){this._localStreams=[e]}else if(!this._localStreams.includes(e)){this._localStreams.push(e)}}return t.apply(this,arguments)}}if(!("removeStream"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;if(!this._localStreams){this._localStreams=[]}var r=this._localStreams.indexOf(e);if(-1===r){return}this._localStreams.splice(r,1);var a=e.getTracks();this.getSenders().forEach(function(e){if(a.includes(e.track)){t.removeTrack(e)}})}}}function s(e){if("object"!==("undefined"==typeof e?"undefined":a(e))||!e.RTCPeerConnection){return}if(!("getRemoteStreams"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}}if(!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;if(this._onaddstream){this.removeEventListener("addstream",this._onaddstream);this.removeEventListener("track",this._onaddstreampoly)}this.addEventListener("addstream",this._onaddstream=e);this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(function(e){if(!t._remoteStreams){t._remoteStreams=[]}if(t._remoteStreams.includes(e)){return}t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e;t.dispatchEvent(r)})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;if(!this._onaddstreampoly){this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(!e._remoteStreams){e._remoteStreams=[]}if(0<=e._remoteStreams.indexOf(t)){return}e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t;e.dispatchEvent(r)})})}return t.apply(e,arguments)}}}function d(e){if(e&&e.video!==void 0){return Object.assign({},e,{video:i.compactObject(e.video)})}return e}function c(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var a=[],n=0,o;n<e.iceServers.length;n++){o=e.iceServers[n];if(!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")){i.deprecated("RTCIceServer.url","RTCIceServer.urls");o=JSON.parse(JSON.stringify(o));o.urls=o.url;delete o.url;a.push(o)}else{a.push(e.iceServers[n])}}e.iceServers=a}return new t(e,r)};e.RTCPeerConnection.prototype=t.prototype;if("generateCertificate"in e.RTCPeerConnection){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function p(e){if("object"===("undefined"==typeof e?"undefined":a(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)){Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}}},{"../utils":15}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)};r.extractVersion=s;r.wrapPeerConnectionEvent=function(e,t,r){if(!e.RTCPeerConnection){return}var a=e.RTCPeerConnection.prototype,n=a.addEventListener;a.addEventListener=function(e,a){if(e!==t){return n.apply(this,arguments)}var i=function(t){var e=r(t);if(e){a(e)}};this._eventMap=this._eventMap||{};this._eventMap[a]=i;return n.apply(this,[e,i])};var i=a.removeEventListener;a.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r]){return i.apply(this,arguments)}var a=this._eventMap[r];delete this._eventMap[r];return i.apply(this,[e,a])};Object.defineProperty(a,"on"+t,{get:function(){return this["_on"+t]},set:function(e){if(this["_on"+t]){this.removeEventListener(t,this["_on"+t]);delete this["_on"+t]}if(e){this.addEventListener(t,this["_on"+t]=e)}},enumerable:!0,configurable:!0})};r.disableLog=function(e){if("boolean"!=typeof e){return new Error("Argument type: "+("undefined"==typeof e?"undefined":a(e))+". Please use a boolean.")}i=e;return e?"adapter.js logging disabled":"adapter.js logging enabled"};r.disableWarnings=function(e){if("boolean"!=typeof e){return new Error("Argument type: "+("undefined"==typeof e?"undefined":a(e))+". Please use a boolean.")}o=!e;return"adapter.js deprecation warnings "+(e?"disabled":"enabled")};r.log=d;r.deprecated=c;r.detectBrowser=p;r.compactObject=m;r.walkStats=f;r.filterStats=function(e,t,r){var a=r?"outbound-rtp":"inbound-rtp",n=new Map;if(null===t){return n}var i=[];e.forEach(function(e){if("track"===e.type&&e.trackIdentifier===t.id){i.push(e)}});i.forEach(function(t){e.forEach(function(r){if(r.type===a&&r.trackId===t.id){f(e,r,n)}})});return n};function n(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0})}else{e[t]=r}return e}var i=!0,o=!0;function s(e,t,r){var a=e.match(t);return a&&a.length>=r&&parseInt(a[r],10)}function d(){if("object"===("undefined"==typeof window?"undefined":a(window))){if(i){return}if("undefined"!=typeof console&&"function"==typeof console.log){console.log.apply(console,arguments)}}}function c(e,t){if(!o){return}console.warn(e+" is deprecated, please use "+t+" instead.")}function p(e){var t=e.navigator,r={browser:null,version:null};if("undefined"==typeof e||!e.navigator){r.browser="Not a browser.";return r}if(t.mozGetUserMedia){r.browser="firefox";r.version=s(t.userAgent,/Firefox\/(\d+)\./,1)}else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer){r.browser="chrome";r.version=s(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/)){r.browser="edge";r.version=s(t.userAgent,/Edge\/(\d+).(\d+)$/,2)}else if(e.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./)){r.browser="safari";r.version=s(t.userAgent,/AppleWebKit\/(\d+)\./,1);r.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}else{r.browser="Not a supported browser.";return r}return r}function l(e){return"[object Object]"===Object.prototype.toString.call(e)}function m(e){if(!l(e)){return e}return Object.keys(e).reduce(function(t,r){var a=l(e[r]),i=a?m(e[r]):e[r],o=a&&!Object.keys(i).length;if(i===void 0||o){return t}return Object.assign(t,n({},r,i))},{})}function f(e,t,r){if(!t||r.has(t.id)){return}r.set(t.id,t);Object.keys(t).forEach(function(a){if(a.endsWith("Id")){f(e,e.get(t[a]),r)}else if(a.endsWith("Ids")){t[a].forEach(function(t){f(e,e.get(t),r)})}})}},{}],16:[function(e,t){"use strict";var r=e("sdp");function a(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function n(e,t,a,n,i){var o=r.writeRtpDescription(e.kind,t);o+=r.writeIceParameters(e.iceGatherer.getLocalParameters());o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===a?"actpass":i||"active");o+="a=mid:"+e.mid+"\r\n";if(e.rtpSender&&e.rtpReceiver){o+="a=sendrecv\r\n"}else if(e.rtpSender){o+="a=sendonly\r\n"}else if(e.rtpReceiver){o+="a=recvonly\r\n"}else{o+="a=inactive\r\n"}if(e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var d="msid:"+(n?n.id:"-")+" "+s+"\r\n";o+="a="+d;o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+d;if(e.sendEncodingParameters[0].rtx){o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+d;o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n";if(e.rtpSender&&e.sendEncodingParameters[0].rtx){o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"}return o}function o(e,t){var r=!1;e=JSON.parse(JSON.stringify(e));return e.filter(function(e){if(e&&(e.urls||e.url)){var a=e.urls||e.url;if(e.url&&!e.urls){console.warn("RTCIceServer.url is deprecated! Use urls instead.")}var n="string"==typeof a;if(n){a=[a]}a=a.filter(function(e){var a=0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r;if(a){r=!0;return!0}return 0===e.indexOf("stun:")&&14393<=t&&-1===e.indexOf("?transport=udp")});delete e.url;e.urls=n?a[0]:a;return!!a.length}})}function s(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},a=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++){if(t[r].payloadType===e||t[r].preferredPayloadType===e){return t[r]}}},n=function(e,t,r,n){var i=a(e.parameters.apt,r),o=a(t.parameters.apt,n);return i&&o&&i.name.toLowerCase()===o.name.toLowerCase()};e.codecs.forEach(function(a){for(var o=0,s;o<t.codecs.length;o++){s=t.codecs[o];if(a.name.toLowerCase()===s.name.toLowerCase()&&a.clockRate===s.clockRate){if("rtx"===a.name.toLowerCase()&&a.parameters&&s.parameters.apt){if(!n(a,s,e.codecs,t.codecs)){continue}}s=JSON.parse(JSON.stringify(s));s.numChannels=Math.min(a.numChannels,s.numChannels);r.codecs.push(s);s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<a.rtcpFeedback.length;t++){if(a.rtcpFeedback[t].type===e.type&&a.rtcpFeedback[t].parameter===e.parameter){return!0}}return!1});break}}});e.headerExtensions.forEach(function(e){for(var a=0,n;a<t.headerExtensions.length;a++){n=t.headerExtensions[a];if(e.uri===n.uri){r.headerExtensions.push(n);break}}});return r}function d(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function c(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});if(!r){e.addRemoteCandidate(t)}return!r}function p(t,r){var a=new Error(r);a.name=t;a.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[t];return a}t.exports=function(e,t){function i(t,r){r.addTrack(t);r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function l(t,r){r.removeTrack(t);r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function m(t,r,a,n){var i=new Event("track");i.track=r;i.receiver=a;i.transceiver={receiver:a};i.streams=n;e.setTimeout(function(){t._dispatchEvent("track",i)})}var f=function(a){var n=this,s=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=s[e].bind(s)});this.canTrickleIceCandidates=null;this.needNegotiation=!1;this.localStreams=[];this.remoteStreams=[];this._localDescription=null;this._remoteDescription=null;this.signalingState="stable";this.iceConnectionState="new";this.connectionState="new";this.iceGatheringState="new";a=JSON.parse(JSON.stringify(a||{}));this.usingBundle="max-bundle"===a.bundlePolicy;if("negotiate"===a.rtcpMuxPolicy){throw p("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported")}else if(!a.rtcpMuxPolicy){a.rtcpMuxPolicy="require"}switch(a.iceTransportPolicy){case"all":case"relay":break;default:a.iceTransportPolicy="all";break;}switch(a.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:a.bundlePolicy="balanced";break;}a.iceServers=o(a.iceServers||[],t);this._iceGatherers=[];if(a.iceCandidatePoolSize){for(var d=a.iceCandidatePoolSize;0<d;d--){this._iceGatherers.push(new e.RTCIceGatherer({iceServers:a.iceServers,gatherPolicy:a.iceTransportPolicy}))}}else{a.iceCandidatePoolSize=0}this._config=a;this.transceivers=[];this._sdpSessionId=r.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0;this._isClosed=!1};Object.defineProperty(f.prototype,"localDescription",{configurable:!0,get:function get(){return this._localDescription}});Object.defineProperty(f.prototype,"remoteDescription",{configurable:!0,get:function get(){return this._remoteDescription}});f.prototype.onicecandidate=null;f.prototype.onaddstream=null;f.prototype.ontrack=null;f.prototype.onremovestream=null;f.prototype.onsignalingstatechange=null;f.prototype.oniceconnectionstatechange=null;f.prototype.onconnectionstatechange=null;f.prototype.onicegatheringstatechange=null;f.prototype.onnegotiationneeded=null;f.prototype.ondatachannel=null;f.prototype._dispatchEvent=function(e,t){if(this._isClosed){return}this.dispatchEvent(t);if("function"==typeof this["on"+e]){this["on"+e](t)}};f.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)};f.prototype.getConfiguration=function(){return this._config};f.prototype.getLocalStreams=function(){return this.localStreams};f.prototype.getRemoteStreams=function(){return this.remoteStreams};f.prototype._createTransceiver=function(e,t){var r=0<this.transceivers.length,a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r){a.iceTransport=this.transceivers[0].iceTransport;a.dtlsTransport=this.transceivers[0].dtlsTransport}else{var n=this._createIceAndDtlsTransports();a.iceTransport=n.iceTransport;a.dtlsTransport=n.dtlsTransport}if(!t){this.transceivers.push(a)}return a};f.prototype.addTrack=function(t,r){if(this._isClosed){throw p("InvalidStateError","Attempted to call addTrack on a closed peerconnection.")}var a=this.transceivers.find(function(e){return e.track===t});if(a){throw p("InvalidAccessError","Track already exists.")}for(var n,o=0;o<this.transceivers.length;o++){if(!this.transceivers[o].track&&this.transceivers[o].kind===t.kind){n=this.transceivers[o]}}if(!n){n=this._createTransceiver(t.kind)}this._maybeFireNegotiationNeeded();if(-1===this.localStreams.indexOf(r)){this.localStreams.push(r)}n.track=t;n.stream=r;n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport);return n.rtpSender};f.prototype.addStream=function(e){var r=this;if(15025<=t){e.getTracks().forEach(function(t){r.addTrack(t,e)})}else{var a=e.clone();e.getTracks().forEach(function(e,t){var r=a.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})});a.getTracks().forEach(function(e){r.addTrack(e,a)})}};f.prototype.removeTrack=function(r){if(this._isClosed){throw p("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.")}if(!(r instanceof e.RTCRtpSender)){throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.")}var a=this.transceivers.find(function(e){return e.rtpSender===r});if(!a){throw p("InvalidAccessError","Sender was not created by this connection.")}var n=a.stream;a.rtpSender.stop();a.rtpSender=null;a.track=null;a.stream=null;var i=this.transceivers.map(function(e){return e.stream});if(-1===i.indexOf(n)&&-1<this.localStreams.indexOf(n)){this.localStreams.splice(this.localStreams.indexOf(n),1)}this._maybeFireNegotiationNeeded()};f.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});if(r){t.removeTrack(r)}})};f.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})};f.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})};f.prototype._createIceGatherer=function(t,r){var a=this;if(r&&0<t){return this.transceivers[0].iceGatherer}else if(this._iceGatherers.length){return this._iceGatherers.shift()}var n=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(n,"state",{value:"new",writable:!0});this.transceivers[t].bufferedCandidateEvents=[];this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;n.state=r?"completed":"gathering";if(null!==a.transceivers[t].bufferedCandidateEvents){a.transceivers[t].bufferedCandidateEvents.push(e)}};n.addEventListener("localcandidate",this.transceivers[t].bufferCandidates);return n};f.prototype._gather=function(t,a){var n=this,i=this.transceivers[a].iceGatherer;if(i.onlocalcandidate){return}var o=this.transceivers[a].bufferedCandidateEvents;this.transceivers[a].bufferedCandidateEvents=null;i.removeEventListener("localcandidate",this.transceivers[a].bufferCandidates);i.onlocalcandidate=function(e){if(n.usingBundle&&0<a){return}var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:a};var s=e.candidate,d=!s||0===Object.keys(s).length;if(d){if("new"===i.state||"gathering"===i.state){i.state="completed"}}else{if("new"===i.state){i.state="gathering"}s.component=1;s.ufrag=i.getLocalParameters().usernameFragment;var c=r.writeCandidate(s);o.candidate=Object.assign(o.candidate,r.parseCandidate(c));o.candidate.candidate=c;o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var p=r.getMediaSections(n._localDescription.sdp);if(!d){p[o.candidate.sdpMLineIndex]+="a="+o.candidate.candidate+"\r\n"}else{p[o.candidate.sdpMLineIndex]+="a=end-of-candidates\r\n"}n._localDescription.sdp=r.getDescription(n._localDescription.sdp)+p.join("");var l=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});if("gathering"!==n.iceGatheringState){n.iceGatheringState="gathering";n._emitGatheringStateChange()}if(!d){n._dispatchEvent("icecandidate",o)}if(l){n._dispatchEvent("icecandidate",new Event("icecandidate"));n.iceGatheringState="complete";n._emitGatheringStateChange()}};e.setTimeout(function(){o.forEach(function(t){i.onlocalcandidate(t)})},0)};f.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState();t._updateConnectionState()};var a=new e.RTCDtlsTransport(r);a.ondtlsstatechange=function(){t._updateConnectionState()};a.onerror=function(){Object.defineProperty(a,"state",{value:"failed",writable:!0});t._updateConnectionState()};return{iceTransport:r,dtlsTransport:a}};f.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;if(t){delete t.onlocalcandidate;delete this.transceivers[e].iceGatherer}var r=this.transceivers[e].iceTransport;if(r){delete r.onicestatechange;delete this.transceivers[e].iceTransport}var a=this.transceivers[e].dtlsTransport;if(a){delete a.ondtlsstatechange;delete a.onerror;delete this.transceivers[e].dtlsTransport}};f.prototype._transceive=function(e,a,n){var i=s(e.localCapabilities,e.remoteCapabilities);if(a&&e.rtpSender){i.encodings=e.sendEncodingParameters;i.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound};if(e.recvEncodingParameters.length){i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc}e.rtpSender.send(i)}if(n&&e.rtpReceiver&&0<i.codecs.length){if("video"===e.kind&&e.recvEncodingParameters&&15019>t){e.recvEncodingParameters.forEach(function(e){delete e.rtx})}if(e.recvEncodingParameters.length){i.encodings=e.recvEncodingParameters}else{i.encodings=[{}]}i.rtcp={compound:e.rtcpParameters.compound};if(e.rtcpParameters.cname){i.rtcp.cname=e.rtcpParameters.cname}if(e.sendEncodingParameters.length){i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc}e.rtpReceiver.receive(i)}};f.prototype.setLocalDescription=function(e){var t=this;if(-1===["offer","answer"].indexOf(e.type)){return Promise.reject(p("TypeError","Unsupported type \""+e.type+"\""))}if(!d("setLocalDescription",e.type,t.signalingState)||t._isClosed){return Promise.reject(p("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState))}var a,n;if("offer"===e.type){a=r.splitSections(e.sdp);n=a.shift();a.forEach(function(e,a){var n=r.parseRtpParameters(e);t.transceivers[a].localCapabilities=n});t.transceivers.forEach(function(e,r){t._gather(e.mid,r)})}else if("answer"===e.type){a=r.splitSections(t._remoteDescription.sdp);n=a.shift();var i=0<r.matchPrefix(n,"a=ice-lite").length;a.forEach(function(e,a){var o=t.transceivers[a],d=o.iceGatherer,c=o.iceTransport,p=o.dtlsTransport,l=o.localCapabilities,m=o.remoteCapabilities,f=r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length;if(!f&&!o.rejected){var h=r.getIceParameters(e,n),g=r.getDtlsParameters(e,n);if(i){g.role="server"}if(!t.usingBundle||0===a){t._gather(o.mid,a);if("new"===c.state){c.start(d,h,i?"controlling":"controlled")}if("new"===p.state){p.start(g)}}var y=s(l,m);t._transceive(o,0<y.codecs.length,!1)}})}t._localDescription={type:e.type,sdp:e.sdp};if("offer"===e.type){t._updateSignalingState("have-local-offer")}else{t._updateSignalingState("stable")}return Promise.resolve()};f.prototype.setRemoteDescription=function(a){var n=this;if(-1===["offer","answer"].indexOf(a.type)){return Promise.reject(p("TypeError","Unsupported type \""+a.type+"\""))}if(!d("setRemoteDescription",a.type,n.signalingState)||n._isClosed){return Promise.reject(p("InvalidStateError","Can not set remote "+a.type+" in state "+n.signalingState))}var o={};n.remoteStreams.forEach(function(e){o[e.id]=e});var f=[],h=r.splitSections(a.sdp),g=h.shift(),y=0<r.matchPrefix(g,"a=ice-lite").length,u=0<r.matchPrefix(g,"a=group:BUNDLE ").length;n.usingBundle=u;var v=r.matchPrefix(g,"a=ice-options:")[0];if(v){n.canTrickleIceCandidates=0<=v.substr(14).split(" ").indexOf("trickle")}else{n.canTrickleIceCandidates=!1}h.forEach(function(d,p){var m=r.splitLines(d),h=r.getKind(d),v=r.isRejected(d)&&0===r.matchPrefix(d,"a=bundle-only").length,C=m[0].substr(2).split(" ")[2],T=r.getDirection(d,g),S=r.parseMsid(d),R=r.getMid(d)||r.generateIdentifier();if(v||"application"===h&&("DTLS/SCTP"===C||"UDP/DTLS/SCTP"===C)){n.transceivers[p]={mid:R,kind:h,protocol:C,rejected:!0};return}if(!v&&n.transceivers[p]&&n.transceivers[p].rejected){n.transceivers[p]=n._createTransceiver(h,!0)}var P,_,k,E,b,x,M,D,I,w=r.parseRtpParameters(d),L,G;if(!v){L=r.getIceParameters(d,g);G=r.getDtlsParameters(d,g);G.role="client"}M=r.parseRtpEncodingParameters(d);var j=r.parseRtcpParameters(d),A=0<r.matchPrefix(d,"a=end-of-candidates",g).length,O=r.matchPrefix(d,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===a.type||"answer"===a.type)&&!v&&u&&0<p&&n.transceivers[p]){n._disposeIceAndDtlsTransports(p);n.transceivers[p].iceGatherer=n.transceivers[0].iceGatherer;n.transceivers[p].iceTransport=n.transceivers[0].iceTransport;n.transceivers[p].dtlsTransport=n.transceivers[0].dtlsTransport;if(n.transceivers[p].rtpSender){n.transceivers[p].rtpSender.setTransport(n.transceivers[0].dtlsTransport)}if(n.transceivers[p].rtpReceiver){n.transceivers[p].rtpReceiver.setTransport(n.transceivers[0].dtlsTransport)}}if("offer"===a.type&&!v){P=n.transceivers[p]||n._createTransceiver(h);P.mid=R;if(!P.iceGatherer){P.iceGatherer=n._createIceGatherer(p,u)}if(O.length&&"new"===P.iceTransport.state){if(A&&(!u||0===p)){P.iceTransport.setRemoteCandidates(O)}else{O.forEach(function(e){c(P.iceTransport,e)})}}D=e.RTCRtpReceiver.getCapabilities(h);if(15019>t){D.codecs=D.codecs.filter(function(e){return"rtx"!==e.name})}x=P.sendEncodingParameters||[{ssrc:1001*(2*p+2)}];var U=!1;if("sendrecv"===T||"sendonly"===T){U=!P.rtpReceiver;b=P.rtpReceiver||new e.RTCRtpReceiver(P.dtlsTransport,h);if(U){var F;I=b.track;if(S&&"-"===S.stream){}else if(S){if(!o[S.stream]){o[S.stream]=new e.MediaStream;Object.defineProperty(o[S.stream],"id",{get:function get(){return S.stream}})}Object.defineProperty(I,"id",{get:function get(){return S.track}});F=o[S.stream]}else{if(!o.default){o.default=new e.MediaStream}F=o.default}if(F){i(I,F);P.associatedRemoteMediaStreams.push(F)}f.push([I,b,F])}}else if(P.rtpReceiver&&P.rtpReceiver.track){P.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===P.rtpReceiver.track.id});if(t){l(t,e)}});P.associatedRemoteMediaStreams=[]}P.localCapabilities=D;P.remoteCapabilities=w;P.rtpReceiver=b;P.rtcpParameters=j;P.sendEncodingParameters=x;P.recvEncodingParameters=M;n._transceive(n.transceivers[p],!1,U)}else if("answer"===a.type&&!v){P=n.transceivers[p];_=P.iceGatherer;k=P.iceTransport;E=P.dtlsTransport;b=P.rtpReceiver;x=P.sendEncodingParameters;D=P.localCapabilities;n.transceivers[p].recvEncodingParameters=M;n.transceivers[p].remoteCapabilities=w;n.transceivers[p].rtcpParameters=j;if(O.length&&"new"===k.state){if((y||A)&&(!u||0===p)){k.setRemoteCandidates(O)}else{O.forEach(function(e){c(P.iceTransport,e)})}}if(!u||0===p){if("new"===k.state){k.start(_,L,"controlling")}if("new"===E.state){E.start(G)}}var N=s(P.localCapabilities,P.remoteCapabilities),z=N.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;if(!z&&P.sendEncodingParameters[0].rtx){delete P.sendEncodingParameters[0].rtx}n._transceive(P,"sendrecv"===T||"recvonly"===T,"sendrecv"===T||"sendonly"===T);if(b&&("sendrecv"===T||"sendonly"===T)){I=b.track;if(S){if(!o[S.stream]){o[S.stream]=new e.MediaStream}i(I,o[S.stream]);f.push([I,b,o[S.stream]])}else{if(!o.default){o.default=new e.MediaStream}i(I,o.default);f.push([I,b,o.default])}}else{delete P.rtpReceiver}}});if(n._dtlsRole===void 0){n._dtlsRole="offer"===a.type?"active":"passive"}n._remoteDescription={type:a.type,sdp:a.sdp};if("offer"===a.type){n._updateSignalingState("have-remote-offer")}else{n._updateSignalingState("stable")}Object.keys(o).forEach(function(t){var r=o[t];if(r.getTracks().length){if(-1===n.remoteStreams.indexOf(r)){n.remoteStreams.push(r);var a=new Event("addstream");a.stream=r;e.setTimeout(function(){n._dispatchEvent("addstream",a)})}f.forEach(function(e){var t=e[0],a=e[1];if(r.id!==e[2].id){return}m(n,t,a,[r])})}});f.forEach(function(e){if(e[2]){return}m(n,e[0],e[1],[])});e.setTimeout(function(){if(!(n&&n.transceivers)){return}n.transceivers.forEach(function(e){if(e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length){console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification");e.iceTransport.addRemoteCandidate({})}})},4e3);return Promise.resolve()};f.prototype.close=function(){this.transceivers.forEach(function(e){if(e.iceTransport){e.iceTransport.stop()}if(e.dtlsTransport){e.dtlsTransport.stop()}if(e.rtpSender){e.rtpSender.stop()}if(e.rtpReceiver){e.rtpReceiver.stop()}});this._isClosed=!0;this._updateSignalingState("closed")};f.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)};f.prototype._maybeFireNegotiationNeeded=function(){var t=this;if("stable"!==this.signalingState||!0===this.needNegotiation){return}this.needNegotiation=!0;e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0)};f.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){if(e.iceTransport&&!e.rejected){t[e.iceTransport.state]++}});e="new";if(0<t.failed){e="failed"}else if(0<t.checking){e="checking"}else if(0<t.disconnected){e="disconnected"}else if(0<t.new){e="new"}else if(0<t.connected){e="connected"}else if(0<t.completed){e="completed"}if(e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}};f.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){if(e.iceTransport&&e.dtlsTransport&&!e.rejected){t[e.iceTransport.state]++;t[e.dtlsTransport.state]++}});t.connected+=t.completed;e="new";if(0<t.failed){e="failed"}else if(0<t.connecting){e="connecting"}else if(0<t.disconnected){e="disconnected"}else if(0<t.new){e="new"}else if(0<t.connected){e="connected"}if(e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}};f.prototype.createOffer=function(){var a=this;if(a._isClosed){return Promise.reject(p("InvalidStateError","Can not call createOffer after close"))}var i=a.transceivers.filter(function(e){return"audio"===e.kind}).length,o=a.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional){throw new TypeError("Legacy mandatory/optional constraints not supported.")}if(s.offerToReceiveAudio!==void 0){if(!0===s.offerToReceiveAudio){i=1}else if(!1===s.offerToReceiveAudio){i=0}else{i=s.offerToReceiveAudio}}if(s.offerToReceiveVideo!==void 0){if(!0===s.offerToReceiveVideo){o=1}else if(!1===s.offerToReceiveVideo){o=0}else{o=s.offerToReceiveVideo}}}a.transceivers.forEach(function(e){if("audio"===e.kind){i--;if(0>i){e.wantReceive=!1}}else if("video"===e.kind){o--;if(0>o){e.wantReceive=!1}}});while(0<i||0<o){if(0<i){a._createTransceiver("audio");i--}if(0<o){a._createTransceiver("video");o--}}var d=r.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.transceivers.forEach(function(n,i){var o=n.track,s=n.kind,d=n.mid||r.generateIdentifier();n.mid=d;if(!n.iceGatherer){n.iceGatherer=a._createIceGatherer(i,a.usingBundle)}var c=e.RTCRtpSender.getCapabilities(s);if(15019>t){c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})}c.codecs.forEach(function(e){if("H264"===e.name&&e.parameters["level-asymmetry-allowed"]===void 0){e.parameters["level-asymmetry-allowed"]="1"}if(n.remoteCapabilities&&n.remoteCapabilities.codecs){n.remoteCapabilities.codecs.forEach(function(t){if(e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate){e.preferredPayloadType=t.payloadType}})}});c.headerExtensions.forEach(function(e){var t=n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[];t.forEach(function(t){if(e.uri===t.uri){e.id=t.id}})});var p=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];if(o){if(15019<=t&&"video"===s&&!p[0].rtx){p[0].rtx={ssrc:p[0].ssrc+1}}}if(n.wantReceive){n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,s)}n.localCapabilities=c;n.sendEncodingParameters=p});if("max-compat"!==a._config.bundlePolicy){d+="a=group:BUNDLE "+a.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"}d+="a=ice-options:trickle\r\n";a.transceivers.forEach(function(e,t){d+=n(e,e.localCapabilities,"offer",e.stream,a._dtlsRole);d+="a=rtcp-rsize\r\n";if(e.iceGatherer&&"new"!==a.iceGatheringState&&(0===t||!a.usingBundle)){e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1;d+="a="+r.writeCandidate(e)+"\r\n"});if("completed"===e.iceGatherer.state){d+="a=end-of-candidates\r\n"}}});var c=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(c)};f.prototype.createAnswer=function(){var a=this;if(a._isClosed){return Promise.reject(p("InvalidStateError","Can not call createAnswer after close"))}if(!("have-remote-offer"===a.signalingState||"have-local-pranswer"===a.signalingState)){return Promise.reject(p("InvalidStateError","Can not call createAnswer in signalingState "+a.signalingState))}var i=r.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);if(a.usingBundle){i+="a=group:BUNDLE "+a.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"}i+="a=ice-options:trickle\r\n";var o=r.getMediaSections(a._remoteDescription.sdp).length;a.transceivers.forEach(function(e,r){if(r+1>o){return}if(e.rejected){if("application"===e.kind){if("DTLS/SCTP"===e.protocol){i+="m=application 0 DTLS/SCTP 5000\r\n"}else{i+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n"}}else if("audio"===e.kind){i+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n"}else if("video"===e.kind){i+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"}i+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n";return}if(e.stream){var d;if("audio"===e.kind){d=e.stream.getAudioTracks()[0]}else if("video"===e.kind){d=e.stream.getVideoTracks()[0]}if(d){if(15019<=t&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx){e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}}}}var c=s(e.localCapabilities,e.remoteCapabilities),p=c.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;if(!p&&e.sendEncodingParameters[0].rtx){delete e.sendEncodingParameters[0].rtx}i+=n(e,c,"answer",e.stream,a._dtlsRole);if(e.rtcpParameters&&e.rtcpParameters.reducedSize){i+="a=rtcp-rsize\r\n"}});var d=new e.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(d)};f.prototype.addIceCandidate=function(e){var t=this,a;if(e&&!(e.sdpMLineIndex!==void 0||e.sdpMid)){return Promise.reject(new TypeError("sdpMLineIndex or sdpMid required"))}return new Promise(function(n,o){if(!t._remoteDescription){return o(p("InvalidStateError","Can not add ICE candidate without a remote description"))}else if(!e||""===e.candidate){for(var s=0;s<t.transceivers.length;s++){if(t.transceivers[s].rejected){continue}t.transceivers[s].iceTransport.addRemoteCandidate({});a=r.getMediaSections(t._remoteDescription.sdp);a[s]+="a=end-of-candidates\r\n";t._remoteDescription.sdp=r.getDescription(t._remoteDescription.sdp)+a.join("");if(t.usingBundle){break}}}else{var d=e.sdpMLineIndex;if(e.sdpMid){for(var l=0;l<t.transceivers.length;l++){if(t.transceivers[l].mid===e.sdpMid){d=l;break}}}var m=t.transceivers[d];if(m){if(m.rejected){return n()}var f=0<Object.keys(e.candidate).length?r.parseCandidate(e.candidate):{};if("tcp"===f.protocol&&(0===f.port||9===f.port)){return n()}if(f.component&&1!==f.component){return n()}if(0===d||0<d&&m.iceTransport!==t.transceivers[0].iceTransport){if(!c(m.iceTransport,f)){return o(p("OperationError","Can not add ICE candidate"))}}var h=e.candidate.trim();if(0===h.indexOf("a=")){h=h.substr(2)}a=r.getMediaSections(t._remoteDescription.sdp);a[d]+="a="+(f.type?h:"end-of-candidates")+"\r\n";t._remoteDescription.sdp=r.getDescription(t._remoteDescription.sdp)+a.join("")}else{return o(p("OperationError","Can not add ICE candidate"))}}n()})};f.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;this.transceivers.forEach(function(e){if(e.rtpSender&&e.rtpSender.track===t){r=e.rtpSender}else if(e.rtpReceiver&&e.rtpReceiver.track===t){r=e.rtpReceiver}});if(!r){throw p("InvalidAccessError","Invalid selector.")}return r.getStats()}var a=[];this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){if(e[t]){a.push(e[t].getStats())}})});return Promise.all(a).then(function(e){var t=new Map;e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})});return t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;Object.keys(e).forEach(function(r){e[r].type=a(e[r]);t.set(r,e[r])});return t})}}});var h=["createOffer","createAnswer"];h.forEach(function(e){var t=f.prototype[e];f.prototype[e]=function(){var e=arguments;if("function"==typeof e[0]||"function"==typeof e[1]){return t.apply(this,[arguments[2]]).then(function(t){if("function"==typeof e[0]){e[0].apply(null,[t])}},function(t){if("function"==typeof e[1]){e[1].apply(null,[t])}})}return t.apply(this,arguments)}});h=["setLocalDescription","setRemoteDescription","addIceCandidate"];h.forEach(function(e){var t=f.prototype[e];f.prototype[e]=function(){var e=arguments;if("function"==typeof e[1]||"function"==typeof e[2]){return t.apply(this,arguments).then(function(){if("function"==typeof e[1]){e[1].apply(null)}},function(t){if("function"==typeof e[2]){e[2].apply(null,[t])}})}return t.apply(this,arguments)}});["getStats"].forEach(function(e){var t=f.prototype[e];f.prototype[e]=function(){var e=arguments;if("function"==typeof e[1]){return t.apply(this,arguments).then(function(){if("function"==typeof e[1]){e[1].apply(null)}})}return t.apply(this,arguments)}});return f}},{sdp:17}],17:[function(e,t){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier();r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})};r.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})};r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]};r.getMediaSections=function(e){var t=r.splitSections(e);t.shift();return t};r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})};r.parseCandidate=function(e){var t;if(0===e.indexOf("a=candidate:")){t=e.substring(12).split(" ")}else{t=e.substring(10).split(" ")}for(var r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},a=8;a<t.length;a+=2){switch(t[a]){case"raddr":r.relatedAddress=t[a+1];break;case"rport":r.relatedPort=parseInt(t[a+1],10);break;case"tcptype":r.tcpType=t[a+1];break;case"ufrag":r.ufrag=t[a+1];r.usernameFragment=t[a+1];break;default:r[t[a]]=t[a+1];break;}}return r};r.writeCandidate=function(e){var t=[e.foundation,e.component,e.protocol.toUpperCase(),e.priority,e.address||e.ip,e.port],r=e.type;t.push("typ");t.push(r);if("host"!==r&&e.relatedAddress&&e.relatedPort){t.push("raddr");t.push(e.relatedAddress);t.push("rport");t.push(e.relatedPort)}if(e.tcpType&&"tcp"===e.protocol.toLowerCase()){t.push("tcptype");t.push(e.tcpType)}if(e.usernameFragment||e.ufrag){t.push("ufrag");t.push(e.usernameFragment||e.ufrag)}return"candidate:"+t.join(" ")};r.parseIceOptions=function(e){return e.substr(14).split(" ")};r.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};t=t[0].split("/");r.name=t[0];r.clockRate=parseInt(t[1],10);r.channels=3===t.length?parseInt(t[2],10):1;r.numChannels=r.channels;return r};r.writeRtpMap=function(e){var t=e.payloadType;if(e.preferredPayloadType!==void 0){t=e.preferredPayloadType}var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"};r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:0<t[0].indexOf("/")?t[0].split("/")[1]:"sendrecv",uri:t[1]}};r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"};r.parseFmtp=function(e){for(var t={},r,a=e.substr(e.indexOf(" ")+1).split(";"),n=0;n<a.length;n++){r=a[n].trim().split("=");t[r[0].trim()]=r[1]}return t};r.writeFmtp=function(e){var t="",r=e.payloadType;if(e.preferredPayloadType!==void 0){r=e.preferredPayloadType}if(e.parameters&&Object.keys(e.parameters).length){var a=[];Object.keys(e.parameters).forEach(function(t){if(e.parameters[t]){a.push(t+"="+e.parameters[t])}else{a.push(t)}});t+="a=fmtp:"+r+" "+a.join(";")+"\r\n"}return t};r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};r.writeRtcpFb=function(e){var t="",r=e.payloadType;if(e.preferredPayloadType!==void 0){r=e.preferredPayloadType}if(e.rtcpFeedback&&e.rtcpFeedback.length){e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})}return t};r.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},a=e.indexOf(":",t);if(-1<a){r.attribute=e.substr(t+1,a-t-1);r.value=e.substr(a+1)}else{r.attribute=e.substr(t+1)}return r};r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}};r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t){return t.substr(6)}};r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}};r.getDtlsParameters=function(e,t){var a=r.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:a.map(r.parseFingerprint)}};r.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"});return r};r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}};r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===_typeof2(e.keyParams)?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"};r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:")){return null}var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}};r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")};r.getCryptoParameters=function(e,t){var a=r.matchPrefix(e+t,"a=crypto:");return a.map(r.parseCryptoLine)};r.getIceParameters=function(e,t){var a=r.matchPrefix(e+t,"a=ice-ufrag:")[0],n=r.matchPrefix(e+t,"a=ice-pwd:")[0];if(!(a&&n)){return null}return{usernameFragment:a.substr(12),password:n.substr(10)}};r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"};r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=r.splitLines(e),n=a[0].split(" "),o=3;o<n.length;o++){var s=n[o],d=r.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(d){var c=r.parseRtpMap(d),p=r.matchPrefix(e,"a=fmtp:"+s+" ");c.parameters=p.length?r.parseFmtp(p[0]):{};c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(r.parseRtcpFb);t.codecs.push(c);switch(c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase());break;default:break;}}}r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))});return t};r.writeRtpDescription=function(e,t){var a="";a+="m="+e+" ";a+=0<t.codecs.length?"9":"0";a+=" UDP/TLS/RTP/SAVPF ";a+=t.codecs.map(function(e){if(e.preferredPayloadType!==void 0){return e.preferredPayloadType}return e.payloadType}).join(" ")+"\r\n";a+="c=IN IP4 0.0.0.0\r\n";a+="a=rtcp:9 IN IP4 0.0.0.0\r\n";t.codecs.forEach(function(e){a+=r.writeRtpMap(e);a+=r.writeFmtp(e);a+=r.writeRtcpFb(e)});var n=0;t.codecs.forEach(function(e){if(e.maxptime>n){n=e.maxptime}});if(0<n){a+="a=maxptime:"+n+"\r\n"}a+="a=rtcp-mux\r\n";if(t.headerExtensions){t.headerExtensions.forEach(function(e){a+=r.writeExtmap(e)})}return a};r.parseRtpEncodingParameters=function(e){var t=[],a=r.parseRtpParameters(e),n=-1!==a.fecMechanisms.indexOf("RED"),i=-1!==a.fecMechanisms.indexOf("ULPFEC"),o=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),s=0<o.length&&o[0].ssrc,d,c=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.substr(17).split(" ");return t.map(function(e){return parseInt(e,10)})});if(0<c.length&&1<c[0].length&&c[0][0]===s){d=c[0][1]}a.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};if(s&&d){r.rtx={ssrc:d}}t.push(r);if(n){r=JSON.parse(JSON.stringify(r));r.fec={ssrc:s,mechanism:i?"red+ulpfec":"red"};t.push(r)}}});if(0===t.length&&s){t.push({ssrc:s})}var p=r.matchPrefix(e,"b=");if(p.length){if(0===p[0].indexOf("b=TIAS:")){p=parseInt(p[0].substr(7),10)}else if(0===p[0].indexOf("b=AS:")){p=.95*(1e3*parseInt(p[0].substr(5),10))-16000}else{p=void 0}t.forEach(function(e){e.maxBitrate=p})}return t};r.parseRtcpParameters=function(e){var t={},a=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];if(a){t.cname=a.value;t.ssrc=a.ssrc}var n=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<n.length;t.compound=0===n.length;var i=r.matchPrefix(e,"a=rtcp-mux");t.mux=0<i.length;return t};r.parseMsid=function(e){var t,a=r.matchPrefix(e,"a=msid:");if(1===a.length){t=a[0].substr(7).split(" ");return{stream:t[0],track:t[1]}}var n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});if(0<n.length){t=n[0].value.split(" ");return{stream:t[0],track:t[1]}}};r.parseSctpDescription=function(e){var t=r.parseMLine(e),a=r.matchPrefix(e,"a=max-message-size:"),n;if(0<a.length){n=parseInt(a[0].substr(19),10)}if(isNaN(n)){n=65536}var i=r.matchPrefix(e,"a=sctp-port:");if(0<i.length){return{port:parseInt(i[0].substr(12),10),protocol:t.fmt,maxMessageSize:n}}var o=r.matchPrefix(e,"a=sctpmap:");if(0<o.length){var s=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:n}}};r.writeSctpDescription=function(e,t){var r=[];if("DTLS/SCTP"!==e.protocol){r=["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]}else{r=["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"]}if(t.maxMessageSize!==void 0){r.push("a=max-message-size:"+t.maxMessageSize+"\r\n")}return r.join("")};r.generateSessionId=function(){return Math.random().toString().substr(2,21)};r.writeSessionBoilerplate=function(e,t,a){var n,i=t!==void 0?t:2;if(e){n=e}else{n=r.generateSessionId()}return"v=0\r\no="+(a||"thisisadapterortc")+" "+n+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};r.writeMediaSection=function(e,t,a,n){var i=r.writeRtpDescription(e.kind,t);i+=r.writeIceParameters(e.iceGatherer.getLocalParameters());i+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===a?"actpass":"active");i+="a=mid:"+e.mid+"\r\n";if(e.direction){i+="a="+e.direction+"\r\n"}else if(e.rtpSender&&e.rtpReceiver){i+="a=sendrecv\r\n"}else if(e.rtpSender){i+="a=sendonly\r\n"}else if(e.rtpReceiver){i+="a=recvonly\r\n"}else{i+="a=inactive\r\n"}if(e.rtpSender){var o="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+o;i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o;if(e.sendEncodingParameters[0].rtx){i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o;i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n";if(e.rtpSender&&e.sendEncodingParameters[0].rtx){i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"}return i};r.getDirection=function(e,t){for(var a=r.splitLines(e),n=0;n<a.length;n++){switch(a[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[n].substr(2);default:}}if(t){return r.getDirection(t)}return"sendrecv"};r.getKind=function(e){var t=r.splitLines(e),a=t[0].split(" ");return a[0].substr(2)};r.isRejected=function(e){return"0"===e.split(" ",2)[1]};r.parseMLine=function(e){var t=r.splitLines(e),a=t[0].substr(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}};r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0],a=t.substr(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}};r.isValidSDP=function(e){if("string"!=typeof e||0===e.length){return!1}for(var t=r.splitLines(e),a=0;a<t.length;a++){if(2>t[a].length||"="!==t[a].charAt(1)){return!1}}return!0};if("object"===_typeof2(t)){t.exports=r}},{}]},{},[1])(1)});
//# sourceMappingURL=adapter.min.js.map
