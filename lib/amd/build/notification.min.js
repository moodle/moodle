define ("core/notification",["exports","core/pending","core/log"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=a.init=a.exception=a.saveCancel=a.alert=a.addNotification=a.fetchNotifications=void 0;b=d(b);c=d(c);var m="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){return h(a)||g(a,b)||f()}function f(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function g(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function h(a){if(Array.isArray(a))return a}function i(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{},d=Object.keys(c);if("function"==typeof Object.getOwnPropertySymbols){d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))}d.forEach(function(b){j(a,b,c[b])})}return a}function j(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}function k(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function l(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){k(h,d,e,f,g,"next",a)}function g(a){k(h,d,e,f,g,"throw",a)}f(void 0)})}}var n=M.cfg.contextid,o={success:"core/notification_success",info:"core/notification_info",warning:"core/notification_warning",error:"core/notification_error"},p="user-notifications",q={notificationRegion:"#".concat(p),fallbackRegionParents:["#region-main","[role=\"main\"]","body"]},r=function(){var a=w();if(a){return!1}var b=document.createElement("span");b.id=p;return q.fallbackRegionParents.some(function(a){var c=document.querySelector(a);if(c){c.prepend(b);return!0}return!1})},s=function(){var a=l(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return"function"==typeof m.define&&m.define.amd?new Promise(function(a,b){m.require(["core/ajax"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&m.require&&"component"===m.require.loader?Promise.resolve(require(("core/ajax"))):Promise.resolve(m["core/ajax"]);case 2:b=a.sent;return a.abrupt("return",b.call([{methodname:"core_fetch_notifications",args:{contextid:n}}])[0].then(t));case 4:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();a.fetchNotifications=s;var t=function(a){if(!a.length){return Promise.resolve()}var c=new b.default("core/notification:addNotifications");a.forEach(function(a){return v(a.template,a.variables)});return c.resolve()},u=function(a){var c=new b.default("core/notification:addNotifications"),d=o.error;a=i({closebutton:!0,announce:!0,type:"error"},a);if(a.template){d=a.template;delete a.template}else if(a.type){if("undefined"!=typeof o[a.type]){d=o[a.type]}delete a.type}return v(d,a).then(c.resolve)};a.addNotification=u;var v=function(){var a=l(regeneratorRuntime.mark(function a(d,e){var f,g;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:if(!("undefined"==typeof e.message||!e.message)){a.next=3;break}c.default.debug("Notification received without content. Skipping.");return a.abrupt("return");case 3:f=new b.default("core/notification:renderNotification");a.next=6;return"function"==typeof m.define&&m.define.amd?new Promise(function(a,b){m.require(["core/templates"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&m.require&&"component"===m.require.loader?Promise.resolve(require(("core/templates"))):Promise.resolve(m["core/templates"]);case 6:g=a.sent;g.renderForPromise(d,e).then(function(a){var b=a.html,c=a.js,d=void 0===c?"":c;g.prependNodeContents(w(),b,d);return}).then(f.resolve).catch(z);case 8:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),w=function(){return document.querySelector(q.notificationRegion)},x=function(){var a=l(regeneratorRuntime.mark(function a(c,d,e){var f,g;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:f=new b.default("core/notification:alert");a.next=3;return"function"==typeof m.define&&m.define.amd?new Promise(function(a,b){m.require(["core/modal_factory"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&m.require&&"component"===m.require.loader?Promise.resolve(require(("core/modal_factory"))):Promise.resolve(m["core/modal_factory"]);case 3:g=a.sent;return a.abrupt("return",g.create({type:g.types.ALERT,body:d,title:c,buttons:{cancel:e},removeOnClose:!0}).then(function(a){a.show();f.resolve();return a}));case 5:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();a.alert=x;var y=function(){var a=l(regeneratorRuntime.mark(function a(c,d,f,g,h){var i,j,k,l,n;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:i=new b.default("core/notification:confirm");a.next=3;return Promise.all(["function"==typeof m.define&&m.define.amd?new Promise(function(a,b){m.require(["core/modal_factory"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&m.require&&"component"===m.require.loader?Promise.resolve(require(("core/modal_factory"))):Promise.resolve(m["core/modal_factory"]),"function"==typeof m.define&&m.define.amd?new Promise(function(a,b){m.require(["core/modal_events"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&m.require&&"component"===m.require.loader?Promise.resolve(require(("core/modal_events"))):Promise.resolve(m["core/modal_events"])]);case 3:j=a.sent;k=e(j,2);l=k[0];n=k[1];return a.abrupt("return",l.create({type:l.types.SAVE_CANCEL,title:c,body:d,buttons:{save:f},removeOnClose:!0}).then(function(a){a.show();a.getRoot().on(n.save,g);a.getRoot().on(n.cancel,h);i.resolve();return a}));case 8:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();a.saveCancel=y;var z=function(){var a=l(regeneratorRuntime.mark(function a(c){var d,e,f,g;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:d=new b.default("core/notification:displayException");if(!c.stack){c.stack=""}if(c.debuginfo){c.stack+=c.debuginfo+"\n"}if(!c.backtrace&&c.stacktrace){c.backtrace=c.stacktrace}if(c.backtrace){c.stack+=c.backtrace;e=c.backtrace.match(/line ([^ ]*) of/);f=c.backtrace.match(/ of ([^:]*): /);if(e&&e[1]){c.lineNumber=e[1]}if(f&&f[1]){c.fileName=f[1];if(30<c.fileName.length){c.fileName="..."+c.fileName.substr(c.fileName.length-27)}}}if("undefined"==typeof c.name&&c.errorcode){c.name=c.errorcode}a.next=8;return"function"==typeof m.define&&m.define.amd?new Promise(function(a,b){m.require(["core/yui"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&m.require&&"component"===m.require.loader?Promise.resolve(require(("core/yui"))):Promise.resolve(m["core/yui"]);case 8:g=a.sent;g.use("moodle-core-notification-exception",function(){var a=new M.core.exception(c);a.show();d.resolve()});case 10:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();a.exception=z;var A=function(a,b){n=a;r();t(b);s()};a.init=A;var B={init:A,fetchNotifications:s,addNotification:u,alert:x,confirm:confirm,saveCancel:y,exception:z};a.default=B;return a.default});
//# sourceMappingURL=notification.min.js.map
