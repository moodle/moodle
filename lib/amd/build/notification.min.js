define ("core/notification",["exports","core/pending","core/log"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.saveCancelPromise=a.saveCancel=a.init=a.fetchNotifications=a.exception=a.default=a.confirm=a.alert=a.addNotification=void 0;b=e(b);c=e(c);var d="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){return k(a)||j(a,b)||h(a,b)||g()}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(a,b){if(!a)return;if("string"==typeof a)return i(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return i(a,b)}function i(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function j(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null==c)return;var d=[],e=!0,f=!1,g,h;try{for(c=c.call(a);!(e=(g=c.next()).done);e=!0){d.push(g.value);if(b&&d.length===b)break}}catch(a){f=!0;h=a}finally{try{if(!e&&null!=c["return"])c["return"]()}finally{if(f)throw h}}return d}function k(a){if(Array.isArray(a))return a}function l(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function m(a){for(var b=1,c;b<arguments.length;b++){c=null!=arguments[b]?arguments[b]:{};b%2?l(Object(c),!0).forEach(function(b){n(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):l(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function n(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}function o(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function p(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var f=a.apply(b,c);function g(a){o(f,d,e,g,h,"next",a)}function h(a){o(f,d,e,g,h,"throw",a)}g(void 0)})}}var q=M.cfg.contextid,r={success:"core/notification_success",info:"core/notification_info",warning:"core/notification_warning",error:"core/notification_error"},s="user-notifications",t={notificationRegion:"#".concat(s),fallbackRegionParents:["#region-main","[role=\"main\"]","body"]},u=function(){var a=z();if(a){return!1}var b=document.createElement("span");b.id=s;return t.fallbackRegionParents.some(function(a){var c=document.querySelector(a);if(c){c.prepend(b);return!0}return!1})},v=function(){var a=p(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return"function"==typeof d.define&&d.define.amd?new Promise(function(a,b){d.require(["core/ajax"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&d.require&&"component"===d.require.loader?Promise.resolve(require(("core/ajax"))):Promise.resolve(d["core/ajax"]);case 2:b=a.sent;return a.abrupt("return",b.call([{methodname:"core_fetch_notifications",args:{contextid:q}}])[0].then(w));case 4:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();a.fetchNotifications=v;var w=function(a){if(!a.length){return Promise.resolve()}var c=new b.default("core/notification:addNotifications");a.forEach(function(a){return y(a.template,a.variables)});return c.resolve()},x=function(a){var c=new b.default("core/notification:addNotifications"),d=r.error;a=m({closebutton:!0,announce:!0,type:"error"},a);if(a.template){d=a.template;delete a.template}else if(a.type){if("undefined"!=typeof r[a.type]){d=r[a.type]}delete a.type}return y(d,a).then(c.resolve)};a.addNotification=x;var y=function(){var a=p(regeneratorRuntime.mark(function f(a,e){var g,h;return regeneratorRuntime.wrap(function(f){while(1){switch(f.prev=f.next){case 0:if(!("undefined"==typeof e.message||!e.message)){f.next=3;break}c.default.debug("Notification received without content. Skipping.");return f.abrupt("return");case 3:g=new b.default("core/notification:renderNotification");f.next=6;return"function"==typeof d.define&&d.define.amd?new Promise(function(a,b){d.require(["core/templates"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&d.require&&"component"===d.require.loader?Promise.resolve(require(("core/templates"))):Promise.resolve(d["core/templates"]);case 6:h=f.sent;h.renderForPromise(a,e).then(function(a){var b=a.html,c=a.js,d=void 0===c?"":c;h.prependNodeContents(z(),b,d);return}).then(g.resolve).catch(E);case 8:case"end":return f.stop();}}},f)}));return function(){return a.apply(this,arguments)}}(),z=function(){return document.querySelector(t.notificationRegion)},A=function(){var a=p(regeneratorRuntime.mark(function f(a,c,e){var g,h;return regeneratorRuntime.wrap(function(f){while(1){switch(f.prev=f.next){case 0:g=new b.default("core/notification:alert");f.next=3;return"function"==typeof d.define&&d.define.amd?new Promise(function(a,b){d.require(["core/modal_factory"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&d.require&&"component"===d.require.loader?Promise.resolve(require(("core/modal_factory"))):Promise.resolve(d["core/modal_factory"]);case 3:h=f.sent;return f.abrupt("return",h.create({type:h.types.ALERT,body:c,title:a,buttons:{cancel:e},removeOnClose:!0}).then(function(a){a.show();g.resolve();return a}));case 5:case"end":return f.stop();}}},f)}));return function(){return a.apply(this,arguments)}}();a.alert=A;var B=function(a,b,c,d,e,f){return C(a,b,c,e,f)};a.confirm=B;var C=function(){var a=p(regeneratorRuntime.mark(function i(a,c,e,g,h){var j,k,l,m,n,o,p,q,r=arguments;return regeneratorRuntime.wrap(function(i){while(1){switch(i.prev=i.next){case 0:j=5<r.length&&r[5]!==void 0?r[5]:{},k=j.triggerElement,l=void 0===k?null:k;m=new b.default("core/notification:confirm");i.next=4;return Promise.all(["function"==typeof d.define&&d.define.amd?new Promise(function(a,b){d.require(["core/modal_factory"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&d.require&&"component"===d.require.loader?Promise.resolve(require(("core/modal_factory"))):Promise.resolve(d["core/modal_factory"]),"function"==typeof d.define&&d.define.amd?new Promise(function(a,b){d.require(["core/modal_events"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&d.require&&"component"===d.require.loader?Promise.resolve(require(("core/modal_events"))):Promise.resolve(d["core/modal_events"])]);case 4:n=i.sent;o=f(n,2);p=o[0];q=o[1];return i.abrupt("return",p.create({type:p.types.SAVE_CANCEL,title:a,body:c,buttons:{save:e},removeOnClose:!0}).then(function(a){a.show();a.getRoot().on(q.save,g);a.getRoot().on(q.cancel,h);a.getRoot().on(q.hidden,function(){return null===l||void 0===l?void 0:l.focus()});m.resolve();return a}));case 9:case"end":return i.stop();}}},i)}));return function(){return a.apply(this,arguments)}}();a.saveCancel=C;var D=function(a,b,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{},e=d.triggerElement,f=void 0===e?null:e;return new Promise(function(d,e){C(a,b,c,d,e,{triggerElement:f})})};a.saveCancelPromise=D;var E=function(){var a=p(regeneratorRuntime.mark(function c(a){var e,f,g,h;return regeneratorRuntime.wrap(function(c){while(1){switch(c.prev=c.next){case 0:e=new b.default("core/notification:displayException");if(!a.stack){a.stack=""}if(a.debuginfo){a.stack+=a.debuginfo+"\n"}if(!a.backtrace&&a.stacktrace){a.backtrace=a.stacktrace}if(a.backtrace){a.stack+=a.backtrace;f=a.backtrace.match(/line ([^ ]*) of/);g=a.backtrace.match(/ of ([^:]*): /);if(f&&f[1]){a.lineNumber=f[1]}if(g&&g[1]){a.fileName=g[1];if(30<a.fileName.length){a.fileName="..."+a.fileName.substr(a.fileName.length-27)}}}if("undefined"==typeof a.name&&a.errorcode){a.name=a.errorcode}c.next=8;return"function"==typeof d.define&&d.define.amd?new Promise(function(a,b){d.require(["core/yui"],a,b)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&d.require&&"component"===d.require.loader?Promise.resolve(require(("core/yui"))):Promise.resolve(d["core/yui"]);case 8:h=c.sent;h.use("moodle-core-notification-exception",function(){var b=new M.core.exception(a);b.show();e.resolve()});case 10:case"end":return c.stop();}}},c)}));return function(){return a.apply(this,arguments)}}();a.exception=E;var F=function(a,b){q=a;u();w(b)};a.init=F;a.default={init:F,fetchNotifications:v,addNotification:x,alert:A,confirm:B,saveCancel:C,saveCancelPromise:D,exception:E};return a.default});
//# sourceMappingURL=notification.min.js.map
