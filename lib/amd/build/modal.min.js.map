{"version":3,"file":"modal.min.js","sources":["../src/modal.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Contain the logic for modals.\n *\n * @module     core/modal\n * @class      modal\n * @package    core\n * @copyright  2016 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/notification',\n    'core/key_codes',\n    'core/custom_interaction_events',\n    'core/modal_backdrop',\n    'core/event',\n    'core/modal_events',\n    'core/local/aria/focuslock',\n    'core/pending',\n    'core/fullscreen'\n], function(\n    $,\n    Templates,\n    Notification,\n    KeyCodes,\n    CustomEvents,\n    ModalBackdrop,\n    Event,\n    ModalEvents,\n    FocusLock,\n    Pending,\n    Fullscreen\n) {\n\n    var SELECTORS = {\n        CONTAINER: '[data-region=\"modal-container\"]',\n        MODAL: '[data-region=\"modal\"]',\n        HEADER: '[data-region=\"header\"]',\n        TITLE: '[data-region=\"title\"]',\n        BODY: '[data-region=\"body\"]',\n        FOOTER: '[data-region=\"footer\"]',\n        HIDE: '[data-action=\"hide\"]',\n        DIALOG: '[role=dialog]',\n        FORM: 'form',\n        MENU_BAR: '[role=menubar]',\n        HAS_Z_INDEX: '.moodle-has-zindex',\n        CAN_RECEIVE_FOCUS: 'input:not([type=\"hidden\"]), a[href], button, textarea, select, [tabindex]',\n    };\n\n    var TEMPLATES = {\n        LOADING: 'core/loading',\n        BACKDROP: 'core/modal_backdrop',\n    };\n\n    /**\n     * Module singleton for the backdrop to be reused by all Modal instances.\n     */\n    var backdropPromise;\n\n    /**\n     * A counter that gets incremented for each modal created. This can be\n     * used to generate unique values for the modals.\n     */\n    var modalCounter = 0;\n\n    /**\n     * Constructor for the Modal.\n     *\n     * @param {object} root The root jQuery element for the modal\n     */\n    var Modal = function(root) {\n        this.root = $(root);\n        this.modal = this.root.find(SELECTORS.MODAL);\n        this.header = this.modal.find(SELECTORS.HEADER);\n        this.headerPromise = $.Deferred();\n        this.title = this.header.find(SELECTORS.TITLE);\n        this.titlePromise = $.Deferred();\n        this.body = this.modal.find(SELECTORS.BODY);\n        this.bodyPromise = $.Deferred();\n        this.footer = this.modal.find(SELECTORS.FOOTER);\n        this.footerPromise = $.Deferred();\n        this.hiddenSiblings = [];\n        this.isAttached = false;\n        this.bodyJS = null;\n        this.footerJS = null;\n        this.modalCount = modalCounter++;\n        this.attachmentPoint = document.createElement('div');\n        document.body.append(this.attachmentPoint);\n\n        if (!this.root.is(SELECTORS.CONTAINER)) {\n            Notification.exception({message: 'Element is not a modal container'});\n        }\n\n        if (!this.modal.length) {\n            Notification.exception({message: 'Container does not contain a modal'});\n        }\n\n        if (!this.header.length) {\n            Notification.exception({message: 'Modal is missing a header region'});\n        }\n\n        if (!this.title.length) {\n            Notification.exception({message: 'Modal header is missing a title region'});\n        }\n\n        if (!this.body.length) {\n            Notification.exception({message: 'Modal is missing a body region'});\n        }\n\n        if (!this.footer.length) {\n            Notification.exception({message: 'Modal is missing a footer region'});\n        }\n\n        this.registerEventListeners();\n    };\n\n    /**\n     * Attach the modal to the correct part of the page.\n     *\n     * If it hasn't already been added it runs any\n     * javascript that has been cached until now.\n     *\n     * @method attachToDOM\n     */\n    Modal.prototype.attachToDOM = function() {\n        this.getAttachmentPoint().append(this.root);\n\n        if (this.isAttached) {\n            return;\n        }\n\n        FocusLock.trapFocus(this.root[0]);\n\n        // If we'd cached any JS then we can run it how that the modal is\n        // attached to the DOM.\n        if (this.bodyJS) {\n            Templates.runTemplateJS(this.bodyJS);\n            this.bodyJS = null;\n        }\n\n        if (this.footerJS) {\n            Templates.runTemplateJS(this.footerJS);\n            this.footerJS = null;\n        }\n\n        this.isAttached = true;\n    };\n\n    /**\n     * Count the number of other visible modals (not including this one).\n     *\n     * @method countOtherVisibleModals\n     * @return {int}\n     */\n    Modal.prototype.countOtherVisibleModals = function() {\n        var count = 0;\n        $('body').find(SELECTORS.CONTAINER).each(function(index, element) {\n            element = $(element);\n\n            // If we haven't found ourself and the element is visible.\n            if (!this.root.is(element) && element.hasClass('show')) {\n                count++;\n            }\n        }.bind(this));\n\n        return count;\n    };\n\n    /**\n     * Get the modal backdrop.\n     *\n     * @method getBackdrop\n     * @return {object} jQuery promise\n     */\n    Modal.prototype.getBackdrop = function() {\n        if (!backdropPromise) {\n            backdropPromise = Templates.render(TEMPLATES.BACKDROP, {})\n                .then(function(html) {\n                    var element = $(html);\n\n                    return new ModalBackdrop(element);\n                })\n                .fail(Notification.exception);\n        }\n\n        return backdropPromise;\n    };\n\n    /**\n     * Get the root element of this modal.\n     *\n     * @method getRoot\n     * @return {object} jQuery object\n     */\n    Modal.prototype.getRoot = function() {\n        return this.root;\n    };\n\n    /**\n     * Get the modal element of this modal.\n     *\n     * @method getModal\n     * @return {object} jQuery object\n     */\n    Modal.prototype.getModal = function() {\n        return this.modal;\n    };\n\n    /**\n     * Get the modal title element.\n     *\n     * @method getTitle\n     * @return {object} jQuery object\n     */\n    Modal.prototype.getTitle = function() {\n        return this.title;\n    };\n\n    /**\n     * Get the modal body element.\n     *\n     * @method getBody\n     * @return {object} jQuery object\n     */\n    Modal.prototype.getBody = function() {\n        return this.body;\n    };\n\n    /**\n     * Get the modal footer element.\n     *\n     * @method getFooter\n     * @return {object} jQuery object\n     */\n    Modal.prototype.getFooter = function() {\n        return this.footer;\n    };\n\n    /**\n     * Get a promise resolving to the title region.\n     *\n     * @method getTitlePromise\n     * @return {Promise}\n     */\n    Modal.prototype.getTitlePromise = function() {\n        return this.titlePromise;\n    };\n\n    /**\n     * Get a promise resolving to the body region.\n     *\n     * @method getBodyPromise\n     * @return {object} jQuery object\n     */\n    Modal.prototype.getBodyPromise = function() {\n        return this.bodyPromise;\n    };\n\n    /**\n     * Get a promise resolving to the footer region.\n     *\n     * @method getFooterPromise\n     * @return {object} jQuery object\n     */\n    Modal.prototype.getFooterPromise = function() {\n        return this.footerPromise;\n    };\n\n    /**\n     * Get the unique modal count.\n     *\n     * @method getModalCount\n     * @return {int}\n     */\n    Modal.prototype.getModalCount = function() {\n        return this.modalCount;\n    };\n\n    /**\n     * Set the modal title element.\n     *\n     * This method is overloaded to take either a string value for the title or a jQuery promise that is resolved with\n     * HTML most commonly from a Str.get_string call.\n     *\n     * @method setTitle\n     * @param {(string|object)} value The title string or jQuery promise which resolves to the title.\n     */\n    Modal.prototype.setTitle = function(value) {\n        var title = this.getTitle();\n        this.titlePromise = $.Deferred();\n\n        this.asyncSet(value, title.html.bind(title))\n        .then(function() {\n            this.titlePromise.resolve(title);\n        }.bind(this))\n        .catch(Notification.exception);\n    };\n\n    /**\n     * Set the modal body element.\n     *\n     * This method is overloaded to take either a string value for the body or a jQuery promise that is resolved with\n     * HTML and Javascript most commonly from a Templates.render call.\n     *\n     * @method setBody\n     * @param {(string|object)} value The body string or jQuery promise which resolves to the body.\n     */\n    Modal.prototype.setBody = function(value) {\n        this.bodyPromise = $.Deferred();\n\n        var body = this.getBody();\n\n        if (typeof value === 'string') {\n            // Just set the value if it's a string.\n            body.html(value);\n            Event.notifyFilterContentUpdated(body);\n            this.getRoot().trigger(ModalEvents.bodyRendered, this);\n            this.bodyPromise.resolve(body);\n        } else {\n            var jsPendingId = 'amd-modal-js-pending-id-' + this.getModalCount();\n            M.util.js_pending(jsPendingId);\n            // Otherwise we assume it's a promise to be resolved with\n            // html and javascript.\n            var contentPromise = null;\n            body.css('overflow', 'hidden');\n\n            // Ensure that the `value` is a jQuery Promise.\n            value = $.when(value);\n\n            if (value.state() == 'pending') {\n                // We're still waiting for the body promise to resolve so\n                // let's show a loading icon.\n                var height = body.innerHeight();\n                if (height < 100) {\n                    height = 100;\n                }\n\n                body.animate({height: height + 'px'}, 150);\n\n                body.html('');\n                contentPromise = Templates.render(TEMPLATES.LOADING, {})\n                    .then(function(html) {\n                        var loadingIcon = $(html).hide();\n                        body.html(loadingIcon);\n                        loadingIcon.fadeIn(150);\n\n                        // We only want the loading icon to fade out\n                        // when the content for the body has finished\n                        // loading.\n                        return $.when(loadingIcon.promise(), value);\n                    })\n                    .then(function(loadingIcon) {\n                        // Once the content has finished loading and\n                        // the loading icon has been shown then we can\n                        // fade the icon away to reveal the content.\n                        return loadingIcon.fadeOut(100).promise();\n                    })\n                    .then(function() {\n                        return value;\n                    });\n            } else {\n                // The content is already loaded so let's just display\n                // it to the user. No need for a loading icon.\n                contentPromise = value;\n            }\n\n            // Now we can actually display the content.\n            contentPromise.then(function(html, js) {\n                var result = null;\n\n                if (this.isVisible()) {\n                    // If the modal is visible then we should display\n                    // the content gracefully for the user.\n                    body.css('opacity', 0);\n                    var currentHeight = body.innerHeight();\n                    body.html(html);\n                    // We need to clear any height values we've set here\n                    // in order to measure the height of the content being\n                    // added. This then allows us to animate the height\n                    // transition.\n                    body.css('height', '');\n                    var newHeight = body.innerHeight();\n                    body.css('height', currentHeight + 'px');\n                    result = body.animate(\n                        {height: newHeight + 'px', opacity: 1},\n                        {duration: 150, queue: false}\n                    ).promise();\n                } else {\n                    // Since the modal isn't visible we can just immediately\n                    // set the content. No need to animate it.\n                    body.html(html);\n                }\n\n                if (js) {\n                    if (this.isAttached) {\n                        // If we're in the DOM then run the JS immediately.\n                        Templates.runTemplateJS(js);\n                    } else {\n                        // Otherwise cache it to be run when we're attached.\n                        this.bodyJS = js;\n                    }\n                }\n\n                return result;\n            }.bind(this))\n            .then(function(result) {\n                Event.notifyFilterContentUpdated(body);\n                this.getRoot().trigger(ModalEvents.bodyRendered, this);\n                return result;\n            }.bind(this))\n            .then(function() {\n                this.bodyPromise.resolve(body);\n                return;\n            }.bind(this))\n            .fail(Notification.exception)\n            .always(function() {\n                // When we're done displaying all of the content we need\n                // to clear the custom values we've set here.\n                body.css('height', '');\n                body.css('overflow', '');\n                body.css('opacity', '');\n                M.util.js_complete(jsPendingId);\n\n                return;\n            })\n            .fail(Notification.exception);\n        }\n    };\n\n    /**\n     * Set the modal footer element. The footer element is made visible, if it\n     * isn't already.\n     *\n     * This method is overloaded to take either a string\n     * value for the body or a jQuery promise that is resolved with HTML and Javascript\n     * most commonly from a Templates.render call.\n     *\n     * @method setFooter\n     * @param {(string|object)} value The footer string or jQuery promise\n     */\n    Modal.prototype.setFooter = function(value) {\n        // Make sure the footer is visible.\n        this.showFooter();\n        this.footerPromise = $.Deferred();\n\n        var footer = this.getFooter();\n\n        if (typeof value === 'string') {\n            // Just set the value if it's a string.\n            footer.html(value);\n            this.footerPromise.resolve(footer);\n        } else {\n            // Otherwise we assume it's a promise to be resolved with\n            // html and javascript.\n            Templates.render(TEMPLATES.LOADING, {})\n            .then(function(html) {\n                footer.html(html);\n\n                return value;\n            })\n            .then(function(html, js) {\n                footer.html(html);\n\n                if (js) {\n                    if (this.isAttached) {\n                        // If we're in the DOM then run the JS immediately.\n                        Templates.runTemplateJS(js);\n                    } else {\n                        // Otherwise cache it to be run when we're attached.\n                        this.footerJS = js;\n                    }\n                }\n\n                return footer;\n            }.bind(this))\n            .then(function(footer) {\n                this.footerPromise.resolve(footer);\n                return;\n            }.bind(this))\n            .catch(Notification.exception);\n        }\n    };\n\n    /**\n     * Check if the footer has any content in it.\n     *\n     * @method hasFooterContent\n     * @return {bool}\n     */\n    Modal.prototype.hasFooterContent = function() {\n        return this.getFooter().children().length ? true : false;\n    };\n\n    /**\n     * Hide the footer element.\n     *\n     * @method hideFooter\n     */\n    Modal.prototype.hideFooter = function() {\n        this.getFooter().addClass('hidden');\n    };\n\n    /**\n     * Show the footer element.\n     *\n     * @method showFooter\n     */\n    Modal.prototype.showFooter = function() {\n        this.getFooter().removeClass('hidden');\n    };\n\n    /**\n     * Mark the modal as a large modal.\n     *\n     * @method setLarge\n     */\n    Modal.prototype.setLarge = function() {\n        if (this.isLarge()) {\n            return;\n        }\n\n        this.getModal().addClass('modal-lg');\n    };\n\n    /**\n     * Check if the modal is a large modal.\n     *\n     * @method isLarge\n     * @return {bool}\n     */\n    Modal.prototype.isLarge = function() {\n        return this.getModal().hasClass('modal-lg');\n    };\n\n    /**\n     * Mark the modal as a small modal.\n     *\n     * @method setSmall\n     */\n    Modal.prototype.setSmall = function() {\n        if (this.isSmall()) {\n            return;\n        }\n\n        this.getModal().removeClass('modal-lg');\n    };\n\n    /**\n     * Check if the modal is a small modal.\n     *\n     * @method isSmall\n     * @return {bool}\n     */\n    Modal.prototype.isSmall = function() {\n        return !this.getModal().hasClass('modal-lg');\n    };\n\n    /**\n     * Determine the highest z-index value currently on the page.\n     *\n     * @method calculateZIndex\n     * @return {int}\n     */\n    Modal.prototype.calculateZIndex = function() {\n        var items = $(SELECTORS.DIALOG + ', ' + SELECTORS.MENU_BAR + ', ' + SELECTORS.HAS_Z_INDEX);\n        var zIndex = parseInt(this.root.css('z-index'));\n\n        items.each(function(index, item) {\n            item = $(item);\n            // Note that webkit browsers won't return the z-index value from the CSS stylesheet\n            // if the element doesn't have a position specified. Instead it'll return \"auto\".\n            var itemZIndex = item.css('z-index') ? parseInt(item.css('z-index')) : 0;\n\n            if (itemZIndex > zIndex) {\n                zIndex = itemZIndex;\n            }\n        });\n\n        return zIndex;\n    };\n\n    /**\n     * Check if this modal is visible.\n     *\n     * @method isVisible\n     * @return {bool}\n     */\n    Modal.prototype.isVisible = function() {\n        return this.root.hasClass('show');\n    };\n\n    /**\n     * Check if this modal has focus.\n     *\n     * @method hasFocus\n     * @return {bool}\n     */\n    Modal.prototype.hasFocus = function() {\n        var target = $(document.activeElement);\n        return this.root.is(target) || this.root.has(target).length;\n    };\n\n    /**\n     * Check if this modal has CSS transitions applied.\n     *\n     * @method hasTransitions\n     * @return {bool}\n     */\n    Modal.prototype.hasTransitions = function() {\n        return this.getRoot().hasClass('fade');\n    };\n\n    /**\n     * Gets the jQuery wrapped node that the Modal should be attached to.\n     *\n     * @returns {jQuery}\n     */\n    Modal.prototype.getAttachmentPoint = function() {\n        return $(Fullscreen.getElement() || this.attachmentPoint);\n    };\n\n    /**\n     * Display this modal. The modal will be attached to the DOM if it hasn't\n     * already been.\n     *\n     * @method show\n     * @returns {Promise}\n     */\n    Modal.prototype.show = function() {\n        if (this.isVisible()) {\n            return $.Deferred().resolve();\n        }\n\n        var pendingPromise = new Pending('core/modal:show');\n\n        if (this.hasFooterContent()) {\n            this.showFooter();\n        } else {\n            this.hideFooter();\n        }\n\n        this.attachToDOM();\n\n        return this.getBackdrop()\n        .then(function(backdrop) {\n            var currentIndex = this.calculateZIndex();\n            var newIndex = currentIndex + 2;\n            var newBackdropIndex = newIndex - 1;\n            this.root.css('z-index', newIndex);\n            backdrop.setZIndex(newBackdropIndex);\n            backdrop.show();\n\n            this.root.removeClass('hide').addClass('show');\n            this.accessibilityShow();\n            this.getModal().focus();\n            $('body').addClass('modal-open');\n            this.root.trigger(ModalEvents.shown, this);\n\n            return;\n        }.bind(this))\n        .then(pendingPromise.resolve);\n    };\n\n    /**\n     * Hide this modal if it does not contain a form.\n     *\n     * @method hideIfNotForm\n     */\n    Modal.prototype.hideIfNotForm = function() {\n        var formElement = this.modal.find(SELECTORS.FORM);\n        if (formElement.length == 0) {\n            this.hide();\n        }\n    };\n\n    /**\n     * Hide this modal.\n     *\n     * @method hide\n     */\n    Modal.prototype.hide = function() {\n        this.getBackdrop().done(function(backdrop) {\n            FocusLock.untrapFocus();\n\n            if (!this.countOtherVisibleModals()) {\n                // Hide the backdrop if we're the last open modal.\n                backdrop.hide();\n                $('body').removeClass('modal-open');\n            }\n\n            var currentIndex = parseInt(this.root.css('z-index'));\n            this.root.css('z-index', '');\n            backdrop.setZIndex(currentIndex - 3);\n\n            this.accessibilityHide();\n\n            if (this.hasTransitions()) {\n                // Wait for CSS transitions to complete before hiding the element.\n                this.getRoot().one('transitionend webkitTransitionEnd oTransitionEnd', function() {\n                    this.getRoot().removeClass('show').addClass('hide');\n                }.bind(this));\n            } else {\n                this.getRoot().removeClass('show').addClass('hide');\n            }\n\n            // Ensure the modal is moved onto the body node if it is still attached to the DOM.\n            if ($(document.body).find(this.getRoot()).length) {\n                $(document.body).append(this.getRoot());\n            }\n\n            this.root.trigger(ModalEvents.hidden, this);\n        }.bind(this));\n    };\n\n    /**\n     * Remove this modal from the DOM.\n     *\n     * @method destroy\n     */\n    Modal.prototype.destroy = function() {\n        this.hide();\n        this.root.remove();\n        this.root.trigger(ModalEvents.destroyed, this);\n        this.attachmentPoint.remove();\n    };\n\n    /**\n     * Sets the appropriate aria attributes on this dialogue and the other\n     * elements in the DOM to ensure that screen readers are able to navigate\n     * the dialogue popup correctly.\n     *\n     * @method accessibilityShow\n     */\n    Modal.prototype.accessibilityShow = function() {\n        // We need to get a list containing each sibling element and the shallowest\n        // non-ancestral nodes in the DOM. We can shortcut this a little by leveraging\n        // the fact that this dialogue is always appended to the document body therefore\n        // it's siblings are the shallowest non-ancestral nodes. If that changes then\n        // this code should also be updated.\n        $('body').children().each(function(index, child) {\n            // Skip the current modal.\n            if (!this.root.is(child)) {\n                child = $(child);\n                var hidden = child.attr('aria-hidden');\n                // If they are already hidden we can ignore them.\n                if (hidden !== 'true') {\n                    // Save their current state.\n                    child.data('previous-aria-hidden', hidden);\n                    this.hiddenSiblings.push(child);\n\n                    // Hide this node from screen readers.\n                    child.attr('aria-hidden', 'true');\n                }\n            }\n        }.bind(this));\n\n        // Make us visible to screen readers.\n        this.root.attr('aria-hidden', 'false');\n    };\n\n    /**\n     * Restores the aria visibility on the DOM elements changed when displaying\n     * the dialogue popup and makes the dialogue aria hidden to allow screen\n     * readers to navigate the main page correctly when the dialogue is closed.\n     *\n     * @method accessibilityHide\n     */\n    Modal.prototype.accessibilityHide = function() {\n        this.root.attr('aria-hidden', 'true');\n\n        // Restore the sibling nodes back to their original values.\n        $.each(this.hiddenSiblings, function(index, sibling) {\n            sibling = $(sibling);\n            var previousValue = sibling.data('previous-aria-hidden');\n            // If the element didn't previously have an aria-hidden attribute\n            // then we can just remove the one we set.\n            if (typeof previousValue == 'undefined') {\n                sibling.removeAttr('aria-hidden');\n            } else {\n                // Otherwise set it back to the old value (which will be false).\n                sibling.attr('aria-hidden', previousValue);\n            }\n        });\n\n        // Clear the cache. No longer need to store these.\n        this.hiddenSiblings = [];\n    };\n\n    /**\n     * Set up all of the event handling for the modal.\n     *\n     * @method registerEventListeners\n     */\n    Modal.prototype.registerEventListeners = function() {\n        this.getRoot().on('keydown', function(e) {\n            if (!this.isVisible()) {\n                return;\n            }\n\n            if (e.keyCode == KeyCodes.escape) {\n                if (this.removeOnClose) {\n                    this.destroy();\n                } else {\n                    this.hide();\n                }\n            }\n        }.bind(this));\n\n        // Listen for clicks on the modal container.\n        this.getRoot().click(function(e) {\n            // If the click wasn't inside the modal element then we should\n            // hide the modal.\n            if (!$(e.target).closest(SELECTORS.MODAL).length) {\n                // The check above fails to detect the click was inside the modal when the DOM tree is already changed.\n                // So, we check if we can still find the container element or not. If not, then the DOM tree is changed.\n                // It's best not to hide the modal in that case.\n                if ($(e.target).closest(SELECTORS.CONTAINER).length) {\n                    this.hideIfNotForm();\n                }\n            }\n        }.bind(this));\n\n        CustomEvents.define(this.getModal(), [CustomEvents.events.activate]);\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.HIDE, function(e, data) {\n            this.hide();\n            data.originalEvent.preventDefault();\n        }.bind(this));\n    };\n\n    /**\n     * Register a listener to close the dialogue when the cancel button is pressed.\n     *\n     * @method registerCloseOnCancel\n     */\n    Modal.prototype.registerCloseOnCancel = function() {\n        // Handle the clicking of the Cancel button.\n        this.getModal().on(CustomEvents.events.activate, this.getActionSelector('cancel'), function(e, data) {\n            var cancelEvent = $.Event(ModalEvents.cancel);\n            this.getRoot().trigger(cancelEvent, this);\n\n            if (!cancelEvent.isDefaultPrevented()) {\n                data.originalEvent.preventDefault();\n\n                if (this.removeOnClose) {\n                    this.destroy();\n                } else {\n                    this.hide();\n                }\n            }\n        }.bind(this));\n    };\n\n    /**\n     * Register a listener to close the dialogue when the save button is pressed.\n     *\n     * @method registerCloseOnSave\n     */\n    Modal.prototype.registerCloseOnSave = function() {\n        // Handle the clicking of the Cancel button.\n        this.getModal().on(CustomEvents.events.activate, this.getActionSelector('save'), function(e, data) {\n            var saveEvent = $.Event(ModalEvents.save);\n            this.getRoot().trigger(saveEvent, this);\n\n            if (!saveEvent.isDefaultPrevented()) {\n                data.originalEvent.preventDefault();\n\n                if (this.removeOnClose) {\n                    this.destroy();\n                } else {\n                    this.hide();\n                }\n            }\n        }.bind(this));\n    };\n\n    /**\n     * Set or resolve and set the value using the function.\n     *\n     * @method asyncSet\n     * @param {(string|object)} value The string or jQuery promise.\n     * @param {function} setFunction The setter\n     * @return {Promise}\n     */\n    Modal.prototype.asyncSet = function(value, setFunction) {\n        var p = value;\n        if (typeof value !== 'object' || !value.hasOwnProperty('then')) {\n            p = $.Deferred();\n            p.resolve(value);\n        }\n\n        p.then(function(content) {\n            setFunction(content);\n\n            return;\n        })\n        .fail(Notification.exception);\n\n        return p;\n    };\n\n    /**\n     * Set the title text of a button.\n     *\n     * This method is overloaded to take either a string value for the button title or a jQuery promise that is resolved with\n     * text most commonly from a Str.get_string call.\n     *\n     * @param {DOMString} action The action of the button\n     * @param {(String|object)} value The button text, or a promise which will resolve to it\n     * @returns {Promise}\n     */\n    Modal.prototype.setButtonText = function(action, value) {\n        const button = this.getFooter().find(this.getActionSelector(action));\n\n        if (!button) {\n            throw new Error(\"Unable to find the '\" + action + \"' button\");\n        }\n\n        return this.asyncSet(value, button.text.bind(button));\n    };\n\n    /**\n     * Get the Selector for an action.\n     *\n     * @param {String} action\n     * @returns {DOMString}\n     */\n    Modal.prototype.getActionSelector = function(action) {\n        return \"[data-action='\" + action + \"']\";\n    };\n\n    /**\n     * Set the flag to remove the modal from the DOM on close.\n     *\n     * @param {Boolean} remove\n     */\n    Modal.prototype.setRemoveOnClose = function(remove) {\n        this.removeOnClose = remove;\n    };\n\n    return Modal;\n});\n"],"names":["define","$","Templates","Notification","KeyCodes","CustomEvents","ModalBackdrop","Event","ModalEvents","FocusLock","Pending","Fullscreen","backdropPromise","SELECTORS","TEMPLATES","modalCounter","Modal","root","this","modal","find","header","headerPromise","Deferred","title","titlePromise","body","bodyPromise","footer","footerPromise","hiddenSiblings","isAttached","bodyJS","footerJS","modalCount","attachmentPoint","document","createElement","append","is","exception","message","length","registerEventListeners","prototype","attachToDOM","getAttachmentPoint","trapFocus","runTemplateJS","countOtherVisibleModals","count","each","index","element","hasClass","bind","getBackdrop","render","then","html","fail","getRoot","getModal","getTitle","getBody","getFooter","getTitlePromise","getBodyPromise","getFooterPromise","getModalCount","setTitle","value","asyncSet","resolve","catch","setBody","notifyFilterContentUpdated","trigger","bodyRendered","jsPendingId","M","util","js_pending","contentPromise","css","when","state","height","innerHeight","animate","loadingIcon","hide","fadeIn","promise","fadeOut","js","result","isVisible","currentHeight","newHeight","opacity","duration","queue","always","js_complete","setFooter","showFooter","hasFooterContent","children","hideFooter","addClass","removeClass","setLarge","isLarge","setSmall","isSmall","calculateZIndex","items","zIndex","parseInt","item","itemZIndex","hasFocus","target","activeElement","has","hasTransitions","getElement","show","pendingPromise","backdrop","newIndex","newBackdropIndex","setZIndex","accessibilityShow","focus","shown","hideIfNotForm","done","untrapFocus","currentIndex","accessibilityHide","one","hidden","destroy","remove","destroyed","child","attr","data","push","sibling","previousValue","removeAttr","on","e","keyCode","escape","removeOnClose","click","closest","events","activate","originalEvent","preventDefault","registerCloseOnCancel","getActionSelector","cancelEvent","cancel","isDefaultPrevented","registerCloseOnSave","saveEvent","save","setFunction","p","_typeof","hasOwnProperty","content","setButtonText","action","button","Error","text","setRemoveOnClose"],"mappings":"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"}