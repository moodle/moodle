/**
 * @copyright  Pimenko 2019
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_pimenko/catalog",["jquery","core/ajax","core/templates","core/config"],(function($,ajax,templates,cfg){const categorySelect=$("#page-course-index-category .categoryselect .urlselect .custom-select"),tagSelect=$("#page-course-index-category .tagselect .urlselect .custom-select"),categorySearch=$("#page-course-index-category .searchcourse form.simplesearchform input"),categoryidselect=$("input[name='categoryid']"),customfieldSearch=$("#page-course-index-category .customfieldsearch form"),customfieldDate=$("#page-course-index-category .customfielddate form select"),customfieldSelect=$("#page-course-index-category .customfieldselect form select"),resetbutton=$("#page-course-index-category button.btn[data-filteraction='reset']"),endQuery=function(nbCourses){categorySelect.removeAttr("disabled"),tagSelect.removeAttr("disabled"),categorySearch.removeAttr("disabled"),customfieldSearch.removeAttr("disabled"),customfieldDate.removeAttr("disabled"),customfieldSelect.removeAttr("disabled"),resetbutton.removeAttr("disabled"),$("#course-gallery").attr("style","opacity: 1;"),$("#loader-gallery").attr("style","display: none;");let buttonLoadMore=$("#load-more");nbCourses>12&&buttonLoadMore.show(),buttonLoadMore.click((function(){let courses=document.getElementsByClassName("course-gallery"),nbCourseMore=1;for(let i in courses)if("none"===courses.item(parseInt(i)).style.display){if(!(nbCourseMore<=6))break;courses.item(parseInt(i)).style.display="flex",parseInt(i)===courses.length-1&&$("#load-more").hide(),nbCourseMore++}}))},eventcatalog=function(){categorySelect.change((function(){let href=categorySelect.val();categorySearch.val(""),document.location.href="all"!==href?href:"/course/index.php"})),customfieldSearch.submit((function(event){event.preventDefault(),event.stopPropagation();let href=this.action,value=this.querySelector("input").value;""===value?(href+="&customfieldvalue=all",document.location.href=href):(href=href+"&customfieldvalue="+value,document.location.href=href)})),customfieldDate.change((function(){let parent=this.form,datevalues=new FormData(parent),href=parent.action,categoryid=!1;categoryidselect&&(categoryid=categoryidselect.val()),href=href+"?customfieldselected="+parent.closest(".customfielddate").dataset.name+"&day="+datevalues.get("date_selector[day]")+"&month="+datevalues.get("date_selector[month]")+"&year="+datevalues.get("date_selector[year]"),categoryid&&(href=href+"&categoryid="+categoryid),document.location.href=href})),resetbutton.click((function(){document.location.href="/course/index.php?categoryid="+categoryidselect.val()})),$("#page-course-index-category .searchcourse form.simplesearchform").submit((function(event){event.preventDefault(),event.stopPropagation();let categoryid=0;categoryidselect&&(categoryid=categoryidselect.val());let searchargs={criterianame:"search",criteriavalue:categorySearch.val(),categoryid:categoryid,page:0,perpage:100},promises=ajax.call([{methodname:"theme_pimenko_search_courses",args:searchargs}]);categorySelect.attr("disabled","true"),tagSelect.attr("disabled","true"),categorySearch.attr("disabled","true"),customfieldSearch.attr("disabled","true"),customfieldDate.attr("disabled","true"),customfieldSelect.attr("disabled","true"),resetbutton.attr("disabled","true"),$("#course-gallery").attr("style","opacity: 0.25;"),$("#loader-gallery").attr("style","display: flex;"),promises[0].done((function(response){tagSelect.prop("selectedIndex",0),customfieldSearch.prop("selectedIndex",0),customfieldDate.prop("selectedIndex",0),customfieldSelect.prop("selectedIndex",0),function(response){if(void 0!==response){let toDestroy,courses=response.courses,nbCourse=1,template={};for(let i in courses)courses[i].overviewfiles[0]&&courses[i].overviewfiles[0].fileurl&&(courses[i].urlimg=courses[i].overviewfiles[0].fileurl.replace("webservice/","")),courses[i].name=courses[i].fullname,courses[i].category=courses[i].categoryname,courses[i].rootpath=cfg.wwwroot,courses[i].enrollmentmethods.includes("synopsispaypal")?courses[i].url=cfg.wwwroot+"/enrol/synopsispaypal/index.php?id="+courses[i].id:courses[i].enrollmentmethods.includes("synopsis")?courses[i].url=cfg.wwwroot+"/enrol/synopsis/index.php?id="+courses[i].id:courses[i].url=cfg.wwwroot+"/course/view.php?id="+courses[i].id,courses[i].display=nbCourse<=12?"flex":"none",nbCourse++,1===courses[i].id&&(toDestroy=i);toDestroy&&courses.splice(toDestroy,1),courses.length>12&&(template.loadmore=!0),template.courses=courses,templates.render("theme_pimenko/course_gallery",template,"theme_pimenko").then((function(html){document.getElementsByClassName("course-gallery-container")[0].innerHTML=String(html),endQuery(courses.length)})).catch((function(ex){console.error(ex),endQuery()}))}}(response)})).fail((function(ex){console.error("search_courses : "+ex)}))})),$("#load-more").click((function(){let courses=document.getElementsByClassName("course-gallery"),nbCourseMore=1;for(let i in courses)if("none"===courses.item(parseInt(i)).style.display){if(!(nbCourseMore<=12))break;courses.item(parseInt(i)).style.display="flex",parseInt(i)===courses.length-1&&$("#load-more").hide(),nbCourseMore++}}))};return{init:function(){eventcatalog()}}}));

//# sourceMappingURL=catalog.min.js.map