define("theme_snap/sharing_cart",["exports","jquery"],(function(_exports,_jquery){var obj;function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};return _exports.default=class{constructor(courseSections){_defineProperty(this,"str",(identifier=>M.str.block_sharing_cart[identifier]||M.str.moodle[identifier])),_defineProperty(this,"setCreateCommand",(create_command=>{this.create_command=create_command})),_defineProperty(this,"create_special_activity_command",((cssClass,title,imageUrl)=>(0,_jquery.default)('<a href="javascript:void(0)"/>').addClass(cssClass).addClass("dropdown-item menu-action cm-edit-action").attr("title",title).append((0,_jquery.default)('<img class="icon"/>').attr("alt",title).attr("src",imageUrl)))),_defineProperty(this,"addSpinner",(spinner=>{this.snapSpinner?this.snapSpinner.show():this.snapSpinner=spinner})),_defineProperty(this,"hideSpinner",(()=>{this.snapSpinner&&this.snapSpinner.hide()})),_defineProperty(this,"onRestore",(input=>{const restore_targets=input.restore_targets,course=input.course,param=input.param,get_action_url=input.get_action_url,ModalFactory=input.ModalFactory,ModalEvents=input.ModalEvents,id=input.id;var sectionsURLs=[];this.courseSections.forEach((function(section){var urlArray={directory:restore_targets.is_directory,target:id,course:course.id,section:section.num,sesskey:M.cfg.sesskey};urlArray[param]=id;var url=get_action_url("restore",urlArray),sectionName=null;null===section.name?(0,_jquery.default)("#chapters").find(".chapter-title").each((function(){(0,_jquery.default)(this).attr("href")=="#section-"+section.num&&(sectionName=(0,_jquery.default)(this).text())})):sectionName=section.name;var sectionURL={name:sectionName,url:url};sectionsURLs.push(sectionURL)})),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:M.str.block_sharing_cart.restore,body:(sections=>{var s=M.str.block_sharing_cart.snap_dialog_restore;s+='<select id="select-dialog" class="custom-select">';for(var i=0;i<sections.length;i++)s+='<option value="'+sections[i].url+'">'+sections[i].name+"</option>";return s+="</select> <br> <br>"})(sectionsURLs)}).done((function(modal){modal.show(),modal.getRoot().on(ModalEvents.save,(function(){window.location.href=(0,_jquery.default)("#select-dialog").val()})),modal.getRoot().on(ModalEvents.cancel,(function(){modal.destroy()}))}))})),_defineProperty(this,"add_backup_command",(($activity,iconBackup,on_backup)=>{var $menu=$activity.find("ul[role='menu']");if($menu.length){var li=$menu.find("li").first().clone(),$backup=li.find("a").attr("title",this.str("backup")).attr("href","javascript:void(0)");li.find("img").length?li.find("img").attr("alt",this.str("backup")).attr("title",this.str("backup")).attr("src",M.util.image_url(iconBackup.pix)):li.find("i").attr("class","icon fa fa-upload").attr("title",this.str("backup")).attr("aria-label",this.str("backup")),li.find("span").html(this.str("backup")),$menu.append(li)}else{$backup=this.create_command("backup");if(($menu=(0,_jquery.default)("#page-course-view-tiles").length?$activity.find('div[role="menu"]'):$activity.find("div.snap-edit-more-dropdown ul.dropdown-menu")).length){const cssClass=iconBackup.css,title=this.str("backup"),imageUrl=M.util.image_url(iconBackup.pix);if($backup=this.create_special_activity_command(cssClass,title,imageUrl),"none"===$menu.css("display"))0==$menu.find(".editing_backup").length&&($menu.append($backup),$backup.append((0,_jquery.default)("<span class='menu-action-text'/>").append($backup.attr("title"))))}else $activity.find(".commands").append($backup)}var activityClass=$activity[0].className,modtype=activityClass.substr(activityClass.indexOf("modtype_")+8),activityName=this.str("activity_string");"label"!==modtype&&(activityName=(0,_jquery.default)(".activity#"+$activity[0].id).find(".activityinstance p.instancename").html()),$backup.click((function(e){on_backup(e,activityName)}))})),_defineProperty(this,"snapFix",(input=>{const course=input.course,iconBackup=input.iconBackup,on_section_backup=input.on_section_backup,on_backup=input.on_backup,_this=this;if(course.is_frontpage){if((0,_jquery.default)(".sitetopic li.activity").length>0)"done"!==(0,_jquery.default)(".sitetopic li.activity").data("block-sharing-cart")&&((0,_jquery.default)(".sitetopic li.activity").each((function(){_this.add_backup_command((0,_jquery.default)(this),iconBackup,on_backup)})),(0,_jquery.default)(".sitetopic li.activity").data("block-sharing-cart","done"));if((0,_jquery.default)(".block_site_main_menu").length>0)"done"!==(0,_jquery.default)(".block_site_main_menu .content > ul >  li").data("block-sharing-cart")&&((0,_jquery.default)(".block_site_main_menu .content > ul >  li").each((function(){_this.add_backup_command((0,_jquery.default)(this),iconBackup,on_backup)})),(0,_jquery.default)(".block_site_main_menu .content > ul >  li").data("block-sharing-cart","done"))}else{if((0,_jquery.default)(".course-content li.activity").length>0)"done"===(0,_jquery.default)(".course-content li.activity").data("block-sharing-cart")&&1!=this.courseSections.length||((0,_jquery.default)(".course-content li.activity").each((function(){_this.add_backup_command((0,_jquery.default)(this),iconBackup,on_backup)})),(0,_jquery.default)(".course-content li.activity").data("block-sharing-cart","done"))}if("snap"!==M.cfg.theme){let _this=this;(0,_jquery.default)("li.section").each((function(){var sectionID=(0,_jquery.default)(this).find("div.content h3.sectionname span.inplaceeditable").attr("data-itemid"),$menu=(0,_jquery.default)(this).find("ul[role='menu']").first();if($menu.length){var li=$menu.find("li").first().clone(),img=li.find("img");img.length?img.attr("alt",_this.str("backup")).attr("title",_this.str("backup")).attr("src",M.util.image_url(iconBackup.pix,null)):li.find("i").attr("class","icon fa fa-upload").attr("title",_this.str("backup")).attr("aria-label",_this.str("backup")),li.find("span").html(_this.str("backup")),li.find("a").attr("href","javascript:void(0)"),$menu.append(li),li.find("a").click((function(){on_section_backup(sectionID)}))}else{var $backup=null;if(($menu=(0,_jquery.default)(this).find("div[role='menu']").first()).length){const cssClass=iconBackup.css,title=_this.str("backup"),imageUrl=M.util.image_url(iconBackup.pix);$backup=_this.create_special_activity_command(cssClass,title,imageUrl),$menu.append($backup.attr("role","menuitem")),"none"===$menu.css("display")&&$backup.append((0,_jquery.default)("<span class='menu-action-text'/>").append($backup.attr("title")))}else $backup=_this.create_command("backup"),(0,_jquery.default)(this).find(".commands").append($backup);$backup.click((function(){on_section_backup(sectionID)}))}}))}else _jquery.default.each((0,_jquery.default)("a.snap-delete"),(function(i,val){var sectionID=(0,_jquery.default)(val).attr("href").split("?")[1].split("&")[0].split("=")[1],$link=(0,_jquery.default)("<a/>").attr("class","snap-sharing-cart").attr("role","button").attr("id",sectionID);$link.attr("tabindex","0").attr("title","Backup Section"),0==(0,_jquery.default)(val).parent().find("a.snap-sharing-cart").length&&(0,_jquery.default)(val).parent().append($link)})),(0,_jquery.default)("a.snap-sharing-cart").unbind().click((function(){const sectionId=(0,_jquery.default)(this).attr("id"),section=_this.courseSections?_this.courseSections.find((section=>section.id===sectionId)):{num:0,name:void 0},sectionNumber=section.num,courseId=course.id,sectionName=null===section.name?void 0:section.name;on_section_backup(sectionId,sectionNumber,courseId,sectionName)}))})),this.snapSpinner="",this.courseSections=courseSections}},_exports.default}));

//# sourceMappingURL=sharing_cart.min.js.map