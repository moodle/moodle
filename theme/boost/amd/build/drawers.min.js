function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("theme_boost/drawers",["exports","core/modal_backdrop","core/templates","core/aria","core/event_dispatcher","core/utils","core/pending","jquery"],(function(_exports,_modal_backdrop,_templates,Aria,_event_dispatcher,_utils,_pending,_jquery){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modal_backdrop=_interopRequireDefault(_modal_backdrop),_templates=_interopRequireDefault(_templates),Aria=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Aria),_pending=_interopRequireDefault(_pending),_jquery=_interopRequireDefault(_jquery);var backdropPromise=null,drawerMap=new Map,SELECTORS_BUTTONS='[data-toggler="drawers"]',SELECTORS_CLOSEBTN='[data-toggler="drawers"][data-action="closedrawer"]',SELECTORS_OPENBTN='[data-toggler="drawers"][data-action="opendrawer"]',SELECTORS_TOGGLEBTN='[data-toggler="drawers"][data-action="toggle"]',SELECTORS_DRAWERS='[data-region="fixed-drawer"]',SELECTORS_CONTAINER="#page.drawers",SELECTORS_DRAWERCONTENT=".drawercontent",CLASSES_SCROLLED="scrolled",CLASSES_SHOW="show",CLASSES_NOTINITIALISED="not-initialized",sizes_medium=991,sizes_large=1400,getCurrentWidth=function(){var DomRect=document.body.getBoundingClientRect();return DomRect.x+DomRect.width},isSmall=function(){return getCurrentWidth()<sizes_medium},getBackdrop=function(){return backdropPromise||(backdropPromise=_templates.default.render("core/modal_backdrop",{}).then((function(html){return new _modal_backdrop.default(html)})).then((function(modalBackdrop){return modalBackdrop.getAttachmentPoint().get(0).addEventListener("click",(function(e){e.preventDefault(),Drawers.closeAllDrawers()})),modalBackdrop})).catch()),backdropPromise},getDrawerOpenButton=function(drawerId){var openButton=document.querySelector("".concat(SELECTORS_OPENBTN,'[data-target="').concat(drawerId,'"]'));return openButton||(openButton=document.querySelector("".concat(SELECTORS_TOGGLEBTN,'[data-target="').concat(drawerId,'"]'))),openButton},disableDrawerTooltips=function(drawerNode){[drawerNode.querySelector(SELECTORS_CLOSEBTN),getDrawerOpenButton(drawerNode.id)].forEach((function(button){button&&disableButtonTooltip(button)}))},disableButtonTooltip=function(button,enableOnBlur){button.hasAttribute("data-original-title")?((0,_jquery.default)(button).tooltip("disable"),button.setAttribute("title",button.dataset.originalTitle)):(button.dataset.disabledToggle=button.dataset.toggle,button.removeAttribute("data-toggle")),enableOnBlur&&(button.dataset.restoreTooltipOnBlur=!0)},enableButtonTooltip=function(button){button.hasAttribute("data-original-title")?((0,_jquery.default)(button).tooltip("enable"),button.removeAttribute("title")):button.dataset.disabledToggle&&(button.dataset.toggle=button.dataset.disabledToggle,(0,_jquery.default)(button).tooltip()),delete button.dataset.restoreTooltipOnBlur},Drawers=function(){function Drawers(drawerNode){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Drawers),_defineProperty(this,"drawerNode",null),this.drawerNode=drawerNode,isSmall()&&this.closeDrawer({focusOnOpenButton:!1,updatePreferences:!1}),this.drawerNode.classList.contains(CLASSES_SHOW)?this.openDrawer({focusOnCloseButton:!1}):1==this.drawerNode.dataset.forceopen?isSmall()||this.openDrawer({focusOnCloseButton:!1}):Aria.hide(this.drawerNode),isSmall()&&disableDrawerTooltips(this.drawerNode),function(drawerNode){var content=drawerNode.querySelector(SELECTORS_DRAWERCONTENT);content&&content.addEventListener("scroll",(function(){drawerNode.classList.toggle(CLASSES_SCROLLED,0!=content.scrollTop)}))}(this.drawerNode),drawerMap.set(drawerNode,this),drawerNode.classList.remove(CLASSES_NOTINITIALISED)}var Constructor,protoProps,staticProps;return Constructor=Drawers,protoProps=[{key:"isOpen",get:function(){return this.drawerNode.classList.contains(CLASSES_SHOW)}},{key:"closeOnResize",get:function(){return!!parseInt(this.drawerNode.dataset.closeOnResize)}},{key:"dispatchEvent",value:function(eventname){var cancelable=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,_event_dispatcher.dispatchEvent)(eventname,{drawerInstance:this},this.drawerNode,{cancelable:cancelable})}},{key:"openDrawer",value:function(){var _this$drawerNode$quer,_ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$focusOnCloseButt=_ref.focusOnCloseButton,focusOnCloseButton=void 0===_ref$focusOnCloseButt||_ref$focusOnCloseButt,pendingPromise=new _pending.default("theme_boost/drawers:open"),showEvent=this.dispatchEvent(Drawers.eventTypes.drawerShow,!0);if(!showEvent.defaultPrevented){null===(_this$drawerNode$quer=this.drawerNode.querySelector(SELECTORS_CLOSEBTN))||void 0===_this$drawerNode$quer||_this$drawerNode$quer.classList.toggle("hidden",!0);var _jQuery,openButton=getDrawerOpenButton(this.drawerNode.id);openButton&&openButton.hasAttribute("data-original-title")&&(null===(_jQuery=(0,_jquery.default)(openButton))||void 0===_jQuery||_jQuery.tooltip("hide")),Aria.unhide(this.drawerNode),this.drawerNode.classList.add(CLASSES_SHOW);var preference=this.drawerNode.dataset.preference;preference&&!isSmall()&&1!=this.drawerNode.dataset.forceopen&&M.util.set_user_preference(preference,!0);var state=this.drawerNode.dataset.state;if(state){var page=document.getElementById("page");page.classList.add(state)}isSmall()&&getBackdrop().then((function(backdrop){return backdrop.show(),document.getElementById("page-wrapper").style.overflow="hidden",backdrop})).catch();var closeButton=this.drawerNode.querySelector(SELECTORS_CLOSEBTN);focusOnCloseButton&&closeButton&&disableButtonTooltip(closeButton,!0),setTimeout((function(){closeButton.classList.toggle("hidden",!1),focusOnCloseButton&&closeButton.focus(),pendingPromise.resolve()}),300),this.dispatchEvent(Drawers.eventTypes.drawerShown)}}},{key:"closeDrawer",value:function(){var _ref2=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref2$focusOnOpenButt=_ref2.focusOnOpenButton,focusOnOpenButton=void 0===_ref2$focusOnOpenButt||_ref2$focusOnOpenButt,_ref2$updatePreferenc=_ref2.updatePreferences,updatePreferences=void 0===_ref2$updatePreferenc||_ref2$updatePreferenc,pendingPromise=new _pending.default("theme_boost/drawers:close"),hideEvent=this.dispatchEvent(Drawers.eventTypes.drawerHide,!0);if(!hideEvent.defaultPrevented){var _jQuery2,closeButton=this.drawerNode.querySelector(SELECTORS_CLOSEBTN);null==closeButton||closeButton.classList.toggle("hidden",!0),closeButton.hasAttribute("data-original-title")&&(null===(_jQuery2=(0,_jquery.default)(closeButton))||void 0===_jQuery2||_jQuery2.tooltip("hide"));var preference=this.drawerNode.dataset.preference;preference&&updatePreferences&&!isSmall()&&M.util.set_user_preference(preference,!1);var state=this.drawerNode.dataset.state;if(state){var page=document.getElementById("page");page.classList.remove(state)}Aria.hide(this.drawerNode),this.drawerNode.classList.remove(CLASSES_SHOW),getBackdrop().then((function(backdrop){return backdrop.hide(),isSmall()&&(document.getElementById("page-wrapper").style.overflow="auto"),backdrop})).catch();var openButton=getDrawerOpenButton(this.drawerNode.id);openButton&&disableButtonTooltip(openButton,!0),setTimeout((function(){openButton&&focusOnOpenButton&&openButton.focus(),pendingPromise.resolve()}),300),this.dispatchEvent(Drawers.eventTypes.drawerHidden)}}},{key:"toggleVisibility",value:function(){this.drawerNode.classList.contains(CLASSES_SHOW)?this.closeDrawer():this.openDrawer()}}],staticProps=[{key:"getDrawerInstanceForNode",value:function(drawerNode){return drawerMap.has(drawerNode)||new Drawers(drawerNode),drawerMap.get(drawerNode)}},{key:"closeAllDrawers",value:function(){drawerMap.forEach((function(drawerInstance){drawerInstance.closeDrawer()}))}},{key:"closeOtherDrawers",value:function(comparisonInstance){drawerMap.forEach((function(drawerInstance){drawerInstance!==comparisonInstance&&drawerInstance.closeDrawer()}))}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Drawers}();_exports.default=Drawers,_defineProperty(Drawers,"eventTypes",{drawerShow:"theme_boost/drawers:show",drawerShown:"theme_boost/drawers:shown",drawerHide:"theme_boost/drawers:hide",drawerHidden:"theme_boost/drawers:hidden"});var body,drawerLayout,setLastUsedToggle=function(toggleButton){toggleButton.dataset.target&&(document.querySelectorAll("".concat(SELECTORS_BUTTONS,'[data-target="').concat(toggleButton.dataset.target,'"]')).forEach((function(btn){btn.dataset.lastused=!1})),toggleButton.dataset.lastused=!0)};return body=document.querySelector("body"),(drawerLayout=document.querySelector(SELECTORS_CONTAINER))&&drawerLayout.addEventListener("scroll",(function(){drawerLayout.scrollTop>=window.innerHeight?body.classList.add(CLASSES_SCROLLED):body.classList.remove(CLASSES_SCROLLED)})),function(){document.addEventListener("click",(function(e){var toggleButton=e.target.closest(SELECTORS_TOGGLEBTN);if(toggleButton&&toggleButton.dataset.target){e.preventDefault();var targetDrawer=document.getElementById(toggleButton.dataset.target),drawerInstance=Drawers.getDrawerInstanceForNode(targetDrawer);setLastUsedToggle(toggleButton),drawerInstance.toggleVisibility()}var openDrawerButton=e.target.closest(SELECTORS_OPENBTN);if(openDrawerButton&&openDrawerButton.dataset.target){e.preventDefault();var _targetDrawer=document.getElementById(openDrawerButton.dataset.target),_drawerInstance=Drawers.getDrawerInstanceForNode(_targetDrawer);setLastUsedToggle(toggleButton),_drawerInstance.openDrawer()}var target,lastUsedButton,closeDrawerButton=e.target.closest(SELECTORS_CLOSEBTN);if(closeDrawerButton&&closeDrawerButton.dataset.target){e.preventDefault();var _targetDrawer2=document.getElementById(closeDrawerButton.dataset.target);Drawers.getDrawerInstanceForNode(_targetDrawer2).closeDrawer(),target=closeDrawerButton.dataset.target,(lastUsedButton=document.querySelector("".concat(SELECTORS_BUTTONS,'[data-target="').concat(target,'"][data-lastused="true"')))&&lastUsedButton.focus()}})),document.addEventListener(Drawers.eventTypes.drawerShow,(function(e){getCurrentWidth()>=sizes_large||Drawers.closeOtherDrawers(e.detail.drawerInstance)}));var btnSelector="".concat(SELECTORS_TOGGLEBTN,", ").concat(SELECTORS_OPENBTN,", ").concat(SELECTORS_CLOSEBTN);document.addEventListener("focusout",(function(e){var button=e.target.closest(btnSelector);void 0!==(null==button?void 0:button.dataset.restoreTooltipOnBlur)&&enableButtonTooltip(button)}));window.addEventListener("resize",(0,_utils.debounce)((function(){if(isSmall()){var anyOpen=!1;drawerMap.forEach((function(drawerInstance){disableDrawerTooltips(drawerInstance.drawerNode),drawerInstance.isOpen&&(drawerInstance.closeOnResize?drawerInstance.closeDrawer():anyOpen=!0)})),anyOpen&&getBackdrop().then((function(backdrop){return backdrop.show()})).catch()}else drawerMap.forEach((function(drawerInstance){var drawerNode;[(drawerNode=drawerInstance.drawerNode).querySelector(SELECTORS_CLOSEBTN),getDrawerOpenButton(drawerNode.id)].forEach((function(button){button&&enableButtonTooltip(button)}))})),getBackdrop().then((function(backdrop){return backdrop.hide()})).catch()}),400))}(),document.querySelectorAll(SELECTORS_DRAWERS).forEach((function(drawerNode){return Drawers.getDrawerInstanceForNode(drawerNode)})),_exports.default}));

//# sourceMappingURL=drawers.min.js.map