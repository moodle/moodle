function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("core_reportbuilder/audience",["exports","core/templates","core/notification","core/pending","core/prefetch","core/str","core_form/dynamicform","core/toast","core_reportbuilder/local/repository/audiences","core_reportbuilder/local/selectors","core/fragment","core_form/changechecker"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=o(b);c=o(c);d=o(d);g=o(g);j=n(j);function m(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;m=function(){return a};return a}function n(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=m();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function o(a){return a&&a.__esModule?a:{default:a}}var p=0,q=0,r=function(a,e){var g=new d.default("core_reportbuilder/audience:add"),i=document.querySelector(j.regions.audiencesContainer),m=i.querySelectorAll(j.regions.audienceCard).length,n={classname:a,reportid:p,showormessage:0<m,title:e};(0,k.loadFragment)("core_reportbuilder","audience_form",q,n).then(function(a,c){var d=b.default.appendNodeContents(i,a,c)[0],g=i.querySelector(j.regions.audienceEmptyMessage),h=t(d);(0,l.markFormAsDirty)(h.getFormNode());g.classList.add("hidden");return(0,f.get_string)("audienceadded","core_reportbuilder",e)}).then(h.add).then(function(){return g.resolve()}).catch(c.default.exception)},s=function(a){var b=new d.default("core_reportbuilder/audience:edit"),e=t(a),f={reportid:p,id:a.dataset.instanceid,classname:a.dataset.classname};e.load(f).then(function(){var c=a.querySelector(j.regions.audienceFormContainer),d=a.querySelector(j.regions.audienceDescription),e=a.querySelector(j.actions.audienceEdit);c.classList.remove("hidden");d.classList.add("hidden");e.disabled=!0;return b.resolve()}).catch(c.default.exception)},t=function(a){var b=a.querySelector(j.regions.audienceFormContainer),c=new g.default(b,"\\core_reportbuilder\\form\\audience");c.addEventListener(c.events.FORM_SUBMITTED,function(b){var c=a.querySelector(j.regions.audienceDescription);a.dataset.instanceid=b.detail.instanceid;c.innerHTML=b.detail.description;v(a);return(0,f.get_string)("audiencesaved","core_reportbuilder").then(h.add)});c.addEventListener(c.events.FORM_CANCELLED,function(){if(0<a.dataset.instanceid){v(a)}else{w(a)}});return c},u=function(a){var b=a.dataset.title;c.default.saveCancelPromise((0,f.get_string)("deleteaudience","core_reportbuilder",b),(0,f.get_string)("deleteaudienceconfirm","core_reportbuilder",b),(0,f.get_string)("delete","core")).then(function(){var e=new d.default("core_reportbuilder/audience:delete");return(0,i.deleteAudience)(p,a.dataset.instanceid).then(function(){return(0,h.add)((0,f.get_string)("audiencedeleted","core_reportbuilder",b))}).then(function(){w(a);return e.resolve()}).catch(c.default.exception)}).catch(function(){})},v=function(a){var b=a.querySelector(j.regions.audienceFormContainer),c=b.cloneNode(!1);a.querySelector(j.regions.audienceForm).replaceChild(c,b);a.querySelector(j.regions.audienceDescription).classList.remove("hidden");a.querySelector(j.actions.audienceEdit).disabled=!1;a.querySelector(j.actions.audienceDelete).disabled=!1},w=function(a){a.remove();var b=document.querySelector(j.regions.audiencesContainer),c=b.querySelectorAll(j.regions.audienceCard);if(0===c.length){var d=document.querySelector(j.regions.audienceEmptyMessage);d.classList.remove("hidden")}else{var e=c[0].querySelector(".audience-separator");null===e||void 0===e?void 0:e.remove()}},x=!1,y=function(a,b){(0,e.prefetchStrings)("core_reportbuilder",["audienceadded","audiencedeleted","audiencesaved","deleteaudience","deleteaudienceconfirm"]);(0,e.prefetchStrings)("core",["delete"]);p=a;q=b;if(x){return}document.addEventListener("click",function(a){var b=a.target.closest(j.actions.audienceAdd);if(b){a.preventDefault();r(b.dataset.uniqueIdentifier,b.dataset.name)}var c=a.target.closest(j.actions.audienceEdit);if(c){var e=c.closest(j.regions.audienceCard);a.preventDefault();s(e)}var d=a.target.closest(j.actions.audienceDelete);if(d){var f=d.closest(j.regions.audienceCard);a.preventDefault();u(f)}});x=!0};a.init=y});
//# sourceMappingURL=audience.min.js.map
